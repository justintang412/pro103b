(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40ac5d65"],{"032e":function(t,e,i){},"33ea":function(t,e,i){},"361c":function(t,e,i){"use strict";i("032e")},"382b":function(t,e,i){"use strict";i("7b76")},"408a":function(t,e,i){var s=i("e330");t.exports=s(1..valueOf)},"40db":function(t,e,i){},"434f":function(t,e,i){},"498a":function(t,e,i){"use strict";var s=i("23e7"),a=i("58a8").trim,n=i("c8d2");s({target:"String",proto:!0,forced:n("trim")},{trim:function(){return a(this)}})},5873:function(t,e,i){"use strict";i("434f")},"623b":function(t,e,i){"use strict";i("f0f0")},6276:function(t,e){t.exports="data:image/jpeg;base64,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"},"7b76":function(t,e,i){},a9e3:function(t,e,i){"use strict";var s=i("83ab"),a=i("da84"),n=i("e330"),r=i("94ca"),o=i("6eeb"),l=i("1a2d"),c=i("7156"),u=i("3a9b"),d=i("d9b5"),m=i("c04e"),f=i("d039"),p=i("241c").f,h=i("06cf").f,v=i("9bf2").f,g=i("408a"),_=i("58a8").trim,b="Number",C=a[b],y=C.prototype,I=a.TypeError,A=n("".slice),x=n("".charCodeAt),k=function(t){var e=m(t,"number");return"bigint"==typeof e?e:E(e)},E=function(t){var e,i,s,a,n,r,o,l,c=m(t,"number");if(d(c))throw I("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=_(c),e=x(c,0),43===e||45===e){if(i=x(c,2),88===i||120===i)return NaN}else if(48===e){switch(x(c,1)){case 66:case 98:s=2,a=49;break;case 79:case 111:s=8,a=55;break;default:return+c}for(n=A(c,2),r=n.length,o=0;o<r;o++)if(l=x(n,o),l<48||l>a)return NaN;return parseInt(n,s)}return+c};if(r(b,!C(" 0o1")||!C("0b1")||C("+0x1"))){for(var w,O=function(t){var e=arguments.length<1?0:C(k(t)),i=this;return u(y,i)&&f((function(){g(i)}))?c(Object(e),i,O):e},j=s?p(C):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),S=0;j.length>S;S++)l(C,w=j[S])&&!l(O,w)&&v(O,w,h(C,w));O.prototype=y,y.constructor=O,o(a,b,O)}},c740:function(t,e,i){"use strict";var s=i("23e7"),a=i("b727").findIndex,n=i("44d2"),r="findIndex",o=!0;r in[]&&Array(1)[r]((function(){o=!1})),s({target:"Array",proto:!0,forced:o},{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n(r)},c8d2:function(t,e,i){var s=i("5e77").PROPER,a=i("d039"),n=i("5899"),r="​᠎";t.exports=function(t){return a((function(){return!!n[t]()||r[t]()!==r||s&&n[t].name!==t}))}},dabe:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-popover",{on:{show:t.getTemplate,hide:t.onReset},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("el-link",{staticStyle:{"font-size":"14px"},attrs:{slot:"reference",type:"text",icon:"el-icon-chat-line-square"},slot:"reference"},[t._v(t._s(t.SmsBtntext))]),i("div",{staticStyle:{width:"365px",padding:"10px"}},[i("h3",{staticStyle:{"font-size":"16px","margin-bottom":"15px"}},[t._v("发送短信")]),i("el-input",{attrs:{placeholder:"请输入手机号码"},model:{value:t.form.numList,callback:function(e){t.$set(t.form,"numList",e)},expression:"form.numList"}}),i("h4",{staticStyle:{"font-size":"14px",margin:"10px 0"}},[t._v("选择模板")]),i("el-select",{on:{change:t.changeTemplate},model:{value:t.form.templateId,callback:function(e){t.$set(t.form,"templateId",e)},expression:"form.templateId"}},t._l(t.templateData,(function(t){return i("el-option",{key:t.templateId,attrs:{value:t.templateId,label:t.templateName}})})),1),i("div",{staticStyle:{"margin-top":"10px"}},[i("el-input",{attrs:{type:"textarea",rows:"8",disabled:""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),i("div",{staticStyle:{"text-align":"right"}},[t._v(t._s(t.charCount))])],1),i("el-checkbox",{staticStyle:{margin:"10px 0 50px"},model:{value:t.isClose,callback:function(e){t.isClose=e},expression:"isClose"}},[t._v("发送后关闭窗口")]),i("div",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSend(t.form)}}},[t._v("发送")]),i("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("关闭")])],1)],1)],1)},a=[],n=i("5530"),r=i("1da1"),o=(i("96cf"),i("99af"),i("4de4"),i("d3b7"),i("7db0"),i("ac1f"),i("00b4"),{name:"UiSmsSend",props:["phone","SmsBtntext"],data:function(){return{visible:!1,form:{content:"",numList:this.phone},userData:this.$store.state.userData,templateData:[],isClose:!1}},computed:{charCount:function(){var t=this.form.content||"",e=t.length,i=e>70?Math.ceil(e/67):1;return"".concat(e,"字/").concat(i,"条")}},methods:{onReset:function(){this.form={content:"",numList:this.phone}},getTemplate:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$post("/message/template/getMessageTemplate",{entId:t.userData.entid});case 2:i=e.sent,s=i.data,t.templateData=s.list.filter((function(t){return 1===+t.templateStatus}));case 5:case"end":return e.stop()}}),e)})))()},changeTemplate:function(t){var e=this.templateData.find((function(e){return e.templateId===t}));this.form=Object(n["a"])(Object(n["a"])({},this.form),{},{templateName:e.templateName,signName:e.templateSignName,content:e.templateContent,templateType:e.templateType})},onSend:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(/^1[3456789]\d{9}$/.test(t.numList)){i.next=2;break}return i.abrupt("return",e.$message.warning("请输入合法的手机号"));case 2:if(t.templateId){i.next=4;break}return i.abrupt("return",e.$message.warning("请选择模板"));case 4:return i.next=6,e.$http.post("send/message/http/sendmsg",Object(n["a"])(Object(n["a"])({},t),{},{entid:e.userData.entid,seatId:e.userData.userId,seatName:e.userData.username,singleType:"1",configNum:"",numList:[t.numList]}));case 6:e.$message.success("发送成功!"),e.isClose&&(e.visible=!1);case 8:case"end":return i.stop()}}),i)})))()}}}),l=o,c=i("2877"),u=Object(c["a"])(l,s,a,!1,null,null,null);e["a"]=u.exports},de0b:function(t,e,i){"use strict";i.d(e,"d",(function(){return a})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return l}));var s=i("ade3"),a="customer-center",n={CUSTOMER_CENTER:1,WECHAT:2,APP:3,PC_WEB:4,WEIBO:5,MOB_WEB:6,CALL_CENTER:7,WO_CENTER:8,ENT_WECHAT:9,WECHAT_APP:10,EMAIL:11},r=function(t){var e;return e={},Object(s["a"])(e,t.CUSTOMER_CENTER,"客户中心"),Object(s["a"])(e,t.WECHAT,"微信"),Object(s["a"])(e,t.APP,"APP"),Object(s["a"])(e,t.PC_WEB,"桌面网站"),Object(s["a"])(e,t.WEIBO,"微博"),Object(s["a"])(e,t.MOB_WEB,"移动网站"),Object(s["a"])(e,t.CALL_CENTER,"呼叫中心"),Object(s["a"])(e,t.WO_CENTER,"工单中心"),Object(s["a"])(e,t.ENT_WECHAT,"企业微信"),Object(s["a"])(e,t.WECHAT_APP,"微信小程序"),Object(s["a"])(e,t.EMAIL,"邮件"),e}(n),o={BASE:1,VIP:2},l=function(t){var e;return e={},Object(s["a"])(e,t.BASE,"普通客户"),Object(s["a"])(e,t.VIP,"VIP客户"),e}(o)},e351:function(t,e,i){"use strict";i("efdc")},e375:function(t,e,i){"use strict";i("40db")},ed37:function(t,e,i){"use strict";i("33ea")},efdc:function(t,e,i){},f0f0:function(t,e,i){},f29a:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"workorderDetailWrapper"},[i("header",{staticClass:"header"},[i("el-button-group",[i("el-button",{attrs:{icon:"el-icon-arrow-left"},on:{click:function(e){return t.onGoback()}}},[t._v("返回上一级")]),t.isDeleted?t._e():[i("el-button",{on:{click:t.onDelete}},[t._v("删除工单")]),t.closed?i("el-button",{on:{click:t.onActive}},[t._v("激活工单")]):i("el-button",{on:{click:t.onClose}},[t._v("关闭工单")]),i("el-button",{on:{click:t.onExport}},[t._v("导出工单")]),t.closed?t._e():i("el-button",{on:{click:t.onUrgent}},[t._v("催单")]),i("el-button",{on:{click:t.onEdit}},[t._v("编辑工单")]),t.detail.acceptorId?t._e():i("el-button",{on:{click:function(e){return t.onAccept()}}},[t._v("接单")])],i("el-button",{on:{click:t.onToggleFollow}},[t._v(t._s(t.followObj?"取消关注":"关注"))])],2)],1),i("div",{staticClass:"main"},[i("div",{staticClass:"left-box"},[i("el-scrollbar",{staticClass:"ui-scrollbar"},[i("div",{staticStyle:{padding:"15px 15px 0 0"}},[t.isDeleted?t._e():i("div",t._l(t.urgents,(function(e){return i("com-urgent-alert",{key:e.id,attrs:{content:e.reply,title:e.creator+" 发起了催单 "+t.$adminCore.formatDate(e.createTime,"yyyy-MM-dd HH:mm")}})})),1),i("div",{staticClass:"mark"},[i("div",{staticClass:"mark-title"},[t._v(t._s(t.detail.name))]),i("div",[t._v(t._s(t.detail.description))]),i("com-attach-list",{staticStyle:{"margin-top":"10px"},attrs:{data:t.detail.orderFiles}})],1),t.detail.fieldValues&&t.detail.fieldValues.length&&!t.isDeleted?i("div",{staticClass:"template-field"},[i("div",{staticClass:"template-field-title"},[t._v("模板字段")]),t._l(t.detail.fieldValues,(function(e){return i("div",{key:e.id,staticClass:"template-field-item"},[i("div",{staticClass:"template-field-item-left"},[t._v(t._s(e.orderFieldName)+"：")]),t._v(" "+t._s(e.orderFieldValue)+" ")])}))],2):t._e(),t.closed||t.isDeleted?t._e():i("com-reply-form",{attrs:{sgList:t.sgList,orderId:t.id,detail:t.detail},on:{success:t.getInitData}}),i("div",{staticClass:"workorder-comments"},[i("el-tabs",{attrs:{type:"card"}},[i("el-tab-pane",{attrs:{label:"所有回复"}},[i("el-button",{staticStyle:{"margin-left":"90%"},attrs:{type:"text",icon:t.flag?"el-icon-sort-up":"el-icon-sort-down"},on:{click:function(e){return t.onSort()}}},[t._v(t._s(t.flag?"升序":"降序"))]),i("com-reply",{attrs:{data:t.replies}})],1),i("el-tab-pane",{attrs:{label:"操作历史"}},[i("com-history",{attrs:{data:t.operates}})],1)],1)],1)],1)])],1),i("div",{staticClass:"right-box"},[i("el-scrollbar",{staticClass:"ui-scrollbar"},[i("el-tabs",[i("el-tab-pane",{attrs:{label:"工单属性"}},[i("com-pending",{attrs:{data:t.detail,types:t.types,customerId:t.customerData.customerId},on:{getDetail:t.getInitData}})],1),i("el-tab-pane",{attrs:{label:"客户资料"}},[i("el-link",{staticStyle:{float:"right",position:"relative","z-index":"1","line-height":"28px","margin-right":"10px"},attrs:{underline:!1,type:"primary"},on:{click:t.onCustomerDetail}},[t._v("详情")]),i("com-customer",{ref:"ComCustomer",attrs:{operationSource:8,onSendSms:t.onSendSms,onCall:t.onCall,twoCol:!1,readonly:""}})],1)],1)],1)],1)])])},a=[],n=i("5530"),r=i("3835"),o=(i("fb6a"),i("4de4"),i("d3b7"),i("498a"),i("7db0"),i("3ca3"),i("ddb0"),i("99af"),i("b0c0"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{padding:"15px","padding-top":"0"}},[t.data.length?i("ul",t._l(t.data,(function(e){return i("com-reply-item",{key:e.id,attrs:{data:e,onDelete:t.onDeleteReply}})})),1):i("div",[t._v(" 暂无回复数据")])])}),l=[],c=(i("a434"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",{class:t.prefix},[s("el-avatar",{attrs:{icon:"el-icon-user-solid",size:30,src:i("6276")}}),s("div",{class:t.prefix+"_box"},[s("div",{class:t.prefix+"_title"},[s("span",{class:t.prefix+"_sender"},[t._v(t._s(t.data.creator))]),s("span",{class:t.prefix+"_role"},[t._v("客服")]),t.data.flag?[t._v(" | "),s("span",{class:t.prefix+"_visibility"},[t._v("仅客服可见")])]:t._e()],2),s("div",{class:t.prefix+"_time"},[t._v(t._s(t.data.createTime)+" "),0===t.data.type?[t._v("回复 "+t._s(t.data.userName))]:t._e()],2),1===t.data.type?s("com-urgent-alert",{attrs:{title:"发起了催单",content:t.data.reply}}):2===t.data.type?s("com-urgent-alert",{attrs:{title:"激活了工单",content:t.data.reply}}):s("div",{class:t.prefix+"_content"},[t._v(t._s(t.data.reply))]),0===t.data.type?s("com-attach-list",{attrs:{data:t.data.orderReplyFiles}}):t._e(),s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(e){return t.onDelete(t.data)}}},[t._v("删除回复")])],1)],1)}),u=[],d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.prefix},[i("div",{class:t.prefix+"_title"},[t._t("title",(function(){return[t._v(t._s(t.title))]}))],2),i("div",{class:t.prefix+"_content"},[t._t("default",(function(){return[t._v(t._s(t.content))]}))],2)])},m=[],f={data:function(){return{prefix:"wo-detail-urgent-alert"}},props:{title:String,content:String}},p=f,h=(i("382b"),i("2877")),v=Object(h["a"])(p,d,m,!1,null,null,null),g=v.exports,_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.data&&t.data.length?i("ul",{class:t.prefix},t._l(t.data,(function(e){return i("li",{key:e.id},[i("i",{staticClass:"el-icon-paperclip"}),i("span",{class:t.prefix+"_filename",on:{click:function(i){return t.onView(e.fileName)}}},[t._v(t._s(t.getFileName(e.fileName)))]),i("el-link",{class:t.prefix+"_download",attrs:{icon:"el-icon-download",underline:!1},on:{click:function(i){return t.onDownloadAttachment(e.fileName)}}})],1)})),0):t._e()},b=[],C=(i("ac1f"),i("1276"),i("2b3d"),i("9861"),i("a15b"),i("a02a")),y={data:function(){return{prefix:"wo-detail-attach-list",url:""}},props:{data:{type:Array,default:function(){return[]}}},methods:{onView:function(t){var e=this;["jpeg","jpg","png","bmp"].indexOf(t.split(".").pop())>-1&&this.$post("/workOrder/downLoad",{fileName:t},{responseType:"blob"}).then((function(t){var i=window.URL.createObjectURL(t),s=e.$createElement;e.$msgbox({title:"",customClass:"picStyle",showConfirmButton:!1,message:s("img",{attrs:{src:i}})})}))},onDownloadAttachment:function(t){var e=this;Object(C["i"])({fileName:this.getFileName(t),action:function(){return e.$post("/workOrder/downLoad",{fileName:t},{responseType:"blob"})}})},getFileName:function(t){return t.split("_").slice(1).join("_")}}},I=y,A=(i("623b"),Object(h["a"])(I,_,b,!1,null,null,null)),x=A.exports,k={components:{ComUrgentAlert:g,ComAttachList:x},data:function(){return{prefix:"wo-detail-reply-item"}},props:{data:{type:Object,default:function(){return{}}},onDelete:{type:Function,default:function(){}}}},E=k,w=(i("ed37"),Object(h["a"])(E,c,u,!1,null,null,null)),O=w.exports,j={components:{ComReplyItem:O},props:{data:{type:Array,default:function(){return[]}}},methods:{onDeleteReply:function(t){var e=this;this.$confirm("确认删除该回复？","删除回复").then((function(){e.$http("/workOrderReply/removeReply",{params:{replyId:t.id}}).then((function(){e.$message.success("删除成功"),e.data.splice(e.data.indexOf(t),1)}))}))}}},S=j,D=Object(h["a"])(S,o,l,!1,null,null,null),T=D.exports,N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"history-list"},t._l(t.data,(function(e){return s("li",{key:e.id,staticClass:"list-item"},[s("el-avatar",{attrs:{icon:"el-icon-user-solid",size:30,src:i("6276")}}),s("div",{staticClass:"list-content"},[s("div",{staticClass:"list-cotent-header"},[s("span",{staticClass:"header-space"},[t._v(t._s(e.operator))]),s("span",{staticClass:"header-space"},[t._v("(客服)")]),s("span",{staticClass:"header-space header-color"},[t._v(t._s(t.$adminCore.formatDate(e.createTime,"yyyy-MM-dd HH:mm")))])]),s("div",{staticClass:"cotent-title"},[t._v(t._s(t.onConversion(e.type)))]),s("ul",{staticClass:"cotent-list"},t._l(JSON.parse(e.content),(function(e,i){return s("li",{key:i,staticClass:"cotent-list-item"},[s("div",{staticClass:"cotent-list-item-left"},[t._v(t._s(i)+" ：")]),s("div",{staticClass:"cotent-list-item-right"},[s("p",[t._v(t._s(e))])])])})),0)])],1)})),0)},$=[],R={props:{data:{type:Array,default:function(){return[]}}},methods:{onConversion:function(t){switch(t){case 0:return"创建";case 1:return"编辑";case 2:return"处理";case 3:return"催单";case 4:return"关注";case 5:return"取消关注";case 6:return"激活";case 7:return"关闭"}}}},L=R,M=(i("361c"),Object(h["a"])(L,N,$,!1,null,"4ca25e63",null)),F=M.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"properties"},[i("ul",{staticClass:"properties-list"},[i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("受理客服组：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.sgroupName||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("受理客服：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.acceptor||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("状态：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.getStateText(t.data.status)||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("工单分类：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.getTypeText(t.data.typeId)||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("工单编号：")]),i("div",{staticClass:"list-item-right"},[t._v("#"+t._s(t.data.number||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("创建渠道：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(1==t.data.channelId?"工单中心":"在线客服"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("创建人：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.cuserName||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("手机：")]),t.phone.length?i("div",t._l(t.phone,(function(e,s){return i("div",{key:s,staticClass:"list-item-right"},[i("span",[t._v(" "+t._s(e))]),i("ui-sms-send",{staticStyle:{"margin-left":"5px"},attrs:{phone:e,title:"短信"}}),t.onCall?i("el-link",{attrs:{title:"呼叫",icon:"el-icon-phone-outline",type:"primary",underline:!1},on:{click:function(i){return t.onCall(e)}}}):t._e()],1)})),0):i("div",{staticClass:"list-item-right"},[t._v("--")])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("邮箱：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.email||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("创建时间：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.createTime||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("更新时间")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.data.modifyTime||"--"))])])]),i("div",{staticClass:"history-record"},[i("el-collapse",{model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("el-collapse-item",{attrs:{name:"1"}},[i("template",{slot:"title"},[i("div",{staticClass:"history-record-sub-title"},[i("i",{staticClass:"el-icon-tickets"}),i("span",{staticClass:"sub-title-style"},[t._v("工单历史联络记录")])])]),t.WorkOrder.length?i("div",t._l(t.WorkOrder,(function(e){return i("ul",{key:e.id,staticClass:"properties-list"},[i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("工单标题：")]),i("div",{staticClass:"list-item-right"},[1===e.flag&&new Date-new Date(e.urgeTime)<864e5?i("span",{staticStyle:{color:"#E59208",border:"1px solid #E59208",padding:"0 2px","margin-right":"5px"}},[t._v(" 催")]):t._e(),t._v(" "+t._s(e.name||"--")+" ")])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("创建时间：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.createTime||"--"))]),t.data.id!=e.id?i("el-tag",{staticStyle:{float:"right",cursor:"pointer","margin-right":"5px"},attrs:{type:"warning"},on:{click:function(i){return t.onUrgent(e)}}},[t._v("催单")]):t._e(),t.data.id==e.id?i("el-tag",{staticStyle:{float:"right"}},[t._v("当前")]):i("el-tag",{staticStyle:{float:"right",cursor:"pointer"},on:{click:function(i){return t.onDetail(e)}}},[t._v("详情")])],1),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("工单状态")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.getStateText(e.status)||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("优先级：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(t.getPriorityText(e.priority)||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("工单分类：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.serviceName||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("受理客服：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.acceptor||"--"))])])])})),0):i("div",{staticClass:"no-data"},[t._v("暂无数据")])],2),i("el-collapse-item",{attrs:{name:"2"}},[i("template",{slot:"title"},[i("div",{staticClass:"history-record-sub-title"},[i("i",{staticClass:"el-icon-tickets"}),i("span",{staticClass:"sub-title-style"},[t._v("IM历史联络记录")])])]),t.IMRecoed.length?i("div",t._l(t.IMRecoed,(function(e){return i("ul",{key:e.id,staticClass:"properties-list"},[i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("创建时间：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.createTime||"--"))]),i("el-tag",{staticStyle:{float:"right",cursor:"pointer"},on:{click:function(i){return t.onIMDetail(e)}}},[t._v("详情")])],1),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("业务单元：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.datadept||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("业务类型：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.sessiontype||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("处理状态：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s({inservice:"服务中",end:"结束",inqueue:"队列中"}[e.status]||"--"))])]),i("li",{staticClass:"list-item"},[i("div",{staticClass:"list-item-left"},[t._v("受理客服：")]),i("div",{staticClass:"list-item-right"},[t._v(t._s(e.agentno||"--"))])])])})),0):i("div",{staticClass:"no-data"},[t._v("暂无数据")])],2)],1),i("el-button",{staticStyle:{"margin-left":"30px","font-size":"14px"},attrs:{type:"text"},on:{click:t.onCustomerDetail}},[t._v("进入客户中心查看更多")])],1)])},P=[],W=i("fffc"),Q=i("dabe"),H={components:{UiSmsSend:Q["a"]},data:function(){return{activeNames:[],WorkOrder:[],IMRecoed:[]}},props:{data:{type:Object,default:function(){return{}}},types:{type:Array,default:function(){return[]}},customerId:{type:String,default:function(){return""}}},watch:{data:function(t){this.getWorkOrder(t)},customerId:{immediate:!0,handler:function(t){t&&this.getIMRecord(t)}}},computed:{phone:function(){return[this.data.phone1,this.data.phone2,this.data.phone3,this.data.phone4,this.data.phone5].filter((function(t){return t}))}},methods:{getPriorityText:W["i"],getStateText:W["j"],onCustomerDetail:function(){this.$router.push({name:"customer-center-detail",params:{id:this.data.customerId}})},getTypeText:function(t){var e=[],i=this.types.find((function(e){return e.id===t}));while(i)e.unshift(i.name),i=this.types.find((function(t){return t.id===i.parentId}));return e.join("/")},getWorkOrder:function(t){var e=this;this.$post("/customerWorkOrder/getWorkOrder",{customerId:t.customerId}).then((function(t){var i=t.data;e.WorkOrder=i.data}))},getIMRecord:function(t){var e=this;this.IMRecoed=[],this.$http("/ccas/cc/other/api/im/session/record?customerId=".concat(t)).then((function(t){var i=t.data;i&&(e.IMRecoed=i.records)}))},onDetail:function(t){var e=this;this.$router.push({name:"".concat(W["n"],"-detail"),params:{id:t.id}}),setTimeout((function(){e.$emit("getDetail")}),0)},onIMDetail:function(t){this.$openModal((function(){return Promise.all([i.e("chunk-45682ea3"),i.e("chunk-422b85c9"),i.e("chunk-4642dcbf"),i.e("chunk-d218a22e")]).then(i.bind(null,"36b6"))}),{row:Object(n["a"])(Object(n["a"])({},t),{},{customerId:this.data.customerId})})},onCall:function(t){console.log("拨打客户信息",t,this.data.customerId),this.$eventBus.$emit("phonebar",{type:"makecall",payload:{args:[t,""],params:{phone:t,customerId:this.data.customerId}}})},onUrgent:function(t){var e=this;this.$openModal((function(){return i.e("chunk-2d208a99").then(i.bind(null,"a66d"))}),{row:{orderId:t.id,creatorId:t.creatorId}},{success:function(){e.getWorkOrder(e.data)}})}}},V=H,U=(i("5873"),Object(h["a"])(V,B,P,!1,null,"61ec4a90",null)),G=U.exports,X=i("5425"),K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:t.prefix},[i("div",{class:t.prefix+"_title"},[t._v("回复工单")]),i("el-form",{ref:"Form",attrs:{"label-width":"7em",model:t.form,rules:t.rules}},[i("el-form-item",{attrs:{"label-width":"0"}},[i("el-radio-group",{model:{value:t.form.flag,callback:function(e){t.$set(t.form,"flag",e)},expression:"form.flag"}},[i("el-radio",{attrs:{label:0}},[t._v("所有人可见")]),i("el-radio",{attrs:{label:1}},[t._v("仅客服可见")])],1),i("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),i("div",{class:t.prefix+"_uploadbox"},[i("com-upload",{class:t.prefix+"_upload",attrs:{fileList:t.form.fileName}}),i("el-dropdown",{attrs:{trigger:"click"},on:{command:t.onPresetCommand}},[i("el-link",{attrs:{underline:!1}},[t._v("预设工单回应"),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.WO_PRESET_REPLIES,(function(e){return i("el-dropdown-item",{key:e[0],attrs:{command:e[0]}},[t._v(t._s(e[1]))])})),1)],1)],1)],1),i("ui-select",{attrs:{label:"优先级",options:t.priorities},model:{value:t.form.priority,callback:function(e){t.$set(t.form,"priority",e)},expression:"form.priority"}}),i("ui-select",{attrs:{label:"工单状态",options:t.WO_STATES},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}}),i("ui-select",{attrs:{label:"受理客服组",prop:"sgroupId",options:t.sgList,props:{value:"id",label:"name"}},on:{change:t.changeSgroup},model:{value:t.form.sgroupId,callback:function(e){t.$set(t.form,"sgroupId",e)},expression:"form.sgroupId"}}),i("ui-select",{attrs:{label:"受理客服",prop:"acceptorId",options:t.csList,props:{value:"userId",label:"name"}},model:{value:t.form.acceptorId,callback:function(e){t.$set(t.form,"acceptorId",e)},expression:"form.acceptorId"}}),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)],1)},J=[],q=(i("a9e3"),i("d81d"),i("5319"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-upload",{attrs:{action:"",multiple:"",limit:10,"file-list":t.fileList,"on-remove":t.onFileRemove,"on-error":t.onFileError,"on-exceed":t.onFileExceed,"http-request":t.onFileUpload}},[i("el-link",{attrs:{type:"primary",icon:"el-icon-paperclip",underline:!1}},[t._v("上传附件")]),i("span",{staticClass:"el-upload__tip",staticStyle:{"margin-left":"5px"},attrs:{slot:"tip"},slot:"tip"},[t._v("(最多上传10个附件，单个文件最大20M)")])],1)}),Z=[],z=(i("c740"),{props:{fileList:{type:Array,default:function(){return[]}}},methods:{onFileRemove:function(t){var e=this.fileList;this.$post("/workOrder/remove",{fileName:t.fileName}).then((function(i){i.data;var s=e.findIndex((function(e){return e.fileName===t.response}));e.splice(s,1)}))},onFileExceed:function(t,e){this.$message.warning("当前限制选择 10个文件，本次选择了 ".concat(t.length," 个文件，共选择了 ").concat(t.length+e.length," 个文件"))},onFileUpload:function(t){var e=this,i=t.file,s=new FormData;return s.append("file",i),this.$http.post("/workOrder/upload",s).then((function(t){var i=t.data;return e.fileList.push({name:i.split("_").slice(1).join("_"),fileName:i}),i}))},onFileError:function(t){this.$message.error(t.message)},getFileName:function(t){return t.split("_").slice(1).join("_")}}}),Y=z,tt=Object(h["a"])(Y,q,Z,!1,null,null,null),et=tt.exports,it={components:{ComUpload:et},props:{sgList:{type:Array,default:function(){return[]}},orderId:[String,Number],detail:Object},data:function(){return{priorities:W["o"],WO_STATES:W["e"],WO_PRESET_REPLIES:W["c"],form:this.getInitForm(),csList:[],loading:!1,prefix:"wo-detail-reply-form",rules:{sgroupId:Object(C["z"])("请选择受理客服组"),acceptorId:Object(C["z"])("请选择受理客服")}}},watch:{detail:function(t){var e=this;this.form=Object(n["a"])(Object(n["a"])({},this.form),t),this.$post("/orderGroup/listByGroup",{groupId:t.sgroupId}).then((function(t){var i=t.data;e.csList=i}))}},methods:{getInitForm:function(){return{flag:1,priority:0,status:0,fileName:[]}},onExceed:function(){},onPresetCommand:function(t){var e=this,i=(this.form.content||"").trim(),s=W["c"].find((function(e){return e[0]===t}))[2];(i?this.$confirm("将覆盖工单回复中已输入的内容，确定覆盖？","提示"):Promise.resolve()).then((function(){e.$set(e.form,"content",s)}))},onSubmit:function(){var t=this;this.$refs.Form.validate((function(e){if(e){t.loading=!0;var i={"{COMPANY_NAME}":t.detail.companyName,"{SERVICE_NICK}":t.detail.serviceName,"{TICKET_CODE}":t.detail.number,"{TICKET_TITLE}":t.detail.name};t.$post("/workOrderReply/replyAndOpr",Object(n["a"])(Object(n["a"])({},t.form),{},{fileName:t.form.fileName.map((function(t){return t.fileName}))+"",orderId:t.orderId,creatorId:t.$store.state.userData.userId,content:t.form.content&&t.form.content.replace(/\{([A-Z_]+)\}/gm,(function(t){return i[t]||t}))})).then((function(){t.$message.success("提交成功"),t.form=t.getInitForm(),t.$emit("success")})).finally((function(){t.loading=!1}))}}))},changeSgroup:function(t){this.$set(this.form,"acceptorId",void 0),this.getCsList(t)},getCsList:function(t){var e=this;this.csList=[],this.$post("/orderGroup/listByGroup",{groupId:t}).then((function(t){var i=t.data;e.csList=i}))}}},st=it,at=(i("e375"),Object(h["a"])(st,K,J,!1,null,null,null)),nt=at.exports,rt=i("55ae"),ot={components:{ComReply:T,ComHistory:F,ComPending:G,ComCustomer:X["a"],ComUrgentAlert:g,ComAttachList:x,ComReplyForm:nt},data:function(){return{WO_PRESET_REPLIES:W["c"],form:{},fileList:[],detail:{},replies:[],operates:[],followObj:null,types:[],sgList:[],flag:0,customerData:{}}},computed:{id:function(){return this.$route.params.id},isDeleted:function(){var t=this.detail.status;return Object(C["v"])(t)||t===W["a"][0]},closed:function(){return 4===this.detail.status},urgents:function(){var t=864e5;return this.replies.filter((function(e){return 1===e.type&&new Date-new Date(e.createTime)<t})).slice(0,5)}},beforeRouteEnter:function(t,e,i){i((function(t){(!t._id||t._id!==t.id)&&t.getInitData(),t._id=t.id}))},methods:{onCall:function(t,e){e.customerId?this.$eventBus.$emit("phonebar",{type:"makecall",payload:{args:[t,""],params:{phone:t,customerId:e.customerId}}}):this.$message.warning("请先编辑并保存客户信息后再呼叫！")},onCustomerDetail:function(){this.$router.push({name:"customer-center-detail",params:{id:this.detail.customerId}})},getInitData:function(){this.getDetail(),this.getFollowState(),this.getReplies(),this.getTypes(),this.getSgList()},getDetail:function(){var t=this;this.$http("/workOrder/getOrderById",{params:{orderId:this.id}}).then((function(e){var i=e.data;t.detail=i,t.getOperates(),t.getCustomer(),t.$refs.ComCustomer.getInitData({customerId:i.customerId})}))},getCustomer:function(){var t=this;this.$http("/ccas/cc/customer/details/by/".concat(this.detail.customerId)).then((function(e){var i=e.data;t.customerData=i||{}}))},getTypes:function(){var t=this;this.$http("/orderType/listByPage").then((function(e){var i=e.data;t.types=i}))},onSort:function(){this.flag=this.flag?0:1,this.getReplies()},getReplies:function(){var t=this;this.$http("/workOrderReply/reply",{params:{orderId:this.id,flag:this.flag}}).then((function(e){var i=e.data;t.replies=i}))},getOperates:function(){var t=this;this.$http("/workOrderReply/operate",{params:{orderId:this.id,creatorId:this.detail.creatorId}}).then((function(e){var i=e.data;t.operates=i}))},onPresetCommand:function(t){var e=this,i=(this.form.content||"").trim(),s=W["c"].find((function(e){return e[0]===t}))[2];(i?this.$confirm("将覆盖工单回复中已输入的内容，确定覆盖？","提示"):Promise.resolve()).then((function(){e.$set(e.form,"content",s)}))},onDelete:function(){var t=this;this.$confirm("确定删除此工单？","删除").then((function(){t.$post("/workOrder/delete",{orderId:t.id}).then((function(){t.$message.success("删除成功");var e=Object(rt["c"])(t.$root,"CTabs"),i=Object(r["a"])(e,1),s=i[0];s&&s.onCloseCurrent(),t.onGoback()}))}))},onAccept:function(){var t=this;this.$post("/workOrder/accept",{orderId:this.id}).then((function(e){t.$message.success("接单成功");var i=Object(rt["c"])(t.$root,"CTabs"),s=Object(r["a"])(i,1),a=s[0];a&&a.onCloseCurrent(),t.onGoback()}))},onUrgent:function(){this.$openModal((function(){return i.e("chunk-2d208a99").then(i.bind(null,"a66d"))}),{row:{orderId:this.detail.id,creatorId:this.detail.creatorId}},{success:this.getInitData})},getFollowState:function(){var t=this;this.$post("/workOrderAttention/isAttention",{orderId:this.id}).then((function(e){var i=e.data;t.followObj="string"===typeof i?null:i}))},onToggleFollow:function(){var t=this;this.$http.post("/workOrderAttention/attentionOrder",Object(n["a"])(Object(n["a"])({},this.followObj||{}),{},{orderId:this.id})).then((function(){t.getFollowState()}))},onClose:function(){var t=this;this.$confirm("关闭后，工单将不可再次修改与回复（除非再次被激活）确定关闭该工单？","提示").then((function(){t.$post("/workOrderClose/close",{orderId:t.id}).then((function(){t.getInitData()}))}))},onActive:function(){this.$openModal((function(){return i.e("chunk-2d2133b8").then(i.bind(null,"ac99"))}),{row:{orderId:this.id,creatorId:this.$store.state.userData.userId},sgList:this.sgList},{success:this.getInitData})},handleRemove:function(t,e){console.log(t,e)},handleExceed:function(t,e){this.$message.warning("当前限制选择 10个文件，本次选择了 ".concat(t.length," 个文件，共选择了 ").concat(t.length+e.length," 个文件"))},onGoback:function(){this.$router.back()},onEdit:function(){this.$openModal((function(){return i.e("chunk-c153ac08").then(i.bind(null,"4bd2"))}),{row:this.detail},{success:this.getInitData})},onExport:function(){var t=this;Object(C["i"])({fileName:"工单-".concat(this.detail.name,".xls"),action:function(){return t.$http("/workOrder/export",{params:{orderId:t.id},responseType:"blob"})}})},getSgList:function(){var t=this;this.$http("/orderGroup/listGroup").then((function(e){var i=e.data;t.sgList=i}))},onSendSms:function(t){this.$openModal((function(){return i.e("chunk-97d13c26").then(i.bind(null,"3772"))}),{row:{contactPhone:t},userData:this.$store.state.userData})}}},lt=ot,ct=(i("e351"),Object(h["a"])(lt,s,a,!1,null,"21ad83ff",null));e["default"]=ct.exports}}]);