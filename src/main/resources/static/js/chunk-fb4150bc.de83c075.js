(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fb4150bc"],{"498a":function(t,e,i){"use strict";var n=i("23e7"),a=i("58a8").trim,r=i("c8d2");n({target:"String",proto:!0,forced:r("trim")},{trim:function(){return a(this)}})},"6f5a":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"com-sckm-attachlist"},[i("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",multiple:""},on:{change:t.handleFileChange}}),i("ul",[t._l(t.list,(function(e,n){return i("li",{key:n,class:{editMode:t.editMode},attrs:{title:t.getTitle(e)},on:{click:function(e){return t.handleItemClick(n)}}},[i("div",{staticClass:"image"},[i("i",{staticClass:"el-icon-document"}),t.editMode?i("el-link",{staticClass:"icon-delete",attrs:{icon:"el-icon-error",type:"warning",underline:!1},on:{click:function(e){return t.handleDelete(n)}}}):t._e()],1),i("div",{staticClass:"title"},[t._v(t._s(t.getFileName(e)))])])})),t.editMode&&t.list.length<10?i("li",{staticClass:"btn-add",attrs:{title:"添加附件"},on:{click:t.handleAdd}},[i("i",{staticClass:"el-icon-plus"})]):t._e()],2)])},a=[],r=i("2909"),o=(i("a434"),i("d3b7"),i("159b"),i("fb6a"),i("99af"),{data:function(){return{list:this.value}},props:{value:{type:Array,default:function(){return[]}},editMode:Boolean},watch:{value:function(t){this.list=t},list:function(t){this.$emit("input",t)}},methods:{getFileName:function(t){return window.sckm.getFileName(t)},getTitle:function(t){var e=this.getFileName(t);return this.editMode?e:"下载附件: ".concat(e)},handleDelete:function(t){this.list.splice(t,1)},removeMaxFiles:function(t){var e={pass:[],limit:[]},i=function(t){return t.size>104857600};return Object(r["a"])(t).forEach((function(t){e[i(t)?"limit":"pass"].push(t)})),e},handleFileChange:function(t){var e=t.target,i=e.files,n=this.removeMaxFiles(i);n.limit.length&&this.$message.error("请选择小于100M的文件."),this.list=[].concat(Object(r["a"])(this.list),Object(r["a"])(n.pass)).slice(0,10),e.value=""},handleAdd:function(){this.$refs.File.click()},handleItemClick:function(t){this.$emit("item-click",t)}}}),s=o,l=(i("f944"),i("2877")),c=Object(l["a"])(s,n,a,!1,null,null,null);e["a"]=c.exports},"7cdd":function(t,e,i){},c5008:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ui-modal",t._g(t._b({ref:"Modal"},"ui-modal",t.modalProps,!1),t.$listeners),[i("div",{ref:"scroller",staticClass:"com-sckm-edit--body"},[i("el-form",{ref:"Form",attrs:{"label-width":"6em",model:t.formData,rules:t.rules}},[i("ui-text-field",{attrs:{label:"知识标题",prop:"title",maxlength:40},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}}),i("el-form-item",{attrs:{label:"有效期限"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"- -",options:t.dateOptions},model:{value:t.formData.invalidDate,callback:function(e){t.$set(t.formData,"invalidDate",e)},expression:"formData.invalidDate"}})],1),i("el-form-item",{attrs:{label:"知识内容",prop:"itemContext"}},[i("ComEditor",{ref:"Editor",attrs:{maxHeight:"600"},on:{"on-change":t.handleEditorChange}})],1),i("el-form-item",{attrs:{label:"添加附件"}},[i("ComAttachList",{attrs:{editMode:""},model:{value:t.attachments,callback:function(e){t.attachments=e},expression:"attachments"}})],1)],1)],1),i("div",{staticClass:"com-sckm-edit--footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){return t.submit("0")}}},[t._v("暂存")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submit("1")}}},[t._v("发布")])],1)])},a=[],r=i("15fd"),o=i("2909"),s=i("5530"),l=i("3835"),c=i("1da1"),u=(i("96cf"),i("ac1f"),i("00b4"),i("d3b7"),i("3ca3"),i("ddb0"),i("e9c4"),i("d81d"),i("1276"),i("498a"),i("4de4"),i("b0c0"),i("99af"),i("2ca0"),i("159b"),i("466d"),i("a434"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"com-sckm-editor"},[i("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileChange}}),i("div",{staticClass:"editor-wrapper"},[i("div",{staticClass:"editor-inner"},[i("div",{ref:"Editor",staticClass:"richeditor",style:t.editorStyle})])])])}),d=[],f=(i("a9e3"),i("a15b"),i("a630"),["12px","14px","16px","18px","20px","24px","30px"]);f.selectedIndex=1;var m={fontSizes:f,toolbarOptions:[[{size:f}],[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{align:""},{align:"center"},{align:"right"}],["blockquote"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],["link","image"]],genStyleStr:function(){var t=this.fontSizes[this.fontSizes.selectedIndex],e=this.fontSizes.map((function(t){return"\n      .ql-snow .ql-picker.ql-size .ql-picker-label[data-value='".concat(t,"']:before,\n      .ql-snow .ql-picker.ql-size .ql-picker-item[data-value='").concat(t,"']:before {\n        content: '").concat(t,"';\n      }\n      .ql-snow .ql-picker.ql-size .ql-picker-item[data-value='").concat(t,"']:before {\n        font-size: ").concat(t,";\n      }\n    ")}));return e.push("\n      .ql-snow .ql-picker.ql-size .ql-picker-label:before,\n      .ql-snow .ql-picker.ql-size .ql-picker-item:before {\n        content: '".concat(t,"';\n        font-size: ").concat(t,";\n      }\n    ")),e.join("")},addStylesheet:function(){var t="sckmEditorStylesheet",e=document.getElementById(t);if(!e){var i=document.createElement("style");i.type="text/css",i.id=t,i.innerHTML=this.genStyleStr(),document.head.appendChild(i)}},addTitles:function(t){[[".ql-bold","粗体"],[".ql-italic","斜体"],[".ql-underline","下划线"],[".ql-strike","中划线"],["span.ql-color .ql-picker-label","颜色"],["span.ql-background .ql-picker-label","背景色"],[".ql-blockquote","块引用"],[".ql-link","插入链接"],[".ql-image","插入图片"]].forEach((function(e){t.querySelector(e[0]).title=e[1]})),[[".ql-align",["左对齐","居中对齐","右对齐"]],[".ql-list",["有序列表","无序列表"]],[".ql-indent",["减小缩进","增加缩进"]]].forEach((function(e){Array.from(t.querySelectorAll(e[0])).forEach((function(t,i){t.title=e[1][i]}))}))}},h={data:function(){return{fontSizes:m.fontSizes}},props:{placeholder:{type:String,default:"请输入内容..."},readOnly:Boolean,height:{type:[Number,String],default:240}},computed:{editorStyle:function(){return{height:isNaN(this.height)?this.height:"".concat(this.height,"px")}}},mounted:function(){var t=this;i.e("chunk-68176200").then(i.t.bind(null,"05f4",7)).then((function(e){var i=e.default;return t.initEditor(i)})),m.addStylesheet()},beforeDestroy:function(){this.removeListener()},methods:{initEditor:function(t){var e=t.import("attributors/style/size");e.whitelist=m.fontSizes,t.register(e,!0);var i=this.readOnly,n=this.placeholder;this.editor=new t(this.$refs.Editor,{theme:"snow",readOnly:i,placeholder:n,modules:{toolbar:m.toolbarOptions}}),this.editor.getModule("toolbar").addHandler("image",this.handleImage),this.editor.on("text-change",this.handleTextChange),m.addTitles(this.$el)},removeListener:function(){this.editor.off("text-change",this.handleTextChange)},handleImage:function(){this.$refs.File.click()},handleFileChange:function(t){var e=this,i=t.target,n=i.files[0];if(n){if(!n.type.startsWith("image/"))return this.$message.error("请选择图片文件");if(n.size>104857600)return this.$message.error("请选择小于100M的文件.");i.value="",window.sckm.getImageInfo(n).then((function(t){e.focus();var i='<img src="'.concat(t.src,'" width="').concat(t.width,'" height="').concat(t.height,'" data-name="').concat(t.name,'">');document.execCommand("insertHTML",!1,i),e.focus()}))}},focus:function(){this.editor.root.focus()},getHTML:function(){return this.editor.root.innerHTML},getText:function(){return this.editor.root.textContent.trim()},setHTML:function(t){this.editor.root.innerHTML=t},getImagesAll:function(){return Object(o["a"])(this.editor.root.querySelectorAll("img"))},getImages:function(){return this.getImagesAll().filter((function(t){return t.src.startsWith("data:")}))},resetData:function(){var t=this;this.editor.root.innerHTML="",this.$nextTick((function(){return t.editor.history.clear()}))},handleTextChange:function(){this.$emit("on-change",{html:this.getHTML(),text:this.getText(),hasContent:this.hasContent()})},hasContent:function(){return this.editor.root.querySelector("img")||this.getText()}}},p=h,g=(i("cfbd"),i("2877")),v=Object(g["a"])(p,u,d,!1,null,null,null),b=v.exports,k=i("6f5a"),x=i("a02a"),y=["itemFileId"],w={components:{ComEditor:b,ComAttachList:k["a"]},props:["row","category"],data:function(){var t=this,e=this.row,i=function(t,e,i){/^[a-zA-Z0-9\u4e00-\u9fa5]+$/g.test(e)?i():i(new Error("标题只能包含字母，汉字或数字"))};return{formData:{},images:[],details:{},attachments:[],rules:{title:[Object(x["y"])("请输入知识标题"),{validator:i}],itemContext:{required:!0,message:"请填写知识内容"}},dateOptions:{disabledDate:function(t){return t<new Date}},modalProps:{title:"".concat(e?"编辑":"新建","知识"),drawer:!0,width:"600px",onSubmit:function(){var i=Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$refs.Form.validate();case 2:return i.next=4,Promise.all([t.uploadImages(),t.uploadAttachments()]).then((function(i){var n=Object(l["a"])(i,2),a=n[0],r=n[1],o=t.details.categoryId||t.category.id,c=t.details.categoryName||t.category.title,u=Object(s["a"])(Object(s["a"])({},t.formData),{},{isDraft:t.isDraft,invalidDate:t.formData.invalidDate&&t.formData.invalidDate.getTime(),itemId:e.itemId,itemContext:t.getContent(a.values),rtfImgJson:JSON.stringify(a.data),annexFileJson:JSON.stringify(r),userType:t.userType,categoryId:o,categoryName:c});return t.$post("sckm/item/save",u)}));case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}}),i)})));function n(){return i.apply(this,arguments)}return n}()}}},computed:{title:function(){return"".concat(this.itemId?"编辑":"新建","知识")},userType:function(){return this.$store.getters.isAdmin?"1":this.$store.state.permissions.indexOf("kbm")>-1?"2":"3"}},mounted:function(){this.getDetail(this.row)},methods:{submit:function(t){this.isDraft=t,this.$refs.Modal.submit()},getDetail:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!t){i.next=6;break}return i.t0=e,i.next=4,e.$http("/sckm/item/get/detail/".concat(t.itemId));case 4:i.t1=i.sent.data,i.t0.updateData.call(i.t0,i.t1);case 6:case"end":return i.stop()}}),i)})))()},updateData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.details=t.itemDetail;var e=t.itemDetail,i=e.title,n=e.deptId,a=e.deptName,r=e.invalidTime,o=e.standardQuestion,s=e.similarQuestion,l=e.itemFileList;n=n?n.split(",").map((function(t){return t.trim()})):[],a=a?a.split(",").map((function(t){return t.trim()})):[];var c=n.map((function(t,e){return{deptId:t,deptName:a[e]}}));this.formData={title:i,dept:c,standardQuestion:o,similarQuestion:s,invalidDate:r&&new Date(r)},this.$refs.Editor.setHTML(t.context),this.attachments=l.filter((function(t){return 1===t.itemType})).map((function(t){return{fileSize:t.fileSize,tempPath:t.originalFilePath}})),this.images=l.filter((function(t){return 2===t.itemType})).map((function(t){return{fileSize:t.fileSize,tempPath:t.originalFilePath,itemFileId:t.itemFileId}}))},uploadImages:function(){var t=this;return window.sckm.uploadMany(this.$refs.Editor.getImages().map((function(t){return window.sckm.base64ToFile(t.src,t.dataset.name)}))).then((function(e){return{data:[].concat(Object(o["a"])(t.getNoDeleteImages()),Object(o["a"])(e.map((function(t){return t.data})))),values:e}}))},getContent:function(t){var e=document.createElement("div");e.innerHTML=this.$refs.Editor.getHTML();var i=Object(o["a"])(e.querySelectorAll("img")).filter((function(t){return t.src.startsWith("data:")}));return t.forEach((function(t,e){var n=t.data,a=i[e];a.src=n.tempPath,a.removeAttribute("data-name")})),e.innerHTML},getNoDeleteImages:function(){if(!this.itemId)return[];var t=this.$refs.Editor.getImagesAll().map((function(t){var e=t.src.match(/itemFileId\=(.+)/);return e&&e[1]})).filter((function(t){return t}));return this.images.filter((function(e){return t.some((function(t){return-1!==t.indexOf(encodeURI(e.itemFileId))}))})).map((function(t){t.itemFileId;var e=Object(r["a"])(t,y);return e}))},uploadAttachments:function(){var t=this;return window.sckm.uploadMany(this.attachments.filter((function(t){return t.name}))).then((function(e){var i=Object(o["a"])(t.attachments);return e.forEach((function(t){var e=t.data,n=t.file;return i.splice(i.indexOf(n),1,e)})),i}))},handleEditorChange:function(t){var e=t.text,i=t.hasContent,n=e||(i?"temp":"");this.$set(this.formData,"itemContext",n),this.$refs.Form.validateField("itemContext")}}},q=w,C=Object(g["a"])(q,n,a,!1,null,null,null);e["default"]=C.exports},c8d2:function(t,e,i){var n=i("5e77").PROPER,a=i("d039"),r=i("5899"),o="​᠎";t.exports=function(t){return a((function(){return!!r[t]()||o[t]()!==o||n&&r[t].name!==t}))}},cfbd:function(t,e,i){"use strict";i("7cdd")},e34f:function(t,e,i){},f944:function(t,e,i){"use strict";i("e34f")}}]);