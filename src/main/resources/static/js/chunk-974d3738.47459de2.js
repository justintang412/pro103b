(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-974d3738"],{"5fec":function(e,t,n){"use strict";n("6688")},6688:function(e,t,n){},fb71:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ui-absolute-container page-system-organization"},[n("aside",{staticClass:"aside"},[n("el-scrollbar",{staticClass:"ui-scrollbar"},[n("el-tree",{ref:"Tree",attrs:{data:e.orgData,"node-key":"deptId","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{staticClass:"tree-node"},[n("span",{staticClass:"node-label",attrs:{title:a.label},on:{click:function(t){return e.onOrgView(r)}}},[e._v(e._s(a.label))]),n("span",{staticClass:"node-actions"},["-1"!==r.deptId?n("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgEdit(r)}}}):e._e(),r.deptLevel<4?n("el-link",{attrs:{underline:!1,icon:"el-icon-circle-plus-outline"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgEdit(r,a)}}}):e._e(),r.deptLevel>0?n("el-link",{attrs:{underline:!1,icon:"el-icon-remove-outline"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgDelete(a,r)}}}):e._e()],1)])}}])})],1)],1),n("main",{staticClass:"main"},[n("div",{staticClass:"main-body"},[n("com-table-view",{ref:"ComTableView",attrs:{archiveNo:e.curData&&e.curData.archiveNo}})],1)])])},r=[],i=n("1da1"),o=n("2909"),c=n("5530"),s=(n("96cf"),n("7db0"),n("d3b7"),n("a15b"),n("d81d"),n("b0c0"),n("b64b"),n("ac1f"),n("1276"),n("99af"),n("3ca3"),n("ddb0"),n("a02a")),u=n("cca5"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._g(e._b({},"ui-table-view",e.viewProps,!1),e.viewListeners),[n("ui-text-field",{attrs:{slot:"search",label:"目录名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},slot:"search",model:{value:e.searchForm.seriesName,callback:function(t){e.$set(e.searchForm,"seriesName",t)},expression:"searchForm.seriesName"}})],1)},d=[],p={mixins:[window.mixTableView],props:["archiveNo"],data:function(){return{columns:[{label:"目录编号",prop:"seriesNo"},{label:"目录名称",prop:"seriesName"}]}},methods:{fetchMethod:function(e){return this.$http("/sys/series/list?archiveNo=".concat(this.archiveNo),{params:e}).then((function(e){var t=e.data;return{total:t.length,data:t}}))},onAddUser:function(){var e=this;this.$openModal((function(){return n.e("chunk-2d0f1512").then(n.bind(null,"9fb1"))}),{deptId:this.deptId},{success:function(){return e.getData()}})},onDelete:function(e){var t=this;this.delData({desc:"确定要移除该用户？",action:function(){return t.$post("/ccas/auth/dept/remove/user",{deptId:t.deptId,userId:e.userId})}})}}},f=p,h=n("2877"),v=Object(h["a"])(f,l,d,!1,null,null,null),b=v.exports,m="全宗",g={components:{ComTableView:b},data:function(){return{orgData:[],curData:null}},computed:{flatData:function(){return this.getFlatData(this.orgData)},headerTitle:function(){var e=this,t=function(){var t=e.curData,n=[t],a=function(e){return[void 0,null,""].indexOf(e)<0};while(a(t.parentId)){var r=e.flatData.find((function(e){return e.departmentId===t.parentId}));if(!r)break;n.push(r),t=r}return n.reverse().map((function(e){return e.name})).join(" > ")};return this.curData?t():m},orgTypes:function(){if(this.curData){var e=this.curData.deptLevel<1?Object.keys(u["orgTypes"]):this.curData.type?this.curData.type.split(","):[];return e.map((function(e){return u["orgTypes"][e]})).join("、")}return""}},mounted:function(){this.getOrgData()},methods:{getOrgData:function(){var e=this,t={departmentId:"1",label:m,name:m,deptLevel:0,children:[]};this.orgData=[t],this.$nextTick((function(){var n=e.$refs.Tree,a=n.getNode(t.departmentId),r=a.data;n.setCurrentNode(r),e.onOrgView(r)})),this.$http("/sys/archive-group/list").then((function(e){var n=e.data;t.children=Object(s["y"])(n.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{label:e.archiveName})})),{key:"archiveNo"})}))},getFlatData:function(e){var t=this;return e.reduce((function(e,n){return[].concat(Object(o["a"])(e),[n],Object(o["a"])(n.children?t.getFlatData(n.children):[]))}),[])},onOrgEdit:function(e,t){this.$openModal((function(){return n.e("chunk-72c1b824").then(n.bind(null,"ca20"))}),{data:e,node:t})},onOrgDelete:function(e,t){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,i,o,c,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.$confirm("<p>删除后，该部门及下属部门的所有内容都会被删除，且无法恢复；是否继续删除部门 <b>".concat(t.label,"</b> ？</p>"),"删除部门",{dangerouslyUseHTMLString:!0});case 2:return a.next=4,n.$http("/ccas/auth/dept/del/".concat(t.deptId));case 4:r=n.$refs.Tree,i=r.getCurrentNode(),o=n.orgData[0].deptId,c=r.getNode(o),s=c.data,r.remove(e.key),i===t&&(r.setCurrentNode(s),n.onOrgView(s));case 10:case"end":return a.stop()}}),a)})))()},onOrgView:function(e){var t=this;this.curData=e,this.$nextTick((function(){t.$refs.ComTableView.onReset()}))}}},k=g,D=(n("5fec"),Object(h["a"])(k,a,r,!1,null,null,null));t["default"]=D.exports}}]);