(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73f10490"],{3158:function(t,e,a){"use strict";a("cf83")},"498a":function(t,e,a){"use strict";var n=a("23e7"),i=a("58a8").trim,r=a("c8d2");n({target:"String",proto:!0,forced:r("trim")},{trim:function(){return i(this)}})},7005:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui-absolute-container container"},[a("el-alert",{attrs:{closable:!1,title:"工单分类可以帮助管理者对工单问题进行分类。分类最多支持五级，并且分类中的叶子节点可以设置相关联的模板。"}}),a("section",{staticClass:"section"},[a("aside",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"aside"},[a("header",{staticClass:"aside-header"},[a("el-link",{attrs:{underline:!1,title:"上移",icon:"el-icon-top",disabled:t.disableMoveUp},on:{click:t.onMoveUpNode}}),a("el-link",{attrs:{underline:!1,title:"下移",icon:"el-icon-bottom",disabled:t.disableMoveDown},on:{click:t.onMoveDownNode}})],1),a("main",{staticClass:"aside-main"},[a("el-scrollbar",{staticClass:"ui-scrollbar"},[a("el-tree",{ref:"Tree",attrs:{data:t.data,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,i=e.data;return a("span",{staticClass:"tree-node"},[a("span",{staticClass:"node-label",attrs:{title:n.label},on:{click:function(e){return t.onViewNode(i)}}},[t._v(t._s(n.label))]),0===i.readOnly?a("span",{staticClass:"node-actions"},[-1!==i.id?a("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},nativeOn:{click:function(e){return e.stopPropagation(),t.onEditNode(i)}}}):t._e(),i.level<5&&i.id>=-1?a("el-link",{attrs:{underline:!1,icon:"el-icon-circle-plus-outline"},nativeOn:{click:function(e){return e.stopPropagation(),t.onAddNode(n,i)}}}):t._e(),i.id>=0&&t.isLeaf(i)?a("el-link",{attrs:{underline:!1,icon:"el-icon-remove-outline"},nativeOn:{click:function(e){return e.stopPropagation(),t.onDelNode(n,i)}}}):t._e()],1):t._e()])}}])})],1)],1)]),a("main",{staticClass:"main"},[a("header",{staticClass:"main-header"},[t._v(t._s(t.headerTitle))]),t.curData?a("el-form",{staticClass:"main-form",attrs:{"label-width":"6em",model:t.form,rules:t.rules}},[a("ui-text-field",{attrs:{label:"分类名称",prop:"name",placeholder:"最多可输入10个字符",maxlength:"10",disabled:0!=t.form.readOnly},on:{blur:function(e){return t.onUpdateNode("name")}},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),a("ui-text-field",{attrs:{label:"分类描述",type:"textarea",placeholder:"最多可输入150个字符",maxlength:"150",disabled:0!=t.form.readOnly,autosize:{minRows:3}},on:{blur:function(e){return t.onUpdateNode("description")}},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),t.isLeaf(t.form)?a("ui-select",{attrs:{label:"关联模板",options:t.templates,props:{value:"id",label:"name"},disabled:0!=t.form.readOnly},on:{change:function(e){return t.onUpdateNode("templateId")}},model:{value:t.form.templateId,callback:function(e){t.$set(t.form,"templateId",e)},expression:"form.templateId"}}):t._e()],1):a("p",{staticClass:"tip"},[t._v("您可以点击左侧分类列表来查看分类详情")])],1)])],1)},i=[],r=a("ade3"),o=a("2909"),s=a("5530"),c=(a("7db0"),a("d3b7"),a("a15b"),a("d81d"),a("b0c0"),a("4de4"),a("99af"),a("498a"),a("c740"),a("a434"),a("3ca3"),a("ddb0"),a("a02a")),l={name:"SettingsWorkorderCustomClassification",data:function(){return{data:[],form:{},curData:null,templates:[],rules:{name:Object(c["y"])("请输入分类名称")},loading:!1}},computed:{flatData:function(){return this.getFlatData(this.data)},headerTitle:function(){var t=this,e=function(){var e=t.curData,a=[e],n=function(t){return[void 0,null,""].indexOf(t)<0};while(n(e.parentId)){var i=t.flatData.find((function(t){return t.id===e.parentId}));if(!i)break;a.push(i),e=i}return a.reverse().map((function(t){return t.name})).join(" > ")};return this.curData?e():"全部分类"},disableMoveUp:function(){var t=this;if(!this.curData||this.curData.id<0)return!0;var e=this.flatData.find((function(e){return e.id===t.curData.parentId})),a=e.children.indexOf(this.curData),n=e.children.filter((function(t){return t.id>-1}));return a<1||a>=n.length-2},disableMoveDown:function(){var t=this;if(!this.curData||this.curData.id<0)return!0;var e=this.flatData.find((function(e){return e.id===t.curData.parentId})),a=e.children.filter((function(t){return t.id>-1})),n=a.indexOf(this.curData);return n>=a.length-3},disableMove:function(){return!this.curData||this.curData.id<0}},mounted:function(){this.getData(),this.getTemplates()},methods:{getData:function(){var t=this,e="全部分类",a={id:-1,label:e,name:e,level:0,readOnly:0};this.data=[Object(s["a"])(Object(s["a"])({},a),{},{children:[]})],this.$http("/orderType/listByPage").then((function(e){var n=e.data;n=n.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{label:t.name})})),t.data=[Object(s["a"])(Object(s["a"])({},a),{},{children:Object(o["a"])(Object(c["F"])(n))})]}))},getFlatData:function(t){var e=this;return t.reduce((function(t,a){return[].concat(Object(o["a"])(t),[a],Object(o["a"])(a.children?e.getFlatData(a.children):[]))}),[])},getTemplates:function(){var t=this;this.$http("/orderTemplate/listByPage").then((function(e){var a=e.data;t.templates=a}))},updateNode:function(t){return this.$http.post("/orderType/update",t)},onEditNode:function(t){var e=this;this.$prompt("分类名称","编辑分类",{inputValue:t.name,inputPlaceholder:"最多可输入10个字符",inputValidator:function(t){var e=(t||"").trim();return e?!(e.length>10)||"分类名称不能超过10个字符":"请输入分类名称"}}).then((function(a){var n=a.value,i=n.trim();e.updateNode(Object(s["a"])(Object(s["a"])({},t),{},{name:i})).then((function(){e.$set(t,"name",i),e.$set(t,"label",i),e.curData===t&&e.$set(e.form,"name",i)}))}))},onUpdateNode:function(t){var e=this;if("templateId"===t)this.updateNode(this.form).then((function(){e.$message.success("更新成功"),e.$set(e.curData,t,e.form[t])}));else{var a=this.curData[t],n=this.form[t];if(a=(a||"").trim(),n=(n||"").trim(),a===n)return;this.updateNode(Object(s["a"])(Object(s["a"])({},this.form),{},Object(r["a"])({},t,n))).then((function(){e.$message.success("更新成功"),e.$set(e.curData,t,n)}))}},onAddNode:function(t,e){var a=this;this.$prompt("分类名称","添加分类",{inputPlaceholder:"最多可输入10个字符",inputValidator:function(t){var e=(t||"").trim();return e?!(e.length>10)||"分类名称不能超过10个字符":"请输入分类名称"}}).then((function(n){var i=n.value,r=t.parent,o=r.data.children||r.data[0].children,c=o.reduce((function(t,e){return Math.max(t,e.position||0)}),0)+1,l=i.trim(),d={name:l,label:l,position:c,readOnly:0,level:e.level?e.level+1:1,parentId:e.id,templateId:e.templateId||1};a.$http.post("/orderType/save",d).then((function(t){var n=t.data;d=Object(s["a"])(Object(s["a"])({},d),{},{id:n}),e.children?e.children.push(d):a.$set(e,"children",[d])}))}))},onDelNode:function(t,e){var a=this;this.$confirm("确定删除 新增?","删除分类").then((function(){a.$http.post("/orderType/remove/".concat(e.id)).then((function(){var n=t.parent,i=n.data.children||n.data,r=i.findIndex((function(t){return t.id===e.id}));i.splice(r,1),a.curData===e&&(a.curData=null)}))}))},isLeaf:function(t){return!t.children||!t.children.length},onViewNode:function(t){this.form=Object(s["a"])({},t),this.form.templateId=this.form.templateId||1,this.curData=-1===t.id?null:t},onMoveUpNode:function(){var t=this,e=this.$refs.Tree,a=e.getNode(this.curData),n=a.parent,i=n.data.children||n.data,r=i.indexOf(this.curData),o=i[r-1],c=this.curData.position,l=o.position;this.loading=!0,Promise.all([this.updateNode(Object(s["a"])(Object(s["a"])({},this.curData),{},{position:l})),this.updateNode(Object(s["a"])(Object(s["a"])({},o),{},{position:c}))]).then((function(){t.$set(t.curData,"position",l),t.$set(o,"position",c),e.remove(o),e.insertAfter(o,t.curData)})).finally((function(){t.loading=!1}))},onMoveDownNode:function(){var t=this,e=this.$refs.Tree,a=e.getNode(this.curData),n=a.parent,i=n.data.children||n.data,r=i.indexOf(this.curData),o=i[r+1],c=this.curData.position,l=o.position;this.loading=!0,Promise.all([this.updateNode(Object(s["a"])(Object(s["a"])({},this.curData),{},{position:l})),this.updateNode(Object(s["a"])(Object(s["a"])({},o),{},{position:c}))]).then((function(){t.$set(t.curData,"position",l),t.$set(o,"position",c),e.remove(o),e.insertBefore(o,t.curData)})).finally((function(){t.loading=!1}))},onMoveNode:function(){}}},d=l,u=(a("3158"),a("2877")),f=Object(u["a"])(d,n,i,!1,null,"2aee6d98",null);e["default"]=f.exports},c740:function(t,e,a){"use strict";var n=a("23e7"),i=a("b727").findIndex,r=a("44d2"),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),n({target:"Array",proto:!0,forced:s},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(o)},c8d2:function(t,e,a){var n=a("5e77").PROPER,i=a("d039"),r=a("5899"),o="​᠎";t.exports=function(t){return i((function(){return!!r[t]()||o[t]()!==o||n&&r[t].name!==t}))}},cf83:function(t,e,a){}}]);