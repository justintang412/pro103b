(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7259e838"],{"365f":function(t,e,n){"use strict";n("96a9")},"96a9":function(t,e,n){},e4b9:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ui-absolute-container page-system-organization"},[n("aside",{staticClass:"aside"},[n("el-scrollbar",{staticClass:"ui-scrollbar"},[n("el-tree",{ref:"Tree",attrs:{data:t.orgData,"node-key":"deptId","default-expand-all":"","expand-on-click-node":!1},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.node,r=e.data;return n("span",{staticClass:"tree-node"},[n("span",{staticClass:"node-label",attrs:{title:a.label},on:{click:function(e){return t.onOrgView(r)}}},[t._v(t._s(a.label))]),n("span",{staticClass:"node-actions"},["-1"!==r.deptId?n("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},nativeOn:{click:function(e){return e.stopPropagation(),t.onOrgEdit(r)}}}):t._e(),r.deptLevel<4?n("el-link",{attrs:{underline:!1,icon:"el-icon-circle-plus-outline"},nativeOn:{click:function(e){return e.stopPropagation(),t.onOrgEdit(r,a)}}}):t._e(),r.deptLevel>0?n("el-link",{attrs:{underline:!1,icon:"el-icon-remove-outline"},nativeOn:{click:function(e){return e.stopPropagation(),t.onOrgDelete(a,r)}}}):t._e()],1)])}}])})],1)],1),n("main",{staticClass:"main"},[n("header",{staticClass:"main-header"},[t._v("总公司")]),n("div",{staticClass:"main-body"},[n("p",{staticClass:"main-body-meta"},[n("span",[t._v("部门名称")]),t._v(t._s(t.curData&&t.curData.label)),n("br")]),n("com-table-view",{ref:"ComTableView",attrs:{departmentId:t.curData&&t.curData.departmentId}})],1)])])},r=[],i=n("1da1"),o=n("2909"),c=n("5530"),s=(n("96cf"),n("7db0"),n("d3b7"),n("a15b"),n("d81d"),n("b0c0"),n("b64b"),n("ac1f"),n("1276"),n("99af"),n("3ca3"),n("ddb0"),n("a02a")),l=n("81a5"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ui-table-view",t._g(t._b({},"ui-table-view",t.viewProps,!1),t.viewListeners),[n("ui-text-field",{attrs:{slot:"search",label:"姓名"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},slot:"search",model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name",e)},expression:"searchForm.name"}}),n("el-button",{attrs:{slot:"search-right",type:"primary",icon:"el-icon-plus"},on:{click:t.onAddUser},slot:"search-right"},[t._v("添加人员")])],1)},d=[],p={mixins:[window.mixTableView],props:["departmentId"],data:function(){return{columns:[{label:"用户名",prop:"username"},{label:"状态",minWidth:80,render:function(t,e){var n=e.row;return t.apply(void 0,["el-tag"].concat(Object(o["a"])("false"===n.isActive?["禁用"]:["启用"])))}},{label:"姓名",prop:"email",minWidth:140},{label:"操作",width:100,fixed:"right",render:this.$hBtns({label:"移除",action:this.onDelete})}]}},methods:{fetchMethod:function(t){return this.$http("/user/list?departmentId=".concat(this.departmentId),{params:t}).then((function(t){var e=t.data;return{total:e.length,data:e}}))},onAddUser:function(){var t=this;this.$openModal((function(){return n.e("chunk-2d21f078").then(n.bind(null,"d7a0"))}),{deptId:this.deptId},{success:function(){return t.getData()}})},onDelete:function(t){var e=this;this.delData({desc:"确定要移除该用户？",action:function(){return e.$post("/ccas/auth/dept/remove/user",{deptId:e.deptId,userId:t.userId})}})}}},f=p,h=n("2877"),m=Object(h["a"])(f,u,d,!1,null,null,null),b=m.exports,v="总公司",g={components:{ComTableView:b},data:function(){return{orgData:[],curData:null}},computed:{flatData:function(){return this.getFlatData(this.orgData)},headerTitle:function(){var t=this,e=function(){var e=t.curData,n=[e],a=function(t){return[void 0,null,""].indexOf(t)<0};while(a(e.parentId)){var r=t.flatData.find((function(t){return t.departmentId===e.parentId}));if(!r)break;n.push(r),e=r}return n.reverse().map((function(t){return t.name})).join(" > ")};return this.curData?e():v},orgTypes:function(){if(this.curData){var t=this.curData.deptLevel<1?Object.keys(l["b"]):this.curData.type?this.curData.type.split(","):[];return t.map((function(t){return l["b"][t]})).join("、")}return""}},mounted:function(){this.getOrgData()},methods:{getOrgData:function(){var t=this,e={departmentId:"1",label:v,name:v,deptLevel:0,children:[]};this.orgData=[e],this.$nextTick((function(){var n=t.$refs.Tree,a=n.getNode(e.departmentId),r=a.data;n.setCurrentNode(r),t.onOrgView(r)})),this.$http("/department/list").then((function(t){var n=t.data;e.children=Object(s["y"])(n.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{label:t.departmentName})})),{key:"departmentId"})}))},getFlatData:function(t){var e=this;return t.reduce((function(t,n){return[].concat(Object(o["a"])(t),[n],Object(o["a"])(n.children?e.getFlatData(n.children):[]))}),[])},onOrgEdit:function(t,e){this.$openModal((function(){return n.e("chunk-62a44510").then(n.bind(null,"cf20"))}),{data:t,node:e})},onOrgDelete:function(t,e){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,i,o,c,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.$confirm("<p>删除后，该部门及下属部门的所有内容都会被删除，且无法恢复；是否继续删除部门 <b>".concat(e.label,"</b> ？</p>"),"删除部门",{dangerouslyUseHTMLString:!0});case 2:return a.next=4,n.$http("/ccas/auth/dept/del/".concat(e.deptId));case 4:r=n.$refs.Tree,i=r.getCurrentNode(),o=n.orgData[0].deptId,c=r.getNode(o),s=c.data,r.remove(t.key),i===e&&(r.setCurrentNode(s),n.onOrgView(s));case 10:case"end":return a.stop()}}),a)})))()},onOrgView:function(t){var e=this;this.curData=t,this.$nextTick((function(){e.$refs.ComTableView.onReset()}))}}},D=g,k=(n("365f"),Object(h["a"])(D,a,r,!1,null,null,null));e["default"]=k.exports}}]);