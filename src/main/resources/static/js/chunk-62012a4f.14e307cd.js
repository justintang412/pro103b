(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62012a4f"],{"1ffe":function(e,t,n){},"46a4":function(e,t,n){"use strict";n("1ffe")},"6c4b":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ui-absolute-container"},[n("el-alert",{directives:[{name:"show",rawName:"v-show",value:!e.customerId,expression:"!customerId"}],attrs:{"show-icon":"",type:"warning",title:"该客户信息尚未保存，请单击编辑以保存客户信息"}}),n("div",{staticClass:"sub-container"},[n("customer-info",{ref:"CustomerInfo",staticClass:"customer-info",attrs:{params:e.customerParams,operationSource:7,onSendSms:e.onSendSms,mergeAction:e.mergeAction},on:{getCustomerId:e.getCustomerId,merged:e.onMerged}}),e.customerId?n("main",{staticClass:"main"},[n("header",{staticClass:"header"},[n("span",{staticClass:"title"},[e._v("历史动态")]),e.customerId?[n("el-button",{attrs:{icon:"el-icon-plus",type:"primary",plain:""},on:{click:e.onCreateWorkorder}},[e._v("创建工单")]),n("el-button",{attrs:{icon:"el-icon-plus",type:"primary",plain:""},on:{click:e.onAddContactPlan}},[e._v("添加联系计划")])]:e._e()],2),n("ui-tab-view",{ref:"UiTabView",attrs:{tabs:e.tabs,nocache:""}})],1):e._e()],1)],1)},a=[],o=n("1da1"),i=n("5530"),c=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"container"},[n("header",{staticClass:"header"},[n("span",{staticClass:"header-title"},[e._v("客户信息")]),e.readonly?n("el-link",{attrs:{type:"primary",icon:"el-icon-edit",underline:!1},on:{click:e.onEdit}},[e._v("编辑")]):e._e()],1),n("main",{staticClass:"main"},[n("el-scrollbar",{staticClass:"ui-scrollbar"},[n("com-customer-form",e._g({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ComCustomerForm",attrs:{onSendSms:e.onSendSms,onCall:e.onCall,readonly:e.readonly,operationSource:e.operationSource,mergeAction:e.mergeAction,"inline-message":""}},e.$listeners),[e.readonly?e._e():n("el-form-item",[n("el-button",{on:{click:e.onCancel}},[e._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")])],1)],1)],1)],1)])}),s=[],u=n("5425"),l={components:{ComCustomerForm:u["a"]},props:{params:{type:Object,default:function(){return{}}},onSendSms:Function,operationSource:{},mergeAction:Function},data:function(){return{readonly:!0,loading:!1}},mounted:function(){this.getInitData()},methods:{onCancel:function(){this.readonly=!0},onEdit:function(){this.readonly=!1},getInitData:function(){return this.onCancel(),this.$refs.ComCustomerForm.getInitData(this.params)},onSubmit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.ComCustomerForm.validate();case 2:return e.loading=!0,t.prev=3,t.next=6,e.$refs.ComCustomerForm.submit();case 6:e.readonly=!0,t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](3);case 11:e.loading=!1;case 12:case"end":return t.stop()}}),t,null,[[3,9]])})))()},onCall:function(e,t){t.customerId?this.$eventBus.$emit("phonebar",{type:"makecall",payload:{args:[e,""],params:{phone:e,customerId:t.customerId}}}):this.$message.warning("请先编辑并保存客户信息后再呼叫！")}}},d=l,m=(n("46a4"),n("2877")),h=Object(m["a"])(d,c,s,!1,null,"8a8222fc",null),f=h.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._g(e._b({},"ui-table-view",e.viewProps,!1),e.viewListeners))},b=[],v=n("a02a"),w={mixins:[window.mixTableView],props:{action:Function,customerId:String},data:function(){return{columns:[{label:"通话类型",minWidth:80,render:function(e,t){var n=t.row;return e("div",1===n.dir?"呼入":"呼出")}},{label:"主叫号码",prop:"caller",minWidth:120},{label:"被叫号码",prop:"called",minWidth:120},{label:"开始时间",prop:"beginTime",minWidth:140},{label:"通话总时长",render:function(e,t){var n=t.row;return e("div",Object(v["j"])(n.callTimeLen))}},{label:"处理状态",minWidth:80,render:function(e,t){var n=t.row;return e("div",{1:"未接听",2:"已接听"}[n.callResult])}},{label:"客服",prop:"userName"}]}},watch:{customerId:{immediate:!0,handler:function(e){e&&this.getData()}}},methods:{fetchMethod:function(e){return this.action?this.action():this.$http("/ccas/call/info/list",{params:Object(i["a"])(Object(i["a"])({},e),{},{customerId:this.customerId})}).then((function(e){return e.data}))}}},I=w,g=Object(m["a"])(I,p,b,!1,null,null,null),C=g.exports,$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._g(e._b({},"ui-table-view",e.viewProps,!1),e.viewListeners))},O=[],j=n("fffc"),_={mixins:[window.mixTableView],props:["customerId"],data:function(){var e=this;return{columns:[{label:"工单编号",prop:"number",minWidth:140},Object(j["d"])(),{label:"优先级",minWidth:80,render:function(e,t){var n=t.row;return e("span",Object(j["e"])(n.priority))}},{label:"状态",minWidth:80,render:function(e,t){var n=t.row;return e("span",Object(j["f"])(n.status))}},{label:"分类",prop:"serviceName",minWidth:140},{label:"创建人",prop:"creator",minWidth:120},{label:"受理客服组",prop:"sgroupName",minWidth:120},{label:"受理客服",prop:"acceptor",minWidth:120},{label:"创建时间",prop:"createTime",minWidth:140},{label:"更新时间",prop:"modifyTime",minWidth:140},{label:"操作",width:100,fixed:"right",render:function(t,n){var r=n.row;return e.$hBtns([{label:"详情",action:e.onDetail},4===r.status&&{label:"激活",action:e.onActive},r.status<3&&{label:"催单",action:e.onUrgent}])(t,{row:r})}}]}},watch:{customerId:{immediate:!0,handler:function(e){e&&this.getData()}}},methods:{fetchMethod:function(e){return this.$post("/customerWorkOrder/getWorkOrder",Object(i["a"])(Object(i["a"])({},e),{},{customerId:this.customerId})).then((function(e){return e.data}))},onActive:function(e){this.$openModal((function(){return n.e("chunk-2d2133b8").then(n.bind(null,"ac99"))}),{row:{orderId:e.orderId,creatorId:this.$store.state.userData.userId},sgList:this.sgList},{success:this.onSearch})},onDetail:function(e){this.$router.push({name:"workorder-detail",params:{id:e.id}})},onUrgent:function(e){this.$openModal((function(){return n.e("chunk-2d208a99").then(n.bind(null,"a66d"))}),{row:{orderId:e.id,creatorId:e.creatorId}},{success:this.onSearch})}}},x=_,y=Object(m["a"])(x,$,O,!1,null,null,null),k=y.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._g(e._b({},"ui-table-view",e.viewProps,!1),e.viewListeners))},T=[],D={mixins:[window.mixTableView],props:["customerId"],data:function(){return{columns:[{label:"会话开始时间",prop:"servicetime",minWidth:140},{label:"会话时长",render:function(e,t){var n=t.row;return e("span",Object(v["j"])(n.sessiontimes))}},{label:"最后接待客服",prop:"agentno"},{label:"所属业务",prop:"datadept"},{label:"处理状态",render:function(e,t){var n=t.row;return e("span",{inservice:"服务中",end:"结束",inqueue:"队列中"}[n.status])}},{label:"满意度",minWidth:140,render:function(e,t){var n=t.row;return e("el-rate",{props:{disabled:!0,value:n.satisfaction}})}},{label:"操作",width:80,fixed:"right",render:this.$hBtns({label:"详情",action:this.onDetail})}]}},watch:{customerId:{immediate:!0,handler:function(e){e&&this.getData()}}},methods:{fetchMethod:function(e){return this.$http("/ccas/cc/other/api/im/session/record",{params:Object(i["a"])(Object(i["a"])({},e),{},{customerId:this.customerId})}).then((function(e){var t=e.data;return{data:t.records,total:t.total}}))},onDetail:function(e){this.$openModal((function(){return Promise.all([n.e("chunk-6897f789"),n.e("chunk-46b39c0b"),n.e("chunk-1e33e32b")]).then(n.bind(null,"36b6"))}),{row:Object(i["a"])(Object(i["a"])({},e),{},{customerId:this.customerId})})}}},W=D,E=Object(m["a"])(W,S,T,!1,null,null,null),A=E.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._b({},"ui-table-view",e.viewProps,!1))},M=[],R={mixins:[window.mixTableView],props:["customerId"],data:function(){return{columns:[{label:"联系人",prop:"contactName"},{label:"联系电话",prop:"contactPhone"},{label:"性别",render:function(e,t){var n=t.row;return e("div",{1:"男",2:"女"}[n.contactSex])}},{label:"预约时间",prop:"reserveTime",minWidth:140},{label:"联系状态",render:function(e,t){var n=t.row;return e("div",{1:"已预约",2:"已联系"}[n.planStatus])}}]}},watch:{customerId:{immediate:!0,handler:function(e){e&&this.getData()}}},methods:{fetchMethod:function(e){return this.$http("/ccas/call/manual/contact/list/by/customerId?customerId=".concat(this.customerId),{params:e}).then((function(e){return e.data}))}}},F=R,L=Object(m["a"])(F,P,M,!1,null,null,null),N=L.exports,U=function(e,t){return{render:function(n){return n(e,{props:t})}}},V={components:{CustomerInfo:f},data:function(){return{customerId:null,customerParams:{}}},computed:{tabs:function(){var e={customerId:this.customerId};return this.customerId?[{label:"呼叫历史",component:U(C,e)},{label:"工单",component:U(k,e)},{label:"IM历史",component:U(A,e)},{label:"联系计划",component:U(N,e)}]:[]},callId:function(){return this.$route.params.callId},callType:function(){return this.$route.params.callType}},watch:{callId:"onMerged"},created:function(){this.setCustomerParams(),this.$route.meta.title=1===+this.callType?"来电信息":"呼叫信息"},beforeRouteUpdate:function(e,t,n){this.$route.meta.title=1===+e.params.callType?"来电信息":"呼叫信息",n()},methods:{setCustomerParams:function(){var e=this,t=this.$route.params;this.customerParams={customerSource:7,phone:t.phone,callId:t.callId,saveAction:function(n){return e.$post("/ccas/call/info/phone/bar/call/bind/customer",Object(i["a"])(Object(i["a"])({},n),{},{callId:t.callId}))}}},refresh:function(){var e=this.$refs.UiTabView;if(e){var t=e.getCurrentView();t&&(t.getData?t.getData():(t=t.$children[0],t&&t.getData()))}},openModal:function(e,t){this.$openModal(e,t,{success:this.refresh})},onCreateWorkorder:function(){this.openModal((function(){return n.e("chunk-497ef431").then(n.bind(null,"4bd2"))}),{customerInfo:{channelId:1,customerId:this.customerId}})},onAddContactPlan:function(){this.openModal((function(){return n.e("chunk-4118640c").then(n.bind(null,"f935"))}),{customerId:this.customerId})},getCustomerId:function(e){this.customerId=e},onSendSms:function(e){this.$openModal((function(){return n.e("chunk-97d13c26").then(n.bind(null,"3772"))}),{row:{contactPhone:e},userData:this.$store.state.userData})},mergeAction:function(e){return this.$post("/ccas/call/info/phone/bar/call/bind/merge/customer",Object(i["a"])(Object(i["a"])({},e),{},{callId:this.callId}))},onMerged:function(){var e=this;this.setCustomerParams(),this.$nextTick(Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.CustomerInfo.getInitData();case 2:e.refresh();case 3:case"end":return t.stop()}}),t)}))))}}},B=V,X=(n("ca2e"),Object(m["a"])(B,r,a,!1,null,"6de36bf4",null));t["default"]=X.exports},ca2e:function(e,t,n){"use strict";n("e614")},e614:function(e,t,n){},fffc:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"f",(function(){return m})),n.d(t,"h",(function(){return h})),n.d(t,"e",(function(){return f})),n.d(t,"g",(function(){return b})),n.d(t,"d",(function(){return v}));n("1da1"),n("2909"),n("5530");var r=n("ade3"),a=(n("96cf"),n("7db0"),n("d3b7"),n("b0c0"),n("a15b"),n("99af"),n("d81d"),n("4de4"),n("b64b"),n("caad"),n("2532"),n("3ca3"),n("ddb0"),n("159b"),n("a02a"),{label:"尚未受理",value:0}),o={label:"受理中",value:1},i={label:"等待回复",value:2},c={label:"已解决",value:3},s={label:"已关闭",value:4},u=[a,o,i],l=[a,o,i,c,s],d=[o,c,s],m=function(e){return(l.find((function(t){return t.value===e}))||{}).label},h=[{label:"低",value:0},{label:"中",value:1},{label:"高",value:2},{label:"紧急",value:3}],f=function(e){return(h.find((function(t){return t.value===e}))||{}).label},p={INPUT:0,TEXTAREA:1,RADIO:2,CHECKBOX:3,SELECT:4},b=(function(e){var t;t={},Object(r["a"])(t,e.INPUT,"单行文本框"),Object(r["a"])(t,e.TEXTAREA,"多行文本框"),Object(r["a"])(t,e.RADIO,"单选框"),Object(r["a"])(t,e.CHECKBOX,"复选框"),Object(r["a"])(t,e.SELECT,"下拉框")}(p),function(e,t){var n=[],r=e.find((function(e){return e.id===t}));while(r)n.unshift(r.name),r=e.find((function(e){return e.id===r.parentId}));return n.join(" / ")}),v=function(){return{label:"工单标题",prop:"name",minWidth:120,render:function(e,t){var n=t.row;return 1===n.flag&&new Date-new Date(n.lastUrgeTime)<864e5?e("span",[e("span",{style:"color:#E59208;border:1px solid #E59208;padding:2px;margin-right:5px"},"催"),e("span",n.name)]):e("span",n.name)}}}}}]);