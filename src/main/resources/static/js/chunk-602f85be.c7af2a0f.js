(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-602f85be"],{c740:function(t,e,n){"use strict";var i=n("23e7"),r=n("b727").findIndex,a=n("44d2"),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),i({target:"Array",proto:!0,forced:s},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(o)},ed92:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"warning",closable:!1,title:"您可以根据业务需求自定义工单字段。字段被启用后，即可以在创建工单页进行填写，也可以在工单详情页进行查看和导出。"}}),n("ui-table-view",t._b({},"ui-table-view",Object.assign({},t.viewProps,{hidePager:!0}),!1),[n("el-button",{attrs:{slot:"actions",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.onEdit()}},slot:"actions"},[t._v("添加新字段")])],1)],1)},r=[],a=n("5530"),o=(n("4e82"),n("d3b7"),n("3ca3"),n("ddb0"),n("c740"),n("7db0"),n("a434"),n("fffc")),s={mixins:[window.mixTableView],data:function(){var t=this;return{types:o["h"],columns:[{label:"字段标题",prop:"name"},{label:"字段类型",render:function(e,n){var i=n.row;return e("span",t.types[i.type])}},{label:"是否必填",minWidth:80,render:function(t,e){var n=e.row;return t("span",n.flag?"是":"否")}},{label:"字段描述",prop:"description",minWidth:120},{label:"状态",render:function(e,n){var i=n.row,r=n.$index;return i.readonly?e("span","默认开启"):e("div",[e("el-switch",{style:"margin-right:5px",props:{value:!!i.status},on:{change:t.onUpdateStatus.bind(t,r)}}),e("span",i.status?"开启":"关闭")])}},{label:"操作",width:120,fixed:"right",render:function(e,n){var i=n.row;return i.readonly?e("span","-- --"):t.$hBtns([{props:{icon:"el-icon-edit"},action:t.onEdit},{props:{icon:"el-icon-delete"},action:t.onDelete},{props:{icon:"el-icon-top",disabled:t.disableMoveUp(i)},action:t.onMoveUp},{props:{icon:"el-icon-bottom",disabled:t.disableMoveDown(i)},action:t.onMoveDown}])(e,{row:i})}}]}},mounted:function(){this.getData()},methods:{fetchMethod:function(){return this.$http("/orderField/listByPage").then((function(t){var e=t.data;return e.sort((function(t,e){return t.readonly?e.readonly?0:-1:e.readonly?1:t.position-e.position})),{data:e}}))},onDelete:function(t){var e=this;this.delData({action:function(){return e.$http.post("/orderField/remove/".concat(t.id))}})},onEdit:function(t){var e=this;this.$openModal((function(){return n.e("chunk-f28a046e").then(n.bind(null,"d052"))}),{row:t,maxPos:this.tableData.data.reduce((function(t,e){return Math.max(t,e.position||0)}),0)},{success:function(){return e.getData()}})},onUpdateStatus:function(t){var e=this,n=this.tableData.data,i=n[t],r=+!i.status,o=function(t){e.$set(i,"status",t)};o(r),this.updateRow(Object(a["a"])(Object(a["a"])({},i),{},{status:r})).catch((function(){o(+!r)}))},updateRow:function(t){return this.$http.post("/orderField/update",t)},disableMoveUp:function(t){var e=this.tableData.data,n=e.findIndex((function(e){return e.id===t.id})),i=e[n-1];return!i||!!i.readonly},disableMoveDown:function(t){var e=this.tableData.data,n=e.findIndex((function(e){return e.id===t.id}));return n>=e.length-1},onMoveUp:function(t){var e=this,n=this.tableData.data,i=n.find((function(e){return e.id===t.id})),r=n.indexOf(i),o=n[r-1],s=i.position,u=o.position;this.loading=!0,Promise.all([this.updateRow(Object(a["a"])(Object(a["a"])({},i),{},{position:u})),this.updateRow(Object(a["a"])(Object(a["a"])({},o),{},{position:s}))]).then((function(){e.$set(i,"position",u),e.$set(o,"position",s),n.splice(r-1,2,i,o)})).finally((function(){e.loading=!1}))},onMoveDown:function(t){var e=this,n=this.tableData.data,i=n.find((function(e){return e.id===t.id})),r=n.indexOf(i),o=n[r+1],s=i.position,u=o.position;this.loading=!0,Promise.all([this.updateRow(Object(a["a"])(Object(a["a"])({},i),{},{position:u})),this.updateRow(Object(a["a"])(Object(a["a"])({},o),{},{position:s}))]).then((function(){e.$set(i,"position",u),e.$set(o,"position",s),n.splice(r,2,o,i)})).finally((function(){e.loading=!1}))}}},u=s,c=n("2877"),l=Object(c["a"])(u,i,r,!1,null,null,null);e["default"]=l.exports},fffc:function(t,e,n){"use strict";n.d(e,"n",(function(){return u})),n.d(e,"a",(function(){return h})),n.d(e,"f",(function(){return b})),n.d(e,"d",(function(){return m})),n.d(e,"e",(function(){return v})),n.d(e,"b",(function(){return g})),n.d(e,"j",(function(){return w})),n.d(e,"c",(function(){return T})),n.d(e,"o",(function(){return y})),n.d(e,"i",(function(){return O})),n.d(e,"h",(function(){return E})),n.d(e,"l",(function(){return j})),n.d(e,"k",(function(){return C})),n.d(e,"g",(function(){return x})),n.d(e,"m",(function(){return D}));var i=n("1da1"),r=n("2909"),a=n("5530"),o=n("ade3"),s=(n("96cf"),n("7db0"),n("d3b7"),n("b0c0"),n("a15b"),n("99af"),n("d81d"),n("4de4"),n("b64b"),n("caad"),n("2532"),n("3ca3"),n("ddb0"),n("159b"),n("a02a")),u="workorder",c={label:"尚未受理",value:0},l={label:"受理中",value:1},d={label:"等待回复",value:2},p={label:"已解决",value:3},f={label:"已关闭",value:4},h=[5,"已删除"],b=[c,l,d],m=[p,f],v=[c,l,d,p,f],g=[l,p,f],w=function(t){return(v.find((function(e){return e.value===t}))||{}).label},T=[[0,"我来受理工单","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很高兴为您服务！\n  我们已将您的请求生成工单 {TICKET_CODE} - {TICKET_TITLE}。该工单正在进行处理，一旦有任何更新我们会及时给您回复，请您耐心等待。"],[1,"尝试联系用户","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很抱歉在您百忙之中打扰您。\n  关于您的工单 {TICKET_CODE} - {TICKET_TITLE} ，我们希望确认您是否还存在其他疑问。鉴于还没有收到您的回复，我们会继续尝试联系您。如果您有任何进展或者其他疑问，可随时在系统中进行回复，感谢您的理解与支持。"],[2,"客服处理完毕，请用户确认","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 已完成处理，请在回复中进行确认。\n  希望我们的工作能使您满意，如您有任何建议或意见，欢迎回复告知我们，我们会努力改进。"],[3,"用户没有回复工单","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 用户超时未回复，置为已解决。"]],y=[{label:"低",value:0},{label:"中",value:1},{label:"高",value:2},{label:"紧急",value:3}],O=function(t){return(y.find((function(e){return e.value===t}))||{}).label},I={INPUT:0,TEXTAREA:1,RADIO:2,CHECKBOX:3,SELECT:4},E=function(t){var e;return e={},Object(o["a"])(e,t.INPUT,"单行文本框"),Object(o["a"])(e,t.TEXTAREA,"多行文本框"),Object(o["a"])(e,t.RADIO,"单选框"),Object(o["a"])(e,t.CHECKBOX,"复选框"),Object(o["a"])(e,t.SELECT,"下拉框"),e}(I),j=function(t){return!Object(s["v"])(t)&&t>1},C=function(t,e){var n=[],i=t.find((function(t){return t.id===e}));while(i)n.unshift(i.name),i=t.find((function(t){return t.id===i.parentId}));return n.join(" / ")},x=function(){return{label:"工单标题",prop:"name",minWidth:120,render:function(t,e){var n=e.row;return 1===n.flag&&new Date-new Date(n.lastUrgeTime)<864e5?t("span",[t("span",{style:"color:#E59208;border:1px solid #E59208;padding:2px;margin-right:5px"},"催"),t("span",n.name)]):t("span",n.name)}}},D={data:function(){var t=this,e=["number","name","channelId","status","sgroupName","acceptor","typeId","createTime"];return{priorities:y,types:[],skillGroups:[],states:v,allColumns:{base:{title:"基础字段",data:[{label:"工单编号",prop:"number",minWidth:140},x(),{label:"创建渠道",prop:"channelId",minWidth:80,render:function(t,e){var n=e.row;return t("span",1===n.channelId?"工单中心":"在线客服")}},{label:"工单描述",prop:"description",minWidth:120},{label:"工单状态",prop:"status",minWidth:80,render:function(t,e){var n=e.row;return t("span",w(n.status)||"已删除")}},{label:"优先级",prop:"priority",minWidth:80,render:function(t,e){var n=e.row;return t("span",O(n.priority))}},{label:"创建人",prop:"cuserName"},{label:"创建客服组",prop:"cgroupName",minWidth:120},{label:"受理客服组",prop:"sgroupName",minWidth:120},{label:"受理客服",prop:"acceptor"},{label:"分类",prop:"typeId",minWidth:140,render:function(e,n){var i=n.row;return e("span",t.getTypeText(i.typeId))}},{label:"创建时间",prop:"createTime",minWidth:140},{label:"首次响应时间",prop:"firstUpdateTime",minWidth:140},{label:"首次受理时间",prop:"firstAcceptTime",minWidth:140},{label:"更新时间",prop:"modifyTime",minWidth:140},{label:"首次解决时间",prop:"firstSolveTime",minWidth:140},{label:"最后回复人",prop:"lastReplingPersonName"}]},customer:{title:"客户字段",data:[{label:"客户昵称",prop:"customerNickName"},{label:"客户姓名",prop:"customerName"}]}},defaultProps:e,selectedProps:[].concat(e)}},computed:{typeList:function(){return Object(s["F"])(this.types.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{value:t.id,label:t.name})})))},showedColumns:function(){var t=this;return[{type:"selection"}].concat(Object(r["a"])(Object.keys(this.allColumns).reduce((function(e,n){return[].concat(Object(r["a"])(e),Object(r["a"])(t.allColumns[n].data))}),[]).filter((function(e){return t.selectedProps.includes(e.prop)}))))},typeId:function(){var t=this.searchForm.typeId;return t&&t.length?t[t.length-1]:""}},mounted:function(){this.setInitForm&&this.setInitForm(),this.getInitData(),Object(s["g"])(this,this.getInitData)},methods:{getStateText:w,getInitData:function(){this.isActive?this.getData():(this.onReset(),this.isActive=!0),this.getTypes(),this.getSkillGroups()},onDelete:function(t){var e=this;this.delData({rows:t,action:function(t){return e.$post("/workOrder/delete",{orderId:t.map((function(t){return t.id}))+""})}})},getSkillGroups:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http("/orderGroup/listGroup");case 2:t.skillGroups=e.sent.data;case 3:case"end":return e.stop()}}),e)})))()},getGroupText:function(t){return(this.skillGroups.find((function(e){return e.id===t}))||{}).name},onCreate:function(){this.$openModal((function(){return n.e("chunk-497ef431").then(n.bind(null,"4bd2"))}),{},{success:this.onEditSuccess})},onBatchImport:function(){this.$openModal((function(){return n.e("chunk-2d0da7ad").then(n.bind(null,"6c7a"))}),{typeList:this.typeList},{success:this.onEditSuccess})},onBatchExport:function(t,e){var n=this,i=e.typeId||[],r=i[i.length-1];r?Object(s["i"])({fileName:"工单批量导出数据.xls",action:function(){return n.$post(t,Object(a["a"])(Object(a["a"])({},e),{},{typeId:r}),{responseType:"blob"})}}):this.$message("请先选择分类再导出")},onDetail:function(t){this.$router.push({name:"".concat(u,"-detail"),params:{id:t.id}})},onAccept:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t instanceof Array?t.map((function(t){return t.id}))+"":t.id,n.next=3,e.$post("/workOrder/accept",{orderId:i});case 3:e.$message.success("接单成功"),e.getData();case 5:case"end":return n.stop()}}),n)})))()},getTypes:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http("/orderType/listByPage");case 2:t.types=e.sent.data;case 3:case"end":return e.stop()}}),e)})))()},getTypeText:function(t){return C(this.types,t)},onKeyChange:function(){var t=this;this.options.forEach((function(e){t.$set(t.searchForm,e[0],void 0)}))},onCustomField:function(){var t=this;this.$openModal("UiFieldCustom",{columns:this.allColumns,defaultProps:this.defaultProps,selectedProps:this.selectedProps},{success:function(e){t.selectedProps=e}})}}}}}]);