(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-79109a69"],{"0016":function(e,t,n){},"0eec":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefix},[n("div",{class:e.prefix+"_more"},[e.loading?n("i",{staticClass:"el-icon-loading"}):e.hasMore?n("el-link",{attrs:{underline:!1},on:{click:e.loadmore}},[e._v("加载更多")]):n("span",[e._v("没有更多数据")])],1),n("ul",{class:e.prefix+"_list"},e._l(e.reducedData,(function(t,a){return n("li",e._b({key:a},"li",e.getMsgView(t),!1))})),0)])},i=[],r=n("1da1"),s=(n("96cf"),n("8a79"),n("fb6a"),n("d81d"),n("4de4"),n("d3b7"),n("99af"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:[e.prefix,{isSelf:e.isSelf,isImg:e.isImg}]},[n("div",{class:[e.prefix+"_inner",{isSelf:e.isSelf,isImg:e.isImg}]},[n("header",{class:e.prefix+"_header"},[e._v(e._s(e.userName))]),n("main",{class:e.prefix+"_main"},[e.isSelf?[0===e.data.state?n("i",{staticClass:"el-icon-loading msg-state"}):-1===e.data.state?n("i",{staticClass:"el-icon-error msg-state error",attrs:{title:"点击重发"},on:{click:e.onResend}}):e._e()]:e._e(),n("div",{class:[e.prefix+"_content",e.data.messageType],on:{click:e.onContentClick}},[e.isImg?[n("div",{class:e.prefix+"_img"},[n("img",{attrs:{title:"单击查看大图",src:e.getSrc()},on:{click:e.onPreview}})]),n("el-image",{attrs:{src:e.getSrc(),"preview-src-list":e.imgUrls}})]:e.isVoice?n("div",[n("audio",{attrs:{controls:"",src:e.data.content},on:{play:e.onPlay}})]):e.isText?n("div",{domProps:{innerHTML:e._s(e.parseContent(e.data.content,!0))}}):n("div",{staticClass:"filebox"},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getFileName()))]),n("a",{staticClass:"el-icon-download",attrs:{title:"下载",target:"_blank",href:e.downloadUrl}})])],2)],2)])])}),o=[],c=n("2909"),l=(n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("498a"),n("5319"),n("60e2")),d=n("934a"),m={name:"ImUserMsg",inject:{inClient:{default:!1}},props:{data:Object,isSelf:Boolean,onSend:Function,imgUrls:{type:Array,default:function(){return[]}}},data:function(){return{prefix:"im-msg-user"}},computed:{userName:function(){var e=this.data.ext||{},t="agent"===this.data.source,n=this.data.senderName||e.name||e.senderName;return this.inClient?t?"客服":n:t?this.data.senderId:n},isImg:function(){return this.data.messageType===d["g"].IMAGE},isVoice:function(){return this.data.messageType===d["g"].VOICE},isText:function(){return this.data.messageType===d["g"].TEXT},isFile:function(){return[d["g"].TEXT,d["g"].IMAGE,d["g"].VOICE].indexOf(this.data.messageType)<0},downloadUrl:function(){return this.getApiUrl("/file/fileDownload/".concat(this.data.messageId))}},methods:{getApiUrl:function(e){return Object(l["g"])(Object(l["e"])(this.inClient),e)},parseContent:function(e){return"ai"===this.data.source?Object(d["j"])(e):Object(d["h"])(e,!0)},getSrc:function(){var e=this.data;return e.messageId?this.getApiUrl("/file/image/".concat(e.messageId)):e.content},getFileName:function(){var e=this.data,t=e.content,n=e.fileName;return t.name||n||t.split("/").pop()},onResend:function(){this.onSend&&Object(d["m"])(this.onSend,this.data.messageType===d["g"].TEXT?{content:this.data.content}:{file:this.data.file},this.inClient)},onPreview:function(){var e=this.$el.querySelector(".el-image img");e&&e.click()},onPlay:function(e){Object(c["a"])(document.body.querySelectorAll("audio")).forEach((function(t){t!==e.target&&t.pause()}))},onContentClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&t.parentElement.classList.contains("menu-item")){var n=t.textContent.replace(/^\d+\./,"").trim();this.onSend&&this.onSend({content:n})}}}},u=m,f=(n("fc45"),n("2877")),p=Object(f["a"])(u,s,o,!1,null,null,null),g=p.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[n("span",{class:e.prefix+"_inner"},[e.data.content?n("span",{class:e.prefix+"_content",domProps:{innerHTML:e._s(e.data.content)},on:{click:e.onClick}}):e._e(),n("span",[e._v(e._s(e.formatedTime))])])])},v=[],b=n("a02a"),x={name:"ImTipMsg",inject:{parentVM:{default:""}},props:{data:Object},data:function(){return{prefix:"im-msg-tip"}},computed:{formatedTime:function(){return Object(b["k"])(this.data.createTime)}},methods:{onClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&!t.classList.contains("is-disabled")){t.classList.add("is-disabled");var n=t.dataset.action;"leavemsg"===n&&this.parentVM&&this.parentVM.addMsg(this.parentVM.joinData)}}}},j=x,_=(n("92e5"),Object(f["a"])(j,h,v,!1,null,null,null)),w=_.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[e.submited?n("div",[e._v("留言提交成功，感谢您的参与！")]):n("div",{class:e.prefix+"_box"},[n("header",{class:e.prefix+"_header"},[e._v("当前没有客服在线，请留言")]),n("el-form",{ref:"Form",class:e.prefix+"_form",attrs:{"label-width":"6em",size:"mini",model:e.form,rules:e.rules}},[e.config.lvmname?n("el-form-item",{attrs:{label:"您的姓名"}},[n("el-input",{attrs:{maxlength:"30"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),e.config.lvmphone?n("el-form-item",{attrs:{label:"您的电话",prop:"mobile"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1):e._e(),e.config.lvmemail?n("el-form-item",{attrs:{label:"您的邮箱",prop:"email"}},[n("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1):e._e(),e.config.lvmaddress?n("el-form-item",{attrs:{label:"您的地址"}},[n("el-input",{attrs:{maxlength:"50"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1):e._e(),e.config.lvmqq?n("el-form-item",{attrs:{label:"您的QQ",prop:"qq"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.qq,callback:function(t){e.$set(e.form,"qq",t)},expression:"form.qq"}})],1):e._e(),n("el-form-item",{attrs:{label:"留言内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"300"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),n("el-form-item",[n("div",{class:e.prefix+"_btnBox"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.loading?"提交中...":"提交"))])],1)])],1)],1)])},I=[],k=n("5530"),O=(n("00b4"),n("3ca3"),n("ddb0"),n("4328")),T=n.n(O),D={name:"ImLeaveMessage",props:{data:Object},data:function(){return{prefix:"im-msg-leave-message",form:{},rules:{mobile:{trigger:"blur",validator:function(e,t,n){!t||b["a"].pattern.test(t)?n():n(new Error(b["a"].message))}},email:{trigger:"blur",type:"email",message:"邮箱格式不正确"},qq:{trigger:"blur",type:"number",validator:function(e,t,n){!t||/^\d{5,12}$/.test(t)?n():n(new Error("QQ格式不正确"))}},content:{trigger:"blur",required:!0,validator:function(e,t,n){t&&t.trim()?n():n(new Error("请输入留言内容"))}}},loading:!1,submited:!1}},computed:{config:function(){return this.data.inviteData}},methods:{onSubmit:function(){var e=this;this.$refs.Form.validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return a=e.data,t.prev=2,t.next=5,Promise.all([e.$http.post("/leavemsg/",Object(k["a"])(Object(k["a"])({},e.form),{},{orgi:a.orgi,userid:a.userid})),e.$http.post("/message/saveMessage",T.a.stringify({content:e.form.content,customerId:a.userid,entId:a.orgi}),{baseURL:Object(l["d"])(!0)})]);case 5:e.submited=!0,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}}},S=D,C=(n("3687"),Object(f["a"])(S,y,I,!1,null,null,null)),M=C.exports,$={name:"ImMsgList",inject:{inClient:{default:!1}},props:{imUser:{type:Object,default:function(){return{}}},hasMore:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},onSend:Function,onLoadmore:Function},data:function(){return{loading:!1,prefix:"im-msg-list"}},computed:{imgUrls:function(){var e=Object(l["e"])(this.inClient);return e.endsWith("/")&&(e=e.slice(0,-1)),this.data.filter((function(e){return e.messageType===d["g"].IMAGE})).map((function(t){return t.messageId?"".concat(e,"/file/image/").concat(t.messageId):t.content}))},reducedData:function(){return Object(d["l"])(this.data)}},watch:{data:{immediate:!0,handler:"onDataChange"}},methods:{getMsgView:function(e){var t="client",n=this.imUser.source===t,a=["system","allot","ainew"].indexOf(e.cmdType)>-1||"system"===e.source;if(a)return{is:w,data:e};if("leavemsg"===e.cmdType)return{is:M,data:e};var i=n?e.source===t:e.source!==t;return{is:g,data:e,isSelf:i,imgUrls:this.imgUrls,onSend:this.onSend}},toBottom:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))},loadmore:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.onLoadmore||e.loading){t.next=15;break}return e.loading=!0,e.preventScroll=!0,n=e.data[0]||{},a=n.messageId,t.prev=4,t.next=7,e.onLoadmore(a);case 7:i=t.sent,i.length||(e.preventScroll=!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),e.preventScroll=!1;case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})))()},onDataChange:function(){this.preventScroll?this.preventScroll=!1:this.toBottom()}}},q=$,E=(n("a70f"),Object(f["a"])(q,a,i,!1,null,null,null));t["a"]=E.exports},3687:function(e,t,n){"use strict";n("b6f6")},"3afa":function(e,t,n){"use strict";n("8d2a")},"3b6c":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefix},[n("main",{class:e.prefix+"_window"},[n("div",{class:e.prefix+"_chat"},[n("header",{class:e.prefix+"_header"},[e._v(e._s(e.showImageBtn?"客服":e.joinData.receiverName))]),n("main",{class:e.prefix+"_main"},[n("com-body",{attrs:{data:e.messages,imUser:e.joinData,hasMore:e.connected&&e.hasMore,onSend:e.sendMsg,onLoadmore:e.onLoadmore}})],1),n("footer",{class:e.prefix+"_footer"},[n("com-footer",{attrs:{onSend:e.sendMsg,showImageBtn:e.showImageBtn,connected:e.connected&&!e.isEnd,loading:e.footerLoading}},[n("template",{slot:"toolbar"},[e.showTransferBtn?n("el-link",{staticClass:"tool-btn",attrs:{underline:!1,icon:"el-icon-service",title:"转人工"},on:{click:e.onTransferArtificial}}):e._e()],1)],2)],1)]),n("aside",{class:e.prefix+"_aside"},[n("header",{class:e.prefix+"_header"},[e._v("企业信息")]),n("main",{class:e.prefix+"_main"},[n("el-form",{class:e.prefix+"_company-info",attrs:{"label-width":"5em"}},[n("el-form-item",{attrs:{label:"企业名称"}},[e._v(e._s(e.inviteData.dialogName))]),n("el-form-item",{attrs:{label:"企业地址"}},[e._v(e._s(e.inviteData.dialogAddress))]),n("el-form-item",{attrs:{label:"联系电话"}},[e._v(e._s(e.inviteData.dialogPhone))]),n("el-form-item",{attrs:{label:"企业邮箱"}},[e._v(e._s(e.inviteData.dialogMail))])],1)],1),n("footer",{class:e.prefix+"_footer"},[n("p",{class:e.prefix+"_intro"},[e._v(e._s(e.inviteData.dialogIntroduction))])])])])])},i=[],r=n("2909"),s=n("3835"),o=n("15fd"),c=n("5530"),l=n("1da1"),d=(n("96cf"),n("caad"),n("d3b7"),n("159b"),n("b64b"),n("e9c4"),n("7db0"),n("bd90")),m=n("934a"),u=n("0eec"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:e.prefix},[n("header",{class:e.prefix+"_header"},[n("ui-emoji-list",{on:{"item-click":e.insertContent}},[n("span",{staticClass:"btn btn-emoji",attrs:{title:"表情"}})]),e.showImageBtn?[n("span",{staticClass:"btn el-icon-folder btn-file",attrs:{title:"文件"},on:{click:e.onSelectFile}})]:e._e(),e._t("toolbar")],2),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],class:e.prefix+"_input",domProps:{value:e.content},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.onKeydown.apply(null,arguments))},paste:e.onPaste,input:function(t){t.target.composing||(e.content=t.target.value)}}}),n("footer",{class:e.prefix+"_footer"},[n("span",{staticClass:"tip"},[e._v("按下Ctrl + Enter换行")]),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.send}},[e._v("发送")])],1),n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",multiple:""},on:{change:e.onFileChange}}),e.connected?e._e():n("div",{class:e.prefix+"_overlay"})])},p=[],g=(n("d81d"),n("a630"),n("3ca3"),n("4de4"),n("2ca0"),n("ddb0"),n("2b3d"),n("9861"),n("a15b"),n("498a"),n("a02a")),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popover",{attrs:{placement:"top-start","popper-class":e.prefix},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("template",{slot:"reference"},[e._t("default")],2),n("ul",{class:e.prefix+"_list"},e._l(e.emojiMap,(function(t,a){return n("li",{key:a,class:e.prefix+"_item"},[n("img",e._b({class:e.prefix+"_img",on:{click:function(n){return e.$emit("item-click",t.alt)}}},"img",Object.assign({},t,{title:t.alt}),!1))])})),0)],2)},v=[],b=n("89f6"),x={name:"ImEmojiList",data:function(){return{emojiMap:b["a"],visible:!1,prefix:"im-emoji-list"}}},j=x,_=(n("3afa"),n("2877")),w=Object(_["a"])(j,h,v,!1,null,null,null),y=w.exports,I={name:"ImMsgForm",inject:{inClient:{default:!1}},components:{UiEmojiList:y},props:{onSend:Function,connected:Boolean,showImageBtn:{type:Boolean,default:!0},loading:Boolean},data:function(){return{prefix:"im-msg-form",content:""}},methods:{insertContent:function(e){var t=this.$el.querySelector("textarea");this.content=Object(g["r"])(t,e)},onSelectFile:function(){this.$refs.File.click()},onFileChange:function(e){var t=this,n=e.target;if(n.files.length>9)return this.$message.error("一次最多支持发送9个文件");this.onSend&&Array.from(n.files).map((function(e){Object(m["m"])(t.onSend,{file:e},t.inClient)})),n.value=""},onKeydown:function(e){e.ctrlKey||e.shiftKey?this.insertContent("\n"):this.send()},onPaste:function(e){var t=this,n=e.clipboardData;if(this.showImageBtn&&!n.getData("text")){var a=Array.from(n.files).filter((function(e){return e.type.startsWith("image/")}));if(a.length&&this.onSend){e.preventDefault();var i=a.map((function(e){return window.URL.createObjectURL(e)})),r=i.map((function(e){return'<img src="'.concat(e,'" style="max-width:180px;max-height:180px;margin:5px 5px 5px 0">')})).join(""),s="<div><p>确定要发送如下图片？</p>".concat(r,"</div>");this.$confirm(s,"发送图片",{dangerouslyUseHTMLString:!0}).then((function(){Promise.all(a.map((function(e){return Object(m["m"])(t.onSend,{file:e},t.inClient)}))).finally((function(){i.forEach((function(e){window.URL.revokeObjectURL(e)}))}))}))}}},send:function(){var e=this,t=this.content.trim();t&&this.onSend&&(this.content="",Object(m["m"])(this.onSend,{content:t}).catch((function(n){e.content=t,e.$message.error(n.message)})))}}},k=I,O=(n("cb86"),Object(_["a"])(k,f,p,!1,null,null,null)),T=O.exports,D=["sequenceId"],S=null;m["f"].start();var C={components:{ComBody:u["a"],ComFooter:T},provide:function(){return{inClient:!0,parentVM:this}},data:function(){return{prefix:"page-chat",messages:[],joinData:{},hasMore:!0,footerLoading:!1,isEnd:!1}},computed:{inviteData:function(){return this.joinData.inviteData||{}},connected:function(){return["webimnew","ainew"].indexOf(this.joinData.cmdType)>-1&&this.joinData.receiverId},showTransferBtn:function(){return"ainew"===this.joinData.cmdType},showImageBtn:function(){return"webimnew"===this.joinData.cmdType}},mounted:function(){this.init()},methods:{init:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$route.params.id,a=e.$route.query,!n||!a.orgi){t.next=23;break}return t.next=5,d["a"](Object(c["a"])({appId:n},a));case 5:return i=t.sent,e.joinData=Object(c["a"])(Object(c["a"])({},i),{},{queryParams:a}),t.next=9,e.getChatRecords();case 9:if("leavemsg"!==i.cmdType){t.next=13;break}e.addMsg(i),t.next=23;break;case 13:if(!["webimnew","inservice"].includes(i.cmdType)){t.next=17;break}e.onTransferArtificial(),t.next=23;break;case 17:if("ainew"!==i.cmdType){t.next=23;break}return t.next=20,d["c"](i);case 20:r=t.sent,e.messages.push(r),e.joinData=Object(c["a"])(Object(c["a"])({},e.joinData),{},{sequenceId:r.sequenceId,receiverName:r.ext.senderName,receiverId:r.senderId,sessionId:r.ext.sessionId});case 23:case"end":return t.stop()}}),t)})))()},onTransferArtificial:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.footerLoading=!0,t.prev=1,t.next=4,e.$http("/im/webimnewBefore",{params:{orgi:e.joinData.orgi,appId:e.joinData.appId}});case 4:n=t.sent,a=n.data,a&&"leavemsg"===a.cmdType?(e.addMsg(m["b"]({cmdType:"system",content:"".concat(a.message,' <a data-action="leavemsg">点击留言</a>'),createTime:+new Date,sequenceId:m["d"](e.messages)})),e.joinData=Object(c["a"])(Object(c["a"])({},e.joinData),{},{cmdType:"leavemsg"})):(e.createWS(),e.joinData=Object(c["a"])(Object(c["a"])({},e.joinData),{},{cmdType:"webimnew"})),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](1);case 11:e.footerLoading=!1;case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))()},addMsg:function(e){var t=this,n=m["i"](e.ext),a=(n.sequenceId,Object(o["a"])(n,D));Object.keys(a).forEach((function(n){t.$set(e,n,a[n])})),this.messages.push(e)},sendMsg:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var a,i,r,s,o,l,u,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.joinData,i=t.messages,r=a.queryParams,s=void 0===r?{}:r,o="ainew"===a.cmdType,e=m["b"](Object(c["a"])({senderId:a.userid,receiverId:a.receiverId,sequenceId:m["d"](i),source:"client",ext:{sequenceId:a.sequenceId||"",orgi:a.orgi,receiverName:a.receiverName,senderName:a.nickname,agentserviceid:o?a.aiid:a.agentserviceid,sessionId:a.sessionId,appId:a.appId,email:s.email,phone:s.phone}},e)),l=JSON.parse(JSON.stringify(e)),t.addMsg(e),!o){n.next=22;break}return n.prev=7,n.next=10,d["b"].post("/ai/chatMessage",l);case 10:u=n.sent,f=u.data,a.sequenceId=f.sequenceId,t.$set(e,"state",1),"true"===f.artificial?t.onTransferArtificial():t.addMsg(f),n.next=20;break;case 17:n.prev=17,n.t0=n["catch"](7),t.$set(e,"state",-1);case 20:n.next=24;break;case 22:e.messageType===m["g"].TEXT&&m["n"](S,e),m["f"].push(e);case 24:return n.abrupt("return",e);case 25:case"end":return n.stop()}}),n,null,[[7,17]])})))()},sendHeart:function(){var e=this.joinData.queryParams,t=void 0===e?{}:e;m["n"](S,{cmdType:"heartbeat",senderId:this.joinData.userid,content:"ping",ext:{orgi:this.joinData.orgi,email:t.email,phone:t.phone}})},getChatRecords:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a,i,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=Object(s["a"])(e.messages,1),i=a[0],o=e.joinData,t.next=4,d["b"]("/chatMessage/moremsg",{params:{size:30,source:"client",orgi:o.orgi,userid:o.userid,messageId:i?i.messageId:""}});case 4:return c=t.sent,l=c.data,(n=e.messages).unshift.apply(n,Object(r["a"])(l)),t.abrupt("return",l);case 8:case"end":return t.stop()}}),t)})))()},onLoadmore:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getChatRecords();case 2:return n=t.sent,e.hasMore=n.length>0,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()},createWS:function(){var e=this;S=m["c"]({onmessage:function(t){var n=t.cmdType,a=m["i"](t.ext),i=function(){e.joinData=Object(c["a"])(Object(c["a"])({},e.joinData),{},{receiverName:a.receiverName,receiverId:t.receiverId,agentserviceid:a.agentserviceid})};if("heartbeat"!==n&&m["o"](t),"allot"===n)i(),e.addMsg(t);else if("inservice"===n)i();else if("heartbeat"===n)m["e"].start(S,e.sendHeart.bind(e));else if("ack"===n){var r=e.messages.find((function(e){return+e.sequenceId===+t.sequenceId}));r&&(e.$set(r,"state",1),e.$set(r,"createTime",+t.createTime),e.$set(r,"messageId",t.messageId))}else t.messageId&&m["n"](S,{cmdType:"ack",messageId:t.messageId,receiverId:t.receiverId}),"message"===n?(e.addMsg(t),e.joinData=Object(c["a"])(Object(c["a"])({},e.joinData),{},{receiverName:a.senderName,receiverId:t.senderId,agentserviceid:a.agentserviceid,sessionId:a.sessionId})):"end"===n?(e.isEnd=!0,e.addMsg(t)):"satisfact"===n&&d["d"]({data:Object(c["a"])({},e.joinData),onSuccess:function(){e.addMsg({source:"system",content:"评价提交成功，感谢您的参与！",createTime:+new Date})}})},onopen:function(){var t=e.joinData,n=t.queryParams,a=void 0===n?{}:n;m["e"].start(S,e.sendHeart.bind(e)),m["n"](S,{cmdType:"webimnew",senderId:t.userid,ext:{orgi:t.orgi,senderName:t.nickname,sessionId:t.sessionId,appId:t.appId,ip:t.ip,osname:t.osname,browser:t.browser,email:a.email,phone:a.phone,channel:t.channel}}),e.footerLoading=!1},onclose:function(){m["k"](e.createWS.bind(e))}},!0)}}},M=C,$=(n("5f8b"),Object(_["a"])(M,a,i,!1,null,null,null));t["default"]=$.exports},"5f8b":function(e,t,n){"use strict";n("da96")},"88cf":function(e,t,n){},"8d2a":function(e,t,n){},"92e5":function(e,t,n){"use strict";n("e13a")},a70f:function(e,t,n){"use strict";n("0016")},ab4b:function(e,t,n){},b6f6:function(e,t,n){},cb86:function(e,t,n){"use strict";n("ab4b")},da96:function(e,t,n){},e13a:function(e,t,n){},fc45:function(e,t,n){"use strict";n("88cf")}}]);