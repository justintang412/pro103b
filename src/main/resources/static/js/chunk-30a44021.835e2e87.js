(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30a44021"],{"2d1e":function(e,n,t){},abe4:function(e,n,t){"use strict";t.r(n);var s=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[t("el-form",{ref:"Form",attrs:{"label-width":"7em",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"分配方式"}},[t("el-radio-group",{attrs:{disabled:!!e.row.assignType},on:{change:e.onTypeChange},model:{value:e.form.assignType,callback:function(n){e.$set(e.form,"assignType",n)},expression:"form.assignType"}},e._l(e.assignTypes,(function(n){return t("el-radio",{key:n[0],attrs:{label:n[0]}},[e._v(e._s(n[1]))])})),1)],1),1===e.form.assignType?t("el-form-item",{attrs:{label:"分配规则"}},[t("el-radio-group",{on:{change:e.updateAssignInfos},model:{value:e.form.assignRule,callback:function(n){e.$set(e.form,"assignRule",n)},expression:"form.assignRule"}},e._l(e.assignRules,(function(n){return t("el-radio",{key:n[0],attrs:{label:n[0]}},[e._v(e._s(n[1]))])})),1),t("p",{staticClass:"tip"},[e._v("当前可分配数量 "),t("b",[e._v(e._s(e.total))]),e._v(" 条，选中 "),t("b",[e._v(e._s(e.form.workIds.length))]),e._v(" 位坐席人员")])],1):e.hasLimit?t("el-form-item",{attrs:{label:"抢单上限",required:""}},[t("el-input-number",{attrs:{disabled:!!e.row.assignType,"controls-position":"right",min:1},model:{value:e.form.grabAssignMax,callback:function(n){e.$set(e.form,"grabAssignMax",n)},expression:"form.grabAssignMax"}})],1):e._e(),t("ui-select",{attrs:{label:"选择技能组",prop:"queueId",options:e.queueList,props:{value:"queueId",label:"queueName"},filterable:"",disabled:!!e.row.assignType},on:{change:e.onSkillGroupChange},model:{value:e.form.queueId,callback:function(n){e.$set(e.form,"queueId",n)},expression:"form.queueId"}}),t("ui-select",{attrs:{label:"选择坐席",prop:"workIds",options:e.agentList,props:{value:"userId",label:"userName"},multiple:"","collapse-tags":""},on:{change:e.onAgentChange},model:{value:e.form.workIds,callback:function(n){e.$set(e.form,"workIds",n)},expression:"form.workIds"}}),e.assignWorkInfos.length?[t("el-divider"),t("el-form-item",{attrs:{"label-width":"0"}},[t("el-form",{attrs:{inline:""}},e._l(e.assignWorkInfos,(function(n){return t("el-form-item",{key:n.userId,attrs:{label:n.userName}},[t("el-input-number",{attrs:{min:0,max:e.calcMax(n),disabled:e.isAverage,placeholder:"分配数量"},model:{value:n.assignCount,callback:function(t){e.$set(n,"assignCount",t)},expression:"_.assignCount"}})],1)})),1)],1)]:e._e()],2)],1)},r=[],a=t("5530"),o=t("1da1"),i=(t("96cf"),t("7db0"),t("d3b7"),t("4de4"),t("d81d"),t("b0c0"),t("159b"),t("a02a")),u={props:["row","total","isRecover"],data:function(){var e=this,n=this.row,t=[[1,"按数量"],[2,"抢单"]],s=[[1,"平均分配"],[2,"自由分配"]];return{rules:{queueId:Object(i["z"])("请选择技能组"),workIds:Object(i["z"])("请选择坐席")},form:{assignType:n.assignType||t[0][0],assignRule:s[0][0],workIds:[],queueId:+n.assignQueueId||void 0,grabAssignMax:n.grabAssignMax||void 0},modalProps:{title:"分派",width:"500px",onSubmit:function(){var n=Object(o["a"])(regeneratorRuntime.mark((function n(){var t,s,r,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$refs.Form.validate();case 2:return t=function(n){throw e.$message.error(n),new Error(n)},e.hasLimit&&isNaN(e.form.grabAssignMax)&&t("请输入抢单上限"),s=e.form,r=e.queueList.find((function(e){return e.queueId===s.queueId})),o=1===s.assignType?e.assignWorkInfos.filter((function(e){return e.assignCount})):e.idsToWorks(s.workIds),i=e.isRecover?"/ccas/call/manual/event/recover/assign":"/ccas/call/manual/event/assign",n.next=10,e.$http.post(i,Object(a["a"])(Object(a["a"])({},s),{},{assignWorkInfos:o,eventId:e.row.eventId,queueName:r&&r.queueName}));case 10:return n.abrupt("return",n.sent);case 11:case"end":return n.stop()}}),n)})));function t(){return n.apply(this,arguments)}return t}()},queueList:[],agentList:[],assignWorkInfos:[],assignTypes:t,assignRules:s}},computed:{isAverage:function(){return 1===this.form.assignRule},hasLimit:function(){return 2===this.form.assignType},assignStat:function(){var e=this.total,n=this.assignWorkInfos.reduce((function(e,n){return e+(n.assignCount||0)}),0),t=e-n;return{count:e,selectedCount:n,overCount:t}}},mounted:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var t,s,r,a,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getQueueList(),t=e.form,s=t.queueId,r=t.assignType,!s){n.next=12;break}return n.next=5,e.getAgentList(s);case 5:if(2!==r){n.next=12;break}return n.next=8,e.$http("/ccas/call/manual/event/grab/assigned/info/".concat(e.row.eventId));case 8:a=n.sent,o=a.data,i=e.agentList.map((function(e){return e.userId})),e.form.workIds=o.map((function(e){return e.userId})).filter((function(e){return i.indexOf(e)>-1}));case 12:case"end":return n.stop()}}),n)})))()},methods:{getQueueList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var t,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http("/queue/getAllQueueNoPage",{params:{entId:e.row.entid}});case 2:t=n.sent,s=t.data,e.queueList=s;case 5:case"end":return n.stop()}}),n)})))()},getAgentList:function(e){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.$http("/cti/work/getWorkByQueueid",{params:{entId:n.row.entid,queueId:e}});case 2:s=t.sent,r=s.data,n.agentList=r.map((function(e){return{userId:e.user_id,userName:e.name,workName:e.workname,workNo:e.workno,assignCount:0}}));case 5:case"end":return t.stop()}}),t)})))()},updateAssignInfos:function(){var e=this;if(1===this.form.assignRule){var n=this.assignWorkInfos.length,t=Math.floor(this.total/n),s=this.total-t*n;this.assignWorkInfos.forEach((function(n,r){e.$set(n,"assignCount",r<s?t+1:t)}))}},idsToWorks:function(e){var n=this;return e.map((function(e){return Object(a["a"])({},n.agentList.find((function(n){return n.userId===e})))}))},onTypeChange:function(){this.form.workIds=[],this.assignWorkInfos=[]},onSkillGroupChange:function(e){this.getAgentList(e),this.onTypeChange()},onAgentChange:function(e){1===this.form.assignType&&(this.assignWorkInfos=this.idsToWorks(e),this.updateAssignInfos())},calcMax:function(e){return this.assignStat.overCount+(e.assignCount||0)}}},l=u,c=(t("d11b"),t("2877")),f=Object(c["a"])(l,s,r,!1,null,"66781456",null);n["default"]=f.exports},d11b:function(e,n,t){"use strict";t("2d1e")}}]);