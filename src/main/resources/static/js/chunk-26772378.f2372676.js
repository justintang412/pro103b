(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26772378","chunk-c153ac08"],{"4bd2":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ui-modal",e._g(e._b({ref:"Modal",scopedSlots:e._u([{key:"footer",fn:function(){return[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")]),r("el-button",{on:{click:e.onCancel}},[e._v("取消")]),r("el-button",{on:{click:function(t){return e.onReset()}}},[e._v("清空")])]},proxy:!0}])},"ui-modal",e.modalProps,!1),e.$listeners),[r("el-form",{ref:"Form",attrs:{"label-width":"7em",model:e.form,rules:e.rules}},[r("h4",{staticClass:"form-header"},[e._v("工单内容")]),r("el-form-item",{attrs:{label:"工单分类",prop:"typeId"}},[r("el-cascader",{attrs:{options:e.types,filterable:""},on:{change:function(t){return e.getTemplates(e.form.typeId?e.form.typeId[e.form.typeId.length-1]:"")}},model:{value:e.form.typeId,callback:function(t){e.$set(e.form,"typeId",t)},expression:"form.typeId"}})],1),r("ui-text-field",{attrs:{label:"工单标题",prop:"name",placeholder:"最多输入100个字符"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),r("el-form-item",{attrs:{label:"问题描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:"10"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}}),r("com-upload",{attrs:{fileList:e.form.orderFiles}})],1),r("h4",{staticClass:"form-header"},[e._v("工单描述")]),r("el-form-item",{attrs:{label:"相关客户",prop:"customerId"}},[e.isDisable?r("span",[e._v(e._s(e.getCustomerName(e.form.customerId)))]):r("div",[r("el-select",{attrs:{filterable:""},model:{value:e.form.customerId,callback:function(t){e.$set(e.form,"customerId",t)},expression:"form.customerId"}},e._l(e.customerList,(function(e){return r("el-option",{key:e.customerId,attrs:{value:e.customerId,label:e.customerNickname}})})),1),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(t){return e.onAddCustomer()}}},[e._v("新建客户")]),r("el-button",{attrs:{type:"text"},on:{click:e.onPreciseSearch}},[e._v("精准查找")])],1)]),r("ui-select",{attrs:{label:"优先级",options:e.priorities},model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}}),r("ui-select",{attrs:{label:"工单状态",options:e.WO_STATES},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}}),r("ui-select",{attrs:{label:"受理客服组",options:e.skillGroups,props:{value:"id",label:"name"},clearable:""},on:{change:e.changeSgroup},model:{value:e.form.sgroupId,callback:function(t){e.$set(e.form,"sgroupId",t)},expression:"form.sgroupId"}}),r("ui-select",{attrs:{label:"受理客服",options:e.agents,props:{value:"userId",label:"name"},clearable:""},model:{value:e.form.acceptorId,callback:function(t){e.$set(e.form,"acceptorId",t)},expression:"form.acceptorId"}}),e._l(e.form.templates,(function(t,n){return r("el-form-item",{key:t.id,attrs:{label:t.name,prop:"templates."+n+".orderFieldValue",rules:{required:t.flag,message:t.name+"不能为空",trigger:t.type>1?null:"blur"}}},[0==t.type?r("el-input",{attrs:{placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}}):e._e(),1==t.type?r("el-input",{attrs:{type:"textarea",rows:"10",placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}}):e._e(),2==t.type?r("el-radio-group",{model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(e){return r("el-radio",{key:e.id,attrs:{label:e.content}})})),1):e._e(),3==t.type?r("el-checkbox-group",{model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.content}},[e._v(e._s(t.content))])})),1):e._e(),4==t.type?r("el-select",{attrs:{clearable:"",placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(e){return r("el-option",{key:e.id,attrs:{label:e.content,value:e.content}})})),1):e._e()],1)}))],2)],1)},i=[],o=r("5530"),a=r("1da1"),s=(r("96cf"),r("d81d"),r("b0c0"),r("a15b"),r("7db0"),r("d3b7"),r("a4d3"),r("e01a"),r("ac1f"),r("1276"),r("fb6a"),r("e9c4"),r("3ca3"),r("ddb0"),r("159b"),r("a02a")),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-upload",{attrs:{action:"",multiple:"",limit:10,"file-list":e.fileList,"on-remove":e.onFileRemove,"on-error":e.onFileError,"on-exceed":e.onFileExceed,"http-request":e.onFileUpload}},[r("el-link",{attrs:{type:"primary",icon:"el-icon-paperclip",underline:!1}},[e._v("上传附件")]),r("span",{staticClass:"el-upload__tip",staticStyle:{"margin-left":"5px"},attrs:{slot:"tip"},slot:"tip"},[e._v("(最多上传10个附件，单个文件最大20M)")])],1)},u=[],c=(r("c740"),r("a434"),r("99af"),{props:{fileList:{type:Array,default:function(){return[]}}},methods:{onFileRemove:function(e){var t=this.fileList;this.$post("/workOrder/remove",{fileName:e.fileName}).then((function(r){r.data;var n=t.findIndex((function(t){return t.fileName===e.response}));t.splice(n,1)}))},onFileExceed:function(e,t){this.$message.warning("当前限制选择 10个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},onFileUpload:function(e){var t=this,r=e.file,n=new FormData;return n.append("file",r),this.$http.post("/workOrder/upload",n).then((function(e){var r=e.data;return t.fileList.push({name:r.split("_").slice(1).join("_"),fileName:r}),r}))},onFileError:function(e){this.$message.error(e.message)},getFileName:function(e){return e.split("_").slice(1).join("_")}}}),d=c,p=r("2877"),f=Object(p["a"])(d,l,u,!1,null,null,null),m=f.exports,h=r("fffc"),b={components:{ComUpload:m},props:["row","customerInfo"],data:function(){var e=this;return{priorities:h["o"],WO_STATES:h["e"],types:[],rules:{typeId:Object(s["z"])("请选择工单分类"),name:Object(s["y"])("请输入工单标题"),description:Object(s["y"])("请输入问题描述"),customerId:Object(s["z"])("请选择关联客户")},skillGroups:[],agents:[],classificationData:[],customerList:[],customizeFields:[],isDisable:!1,form:{templates:[]},modalProps:{drawer:!0,width:"600px",isEdit:!!this.row,onSubmit:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.Form.validate();case 2:return r=e.form,n=r.templates.map((function(e){return{orderFieldId:e.id,orderFieldName:e.name,orderFieldValue:3===e.type?e.orderFieldValue.join(","):e.orderFieldValue}})),t.next=6,e.$http.post("/workOrder/saveOrUpdate",Object(o["a"])(Object(o["a"])({},r),{},{fieldValues:n,channelId:r.channelId||1,typeId:r.typeId[r.typeId.length-1]}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));function r(){return t.apply(this,arguments)}return r}()}}},mounted:function(){var e=this.row,t=this.customerInfo;this.onReset(e),this.getTypes(e),this.onCustomerList(),this.form=Object(o["a"])(Object(o["a"])({},this.form),{},{templates:[]}),this.getSkillGroups(),e&&e.sgroupId&&this.getAgents(e.sgroupId),t&&t.customerId?(this.isDisable=!0,this.$set(this.form,"customerId",t.customerId),this.$set(this.form,"channelId",t.channelId),2===t.channelId&&this.$set(this.form,"agentServiceId",t.agentserviceid)):this.isDisable=!1},methods:{onSubmit:function(){this.$refs.Modal.submit()},onCancel:function(){this.$refs.Modal.show(!1)},getTemplates:function(e,t){var r=this;if(e){var n=this.classificationData.find((function(t){return t.id===e}));e=n&&n.templateId}e&&(this.form.templateId=e,this.$http("/orderTemplate/listByPage?id=".concat(e)).then((function(e){var n=e.data;n.length?(r.$set(r.form,"description",n[0].description),n=n[0].filedList,r.form.templates=n.map((function(e,r){return e.orderFieldValue=t&&t.length&&t[r].orderFieldValue||"",t&&t.length&&t[r].orderFieldValue?e.orderFieldValue=3===+e.type?t[r].orderFieldValue.split(","):t[r].orderFieldValue:e.orderFieldValue=3===+e.type?[]:"",e}))):r.form.templates=[]})))},getCustomerName:function(e){var t=this.customerList.find((function(t){return t.customerId===e}));return t?t.customerNickname:""},getSkillGroups:function(){var e=this;this.$http("/orderGroup/listGroup").then((function(t){var r=t.data;e.skillGroups=r}))},getTypes:function(e){var t=this;this.$http("/orderType/listByPage").then((function(r){var n=r.data;t.classificationData=n,t.types=Object(s["F"])(n.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{value:e.id,label:e.name})}))),e&&t.getTemplates(e.typeId,e.fieldValues)}))},changeSgroup:function(e){this.$set(this.form,"acceptorId",void 0),this.getAgents(e)},getAgents:function(e){var t=this;this.agents=[],this.$post("/orderGroup/listByGroup",{groupId:e}).then((function(e){var r=e.data;t.agents=r}))},getFileName:function(e){return e.split("_").slice(1).join("_")},onReset:function(e){var t=this;this.form=e?Object(o["a"])(Object(o["a"])({},JSON.parse(JSON.stringify(e))),{},{orderFiles:e.orderFiles?e.orderFiles.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{name:t.getFileName(e.fileName)})})):[]}):{orderFiles:[],priority:h["o"][0].value,status:h["e"][0].value,channelId:1}},onAddCustomer:function(){var e=this;this.$openModal((function(){return Promise.all([r.e("chunk-4e8d5934"),r.e("chunk-1438376a")]).then(r.bind(null,"6d7f"))}),{},{success:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.onCustomerList();case 2:e.$set(e.form,"customerId",n.customerId);case 3:case"end":return t.stop()}}),t)})));function r(e,r){return t.apply(this,arguments)}return r}()})},onCustomerList:function(){var e=this;return this.$http("/ccas/cc/customer/list",{params:{isBlackList:0}}).then((function(t){var r=t.data;e.customerList=r}))},onPreciseSearch:function(){var e=this;this.$openModal((function(){return r.e("chunk-2d2259e5").then(r.bind(null,"e4bb"))}),{customerList:this.customerList},{success:function(t,r){return e.$set(e.form,"customerId",r)}})},onKeyChange:function(){var e=this;this.options.forEach((function(t){e.$set(e.searchForm,t[0],void 0)}))}}},v=b,g=(r("6af4"),Object(p["a"])(v,n,i,!1,null,"6d48bf67",null));t["default"]=g.exports},"61d1":function(e,t,r){},"6af4":function(e,t,r){"use strict";r("61d1")},fffc:function(e,t,r){"use strict";r.d(t,"n",(function(){return l})),r.d(t,"a",(function(){return m})),r.d(t,"f",(function(){return h})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"b",(function(){return g})),r.d(t,"j",(function(){return I})),r.d(t,"c",(function(){return y})),r.d(t,"o",(function(){return k})),r.d(t,"i",(function(){return F})),r.d(t,"h",(function(){return O})),r.d(t,"l",(function(){return _})),r.d(t,"k",(function(){return $})),r.d(t,"g",(function(){return x})),r.d(t,"m",(function(){return w}));var n=r("1da1"),i=r("2909"),o=r("5530"),a=r("ade3"),s=(r("96cf"),r("7db0"),r("d3b7"),r("b0c0"),r("a15b"),r("99af"),r("d81d"),r("4de4"),r("b64b"),r("caad"),r("2532"),r("3ca3"),r("ddb0"),r("159b"),r("a02a")),l="workorder",u={label:"尚未受理",value:0},c={label:"受理中",value:1},d={label:"等待回复",value:2},p={label:"已解决",value:3},f={label:"已关闭",value:4},m=[5,"已删除"],h=[u,c,d],b=[p,f],v=[u,c,d,p,f],g=[c,p,f],I=function(e){return(v.find((function(t){return t.value===e}))||{}).label},y=[[0,"我来受理工单","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很高兴为您服务！\n  我们已将您的请求生成工单 {TICKET_CODE} - {TICKET_TITLE}。该工单正在进行处理，一旦有任何更新我们会及时给您回复，请您耐心等待。"],[1,"尝试联系用户","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很抱歉在您百忙之中打扰您。\n  关于您的工单 {TICKET_CODE} - {TICKET_TITLE} ，我们希望确认您是否还存在其他疑问。鉴于还没有收到您的回复，我们会继续尝试联系您。如果您有任何进展或者其他疑问，可随时在系统中进行回复，感谢您的理解与支持。"],[2,"客服处理完毕，请用户确认","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 已完成处理，请在回复中进行确认。\n  希望我们的工作能使您满意，如您有任何建议或意见，欢迎回复告知我们，我们会努力改进。"],[3,"用户没有回复工单","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 用户超时未回复，置为已解决。"]],k=[{label:"低",value:0},{label:"中",value:1},{label:"高",value:2},{label:"紧急",value:3}],F=function(e){return(k.find((function(t){return t.value===e}))||{}).label},T={INPUT:0,TEXTAREA:1,RADIO:2,CHECKBOX:3,SELECT:4},O=function(e){var t;return t={},Object(a["a"])(t,e.INPUT,"单行文本框"),Object(a["a"])(t,e.TEXTAREA,"多行文本框"),Object(a["a"])(t,e.RADIO,"单选框"),Object(a["a"])(t,e.CHECKBOX,"复选框"),Object(a["a"])(t,e.SELECT,"下拉框"),t}(T),_=function(e){return!Object(s["v"])(e)&&e>1},$=function(e,t){var r=[],n=e.find((function(e){return e.id===t}));while(n)r.unshift(n.name),n=e.find((function(e){return e.id===n.parentId}));return r.join(" / ")},x=function(){return{label:"工单标题",prop:"name",minWidth:120,render:function(e,t){var r=t.row;return 1===r.flag&&new Date-new Date(r.lastUrgeTime)<864e5?e("span",[e("span",{style:"color:#E59208;border:1px solid #E59208;padding:2px;margin-right:5px"},"催"),e("span",r.name)]):e("span",r.name)}}},w={data:function(){var e=this,t=["number","name","channelId","status","sgroupName","acceptor","typeId","createTime"];return{priorities:k,types:[],skillGroups:[],states:v,allColumns:{base:{title:"基础字段",data:[{label:"工单编号",prop:"number",minWidth:140},x(),{label:"创建渠道",prop:"channelId",minWidth:80,render:function(e,t){var r=t.row;return e("span",1===r.channelId?"工单中心":"在线客服")}},{label:"工单描述",prop:"description",minWidth:120},{label:"工单状态",prop:"status",minWidth:80,render:function(e,t){var r=t.row;return e("span",I(r.status)||"已删除")}},{label:"优先级",prop:"priority",minWidth:80,render:function(e,t){var r=t.row;return e("span",F(r.priority))}},{label:"创建人",prop:"cuserName"},{label:"创建客服组",prop:"cgroupName",minWidth:120},{label:"受理客服组",prop:"sgroupName",minWidth:120},{label:"受理客服",prop:"acceptor"},{label:"分类",prop:"typeId",minWidth:140,render:function(t,r){var n=r.row;return t("span",e.getTypeText(n.typeId))}},{label:"创建时间",prop:"createTime",minWidth:140},{label:"首次响应时间",prop:"firstUpdateTime",minWidth:140},{label:"首次受理时间",prop:"firstAcceptTime",minWidth:140},{label:"更新时间",prop:"modifyTime",minWidth:140},{label:"首次解决时间",prop:"firstSolveTime",minWidth:140},{label:"最后回复人",prop:"lastReplingPersonName"}]},customer:{title:"客户字段",data:[{label:"客户昵称",prop:"customerNickName"},{label:"客户姓名",prop:"customerName"}]}},defaultProps:t,selectedProps:[].concat(t)}},computed:{typeList:function(){return Object(s["F"])(this.types.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{value:e.id,label:e.name})})))},showedColumns:function(){var e=this;return[{type:"selection"}].concat(Object(i["a"])(Object.keys(this.allColumns).reduce((function(t,r){return[].concat(Object(i["a"])(t),Object(i["a"])(e.allColumns[r].data))}),[]).filter((function(t){return e.selectedProps.includes(t.prop)}))))},typeId:function(){var e=this.searchForm.typeId;return e&&e.length?e[e.length-1]:""}},mounted:function(){this.setInitForm&&this.setInitForm(),this.getInitData(),Object(s["g"])(this,this.getInitData)},methods:{getStateText:I,getInitData:function(){this.isActive?this.getData():(this.onReset(),this.isActive=!0),this.getTypes(),this.getSkillGroups()},onDelete:function(e){var t=this;this.delData({rows:e,action:function(e){return t.$post("/workOrder/delete",{orderId:e.map((function(e){return e.id}))+""})}})},getSkillGroups:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderGroup/listGroup");case 2:e.skillGroups=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getGroupText:function(e){return(this.skillGroups.find((function(t){return t.id===e}))||{}).name},onCreate:function(){this.$openModal((function(){return r.e("chunk-497ef431").then(r.bind(null,"4bd2"))}),{},{success:this.onEditSuccess})},onBatchImport:function(){this.$openModal((function(){return r.e("chunk-2d0da7ad").then(r.bind(null,"6c7a"))}),{typeList:this.typeList},{success:this.onEditSuccess})},onBatchExport:function(e,t){var r=this,n=t.typeId||[],i=n[n.length-1];i?Object(s["i"])({fileName:"工单批量导出数据.xls",action:function(){return r.$post(e,Object(o["a"])(Object(o["a"])({},t),{},{typeId:i}),{responseType:"blob"})}}):this.$message("请先选择分类再导出")},onDetail:function(e){this.$router.push({name:"".concat(l,"-detail"),params:{id:e.id}})},onAccept:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e instanceof Array?e.map((function(e){return e.id}))+"":e.id,r.next=3,t.$post("/workOrder/accept",{orderId:n});case 3:t.$message.success("接单成功"),t.getData();case 5:case"end":return r.stop()}}),r)})))()},getTypes:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderType/listByPage");case 2:e.types=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getTypeText:function(e){return $(this.types,e)},onKeyChange:function(){var e=this;this.options.forEach((function(t){e.$set(e.searchForm,t[0],void 0)}))},onCustomField:function(){var e=this;this.$openModal("UiFieldCustom",{columns:this.allColumns,defaultProps:this.defaultProps,selectedProps:this.selectedProps},{success:function(t){e.selectedProps=t}})}}}}}]);