(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45ceb1fd"],{"2d93":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[r("p",{staticClass:"tip"},[e._v(" 带有特殊标记的行表示该字段中存在冲突数据，请选择合并后需要保留的数据。"),r("br"),e._v(" 合并后，原有工单、呼叫、会话历史会合并关联到主记录下。 ")]),r("table",[r("colgroup",[r("col",{attrs:{width:"170"}})]),r("tbody",[r("tr",[r("th",[e._v("主记录")]),r("td",[r("el-radio",{attrs:{label:e.current.customerId},model:{value:e.form.customerId,callback:function(t){e.$set(e.form,"customerId",t)},expression:"form.customerId"}},[e._v("当前编辑客户")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.customerId},model:{value:e.form.customerId,callback:function(t){e.$set(e.form,"customerId",t)},expression:"form.customerId"}},[e._v("信息冲突客户")])],1)]),e.current.customerNickname!==e.conflict.customerNickname?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 客户昵称")]),r("td",[r("el-radio",{attrs:{label:e.current.customerNickname},model:{value:e.form.customerNickname,callback:function(t){e.$set(e.form,"customerNickname",t)},expression:"form.customerNickname"}},[e._v(" "+e._s(e.current.customerNickname||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.customerNickname},model:{value:e.form.customerNickname,callback:function(t){e.$set(e.form,"customerNickname",t)},expression:"form.customerNickname"}},[e._v(" "+e._s(e.conflict.customerNickname||e.empty)+" ")])],1)]):e._e(),e.current.customerName!==e.conflict.customerName?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 真实姓名")]),r("td",[r("el-radio",{attrs:{label:e.current.customerName},model:{value:e.form.customerName,callback:function(t){e.$set(e.form,"customerName",t)},expression:"form.customerName"}},[e._v(" "+e._s(e.current.customerName||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.customerName},model:{value:e.form.customerName,callback:function(t){e.$set(e.form,"customerName",t)},expression:"form.customerName"}},[e._v(" "+e._s(e.conflict.customerName||e.empty)+" ")])],1)]):e._e(),e.current.customerSource!==e.conflict.customerSource?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 来源")]),r("td",[r("el-radio",{attrs:{label:e.current.customerSource},model:{value:e.form.customerSource,callback:function(t){e.$set(e.form,"customerSource",t)},expression:"form.customerSource"}},[e._v(" "+e._s(e.customerSources[e.current.customerSource])+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.customerSource},model:{value:e.form.customerSource,callback:function(t){e.$set(e.form,"customerSource",t)},expression:"form.customerSource"}},[e._v(" "+e._s(e.customerSources[e.conflict.customerSource])+" ")])],1)]):e._e(),e.isDiffLevel?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 客户等级")]),r("td",[r("el-radio",{attrs:{label:e.current.customerLevel},on:{change:function(t){return e.onLevelChange(e.current)}},model:{value:e.form.customerLevel,callback:function(t){e.$set(e.form,"customerLevel",t)},expression:"form.customerLevel"}},[e._v(" "+e._s(e.customerLevels[e.current.customerLevel]||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.customerLevel},on:{change:function(t){return e.onLevelChange(e.conflict)}},model:{value:e.form.customerLevel,callback:function(t){e.$set(e.form,"customerLevel",t)},expression:"form.customerLevel"}},[e._v(" "+e._s(e.customerLevels[e.conflict.customerLevel]||e.empty)+" ")])],1)]):e._e(),e.isDiffVipLevel?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" VIP级别")]),r("td",[r("el-radio",{attrs:{label:e.current.vipLevelId,disabled:e.isDiffLevel},model:{value:e.form.vipLevelId,callback:function(t){e.$set(e.form,"vipLevelId",t)},expression:"form.vipLevelId"}},[e._v(" "+e._s(e.vipLevelMap[e.current.vipLevelId]||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.vipLevelId,disabled:e.isDiffLevel},model:{value:e.form.vipLevelId,callback:function(t){e.$set(e.form,"vipLevelId",t)},expression:"form.vipLevelId"}},[e._v(" "+e._s(e.vipLevelMap[e.conflict.vipLevelId]||e.empty)+" ")])],1)]):e._e(),e.isDiffData(e.current.email,e.conflict.email)?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 邮箱"),r("span",[e._v("(最多10个)")])]),r("td",[r("el-checkbox-group",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}},e._l(e.toArr(e.current.email),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.conflict.email)||e.disEmail(t)}})],1)})),0)],1),r("td",[r("el-checkbox-group",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}},e._l(e.toArr(e.conflict.email),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.current.email)||e.disEmail(t)}})],1)})),0)],1)]):e._e(),r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 电话"),r("span",[e._v("(最多5个)")])]),r("td",[r("el-checkbox-group",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}},e._l(e.toArr(e.current.phone),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.conflict.phone)||e.disPhone(t)}})],1)})),0)],1),r("td",[r("el-checkbox-group",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}},e._l(e.toArr(e.conflict.phone),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.current.phone)||e.disPhone(t)}})],1)})),0)],1)]),e.current.companyId!==e.conflict.companyId?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 公司")]),r("td",[r("el-radio",{attrs:{label:e.current.companyId},model:{value:e.form.companyId,callback:function(t){e.$set(e.form,"companyId",t)},expression:"form.companyId"}},[e._v(" "+e._s(e.current.companyName||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.companyId},model:{value:e.form.companyId,callback:function(t){e.$set(e.form,"companyId",t)},expression:"form.companyId"}},[e._v(" "+e._s(e.conflict.companyName||e.empty)+" ")])],1)]):e._e(),e.isDiffArea?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 省份／城市／地区")]),r("td",[r("el-radio",{attrs:{label:"current"},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}},[e._v(" "+e._s([e.current.customerProvince,e.current.customerCity,e.current.customerArea].filter((function(e){return e})).join("/")||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:"conflict"},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}},[e._v(" "+e._s([e.conflict.customerProvince,e.conflict.customerCity,e.conflict.customerArea].filter((function(e){return e})).join("/")||e.empty)+" ")])],1)]):e._e(),e.isDiffData(e.current.customerTag,e.conflict.customerTag)?r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 客户标签")]),r("td",[r("el-checkbox-group",{model:{value:e.form.customerTag,callback:function(t){e.$set(e.form,"customerTag",t)},expression:"form.customerTag"}},e._l(e.toArr(e.current.customerTag),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.toArr(e.conflict.customerTag))}},[e._v(e._s(e.tagMap[t]))])],1)})),0)],1),r("td",[r("el-checkbox-group",{model:{value:e.form.customerTag,callback:function(t){e.$set(e.form,"customerTag",t)},expression:"form.customerTag"}},e._l(e.toArr(e.conflict.customerTag),(function(t){return r("div",{key:t},[r("el-checkbox",{attrs:{label:t,disabled:e.inArr(t,e.toArr(e.current.customerTag))}},[e._v(e._s(e.tagMap[t]))])],1)})),0)],1)]):e._e(),r("tr",[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" 备注")]),r("td",[r("el-radio",{attrs:{label:e.current.remark},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}},[e._v(" "+e._s(e.current.remark||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict.remark},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}},[e._v(" "+e._s(e.conflict.remark||e.empty)+" ")])],1)]),e._l(e.form.dataJson,(function(t,o){return[e.isDiffData(e.current[t.dataColName],e.conflict[t.dataColName])?r("tr",{key:t.fieldId},[r("th",[r("span",{staticClass:"el-icon-warning"}),e._v(" "+e._s(t.fieldName))]),t.fieldType===e.types.CHECKBOX?[r("td",[r("el-checkbox-group",{model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"_.value"}},e._l(e.toArr(e.current[t.dataColName]),(function(c,a){return r("div",{key:c},[r("el-checkbox",{attrs:{label:c,disabled:e.inArr(c,e.toArr(e.conflict[t.dataColName]))}},[e._v(" "+e._s(e.toArr(e.currentCustomFields[o].label)[a])+" ")])],1)})),0)],1),r("td",[r("el-checkbox-group",{model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"_.value"}},e._l(e.toArr(e.conflict[t.dataColName]),(function(c,a){return r("div",{key:c},[r("el-checkbox",{attrs:{label:c,disabled:e.inArr(c,e.toArr(e.current[t.dataColName]))}},[e._v(" "+e._s(e.toArr(e.conflictCustomFields[o].label)[a])+" ")])],1)})),0)],1)]:[r("td",[r("el-radio",{attrs:{label:e.current[t.dataColName]},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"_.value"}},[e._v(" "+e._s(e.currentCustomFields[o].label||e.empty)+" ")])],1),r("td",[r("el-radio",{attrs:{label:e.conflict[t.dataColName]},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"_.value"}},[e._v(" "+e._s(e.conflictCustomFields[o].label||e.empty)+" ")])],1)]],2):e._e()]}))],2)])])},c=[],a=r("ade3"),n=r("1da1"),s=r("5530"),l=(r("96cf"),r("e9c4"),r("d3b7"),r("4de4"),r("ac1f"),r("1276"),r("a15b"),r("4e82"),r("d81d"),r("159b"),r("de0b")),i=r("e139"),u={name:"CustomerMergeInfo",props:["current","conflict","saveAction"],data:function(){var e=this,t=this.current,r=this.conflict;return{customerSources:l["b"],customerLevels:l["a"],enumCustomerLevels:l["c"],T:i["a"],form:Object(s["a"])(Object(s["a"])({},t),{},{area:"current",phone:this.toArr(t.phone),email:this.toArr(t.email),customerTag:this.toArr(t.customerTag),dataJson:[]}),modalProps:{title:"合并客户信息",okText:"合并",width:"720px",onSubmit:function(){var o=Object(n["a"])(regeneratorRuntime.mark((function o(){var c,n,l,i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return c=e.form,n=e[c.area],l=c.customerId===r.customerId?r:t,i=Object(s["a"])(Object(s["a"])({},l),{},{partnerId:t.partnerId,mergedTargetCustomerId:c.customerId,conflictCustomerIds:c.customerId===r.customerId?t.customerId:r.customerId,customerNickname:c.customerNickname,customerName:c.customerName,customerSource:c.customerSource,customerLevel:c.customerLevel,vipLevelId:c.vipLevelId,companyId:c.companyId,remark:c.remark,phone:c.phone+"",email:c.email+"",customerTag:c.customerTag+"",customerProvince:n.customerProvince,customerProvinceCode:n.customerProvinceCode,customerCity:n.customerCity,customerCityCode:n.customerCityCode,customerArea:n.customerArea,customerAreaCode:n.customerAreaCode,dataJson:JSON.stringify(c.dataJson.reduce((function(e,t){return Object(s["a"])(Object(s["a"])({},e),{},Object(a["a"])({},t.dataColName,t.value+""))}),{}))}),o.next=6,e.saveAction?e.saveAction(i):e.$post("/ccas/cc/customer/merge/save",i);case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}}),o)})));function c(){return o.apply(this,arguments)}return c}()},empty:"(空)",vipLevelMap:{},tagMap:{},customFields:[],currentCustomFields:[],conflictCustomFields:[]}},computed:{isDiffLevel:function(){return this.current.customerLevel!==this.conflict.customerLevel},isDiffVipLevel:function(){var e=l["c"].VIP;return(this.current.customerLevel===e||this.conflict.customerLevel===e)&&this.current.vipLevelId!==this.conflict.vipLevelId},isDiffArea:function(){return this.current.customerProvinceCode!==this.conflict.customerProvinceCode||this.current.customerCityCode!==this.conflict.customerCityCode||this.current.customerAreaCode!==this.conflict.customerAreaCode}},mounted:function(){console.log(this.current,this.conflict),this.getTags(),this.getVipLevels(),this.getCustomFields()},methods:{toArr:function(e){return(e||"").split(",").filter((function(e){return e}))},inArr:function(e,t){return t.indexOf(e)>-1},isDiffData:function(e,t){return this.toArr(e).sort().join("")!==this.toArr(t).sort().join("")},disEmail:function(e){var t=this.form.email;return t.length>=10&&t.indexOf(e)<0},disPhone:function(e){var t=this.form.phone;return t.length>=5&&t.indexOf(e)<0},onLevelChange:function(e){this.isDiffLevel&&this.$set(this.form,"vipLevelId",e.vipLevelId)},getTags:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/ccas/cc/customer/customer/tag/list");case 2:e.tagMap=t.sent.data.reduce((function(e,t){return Object(s["a"])(Object(s["a"])({},e),{},Object(a["a"])({},t.optionId,t.value))}),{});case 3:case"end":return t.stop()}}),t)})))()},getVipLevels:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/ccas/cc/customer/vip/level/list");case 2:e.vipLevelMap=t.sent.data.reduce((function(e,t){return Object(s["a"])(Object(s["a"])({},e),{},Object(a["a"])({},t.optionId,t.value))}),{});case 3:case"end":return t.stop()}}),t)})))()},getCustomFields:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/ccas/cc/field/list?businessType=1");case 2:e.customFields=t.sent.data.filter((function(e){return!e.predefinedType&&e.controlState})),e.form.dataJson=e.customFields.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{value:t.fieldType===i["a"].CHECKBOX?(e.current[t.dataColName]||"").split(",").filter((function(e){return e})):e.current[t.dataColName]})})),e.customFields.forEach(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var o,c,n,l,u,m,f,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=e.current[r.dataColName],c=Object(s["a"])(Object(s["a"])({},r),{},{value:o,label:o}),e.currentCustomFields.push(c),n=e.conflict[r.dataColName],l=Object(s["a"])(Object(s["a"])({},r),{},{value:n,label:n}),e.conflictCustomFields.push(l),!Object(i["c"])(r.fieldType)){t.next=14;break}return t.next=9,e.$http("/ccas/cc/field/option/details/".concat(r.fieldId));case 9:u=t.sent,m=u.data,f=m.reduce((function(e,t){return Object(s["a"])(Object(s["a"])({},e),{},Object(a["a"])({},t.optionId,t.value))}),{}),d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return(e||"").split(",").filter((function(e){return e})).map((function(e){return f[e]})).join(t)},r.fieldType===i["a"].CASCADER?(e.$set(c,"label",d(o," / ")),e.$set(l,"label",d(n," / "))):(e.$set(c,"label",d(o)),e.$set(l,"label",d(n)));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t)})))()}}},m=u,f=(r("f957"),r("2877")),d=Object(f["a"])(m,o,c,!1,null,"34c40d5e",null);t["default"]=d.exports},9163:function(e,t,r){},f957:function(e,t,r){"use strict";r("9163")}}]);