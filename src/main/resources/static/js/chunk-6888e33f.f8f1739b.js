(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6888e33f"],{"3b39":function(e,t,n){},"427a":function(e,t,n){},"64aa":function(e,t,n){},a3fb:function(e,t,n){"use strict";n("427a")},abfb:function(e,t,n){"use strict";n("64aa")},b57c:function(e,t,n){"use strict";n.r(t);var r,a,i,s,c,o,u=n("1da1"),l=(n("d81d"),n("4de4"),n("d3b7"),n("b0c0"),n("96cf"),n("a02a")),m={inject:["imCustomerProfile"],render:function(e){var t=this.imCustomerProfile.accessInfo;return e("ul",{},[{label:"访问来源",prop:"channel"},{label:"接入渠道",prop:"channel"},{label:"技能组",prop:"skill"},{label:"排队时长",prop:function(e){return Object(l["k"])(e.waittingtime,1)}},{label:"IP地址",prop:"ipaddr"},{label:"终端",prop:"browser"},{label:"系统",prop:"osname"}].map((function(n){return e("li",{key:n.label},[e("span",{class:"label"},n.label),e("span",{class:"value"},"function"===typeof n.prop?n.prop(t):t[n.prop])])})))}},d=m,f=n("2877"),p=Object(f["a"])(d,r,a,!1,null,null,null),v=p.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"Form",attrs:{"label-width":"6em",size:"mini","inline-message":"",model:e.form,rules:e.rules}},[n("ui-select",{attrs:{label:"所属业务",prop:"serviceId",options:e.templates,props:{value:"id",label:"name"},filterable:""},on:{change:e.onBussinessChange},model:{value:e.form.serviceId,callback:function(t){e.$set(e.form,"serviceId",t)},expression:"form.serviceId"}}),e.form.serviceId?[n("el-form-item",{attrs:{label:"业务类型",prop:"serviceTypeDOS"}},[n("el-cascader",{attrs:{options:e.businessTypes,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,emitPath:!1}},on:{change:e.onBusinessTypeChange},model:{value:e.form.serviceTypeDOS,callback:function(t){e.$set(e.form,"serviceTypeDOS",t)},expression:"form.serviceTypeDOS"}})],1),n("ui-text-field",{attrs:{label:"备注说明",type:"textarea",placeholder:e.remarkPlaceholder,rows:"3"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),n("el-form-item",{attrs:{label:"处理状态"}},[n("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[n("el-radio",{attrs:{label:0}},[e._v("已解决")]),n("el-radio",{attrs:{label:1}},[e._v("未解决")])],1)],1),e.curTemplate?e._l(e.curTemplate.serviceFieldList,(function(t){return n("ui-text-field",{key:t.id,attrs:{label:t.name,maxlength:"50"},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"_.value"}})})):e._e()]:e._e(),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit(0)}}},[e._v("提交")]),n("el-button",{on:{click:function(t){return e.submit(1)}}},[e._v("无效会话")])],1)],2)},h=[],g=n("2909"),O=n("5530"),T=(n("7db0"),n("99af"),n("159b"),{data:function(){return{form:{},templates:[],businessTypes:[],rules:{serviceId:Object(l["z"])("请选择所属业务"),serviceTypeDOS:Object(l["z"])("请选择业务类型")},loading:!1}},computed:{activeSession:function(){return this.$store.state.im.activeSession},agentserviceid:function(){return this.activeSession.agentserviceid},curTemplate:function(){var e=this;return this.templates.find((function(t){return t.id===e.form.serviceId}))},remarkPlaceholder:function(){return this.curTemplate&&this.curTemplate.content||"请填写备注"}},watch:{agentserviceid:{immediate:!0,handler:"getData"}},methods:{getData:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form={},n={customerId:e.activeSession.userid,agentServiceId:e.activeSession.agentserviceid},!n.agentServiceId){t.next=10;break}return t.next=5,e.$http("/serviceSummary/listByPage",{params:n});case 5:r=t.sent,a=r.data,e.form=Object(O["a"])({serviceId:a.serviceId,content:a.content||"",id:a.id||void 0,status:a.status||0,serviceTypeDOS:(a.serviceTypeDOS||[]).map((function(e){return e.id}))},n),e.$http("/serviceTemplate/listByPage?status=1").then((function(t){var n=t.data;e.templates=n;var r=n.find((function(e){return e.id===a.serviceId}));r&&(r.serviceFieldList=r.serviceFieldList.map((function(e){var t=a.serviceFeildValues.find((function(t){return t.fieldId===e.id}));return Object(O["a"])(Object(O["a"])({},e),{},{value:t?t.value:""})})))})),a.serviceId&&e.getBusinessTypes(a.serviceId).then((function(){return e.onBusinessTypeChange(e.form.serviceTypeDOS)}));case 10:e.$nextTick((function(){e.$refs.Form.clearValidate()}));case 11:case"end":return t.stop()}}),t)})))()},getBusinessTypes:function(e){var t=this;return this.$http("/serviceType/listByPage",{params:{templateId:e}}).then((function(e){var n=e.data;t.businessTypes=Object(l["F"])(n.map((function(e){return Object(O["a"])(Object(O["a"])({},e),{},{value:e.id,label:e.name,disabled:!1})})))}))},onBussinessChange:function(e){this.getBusinessTypes(e),this.form=Object(O["a"])(Object(O["a"])({},this.form),{},{serviceTypeDOS:[],content:"",status:0})},submit:function(e){var t=this;this.$refs.Form.validate((function(n){n&&(t.loading=!0,t.$http.post("/serviceSummary/".concat(t.form.id?"update":"save"),Object(O["a"])(Object(O["a"])({},t.form),{},{effective:e,serviceTypeDOS:t.form.serviceTypeDOS.reduce((function(e,t){return[].concat(Object(g["a"])(e),[{id:t}])}),[]),serviceFeildValues:t.curTemplate.serviceFieldList.map((function(e){return{value:e.value,feildName:e.name,fieldId:e.id}}))})).then((function(){t.$message.success("提交成功")})).finally((function(){t.loading=!1})))}))},onBusinessTypeChange:function(e){var t=this,n=this.getFlatData(this.businessTypes);e.length>=3?n.forEach((function(n){var r=e.reduce((function(e,t){return[].concat(Object(g["a"])(e),[t])}),[]).indexOf(n.id)<0;t.$set(n,"disabled",r)})):n.forEach((function(e){t.$set(e,"disabled",!1)}))},getFlatData:function(e){var t=this;return e.reduce((function(e,n){return[].concat(Object(g["a"])(e),[n],Object(g["a"])(n.children?t.getFlatData(n.children):[]))}),[])}}}),y=T,j=(n("abfb"),Object(f["a"])(y,b,h,!1,null,"4fa9abce",null)),C=j.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("com-customer-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ComCustomerForm",staticStyle:{margin:"0 -1em"},on:{merged:e.getData}},[n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存客户信息")])],1)],1)},k=[],E=n("5425"),I={name:"ImCustomerInfo",components:{ComCustomerForm:E["a"]},data:function(){return{loading:!1}},computed:{activeSession:function(){return this.$store.state.im.activeSession},agentserviceid:function(){return this.activeSession.agentserviceid}},watch:{agentserviceid:{immediate:!0,handler:"getData"}},methods:{getData:function(){var e=this,t=this.activeSession;this.$nextTick((function(){var n=e.$refs.ComCustomerForm;n&&n.getInitData({customerNickname:t.nickname,customerName:t.username,partnerId:t.userid,customerSource:4,isBlackList:0,customerLevel:1,customerTag:"",email:t.email,phone:t.phone})}))},onSubmit:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$refs.ComCustomerForm,t.next=3,n.validate();case 3:return e.loading=!0,t.prev=4,t.next=7,n.submit();case 7:t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](4);case 11:e.loading=!1;case 12:case"end":return t.stop()}}),t,null,[[4,9]])})))()}}},x=I,$=Object(f["a"])(x,S,k,!1,null,null,null),w=$.exports,P=(n("3ca3"),n("ddb0"),{inject:["imCustomerProfile"],render:function(e){var t=this,r=this.imCustomerProfile.contactRecords,a=function(e){t.$openModal((function(){return n.e("chunk-0325e3dd").then(n.bind(null,"2cc5"))}),{row:Object(O["a"])(Object(O["a"])({},e),{},{agentserviceid:e.id}),imUser:t.$store.getters.imUser})};return e("div",[e("ul",{class:"im-right-aside-contact-record"},r.map((function(n){return e("li",{key:n.id},[e("p",{class:"title"},[e("b","".concat(n.channel," ").concat(t.$adminCore.formatDate(n.servicetime))),e("el-link",{props:{underline:!1,type:"primary"},on:{click:a.bind(t,n)}},"详情")]),e("ul",[{label:"所属业务",prop:function(){return"--"}},{label:"业务类型",prop:function(){return"--"}},{label:"处理状态",prop:function(){return"未处理"}},{label:"受理客服",prop:"agentusername"}].map((function(t){return e("li",{key:t.label},[e("span",{class:"label"},t.label),e("span",{class:"value"},"function"===typeof t.prop?t.prop(n):n[t.prop])])})))])})))])}}),_=P,D=(n("dddc"),Object(f["a"])(_,i,s,!1,null,null,null)),B=D.exports,R={name:"ImCustomerProfile",provide:function(){return{imCustomerProfile:this}},data:function(){return{collapsedName:"0",accessInfo:{},contactRecords:[]}},computed:{activeSession:function(){return this.$store.state.im.activeSession},agentserviceid:function(){return this.activeSession.agentserviceid}},watch:{agentserviceid:{immediate:!0,handler:"getData"}},methods:{getData:function(){this.getAccessInfo(),this.getContactRecords()},getAccessInfo:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$imHttp("/agentUser/info",{params:{userid:e.activeSession.userid,orgi:e.$store.getters.imUser.orgi}});case 2:if(t.t0=t.sent.data,t.t0){t.next=5;break}t.t0={};case 5:e.accessInfo=t.t0;case 6:case"end":return t.stop()}}),t)})))()},getContactRecords:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.activeSession,r=n.orgi,a=n.userid,i={orgi:r,userid:a},!a){t.next=8;break}return t.next=5,e.$imHttp("/agent/agentServiceList",{params:i});case 5:t.t0=t.sent.data,t.next=9;break;case 8:t.t0=[];case 9:e.contactRecords=t.t0;case 10:case"end":return t.stop()}}),t)})))()}},render:function(e){var t=this;return e("div",{class:"im-right-aside-customer-profile"},[e("el-scrollbar",{class:"ui-scrollbar"},[e("el-collapse",{props:{accordion:!0,value:this.collapsedName},on:{input:function(e){t.collapsedName=e}}},[{title:"访问信息",name:"0",component:v},this.$hasPerm("service_summary_save")&&{title:"服务总结",name:"1",component:C},{title:"客户信息",name:"2",component:w},{title:"历史联络记录",name:"3",component:B}].filter((function(e){return e})).map((function(t){return e("el-collapse-item",{props:{name:t.name,title:t.title},key:t.name},[e(t.component)])})))])])}},A=R,F=(n("a3fb"),Object(f["a"])(A,c,o,!1,null,null,null));t["default"]=F.exports},dddc:function(e,t,n){"use strict";n("3b39")},de0b:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return o}));var r=n("ade3"),a="customer-center",i={CUSTOMER_CENTER:1,WECHAT:2,APP:3,PC_WEB:4,WEIBO:5,MOB_WEB:6,CALL_CENTER:7,WO_CENTER:8,ENT_WECHAT:9,WECHAT_APP:10,EMAIL:11},s=function(e){var t;return t={},Object(r["a"])(t,e.CUSTOMER_CENTER,"客户中心"),Object(r["a"])(t,e.WECHAT,"微信"),Object(r["a"])(t,e.APP,"APP"),Object(r["a"])(t,e.PC_WEB,"桌面网站"),Object(r["a"])(t,e.WEIBO,"微博"),Object(r["a"])(t,e.MOB_WEB,"移动网站"),Object(r["a"])(t,e.CALL_CENTER,"呼叫中心"),Object(r["a"])(t,e.WO_CENTER,"工单中心"),Object(r["a"])(t,e.ENT_WECHAT,"企业微信"),Object(r["a"])(t,e.WECHAT_APP,"微信小程序"),Object(r["a"])(t,e.EMAIL,"邮件"),t}(i),c={BASE:1,VIP:2},o=function(e){var t;return t={},Object(r["a"])(t,e.BASE,"普通客户"),Object(r["a"])(t,e.VIP,"VIP客户"),t}(c)}}]);