(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b1ff7"],{"21df":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-table-view",e._g(e._b({scopedSlots:e._u([{key:"search",fn:function(){return[e.isSuper?n("el-form-item",{attrs:{label:"所属企业"}},[n("ui-ent-select",{on:{change:e.changeEntId},model:{value:e.searchForm.entId,callback:function(t){e.$set(e.searchForm,"entId",t)},expression:"searchForm.entId"}})],1):e._e(),n("ui-text-field",{attrs:{label:"坐席工号/姓名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},model:{value:e.searchForm.workNameOrNo,callback:function(t){e.$set(e.searchForm,"workNameOrNo",t)},expression:"searchForm.workNameOrNo"}})]},proxy:!0},{key:"actions",fn:function(){return[n("el-button",{attrs:{icon:"el-icon-arrow-down"},on:{click:e.onCustomField}},[e._v("自定义字段")]),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.onEdit()}}},[e._v("新增")]),n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:!e.selectedRow.length},on:{click:function(t){return e.onDelete(e.selectedRow)}}},[e._v("删除")]),n("el-button",{attrs:{icon:"el-icon-download",disabled:!e.selectedRow.length},on:{click:function(t){return e.fileExport(e.selectedRow)}}},[e._v("导出")]),n("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.fileDownload}},[e._v("下载模板")]),n("el-button",{attrs:{icon:"el-icon-upload"},on:{click:e.onSelectFile}},[e._v("上传")]),n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},on:{change:e.onChange}})]},proxy:!0}])},"ui-table-view",e.viewProps,!1),e.viewListeners))},r=[],i=n("1da1"),a=n("ade3"),s=n("5530"),l=n("2909"),c=(n("96cf"),n("99af"),n("4de4"),n("d3b7"),n("caad"),n("2532"),n("d81d"),n("fb6a"),n("a15b"),n("3ca3"),n("ddb0"),n("ac1f"),n("1276"),n("b0c0"),n("a02a")),u={name:"serviceManagement",mixins:[window.mixTableView],data:function(){var e=this,t=["workName","workTel","workState","workPosition","didNo","queueName","extensionNumber"];return{defaultProps:t,selectedProps:[].concat(t),allColumns:[{label:"坐席姓名",prop:"workName"},{label:"登录密码",prop:"workPassword"},{label:"签入方式",prop:"moveInType "},{label:"状态",prop:"workState",minWidth:80,render:function(e,t){var n=t.row;return e("el-tag",{props:{types:0===+n.workState?"primary":"danger"}},0===+n.workState?"正常":"暂停")}},{label:"用户角色",prop:"workPosition",render:function(e,t){var n=t.row;return e("span",{1:"组长",3:"管理员",0:"坐席"}[n.workPosition])}},{label:"归属ACD",prop:"flowNo"},{label:"坐席技能",prop:"workLevel"},{label:"归属队列",prop:"queueId",render:function(t,n){var o=n.row;return t("span",e.queueMap[o.queueId])}},{label:"事后处理时长(秒)",prop:"wrapUpTime",minWidth:120},{label:"手机/市话",prop:"workTel"},{label:"DID直拨号",prop:"didNo"},{label:"分机号",prop:"extensionNumber",minWidth:120}],queueAllData:[]}},computed:{isSuper:function(){return this.$store.getters.isAdmin},columnsFixed:function(){return[{type:"selection",width:55,fixed:"left"},{label:"坐席工号",prop:"workNo",fixed:"left"}]},fieldJson:function(){var e=this,t=this.allColumns.filter((function(t){return e.selectedProps.includes(t.prop)}));return[].concat(Object(l["a"])(this.columnsFixed),Object(l["a"])(t)).slice(1).map((function(e){return{fieldName:e.label,field:e.prop}}))},columns:function(){var e=this,t=this.allColumns.filter((function(t){return e.selectedProps.includes(t.prop)}));return[].concat(Object(l["a"])(this.columnsFixed),Object(l["a"])(t),[{label:"操作",width:200,fixed:"right",render:this.$hBtns([{label:"编辑",action:this.onEdit},{label:"修改密码",action:this.onPwdEdit},{label:"修改归属队列",action:this.onQueueEdit}])}])},queueMap:function(){return this.queueAllData.reduce((function(e,t){return Object(s["a"])(Object(s["a"])({},e),{},Object(a["a"])({},t.queueId,t.queueName))}),{})}},mounted:function(){var e=this;this.setInitForm();var t=function(){e.getData(),e.getQueueList()};t(),Object(c["g"])(this,t)},methods:{setInitForm:function(){this.tableForm={entId:this.$store.state.userData.entid},this.searchForm=Object(s["a"])({},this.tableForm)},onCustomField:function(){var e=this;this.$openModal("UiFieldCustom",{columns:this.allColumns,defaultProps:this.defaultProps,selectedProps:this.selectedProps},{success:function(t){e.selectedProps=t}})},fetchMethod:function(e){return this.$http("/cti/work/listPage",{params:e}).then((function(e){return e.data}))},onDelete:function(e){var t=this;this.delData({rows:e,action:function(e){var n=e.map((function(e){return e.ctiWorkId})).join(",");return t.$post("/cti/work/delete",{ctiWorkId:n,entId:t.searchForm.entId})}})},changeEntId:function(){this.onSearch(),this.getQueueList()},onEdit:function(e){var t=this,o=this.searchForm.entId;return e&&(e=Object(s["a"])(Object(s["a"])({},e),{},{queueName:this.queueMap[e.queueId]})),this.$openModal((function(){return n.e("chunk-77b288df").then(n.bind(null,"b2a2"))}),{row:e,entId:o},{success:function(){t.onEditSuccess.apply(t,arguments),t.getQueueList()}})},onPwdEdit:function(e){var t=this.searchForm.entId;return this.$openModal((function(){return n.e("chunk-2d0de303").then(n.bind(null,"851a"))}),{row:e,entId:t},{success:this.onEditSuccess})},onQueueEdit:function(e){var t=Object(l["a"])(this.queueAllData);return this.$openModal((function(){return n.e("chunk-7ef7b038").then(n.bind(null,"bb1b"))}),{row:e,queueAllData:t},{success:this.onEditSuccess})},getQueueList:function(){var e=this;return this.$http("/queue/getAllQueueNoPageAllState",{params:{entId:this.searchForm.entId}}).then((function(t){var n=t.data;e.queueAllData=n.map((function(e){return{entId:e.entId,queueId:e.queueId,queueName:e.queueName,workLevel:0,selected:!1}}))}))},fileDownload:function(){var e=this;Object(c["i"])({fileName:"呼叫客服模板.xls",action:function(){return e.$http("/cti/work/template",{responseType:"blob"})}})},onSelectFile:function(){this.$refs.File.click()},onChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.target,r=o.files[0],o.value="",!r){n.next=17;break}if(!["xls","xlsx"].includes(r.name.split(".").pop())){n.next=16;break}return i=new FormData,i.append("entId",t.searchForm.entId),i.append("file",r),n.t0=t.$message,n.next=11,t.$http.post("/cti/work/upload",i);case 11:n.t1=n.sent.data,n.t0.success.call(n.t0,n.t1),t.getData(),n.next=17;break;case 16:t.$message.error("请选择Excel文件");case 17:case"end":return n.stop()}}),n)})))()},fileExport:function(e){var t=this;Object(c["i"])({fileName:"坐席名单.xls",action:function(){return t.$http.post("/cti/work/export",Object(s["a"])(Object(s["a"])({},t.searchForm),{},{ids:e.map((function(e){return e.ctiWorkId})),fieldJson:t.fieldJson,entId:t.searchForm.entId+""}))}})}}},d=u,p=n("2877"),h=Object(p["a"])(d,o,r,!1,null,null,null);t["default"]=h.exports}}]);