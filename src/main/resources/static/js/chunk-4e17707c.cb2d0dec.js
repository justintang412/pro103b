(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e17707c"],{"0016":function(e,t,n){},"0eec":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefix},[n("div",{class:e.prefix+"_more"},[e.loading?n("i",{staticClass:"el-icon-loading"}):e.hasMore?n("el-link",{attrs:{underline:!1},on:{click:e.loadmore}},[e._v("加载更多")]):n("span",[e._v("没有更多数据")])],1),n("ul",{class:e.prefix+"_list"},e._l(e.reducedData,(function(t,i){return n("li",e._b({key:i},"li",e.getMsgView(t),!1))})),0)])},a=[],r=n("1da1"),s=(n("96cf"),n("8a79"),n("fb6a"),n("d81d"),n("4de4"),n("d3b7"),n("99af"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:[e.prefix,{isSelf:e.isSelf,isImg:e.isImg}]},[n("div",{class:[e.prefix+"_inner",{isSelf:e.isSelf,isImg:e.isImg}]},[n("header",{class:e.prefix+"_header"},[e._v(e._s(e.userName))]),n("main",{class:e.prefix+"_main"},[e.isSelf?[0===e.data.state?n("i",{staticClass:"el-icon-loading msg-state"}):-1===e.data.state?n("i",{staticClass:"el-icon-error msg-state error",attrs:{title:"点击重发"},on:{click:e.onResend}}):e._e()]:e._e(),n("div",{class:[e.prefix+"_content",e.data.messageType],on:{click:e.onContentClick}},[e.isImg?[n("div",{class:e.prefix+"_img"},[n("img",{attrs:{title:"单击查看大图",src:e.getSrc()},on:{click:e.onPreview}})]),n("el-image",{attrs:{src:e.getSrc(),"preview-src-list":e.imgUrls}})]:e.isVoice?n("div",[n("audio",{attrs:{controls:"",src:e.data.content},on:{play:e.onPlay}})]):e.isText?n("div",{domProps:{innerHTML:e._s(e.parseContent(e.data.content,!0))}}):n("div",{staticClass:"filebox"},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getFileName()))]),n("a",{staticClass:"el-icon-download",attrs:{title:"下载",target:"_blank",href:e.downloadUrl}})])],2)],2)])])}),o=[],l=n("2909"),c=(n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("498a"),n("5319"),n("60e2")),u=n("934a"),m={name:"ImUserMsg",inject:{inClient:{default:!1}},props:{data:Object,isSelf:Boolean,onSend:Function,imgUrls:{type:Array,default:function(){return[]}}},data:function(){return{prefix:"im-msg-user"}},computed:{userName:function(){var e=this.data.ext||{},t="agent"===this.data.source,n=this.data.senderName||e.name||e.senderName;return this.inClient?t?"客服":n:t?this.data.senderId:n},isImg:function(){return this.data.messageType===u["j"].IMAGE},isVoice:function(){return this.data.messageType===u["j"].VOICE},isText:function(){return this.data.messageType===u["j"].TEXT},isFile:function(){return[u["j"].TEXT,u["j"].IMAGE,u["j"].VOICE].indexOf(this.data.messageType)<0},downloadUrl:function(){return this.getApiUrl("/file/fileDownload/".concat(this.data.messageId))}},methods:{getApiUrl:function(e){return Object(c["h"])(Object(c["f"])(this.inClient),e)},parseContent:function(e){return"ai"===this.data.source?Object(u["m"])(e):Object(u["k"])(e,!0)},getSrc:function(){var e=this.data;return e.messageId?this.getApiUrl("/file/image/".concat(e.messageId)):e.content},getFileName:function(){var e=this.data,t=e.content,n=e.fileName;return t.name||n||t.split("/").pop()},onResend:function(){this.onSend&&Object(u["p"])(this.onSend,this.data.messageType===u["j"].TEXT?{content:this.data.content}:{file:this.data.file},this.inClient)},onPreview:function(){var e=this.$el.querySelector(".el-image img");e&&e.click()},onPlay:function(e){Object(l["a"])(document.body.querySelectorAll("audio")).forEach((function(t){t!==e.target&&t.pause()}))},onContentClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&t.parentElement.classList.contains("menu-item")){var n=t.textContent.replace(/^\d+\./,"").trim();this.onSend&&this.onSend({content:n})}}}},f=m,d=(n("fc45"),n("2877")),p=Object(d["a"])(f,s,o,!1,null,null,null),g=p.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[n("span",{class:e.prefix+"_inner"},[e.data.content?n("span",{class:e.prefix+"_content",domProps:{innerHTML:e._s(e.data.content)},on:{click:e.onClick}}):e._e(),n("span",[e._v(e._s(e.formatedTime))])])])},v=[],b=n("a02a"),x={name:"ImTipMsg",inject:{parentVM:{default:""}},props:{data:Object},data:function(){return{prefix:"im-msg-tip"}},computed:{formatedTime:function(){return Object(b["l"])(this.data.createTime)}},methods:{onClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&!t.classList.contains("is-disabled")){t.classList.add("is-disabled");var n=t.dataset.action;"leavemsg"===n&&this.parentVM&&this.parentVM.addMsg(this.parentVM.joinData)}}}},_=x,y=(n("92e5"),Object(d["a"])(_,h,v,!1,null,null,null)),j=y.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[e.submited?n("div",[e._v("留言提交成功，感谢您的参与！")]):n("div",{class:e.prefix+"_box"},[n("header",{class:e.prefix+"_header"},[e._v("当前没有客服在线，请留言")]),n("el-form",{ref:"Form",class:e.prefix+"_form",attrs:{"label-width":"6em",size:"mini",model:e.form,rules:e.rules}},[e.config.lvmname?n("el-form-item",{attrs:{label:"您的姓名"}},[n("el-input",{attrs:{maxlength:"30"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),e.config.lvmphone?n("el-form-item",{attrs:{label:"您的电话",prop:"mobile"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1):e._e(),e.config.lvmemail?n("el-form-item",{attrs:{label:"您的邮箱",prop:"email"}},[n("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1):e._e(),e.config.lvmaddress?n("el-form-item",{attrs:{label:"您的地址"}},[n("el-input",{attrs:{maxlength:"50"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1):e._e(),e.config.lvmqq?n("el-form-item",{attrs:{label:"您的QQ",prop:"qq"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.qq,callback:function(t){e.$set(e.form,"qq",t)},expression:"form.qq"}})],1):e._e(),n("el-form-item",{attrs:{label:"留言内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"300"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),n("el-form-item",[n("div",{class:e.prefix+"_btnBox"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.loading?"提交中...":"提交"))])],1)])],1)],1)])},k=[],C=n("5530"),S=(n("00b4"),n("3ca3"),n("ddb0"),n("4328")),O=n.n(S),I={name:"ImLeaveMessage",props:{data:Object},data:function(){return{prefix:"im-msg-leave-message",form:{},rules:{mobile:{trigger:"blur",validator:function(e,t,n){!t||b["a"].pattern.test(t)?n():n(new Error(b["a"].message))}},email:{trigger:"blur",type:"email",message:"邮箱格式不正确"},qq:{trigger:"blur",type:"number",validator:function(e,t,n){!t||/^\d{5,12}$/.test(t)?n():n(new Error("QQ格式不正确"))}},content:{trigger:"blur",required:!0,validator:function(e,t,n){t&&t.trim()?n():n(new Error("请输入留言内容"))}}},loading:!1,submited:!1}},computed:{config:function(){return this.data.inviteData}},methods:{onSubmit:function(){var e=this;this.$refs.Form.validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return i=e.data,t.prev=2,t.next=5,Promise.all([e.$http.post("/leavemsg/",Object(C["a"])(Object(C["a"])({},e.form),{},{orgi:i.orgi,userid:i.userid})),e.$http.post("/message/saveMessage",O.a.stringify({content:e.form.content,customerId:i.userid,entId:i.orgi}),{baseURL:Object(c["d"])(!0)})]);case 5:e.submited=!0,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}}},T=I,$=(n("3687"),Object(d["a"])(T,w,k,!1,null,null,null)),E=$.exports,M={name:"ImMsgList",inject:{inClient:{default:!1}},props:{imUser:{type:Object,default:function(){return{}}},hasMore:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},onSend:Function,onLoadmore:Function},data:function(){return{loading:!1,prefix:"im-msg-list"}},computed:{imgUrls:function(){var e=Object(c["f"])(this.inClient);return e.endsWith("/")&&(e=e.slice(0,-1)),this.data.filter((function(e){return e.messageType===u["j"].IMAGE})).map((function(t){return t.messageId?"".concat(e,"/file/image/").concat(t.messageId):t.content}))},reducedData:function(){return Object(u["o"])(this.data)}},watch:{data:{immediate:!0,handler:"onDataChange"}},methods:{getMsgView:function(e){var t="client",n=this.imUser.source===t,i=["system","allot","ainew"].indexOf(e.cmdType)>-1||"system"===e.source;if(i)return{is:j,data:e};if("leavemsg"===e.cmdType)return{is:E,data:e};var a=n?e.source===t:e.source!==t;return{is:g,data:e,isSelf:a,imgUrls:this.imgUrls,onSend:this.onSend}},toBottom:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))},loadmore:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.onLoadmore||e.loading){t.next=15;break}return e.loading=!0,e.preventScroll=!0,n=e.data[0]||{},i=n.messageId,t.prev=4,t.next=7,e.onLoadmore(i);case 7:a=t.sent,a.length||(e.preventScroll=!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),e.preventScroll=!1;case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})))()},onDataChange:function(){this.preventScroll?this.preventScroll=!1:this.toBottom()}}},L=M,U=(n("a70f"),Object(d["a"])(L,i,a,!1,null,null,null));t["a"]=U.exports},3687:function(e,t,n){"use strict";n("b6f6")},"3afa":function(e,t,n){"use strict";n("8d2a")},"5b48":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:e.prefix},[n("header",{class:e.prefix+"_header"},[n("ui-emoji-list",{on:{"item-click":e.insertContent}},[n("span",{staticClass:"btn btn-emoji",attrs:{title:"表情"}})]),e.showImageBtn?[n("span",{staticClass:"btn el-icon-folder btn-file",attrs:{title:"文件"},on:{click:e.onSelectFile}})]:e._e(),e._t("toolbar")],2),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],class:e.prefix+"_input",domProps:{value:e.content},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.onKeydown.apply(null,arguments))},paste:e.onPaste,input:function(t){t.target.composing||(e.content=t.target.value)}}}),n("footer",{class:e.prefix+"_footer"},[n("span",{staticClass:"tip"},[e._v("按下Ctrl + Enter换行")]),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.send}},[e._v("发送")])],1),n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",multiple:""},on:{change:e.onFileChange}}),e.connected?e._e():n("div",{class:e.prefix+"_overlay"})])},a=[],r=(n("d81d"),n("a630"),n("3ca3"),n("4de4"),n("d3b7"),n("2ca0"),n("ddb0"),n("2b3d"),n("9861"),n("a15b"),n("159b"),n("498a"),n("a02a")),s=n("934a"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popover",{attrs:{placement:"top-start","popper-class":e.prefix},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("template",{slot:"reference"},[e._t("default")],2),n("ul",{class:e.prefix+"_list"},e._l(e.emojiMap,(function(t,i){return n("li",{key:i,class:e.prefix+"_item"},[n("img",e._b({class:e.prefix+"_img",on:{click:function(n){return e.$emit("item-click",t.alt)}}},"img",Object.assign({},t,{title:t.alt}),!1))])})),0)],2)},l=[],c=n("89f6"),u={name:"ImEmojiList",data:function(){return{emojiMap:c["a"],visible:!1,prefix:"im-emoji-list"}}},m=u,f=(n("3afa"),n("2877")),d=Object(f["a"])(m,o,l,!1,null,null,null),p=d.exports,g={name:"ImMsgForm",inject:{inClient:{default:!1}},components:{UiEmojiList:p},props:{onSend:Function,connected:Boolean,showImageBtn:{type:Boolean,default:!0},loading:Boolean},data:function(){return{prefix:"im-msg-form",content:""}},methods:{insertContent:function(e){var t=this.$el.querySelector("textarea");this.content=Object(r["u"])(t,e)},onSelectFile:function(){this.$refs.File.click()},onFileChange:function(e){var t=this,n=e.target;if(n.files.length>9)return this.$message.error("一次最多支持发送9个文件");this.onSend&&Array.from(n.files).map((function(e){Object(s["p"])(t.onSend,{file:e},t.inClient)})),n.value=""},onKeydown:function(e){e.ctrlKey||e.shiftKey?this.insertContent("\n"):this.send()},onPaste:function(e){var t=this,n=e.clipboardData;if(this.showImageBtn&&!n.getData("text")){var i=Array.from(n.files).filter((function(e){return e.type.startsWith("image/")}));if(i.length&&this.onSend){e.preventDefault();var a=i.map((function(e){return window.URL.createObjectURL(e)})),r=a.map((function(e){return'<img src="'.concat(e,'" style="max-width:180px;max-height:180px;margin:5px 5px 5px 0">')})).join(""),o="<div><p>确定要发送如下图片？</p>".concat(r,"</div>");this.$confirm(o,"发送图片",{dangerouslyUseHTMLString:!0}).then((function(){Promise.all(i.map((function(e){return Object(s["p"])(t.onSend,{file:e},t.inClient)}))).finally((function(){a.forEach((function(e){window.URL.revokeObjectURL(e)}))}))}))}}},send:function(){var e=this,t=this.content.trim();t&&this.onSend&&(this.content="",Object(s["p"])(this.onSend,{content:t}).catch((function(n){e.content=t,e.$message.error(n.message)})))}}},h=g,v=(n("cb86"),Object(f["a"])(h,i,a,!1,null,null,null));t["a"]=v.exports},"88cf":function(e,t,n){},"8d2a":function(e,t,n){},"92e5":function(e,t,n){"use strict";n("e13a")},a70f:function(e,t,n){"use strict";n("0016")},ab4b:function(e,t,n){},b6f6:function(e,t,n){},cb86:function(e,t,n){"use strict";n("ab4b")},e13a:function(e,t,n){},fc45:function(e,t,n){"use strict";n("88cf")}}]);