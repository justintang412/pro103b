(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-591a13c7"],{"0c21":function(e,t,a){"use strict";a("360e")},"360e":function(e,t,a){},ad49:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ui-absolute-container page-system-organization"},[a("aside",{staticClass:"aside"},[a("el-scrollbar",{staticClass:"ui-scrollbar"},[a("el-tree",{ref:"Tree",attrs:{data:e.orgData,"node-key":"deptId","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return a("span",{staticClass:"tree-node"},[a("span",{staticClass:"node-label",attrs:{title:n.label},on:{click:function(t){return e.onOrgView(r)}}},[e._v(e._s(n.label))]),a("span",{staticClass:"node-actions"},["-1"!==r.deptId?a("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgEdit(r)}}}):e._e(),r.deptLevel<4?a("el-link",{attrs:{underline:!1,icon:"el-icon-circle-plus-outline"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgEdit(r,n)}}}):e._e(),r.deptLevel>0?a("el-link",{attrs:{underline:!1,icon:"el-icon-remove-outline"},nativeOn:{click:function(t){return t.stopPropagation(),e.onOrgDelete(n,r)}}}):e._e()],1)])}}])})],1)],1),a("main",{staticClass:"main"},[a("header",{staticClass:"main-header"},[e._v("档案库")]),a("div",{staticClass:"main-body"},[a("p",{staticClass:"main-body-meta"},[e._v(" "+e._s(e.curData&&e.curData.label)),a("br")]),a("com-table-view",{ref:"ComTableView",attrs:{warehouseId:e.curData&&e.curData.warehouseId}})],1)])])},r=[],i=a("1da1"),o=a("2909"),c=a("5530"),s=(a("96cf"),a("7db0"),a("d3b7"),a("a15b"),a("d81d"),a("b0c0"),a("b64b"),a("ac1f"),a("1276"),a("99af"),a("3ca3"),a("ddb0"),a("a02a")),u=a("5c63"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ui-table-view",e._g(e._b({},"ui-table-view",e.viewProps,!1),e.viewListeners),[a("ui-text-field",{attrs:{slot:"search",label:"档案架名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},slot:"search",model:{value:e.searchForm.rackName,callback:function(t){e.$set(e.searchForm,"rackName",t)},expression:"searchForm.rackName"}})],1)},d=[],h={mixins:[window.mixTableView],props:["warehouseId"],data:function(){return{columns:[{label:"档案架名称",prop:"rackName"},{label:"档案架位置",prop:"rackPosition"}]}},methods:{fetchMethod:function(e){return this.$http("/rack/list?warehouseId=".concat(this.warehouseId),{params:e}).then((function(e){var t=e.data;return{total:t.length,data:t}}))},onAddUser:function(){var e=this;this.$openModal((function(){return a.e("chunk-2d0be0ce").then(a.bind(null,"2f37"))}),{deptId:this.deptId},{success:function(){return e.getData()}})},onDelete:function(e){var t=this;this.delData({desc:"确定要移除该用户？",action:function(){return t.$post("/ccas/auth/dept/remove/user",{deptId:t.deptId,userId:e.userId})}})}}},p=h,f=a("2877"),b=Object(f["a"])(p,l,d,!1,null,null,null),m=b.exports,v="档案库",g={components:{ComTableView:m},data:function(){return{orgData:[],curData:null}},computed:{flatData:function(){return this.getFlatData(this.orgData)},headerTitle:function(){var e=this,t=function(){var t=e.curData,a=[t],n=function(e){return[void 0,null,""].indexOf(e)<0};while(n(t.parentId)){var r=e.flatData.find((function(e){return e.warehouseId===t.parentId}));if(!r)break;a.push(r),t=r}return a.reverse().map((function(e){return e.name})).join(" > ")};return this.curData?t():v},orgTypes:function(){if(this.curData){var e=this.curData.deptLevel<1?Object.keys(u["b"]):this.curData.type?this.curData.type.split(","):[];return e.map((function(e){return u["b"][e]})).join("、")}return""}},mounted:function(){this.getOrgData()},methods:{getOrgData:function(){var e=this,t={warehouseId:"-1",label:v,name:v,deptLevel:0,children:[]};this.orgData=[t],this.$nextTick((function(){var a=e.$refs.Tree,n=a.getNode(t.warehouseId),r=n.data;a.setCurrentNode(r),e.onOrgView(r)})),this.$http("/warehouse/list").then((function(e){var a=e.data;t.children=Object(s["y"])(a.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{label:e.warehouseName})})),{key:"warehouseId"})}))},getFlatData:function(e){var t=this;return e.reduce((function(e,a){return[].concat(Object(o["a"])(e),[a],Object(o["a"])(a.children?t.getFlatData(a.children):[]))}),[])},onOrgEdit:function(e,t){this.$openModal((function(){return a.e("chunk-429be71c").then(a.bind(null,"4320"))}),{data:e,node:t})},onOrgDelete:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,i,o,c,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,a.$confirm("<p>删除后，该部门及下属部门的所有内容都会被删除，且无法恢复；是否继续删除部门 <b>".concat(t.label,"</b> ？</p>"),"删除部门",{dangerouslyUseHTMLString:!0});case 2:return n.next=4,a.$http("/ccas/auth/dept/del/".concat(t.warehouseId));case 4:r=a.$refs.Tree,i=r.getCurrentNode(),o=a.orgData[0].deptId,c=r.getNode(o),s=c.data,r.remove(e.key),i===t&&(r.setCurrentNode(s),a.onOrgView(s));case 10:case"end":return n.stop()}}),n)})))()},onOrgView:function(e){var t=this;this.curData=e,this.$nextTick((function(){t.$refs.ComTableView.onReset()}))}}},w=g,k=(a("0c21"),Object(f["a"])(w,n,r,!1,null,null,null));t["default"]=k.exports}}]);