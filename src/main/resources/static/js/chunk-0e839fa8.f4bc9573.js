(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e839fa8"],{"0016":function(e,t,a){},"0eec":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.prefix},[a("div",{class:e.prefix+"_more"},[e.loading?a("i",{staticClass:"el-icon-loading"}):e.hasMore?a("el-link",{attrs:{underline:!1},on:{click:e.loadmore}},[e._v("加载更多")]):a("span",[e._v("没有更多数据")])],1),a("ul",{class:e.prefix+"_list"},e._l(e.reducedData,(function(t,n){return a("li",e._b({key:n},"li",e.getMsgView(t),!1))})),0)])},r=[],i=a("1da1"),s=(a("96cf"),a("8a79"),a("fb6a"),a("d81d"),a("4de4"),a("d3b7"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{class:[e.prefix,{isSelf:e.isSelf,isImg:e.isImg}]},[a("div",{class:[e.prefix+"_inner",{isSelf:e.isSelf,isImg:e.isImg}]},[a("header",{class:e.prefix+"_header"},[e._v(e._s(e.userName))]),a("main",{class:e.prefix+"_main"},[e.isSelf?[0===e.data.state?a("i",{staticClass:"el-icon-loading msg-state"}):-1===e.data.state?a("i",{staticClass:"el-icon-error msg-state error",attrs:{title:"点击重发"},on:{click:e.onResend}}):e._e()]:e._e(),a("div",{class:[e.prefix+"_content",e.data.messageType],on:{click:e.onContentClick}},[e.isImg?[a("div",{class:e.prefix+"_img"},[a("img",{attrs:{title:"单击查看大图",src:e.getSrc()},on:{click:e.onPreview}})]),a("el-image",{attrs:{src:e.getSrc(),"preview-src-list":e.imgUrls}})]:e.isVoice?a("div",[a("audio",{attrs:{controls:"",src:e.data.content},on:{play:e.onPlay}})]):e.isText?a("div",{domProps:{innerHTML:e._s(e.parseContent(e.data.content,!0))}}):a("div",{staticClass:"filebox"},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getFileName()))]),a("a",{staticClass:"el-icon-download",attrs:{title:"下载",target:"_blank",href:e.downloadUrl}})])],2)],2)])])}),o=[],c=a("2909"),l=(a("b0c0"),a("ac1f"),a("1276"),a("159b"),a("498a"),a("5319"),a("60e2")),m=a("934a"),u={name:"ImUserMsg",inject:{inClient:{default:!1}},props:{data:Object,isSelf:Boolean,onSend:Function,imgUrls:{type:Array,default:function(){return[]}}},data:function(){return{prefix:"im-msg-user"}},computed:{userName:function(){var e=this.data.ext||{},t="agent"===this.data.source,a=this.data.senderName||e.name||e.senderName;return this.inClient?t?"客服":a:t?this.data.senderId:a},isImg:function(){return this.data.messageType===m["g"].IMAGE},isVoice:function(){return this.data.messageType===m["g"].VOICE},isText:function(){return this.data.messageType===m["g"].TEXT},isFile:function(){return[m["g"].TEXT,m["g"].IMAGE,m["g"].VOICE].indexOf(this.data.messageType)<0},downloadUrl:function(){return this.getApiUrl("/file/fileDownload/".concat(this.data.messageId))}},methods:{getApiUrl:function(e){return Object(l["g"])(Object(l["e"])(this.inClient),e)},parseContent:function(e){return"ai"===this.data.source?Object(m["j"])(e):Object(m["h"])(e,!0)},getSrc:function(){var e=this.data;return e.messageId?this.getApiUrl("/file/image/".concat(e.messageId)):e.content},getFileName:function(){var e=this.data,t=e.content,a=e.fileName;return t.name||a||t.split("/").pop()},onResend:function(){this.onSend&&Object(m["m"])(this.onSend,this.data.messageType===m["g"].TEXT?{content:this.data.content}:{file:this.data.file},this.inClient)},onPreview:function(){var e=this.$el.querySelector(".el-image img");e&&e.click()},onPlay:function(e){Object(c["a"])(document.body.querySelectorAll("audio")).forEach((function(t){t!==e.target&&t.pause()}))},onContentClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&t.parentElement.classList.contains("menu-item")){var a=t.textContent.replace(/^\d+\./,"").trim();this.onSend&&this.onSend({content:a})}}}},d=u,f=(a("fc45"),a("2877")),p=Object(f["a"])(d,s,o,!1,null,null,null),g=p.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{class:e.prefix},[a("span",{class:e.prefix+"_inner"},[e.data.content?a("span",{class:e.prefix+"_content",domProps:{innerHTML:e._s(e.data.content)},on:{click:e.onClick}}):e._e(),a("span",[e._v(e._s(e.formatedTime))])])])},v=[],b=a("a02a"),x={name:"ImTipMsg",inject:{parentVM:{default:""}},props:{data:Object},data:function(){return{prefix:"im-msg-tip"}},computed:{formatedTime:function(){return Object(b["k"])(this.data.createTime)}},methods:{onClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&!t.classList.contains("is-disabled")){t.classList.add("is-disabled");var a=t.dataset.action;"leavemsg"===a&&this.parentVM&&this.parentVM.addMsg(this.parentVM.joinData)}}}},_=x,w=(a("92e5"),Object(f["a"])(_,h,v,!1,null,null,null)),y=w.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{class:e.prefix},[e.submited?a("div",[e._v("留言提交成功，感谢您的参与！")]):a("div",{class:e.prefix+"_box"},[a("header",{class:e.prefix+"_header"},[e._v("当前没有客服在线，请留言")]),a("el-form",{ref:"Form",class:e.prefix+"_form",attrs:{"label-width":"6em",size:"mini",model:e.form,rules:e.rules}},[e.config.lvmname?a("el-form-item",{attrs:{label:"您的姓名"}},[a("el-input",{attrs:{maxlength:"30"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),e.config.lvmphone?a("el-form-item",{attrs:{label:"您的电话",prop:"mobile"}},[a("el-input",{attrs:{maxlength:"12"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1):e._e(),e.config.lvmemail?a("el-form-item",{attrs:{label:"您的邮箱",prop:"email"}},[a("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1):e._e(),e.config.lvmaddress?a("el-form-item",{attrs:{label:"您的地址"}},[a("el-input",{attrs:{maxlength:"50"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1):e._e(),e.config.lvmqq?a("el-form-item",{attrs:{label:"您的QQ",prop:"qq"}},[a("el-input",{attrs:{maxlength:"12"},model:{value:e.form.qq,callback:function(t){e.$set(e.form,"qq",t)},expression:"form.qq"}})],1):e._e(),a("el-form-item",{attrs:{label:"留言内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"300"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),a("el-form-item",[a("div",{class:e.prefix+"_btnBox"},[a("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.loading?"提交中...":"提交"))])],1)])],1)],1)])},k=[],j=a("5530"),O=(a("00b4"),a("3ca3"),a("ddb0"),a("4328")),S=a.n(O),T={name:"ImLeaveMessage",props:{data:Object},data:function(){return{prefix:"im-msg-leave-message",form:{},rules:{mobile:{trigger:"blur",validator:function(e,t,a){!t||b["a"].pattern.test(t)?a():a(new Error(b["a"].message))}},email:{trigger:"blur",type:"email",message:"邮箱格式不正确"},qq:{trigger:"blur",type:"number",validator:function(e,t,a){!t||/^\d{5,12}$/.test(t)?a():a(new Error("QQ格式不正确"))}},content:{trigger:"blur",required:!0,validator:function(e,t,a){t&&t.trim()?a():a(new Error("请输入留言内容"))}}},loading:!1,submited:!1}},computed:{config:function(){return this.data.inviteData}},methods:{onSubmit:function(){var e=this;this.$refs.Form.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=11;break}return n=e.data,t.prev=2,t.next=5,Promise.all([e.$http.post("/leavemsg/",Object(j["a"])(Object(j["a"])({},e.form),{},{orgi:n.orgi,userid:n.userid})),e.$http.post("/message/saveMessage",S.a.stringify({content:e.form.content,customerId:n.userid,entId:n.orgi}),{baseURL:Object(l["d"])(!0)})]);case 5:e.submited=!0,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}}},I=T,M=(a("3687"),Object(f["a"])(I,C,k,!1,null,null,null)),$=M.exports,U={name:"ImMsgList",inject:{inClient:{default:!1}},props:{imUser:{type:Object,default:function(){return{}}},hasMore:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},onSend:Function,onLoadmore:Function},data:function(){return{loading:!1,prefix:"im-msg-list"}},computed:{imgUrls:function(){var e=Object(l["e"])(this.inClient);return e.endsWith("/")&&(e=e.slice(0,-1)),this.data.filter((function(e){return e.messageType===m["g"].IMAGE})).map((function(t){return t.messageId?"".concat(e,"/file/image/").concat(t.messageId):t.content}))},reducedData:function(){return Object(m["l"])(this.data)}},watch:{data:{immediate:!0,handler:"onDataChange"}},methods:{getMsgView:function(e){var t="client",a=this.imUser.source===t,n=["system","allot","ainew"].indexOf(e.cmdType)>-1||"system"===e.source;if(n)return{is:y,data:e};if("leavemsg"===e.cmdType)return{is:$,data:e};var r=a?e.source===t:e.source!==t;return{is:g,data:e,isSelf:r,imgUrls:this.imgUrls,onSend:this.onSend}},toBottom:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))},loadmore:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.onLoadmore||e.loading){t.next=15;break}return e.loading=!0,e.preventScroll=!0,a=e.data[0]||{},n=a.messageId,t.prev=4,t.next=7,e.onLoadmore(n);case 7:r=t.sent,r.length||(e.preventScroll=!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),e.preventScroll=!1;case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})))()},onDataChange:function(){this.preventScroll?this.preventScroll=!1:this.toBottom()}}},E=U,L=(a("a70f"),Object(f["a"])(E,n,r,!1,null,null,null));t["a"]=L.exports},"16c6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[a("div",{staticClass:"container"},[a("section",{staticClass:"section"},[a("header",{staticClass:"header"},[a("span",[e._v("会话时长 "+e._s(e.fmtTimes(e.row.sessiontimes,1)))]),e.isMe?e._e():a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.onGrab}},[e._v("抢接")])],1),a("main",{staticClass:"main"},[a("com-message-list",{attrs:{hasMore:e.hasMore,data:e.data,imUser:e.imUser,onLoadmore:e.getData}})],1)]),a("section",{staticClass:"section"},[a("header",{staticClass:"header"},[a("span",[e._v("客户信息")])]),a("main",{staticClass:"main"},[a("com-customer-form",{ref:"ComCustomerForm",attrs:{readonly:""}})],1)])])])},r=[],i=a("2909"),s=a("1da1"),o=(a("96cf"),a("99af"),a("b0c0"),a("e9c4"),a("a02a")),c=a("0eec"),l=a("5425"),m={props:["row","imUser"],components:{ComMessageList:c["a"],ComCustomerForm:l["a"]},data:function(){return{data:[],hasMore:!0,total:0,fmtTimes:o["j"]}},computed:{isMe:function(){return this.imUser.agentId===this.row.agentno},modalProps:function(){var e=this.row;return{drawer:!0,hideOK:!0,width:"840px",cancelText:"关闭",title:"客户 ".concat(e.nickname," 与 客服 ").concat(e.agentname," 的对话")}}},mounted:function(){var e=this,t=this.row;this.getData(),this.$nextTick((function(){e.$refs.ComCustomerForm.getInitData({customerNickname:t.nickname,customerName:t.name,partnerId:t.userid,customerSource:4,isBlackList:0,customerLevel:1,customerTag:""})}))},methods:{getData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$imHttp("/chatMessage/moremsgForAgentServiceid",{params:{size:30,orgi:t.imUser.orgi,agentserviceid:t.row.agentserviceid,messageId:e}});case 2:r=a.sent,s=r.data,(n=t.data).unshift.apply(n,Object(i["a"])(s)),t.hasMore=s.length>0;case 6:case"end":return a.stop()}}),a)})))()},onGrab:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm('<b style="color:red;">请确保在线客服窗口是打开状态，否则将抢接失败！</b><br>确定要抢接该会话吗？',"抢接",{dangerouslyUseHTMLString:!0});case 2:a=o["q"].open(),a&&(n=e.row,a.postMessage(JSON.stringify({type:"GRAB",payload:{orgi:n.orgi,agentId:e.imUser.agentId,agentserviceid:n.agentserviceid}})));case 4:case"end":return t.stop()}}),t)})))()}}},u=m,d=(a("a4e6"),a("2877")),f=Object(d["a"])(u,n,r,!1,null,"17b8779c",null);t["default"]=f.exports},3687:function(e,t,a){"use strict";a("b6f6")},"88cf":function(e,t,a){},"92e5":function(e,t,a){"use strict";a("e13a")},a4e6:function(e,t,a){"use strict";a("dae8")},a70f:function(e,t,a){"use strict";a("0016")},b6f6:function(e,t,a){},dae8:function(e,t,a){},e13a:function(e,t,a){},fc45:function(e,t,a){"use strict";a("88cf")}}]);