(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c7b01"],{"524b":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[n("el-form",{ref:"Form",attrs:{"label-width":"6em",model:e.form,rules:e.rules}},[e.row?n("ui-text-field",{attrs:{label:"批次ID",value:e.form.eventId,disabled:""}}):e._e(),n("ui-text-field",{attrs:{label:"批次名称",prop:"eventName"},model:{value:e.form.eventName,callback:function(t){e.$set(e.form,"eventName",t)},expression:"form.eventName"}}),n("el-form-item",{attrs:{label:"批次类型"}},[n("el-radio-group",{model:{value:e.form.eventType,callback:function(t){e.$set(e.form,"eventType",t)},expression:"form.eventType"}},e._l(e.batchTypes,(function(t){return n("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])})),1)],1),n("ui-select",{attrs:{label:"场景",prop:"eventSceneId",options:e.eventSceneList,props:{value:"id",label:"sceneName"},filterable:"",disabled:!!e.row},on:{change:e.onSceneChange},model:{value:e.form.eventSceneId,callback:function(t){e.$set(e.form,"eventSceneId",t)},expression:"form.eventSceneId"}}),n("el-form-item",{attrs:{label:"拨打时间",prop:"callTime"}},[n("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.form.callTime,callback:function(t){e.$set(e.form,"callTime",t)},expression:"form.callTime"}})],1),n("ui-text-field",{attrs:{label:"机器人数量",disabled:""},model:{value:e.form.maxLine,callback:function(t){e.$set(e.form,"maxLine",t)},expression:"form.maxLine"}}),e.row?e._e():[n("ui-text-field",{attrs:{label:"外呼时间段",type:"textarea",disabled:""},model:{value:e.form.callTimeDate,callback:function(t){e.$set(e.form,"callTimeDate",t)},expression:"form.callTimeDate"}}),n("el-form-item",{attrs:{label:"导入批次"}},[n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},on:{change:e.onFileChange}}),n("el-button",{attrs:{type:"primary",plain:""},on:{click:e.onSelectFile}},[e._v("选择文件")]),n("el-link",{staticStyle:{"margin-left":"10px","font-size":"12px"},attrs:{underline:!1,type:"primary"},on:{click:e.onDownloadTemplate}},[e._v("模板下载")]),n("p",[e._v(e._s(e.file&&e.file.name))])],1)],n("el-link",{staticStyle:{"margin-left":"2em","margin-bottom":"1em"},attrs:{underline:!1,type:"primary"},on:{click:e.onToggleShowMore}},[e._v(" 高级 "),n("i",{staticClass:"el-icon-caret-bottom"})]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showMore,expression:"showMore"}],staticClass:"more-wrapper"},[n("ui-text-field",{attrs:{label:"节点流程"},model:{value:e.form.nodeFlow,callback:function(t){e.$set(e.form,"nodeFlow",t)},expression:"form.nodeFlow"}}),n("ui-text-field",{attrs:{label:"任务节点",prop:"notifyNode"},model:{value:e.form.notifyNode,callback:function(t){e.$set(e.form,"notifyNode",t)},expression:"form.notifyNode"}})],1)],2)],1)},r=[],o=n("15fd"),l=n("1da1"),i=n("5530"),c=(n("caad"),n("ac1f"),n("1276"),n("b0c0"),n("7db0"),n("d3b7"),n("a15b"),n("96cf"),n("a02a")),s=n("5cdf"),m=["callTime"],u={props:["row"],data:function(){var e=this,t=this.row;return{batchTypes:s["b"],showMore:!1,eventSceneList:[],form:t?Object(i["a"])(Object(i["a"])({},t),{},{eventTenantId:t.tenantId,callTime:[t.sendTime,t.overTime]}):{callTime:[],eventType:0},rules:{eventName:Object(c["y"])("请输入批次名称"),eventSceneId:Object(c["z"])("请选择场景"),callTime:Object(c["z"])("请选择拨打时间"),notifyNode:{trigger:"blur",pattern:/^\d+$/,message:"任务节点必须为数值"}},file:null,modalProps:{isEdit:!!t,width:"530px",drawer:!0,onSubmit:function(){var n=Object(l["a"])(regeneratorRuntime.mark((function n(){var a,r,l,s,u,d,f,p,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$refs.Form.validate();case 2:if(!e.file&&!t&&Object(c["C"])("请选择文件"),a=e.form,r=a.callTime,l=Object(o["a"])(a,m),!t){n.next=10;break}return n.next=7,e.$post("/ocm/event/save",Object(i["a"])(Object(i["a"])({},l),{},{endDate:+new Date(r[1]),beginDate:+new Date(r[0])}));case 7:return n.abrupt("return",n.sent);case 10:return s=e.form.eventSceneId,n.next=13,e.$http("/ocm/event/importCheckBuslistBefore?eventSceneId=".concat(s));case 13:if(u=n.sent,d=u.data,!d){n.next=19;break}Object(c["C"])(d),n.next=29;break;case 19:return f=new FormData,f.append("file",e.file),f.append("eventSceneId",s),n.next=24,e.$http.post("/ocm/list/import/check/Buslist",f);case 24:return p=n.sent,b=p.data,n.next=28,e.$post("/ocm/event/save",Object(i["a"])(Object(i["a"])({},l),{},{endDate:+r[1],beginDate:+r[0],uploadFailedPath:b.uploadFailedPath,uploadSuccessPath:b.uploadSuccessPath}));case 28:return n.abrupt("return",n.sent);case 29:case"end":return n.stop()}}),n)})));function a(){return n.apply(this,arguments)}return a}()}}},mounted:function(){this.getEventSceneList()},methods:{onToggleShowMore:function(){this.showMore=!this.showMore},onSelectFile:function(){this.$refs.File.click()},onFileChange:function(e){var t=e.target,n=t.files[0];t.value="",["xls","xlsx"].includes(n.name.split(".").pop())?this.file=n:Object(c["C"])("请选择Excel文件")},onDownloadTemplate:function(){var e=this,t=this.form.eventSceneId;t?Object(c["i"])({fileName:"批次导入模板.xls",action:function(){return e.$http("/ocm/list/downloadExcel?sceneId=".concat(t),{responseType:"blob"})}}):Object(c["C"])("请先选择场景")},getEventSceneList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/demo/call/scene/get/all");case 2:e.eventSceneList=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},onSceneChange:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var a,r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.eventSceneList.find((function(t){return t.id===e})),t.form=Object(i["a"])(Object(i["a"])({},t.form),{},{caller:a.caller}),n.next=4,t.$http("/ocm/event/data/for/validation?eventSceneId=".concat(e));case 4:r=n.sent,o=r.data,t.form=Object(i["a"])(Object(i["a"])({},t.form),{},{maxLine:o.maxLine,callTimeDate:o.callTimeList.join(",")});case 7:case"end":return n.stop()}}),n)})))()}}},d=u,f=n("2877"),p=Object(f["a"])(d,a,r,!1,null,null,null);t["default"]=p.exports}}]);