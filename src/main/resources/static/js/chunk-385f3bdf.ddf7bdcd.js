(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-385f3bdf"],{"2dd3":function(e,t,a){},"5bd3":function(e,t,a){"use strict";a("2dd3")},"62e8":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SckmMainLayout",{staticClass:"page-sckm-manage"},[a("SckmStructure",{attrs:{slot:"left",disabled:e.userType>2,data:e.treeData},slot:"left",model:{value:e.selectedNodeData,callback:function(t){e.selectedNodeData=t},expression:"selectedNodeData"}}),a("div",{staticClass:"tabs-wrap"},[a("el-tabs",{on:{"tab-click":function(t){return e.getData()}},model:{value:e.itemType,callback:function(t){e.itemType=t},expression:"itemType"}},[a("el-tab-pane",{attrs:{label:"知识管理",name:"0"}},[a("ComManage",e._b({ref:"Manage",attrs:{title:e.title,loading:e.loading},on:{"on-edit":e.handleEdit,"on-import":e.handleImport,"on-exportall":e.handleExportAll,"on-change":e.getData}},"ComManage",e.tableData[0],!1))],1),a("el-tab-pane",{attrs:{label:"草稿箱",name:"1"}},[a("ComDraftbox",e._b({ref:"Draftbox",attrs:{title:e.title,loading:e.loading},on:{"on-edit":e.handleEdit,"on-change":e.getData}},"ComDraftbox",e.tableData[1],!1))],1),a("el-tab-pane",{attrs:{label:"回收站",name:"2"}},[a("ComRecycle",e._b({ref:"Recycle",attrs:{title:e.title,loading:e.loading},on:{"on-change":e.getData}},"ComRecycle",e.tableData[2],!1))],1)],1)],1)],1)},i=[],o=a("5530"),c=(a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("99af"),a("a02a")),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SckmDataTable",e._b({on:{"on-change":e.handleChange,"on-selection-change":e.handleSelectionChange}},"SckmDataTable",e.bindProps,!1),[a("el-button-group",{attrs:{slot:"actions"},slot:"actions"},[a("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("新建")]),e.userType<3?a("el-button",{attrs:{icon:"el-icon-upload2"},on:{click:e.handleImport}},[e._v("导入")]):e._e(),a("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.handleExportAll}},[e._v("全部导出")])],1),a("template",{slot:"toolbar"},[a("SckmTextButton",{attrs:{noBorder:""},on:{click:e.handleExport}},[e._v("导出")]),a("SckmTextButton",{on:{click:e.handleToDraft}},[e._v("转草稿")]),a("span",{class:e.cls.tableHeadPicker},[a("SckmTextButton",[e._v("有效期修改")]),a("el-date-picker",{class:e.cls.tableHeadDatePicker,attrs:{"picker-options":{disabledDate:function(e){return e<new Date}},type:"datetime"},on:{change:e.handleDateChange},model:{value:e.datePickerValue,callback:function(t){e.datePickerValue=t},expression:"datePickerValue"}})],1),e.canTop?a("SckmTextButton",{on:{click:e.handleSetTop}},[e._v(e._s(e.selectedData[0].isTop?"取消置顶":"置顶"))]):e._e(),e.userType<3?a("SckmTextButton",{attrs:{disabled:!e.canEdit},on:{click:e.handleRemind}},[e._v("提醒更新")]):e._e(),a("SckmTextButton",{attrs:{disabled:!e.canEdit},on:{click:e.handleEdit}},[e._v("编辑")]),a("SckmTextButton",{attrs:{type:"danger"},on:{click:e.handleDelete}},[e._v("删除")])],1)],2)},l=[],s=(a("e9c4"),a("a15b"),a("d81d"),a("0053")),d=a("ec1e"),u=a.n(d),h={mixins:[window.sckm.manageTabMixin],data:function(){var e=this;return{cls:u.a,datePickerValue:"",columns:[Object(s["d"])(),Object(s["f"])({hasMark:!0,hasExpired:!0,isManage:!0,onChange:function(t){return e.$emit("on-change",{title:t,pageNum:1})}}),Object(s["e"])({onOk:function(t,a){return e.$emit("on-change",{searchBeginDate:t,searchEndDate:a,pageNum:1})},onSort:function(t){return e.$emit("on-change",{orderJson:t?JSON.stringify({orderKey:"modify_time",orderRule:t}):void 0,pageNum:1})}}),Object(s["a"])({onChange:function(t){return e.$emit("on-change",{authorName:t,pageNum:1})}}),{title:"有效期限",key:"invalidTime",minWidth:170}]}},methods:{handleAdd:function(){this.$emit("on-edit")},handleImport:function(){this.$emit("on-import")},handleExport:function(){var e=this;Object(c["i"])({fileName:"知识库数据导出.xls",action:function(){return e.$http("/sckm/item/export?itemIds=".concat(e.selectedData.map((function(e){return e.itemId})).join(",")),{responseType:"blob"})}})},handleExportAll:function(){this.$emit("on-exportall")},handleToDraft:function(){this.toDraftOrPublish({title:"转至草稿",content:"确定要将所选的".concat(this.selectedData.length,"条知识转到草稿吗？"),isDraft:0})},handleDateChange:function(e){var t=this;e&&this.$post("/sckm/item/update/invalid",{invalidTime:+e,userType:this.userType,itemIds:this.selectedData.map((function(e){return e.itemId})).join(",")}).then((function(e){var a=e.data;t.$message(a),t.$emit("on-change")}))},handleSetTop:function(){var e=this,t=this.selectedData[0],a=t.itemId,n=t.categoryId,i=t.isTop;this.$post("/sckm/item/isTop",{isTop:+!i,itemId:a,categoryId:n}).then((function(){return e.$emit("on-change")}))},handleRemind:function(){var e=this;this.$post("/sckm/item/message/remind",{itemId:this.selectedData[0].itemId}).then((function(){return e.$message("已提醒更新")}))}}},m=h,p=a("2877"),g=Object(p["a"])(m,r,l,!1,null,null,null),f=g.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SckmDataTable",e._b({on:{"on-change":e.handleChange,"on-selection-change":e.handleSelectionChange}},"SckmDataTable",e.bindProps,!1),[a("template",{slot:"toolbar"},[a("SckmTextButton",{attrs:{noBorder:""},on:{click:e.handlePublish}},[e._v("发布")]),a("SckmTextButton",{attrs:{disabled:!e.canEdit},on:{click:e.handleEdit}},[e._v("编辑")]),a("SckmTextButton",{attrs:{type:"danger"},on:{click:e.handleDelete}},[e._v("删除")])],1)],2)},D=[],k={mixins:[window.sckm.manageTabMixin],data:function(){var e=this;return{columns:[Object(s["d"])(),Object(s["f"])({canCollect:!1,isManage:!0,onChange:function(t){return e.$emit("on-change",{title:t,pageNum:1})}}),Object(s["e"])({onOk:function(t,a){return e.$emit("on-change",{searchBeginDate:t,searchEndDate:a,pageNum:1})},onSort:function(t){return e.$emit("on-change",{orderJson:t&&JSON.stringify({orderKey:"modify_time",orderRule:t}),pageNum:1})}}),Object(s["a"])({onChange:function(t){return e.$emit("on-change",{authorName:t,pageNum:1})}})]}},methods:{handlePublish:function(){this.toDraftOrPublish({title:"发布知识",content:"确定要发布所选的".concat(this.selectedData.length,"条知识吗？"),isDraft:1})}}},T=k,y=Object(p["a"])(T,b,D,!1,null,null,null),v=y.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SckmDataTable",e._b({on:{"on-change":e.handleChange,"on-selection-change":e.handleSelectionChange}},"SckmDataTable",e.bindProps,!1),[a("template",{slot:"toolbar"},[a("SckmTextButton",{attrs:{noBorder:""},on:{click:e.handleRestore}},[e._v("恢复")]),a("SckmTextButton",{attrs:{type:"danger"},on:{click:e.handleRealDelete}},[e._v("彻底删除")])],1)],2)},$=[],N=a("1da1"),S=(a("96cf"),{mixins:[window.sckm.manageTabMixin],data:function(){var e=this;return{columns:[Object(s["d"])(),Object(s["f"])({canCollect:!1,isManage:!0,onChange:function(t){return e.$emit("on-change",{title:t,pageNum:1})}}),Object(s["e"])({onOk:function(t,a){return e.$emit("on-change",{searchBeginDate:t,searchEndDate:a,pageNum:1})},onSort:function(t){return e.$emit("on-change",{orderJson:t&&JSON.stringify({orderKey:"modify_time",orderRule:t}),pageNum:1})}}),Object(s["a"])({onChange:function(t){return e.$emit("on-change",{authorName:t,pageNum:1})}})]}},methods:{handleRestore:function(){this.toDeleteOrRestore({title:"恢复知识",content:"确定要恢复所选的".concat(this.selectedData.length,"条知识吗？"),stateDelete:0})},handleRealDelete:function(){var e=this;return Object(N["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm("确定要彻底删除所选的".concat(e.selectedData.length,"条知识吗？"),"彻底删除知识");case 2:return t.next=4,e.$post("/sckm/item/real/delete",{itemIds:e.selectedData.map((function(e){return e.itemId})).join(","),userType:e.userType});case 4:e.$emit("on-change");case 5:case"end":return t.stop()}}),t)})))()}}}),_=S,O=Object(p["a"])(_,x,$,!1,null,null,null),j=O.exports,C={components:{ComManage:f,ComDraftbox:v,ComRecycle:j},data:function(){return{itemType:"0",selectedNodeData:null,tableData:{0:this.getInitData(),1:this.getInitData(),2:this.getInitData()},loading:!1,treeData:[]}},computed:{title:function(){return this.selectedNodeData?this.selectedNodeData.name:"知识库"},currentData:function(){return this.tableData[this.itemType]},userType:function(){return this.$store.getters.isAdmin?"1":this.$store.state.permissions.indexOf("kbm")>-1?"2":"3"}},watch:{selectedNodeData:function(){this.getData({pageNum:1})}},activated:function(){this.getData({pageNum:1})},mounted:function(){this.getTreeData()},methods:{getTreeData:function(){var e=this;return this.$http("/sckm/category/nodes").then((function(e){var t=e.data;return[{title:"知识库",name:"知识库",expand:!0,id:"-1",children:Object(c["F"])(t,{parentId:"pId"})}]})).then((function(t){e.treeData=t,e.selectedNodeData=t[0]}))},getInitData:function(){return{data:[],total:0,params:{pageNum:1,pageSize:10}}},handleEdit:function(e){var t=this,n={row:e?{itemId:e}:null,category:this.selectedNodeData||{}};this.$openModal((function(){return a.e("chunk-fb4150bc").then(a.bind(null,"c5008"))}),n,{success:function(){return t.getData()}})},handleImport:function(){var e=this,t={category:this.selectedNodeData||{}};this.$openModal((function(){return a.e("chunk-0699da54").then(a.bind(null,"9169"))}),t,{success:function(){return e.getData({pageNum:1})}})},handleExportAll:function(){var e=this;Object(c["i"])({fileName:"知识库全部数据导出.xls",action:function(){return e.$http("/sckm/item/batchExport?categoryId=".concat(e.selectedNodeData.id,"&userType=").concat(e.userType),{responseType:"blob"})}})},clearSelectedData:function(){var e=this.$refs,t=e.Manage,a=e.Draftbox,n=e.Recycle;({0:t,1:a,2:n})[this.itemType].clearSelectedData()},getData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,this.clearSelectedData(),this.currentData.params=Object(o["a"])(Object(o["a"])({},this.currentData.params),t),this.$http("/sckm/item/get/list",{params:Object(o["a"])(Object(o["a"])({},this.currentData.params),{},{itemType:this.itemType,userType:this.userType,categoryId:this.selectedNodeData&&this.selectedNodeData.id})}).then((function(t){var a=t.data;e.$set(e.currentData,"data",a.list),e.$set(e.currentData,"total",a.total)})).finally((function(){e.loading=!1}))}}},I=C,E=(a("5bd3"),Object(p["a"])(I,n,i,!1,null,null,null));t["default"]=E.exports}}]);