(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0edefebd"],{"0016":function(e,t,n){},"0eec":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefix},[n("div",{class:e.prefix+"_more"},[e.loading?n("i",{staticClass:"el-icon-loading"}):e.hasMore?n("el-link",{attrs:{underline:!1},on:{click:e.loadmore}},[e._v("加载更多")]):n("span",[e._v("没有更多数据")])],1),n("ul",{class:e.prefix+"_list"},e._l(e.reducedData,(function(t,a){return n("li",e._b({key:a},"li",e.getMsgView(t),!1))})),0)])},r=[],i=n("1da1"),s=(n("96cf"),n("8a79"),n("fb6a"),n("d81d"),n("4de4"),n("d3b7"),n("99af"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:[e.prefix,{isSelf:e.isSelf,isImg:e.isImg}]},[n("div",{class:[e.prefix+"_inner",{isSelf:e.isSelf,isImg:e.isImg}]},[n("header",{class:e.prefix+"_header"},[e._v(e._s(e.userName))]),n("main",{class:e.prefix+"_main"},[e.isSelf?[0===e.data.state?n("i",{staticClass:"el-icon-loading msg-state"}):-1===e.data.state?n("i",{staticClass:"el-icon-error msg-state error",attrs:{title:"点击重发"},on:{click:e.onResend}}):e._e()]:e._e(),n("div",{class:[e.prefix+"_content",e.data.messageType],on:{click:e.onContentClick}},[e.isImg?[n("div",{class:e.prefix+"_img"},[n("img",{attrs:{title:"单击查看大图",src:e.getSrc()},on:{click:e.onPreview}})]),n("el-image",{attrs:{src:e.getSrc(),"preview-src-list":e.imgUrls}})]:e.isVoice?n("div",[n("audio",{attrs:{controls:"",src:e.data.content},on:{play:e.onPlay}})]):e.isText?n("div",{domProps:{innerHTML:e._s(e.parseContent(e.data.content,!0))}}):n("div",{staticClass:"filebox"},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getFileName()))]),n("a",{staticClass:"el-icon-download",attrs:{title:"下载",target:"_blank",href:e.downloadUrl}})])],2)],2)])])}),o=[],c=n("2909"),l=(n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("498a"),n("5319"),n("60e2")),m=n("934a"),u={name:"ImUserMsg",inject:{inClient:{default:!1}},props:{data:Object,isSelf:Boolean,onSend:Function,imgUrls:{type:Array,default:function(){return[]}}},data:function(){return{prefix:"im-msg-user"}},computed:{userName:function(){var e=this.data.ext||{},t="agent"===this.data.source,n=this.data.senderName||e.name||e.senderName;return this.inClient?t?"客服":n:t?this.data.senderId:n},isImg:function(){return this.data.messageType===m["j"].IMAGE},isVoice:function(){return this.data.messageType===m["j"].VOICE},isText:function(){return this.data.messageType===m["j"].TEXT},isFile:function(){return[m["j"].TEXT,m["j"].IMAGE,m["j"].VOICE].indexOf(this.data.messageType)<0},downloadUrl:function(){return this.getApiUrl("/file/fileDownload/".concat(this.data.messageId))}},methods:{getApiUrl:function(e){return Object(l["h"])(Object(l["f"])(this.inClient),e)},parseContent:function(e){return"ai"===this.data.source?Object(m["m"])(e):Object(m["k"])(e,!0)},getSrc:function(){var e=this.data;return e.messageId?this.getApiUrl("/file/image/".concat(e.messageId)):e.content},getFileName:function(){var e=this.data,t=e.content,n=e.fileName;return t.name||n||t.split("/").pop()},onResend:function(){this.onSend&&Object(m["p"])(this.onSend,this.data.messageType===m["j"].TEXT?{content:this.data.content}:{file:this.data.file},this.inClient)},onPreview:function(){var e=this.$el.querySelector(".el-image img");e&&e.click()},onPlay:function(e){Object(c["a"])(document.body.querySelectorAll("audio")).forEach((function(t){t!==e.target&&t.pause()}))},onContentClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&t.parentElement.classList.contains("menu-item")){var n=t.textContent.replace(/^\d+\./,"").trim();this.onSend&&this.onSend({content:n})}}}},d=u,f=(n("fc45"),n("2877")),p=Object(f["a"])(d,s,o,!1,null,null,null),g=p.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[n("span",{class:e.prefix+"_inner"},[e.data.content?n("span",{class:e.prefix+"_content",domProps:{innerHTML:e._s(e.data.content)},on:{click:e.onClick}}):e._e(),n("span",[e._v(e._s(e.formatedTime))])])])},b=[],v=n("a02a"),_={name:"ImTipMsg",inject:{parentVM:{default:""}},props:{data:Object},data:function(){return{prefix:"im-msg-tip"}},computed:{formatedTime:function(){return Object(v["l"])(this.data.createTime)}},methods:{onClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&!t.classList.contains("is-disabled")){t.classList.add("is-disabled");var n=t.dataset.action;"leavemsg"===n&&this.parentVM&&this.parentVM.addMsg(this.parentVM.joinData)}}}},x=_,C=(n("92e5"),Object(f["a"])(x,h,b,!1,null,null,null)),O=C.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[e.submited?n("div",[e._v("留言提交成功，感谢您的参与！")]):n("div",{class:e.prefix+"_box"},[n("header",{class:e.prefix+"_header"},[e._v("当前没有客服在线，请留言")]),n("el-form",{ref:"Form",class:e.prefix+"_form",attrs:{"label-width":"6em",size:"mini",model:e.form,rules:e.rules}},[e.config.lvmname?n("el-form-item",{attrs:{label:"您的姓名"}},[n("el-input",{attrs:{maxlength:"30"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),e.config.lvmphone?n("el-form-item",{attrs:{label:"您的电话",prop:"mobile"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1):e._e(),e.config.lvmemail?n("el-form-item",{attrs:{label:"您的邮箱",prop:"email"}},[n("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1):e._e(),e.config.lvmaddress?n("el-form-item",{attrs:{label:"您的地址"}},[n("el-input",{attrs:{maxlength:"50"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1):e._e(),e.config.lvmqq?n("el-form-item",{attrs:{label:"您的QQ",prop:"qq"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.qq,callback:function(t){e.$set(e.form,"qq",t)},expression:"form.qq"}})],1):e._e(),n("el-form-item",{attrs:{label:"留言内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"300"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),n("el-form-item",[n("div",{class:e.prefix+"_btnBox"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.loading?"提交中...":"提交"))])],1)])],1)],1)])},E=[],T=n("5530"),w=(n("00b4"),n("3ca3"),n("ddb0"),n("4328")),y=n.n(w),k={name:"ImLeaveMessage",props:{data:Object},data:function(){return{prefix:"im-msg-leave-message",form:{},rules:{mobile:{trigger:"blur",validator:function(e,t,n){!t||v["a"].pattern.test(t)?n():n(new Error(v["a"].message))}},email:{trigger:"blur",type:"email",message:"邮箱格式不正确"},qq:{trigger:"blur",type:"number",validator:function(e,t,n){!t||/^\d{5,12}$/.test(t)?n():n(new Error("QQ格式不正确"))}},content:{trigger:"blur",required:!0,validator:function(e,t,n){t&&t.trim()?n():n(new Error("请输入留言内容"))}}},loading:!1,submited:!1}},computed:{config:function(){return this.data.inviteData}},methods:{onSubmit:function(){var e=this;this.$refs.Form.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return a=e.data,t.prev=2,t.next=5,Promise.all([e.$http.post("/leavemsg/",Object(T["a"])(Object(T["a"])({},e.form),{},{orgi:a.orgi,userid:a.userid})),e.$http.post("/message/saveMessage",y.a.stringify({content:e.form.content,customerId:a.userid,entId:a.orgi}),{baseURL:Object(l["d"])(!0)})]);case 5:e.submited=!0,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}}},I=k,S=(n("3687"),Object(f["a"])(I,j,E,!1,null,null,null)),M=S.exports,A={name:"ImMsgList",inject:{inClient:{default:!1}},props:{imUser:{type:Object,default:function(){return{}}},hasMore:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},onSend:Function,onLoadmore:Function},data:function(){return{loading:!1,prefix:"im-msg-list"}},computed:{imgUrls:function(){var e=Object(l["f"])(this.inClient);return e.endsWith("/")&&(e=e.slice(0,-1)),this.data.filter((function(e){return e.messageType===m["j"].IMAGE})).map((function(t){return t.messageId?"".concat(e,"/file/image/").concat(t.messageId):t.content}))},reducedData:function(){return Object(m["o"])(this.data)}},watch:{data:{immediate:!0,handler:"onDataChange"}},methods:{getMsgView:function(e){var t="client",n=this.imUser.source===t,a=["system","allot","ainew"].indexOf(e.cmdType)>-1||"system"===e.source;if(a)return{is:O,data:e};if("leavemsg"===e.cmdType)return{is:M,data:e};var r=n?e.source===t:e.source!==t;return{is:g,data:e,isSelf:r,imgUrls:this.imgUrls,onSend:this.onSend}},toBottom:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))},loadmore:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.onLoadmore||e.loading){t.next=15;break}return e.loading=!0,e.preventScroll=!0,n=e.data[0]||{},a=n.messageId,t.prev=4,t.next=7,e.onLoadmore(a);case 7:r=t.sent,r.length||(e.preventScroll=!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),e.preventScroll=!1;case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})))()},onDataChange:function(){this.preventScroll?this.preventScroll=!1:this.toBottom()}}},P=A,L=(n("a70f"),Object(f["a"])(P,a,r,!1,null,null,null));t["a"]=L.exports},"16c6":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[n("div",{staticClass:"container"},[n("section",{staticClass:"section"},[n("header",{staticClass:"header"},[n("span",[e._v("会话时长 "+e._s(e.fmtTimes(e.row.sessiontimes,1)))]),e.isMe?e._e():n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.onGrab}},[e._v("抢接")])],1),n("main",{staticClass:"main"},[n("com-message-list",{attrs:{hasMore:e.hasMore,data:e.data,imUser:e.imUser,onLoadmore:e.getData}})],1)]),n("section",{staticClass:"section"},[n("header",{staticClass:"header"},[n("span",[e._v("客户信息")])]),n("main",{staticClass:"main"},[n("com-customer-form",{ref:"ComCustomerForm",attrs:{readonly:""}})],1)])])])},r=[],i=n("2909"),s=n("1da1"),o=(n("96cf"),n("99af"),n("b0c0"),n("e9c4"),n("a02a")),c=n("0eec"),l=n("5425"),m={props:["row","imUser"],components:{ComMessageList:c["a"],ComCustomerForm:l["a"]},data:function(){return{data:[],hasMore:!0,total:0,fmtTimes:o["k"]}},computed:{isMe:function(){return this.imUser.agentId===this.row.agentno},modalProps:function(){var e=this.row;return{drawer:!0,hideOK:!0,width:"840px",cancelText:"关闭",title:"客户 ".concat(e.nickname," 与 客服 ").concat(e.agentname," 的对话")}}},mounted:function(){var e=this,t=this.row;this.getData(),this.$nextTick((function(){e.$refs.ComCustomerForm.getInitData({customerNickname:t.nickname,customerName:t.name,partnerId:t.userid,customerSource:4,isBlackList:0,customerLevel:1,customerTag:""})}))},methods:{getData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$imHttp("/chatMessage/moremsgForAgentServiceid",{params:{size:30,orgi:t.imUser.orgi,agentserviceid:t.row.agentserviceid,messageId:e}});case 2:r=n.sent,s=r.data,(a=t.data).unshift.apply(a,Object(i["a"])(s)),t.hasMore=s.length>0;case 6:case"end":return n.stop()}}),n)})))()},onGrab:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm('<b style="color:red;">请确保在线客服窗口是打开状态，否则将抢接失败！</b><br>确定要抢接该会话吗？',"抢接",{dangerouslyUseHTMLString:!0});case 2:n=o["t"].open(),n&&(a=e.row,n.postMessage(JSON.stringify({type:"GRAB",payload:{orgi:a.orgi,agentId:e.imUser.agentId,agentserviceid:a.agentserviceid}})));case 4:case"end":return t.stop()}}),t)})))()}}},u=m,d=(n("a4e6"),n("2877")),f=Object(d["a"])(u,a,r,!1,null,"17b8779c",null);t["default"]=f.exports},3687:function(e,t,n){"use strict";n("b6f6")},"498a":function(e,t,n){"use strict";var a=n("23e7"),r=n("58a8").trim,i=n("c8d2");a({target:"String",proto:!0,forced:i("trim")},{trim:function(){return r(this)}})},"88cf":function(e,t,n){},"92e5":function(e,t,n){"use strict";n("e13a")},a4e6:function(e,t,n){"use strict";n("dae8")},a70f:function(e,t,n){"use strict";n("0016")},b6f6:function(e,t,n){},c8d2:function(e,t,n){var a=n("5e77").PROPER,r=n("d039"),i=n("5899"),s="​᠎";e.exports=function(e){return r((function(){return!!i[e]()||s[e]()!==s||a&&i[e].name!==e}))}},dae8:function(e,t,n){},de0b:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return c}));var a=n("ade3"),r="customer-center",i={CUSTOMER_CENTER:1,WECHAT:2,APP:3,PC_WEB:4,WEIBO:5,MOB_WEB:6,CALL_CENTER:7,WO_CENTER:8,ENT_WECHAT:9,WECHAT_APP:10,EMAIL:11},s=function(e){var t;return t={},Object(a["a"])(t,e.CUSTOMER_CENTER,"客户中心"),Object(a["a"])(t,e.WECHAT,"微信"),Object(a["a"])(t,e.APP,"APP"),Object(a["a"])(t,e.PC_WEB,"桌面网站"),Object(a["a"])(t,e.WEIBO,"微博"),Object(a["a"])(t,e.MOB_WEB,"移动网站"),Object(a["a"])(t,e.CALL_CENTER,"呼叫中心"),Object(a["a"])(t,e.WO_CENTER,"工单中心"),Object(a["a"])(t,e.ENT_WECHAT,"企业微信"),Object(a["a"])(t,e.WECHAT_APP,"微信小程序"),Object(a["a"])(t,e.EMAIL,"邮件"),t}(i),o={BASE:1,VIP:2},c=function(e){var t;return t={},Object(a["a"])(t,e.BASE,"普通客户"),Object(a["a"])(t,e.VIP,"VIP客户"),t}(o)},e13a:function(e,t,n){},fc45:function(e,t,n){"use strict";n("88cf")}}]);