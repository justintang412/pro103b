(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-092df946","chunk-0325e3dd"],{"0016":function(e,t,n){},"09fc":function(e,t,n){},"0eec":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.prefix},[n("div",{class:e.prefix+"_more"},[e.loading?n("i",{staticClass:"el-icon-loading"}):e.hasMore?n("el-link",{attrs:{underline:!1},on:{click:e.loadmore}},[e._v("加载更多")]):n("span",[e._v("没有更多数据")])],1),n("ul",{class:e.prefix+"_list"},e._l(e.reducedData,(function(t,a){return n("li",e._b({key:a},"li",e.getMsgView(t),!1))})),0)])},r=[],i=n("1da1"),s=(n("96cf"),n("8a79"),n("fb6a"),n("d81d"),n("4de4"),n("d3b7"),n("99af"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:[e.prefix,{isSelf:e.isSelf,isImg:e.isImg}]},[n("div",{class:[e.prefix+"_inner",{isSelf:e.isSelf,isImg:e.isImg}]},[n("header",{class:e.prefix+"_header"},[e._v(e._s(e.userName))]),n("main",{class:e.prefix+"_main"},[e.isSelf?[0===e.data.state?n("i",{staticClass:"el-icon-loading msg-state"}):-1===e.data.state?n("i",{staticClass:"el-icon-error msg-state error",attrs:{title:"点击重发"},on:{click:e.onResend}}):e._e()]:e._e(),n("div",{class:[e.prefix+"_content",e.data.messageType],on:{click:e.onContentClick}},[e.isImg?[n("div",{class:e.prefix+"_img"},[n("img",{attrs:{title:"单击查看大图",src:e.getSrc()},on:{click:e.onPreview}})]),n("el-image",{attrs:{src:e.getSrc(),"preview-src-list":e.imgUrls}})]:e.isVoice?n("div",[n("audio",{attrs:{controls:"",src:e.data.content},on:{play:e.onPlay}})]):e.isText?n("div",{domProps:{innerHTML:e._s(e.parseContent(e.data.content,!0))}}):n("div",{staticClass:"filebox"},[n("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getFileName()))]),n("a",{staticClass:"el-icon-download",attrs:{title:"下载",target:"_blank",href:e.downloadUrl}})])],2)],2)])])}),o=[],c=n("2909"),l=(n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("498a"),n("5319"),n("60e2")),u=n("934a"),m={name:"ImUserMsg",inject:{inClient:{default:!1}},props:{data:Object,isSelf:Boolean,onSend:Function,imgUrls:{type:Array,default:function(){return[]}}},data:function(){return{prefix:"im-msg-user"}},computed:{userName:function(){var e=this.data.ext||{},t="agent"===this.data.source,n=this.data.senderName||e.name||e.senderName;return this.inClient?t?"客服":n:t?this.data.senderId:n},isImg:function(){return this.data.messageType===u["j"].IMAGE},isVoice:function(){return this.data.messageType===u["j"].VOICE},isText:function(){return this.data.messageType===u["j"].TEXT},isFile:function(){return[u["j"].TEXT,u["j"].IMAGE,u["j"].VOICE].indexOf(this.data.messageType)<0},downloadUrl:function(){return this.getApiUrl("/file/fileDownload/".concat(this.data.messageId))}},methods:{getApiUrl:function(e){return Object(l["h"])(Object(l["f"])(this.inClient),e)},parseContent:function(e){return"ai"===this.data.source?Object(u["m"])(e):Object(u["k"])(e,!0)},getSrc:function(){var e=this.data;return e.messageId?this.getApiUrl("/file/image/".concat(e.messageId)):e.content},getFileName:function(){var e=this.data,t=e.content,n=e.fileName;return t.name||n||t.split("/").pop()},onResend:function(){this.onSend&&Object(u["p"])(this.onSend,this.data.messageType===u["j"].TEXT?{content:this.data.content}:{file:this.data.file},this.inClient)},onPreview:function(){var e=this.$el.querySelector(".el-image img");e&&e.click()},onPlay:function(e){Object(c["a"])(document.body.querySelectorAll("audio")).forEach((function(t){t!==e.target&&t.pause()}))},onContentClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&t.parentElement.classList.contains("menu-item")){var n=t.textContent.replace(/^\d+\./,"").trim();this.onSend&&this.onSend({content:n})}}}},d=m,f=(n("fc45"),n("2877")),p=Object(f["a"])(d,s,o,!1,null,null,null),g=p.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[n("span",{class:e.prefix+"_inner"},[e.data.content?n("span",{class:e.prefix+"_content",domProps:{innerHTML:e._s(e.data.content)},on:{click:e.onClick}}):e._e(),n("span",[e._v(e._s(e.formatedTime))])])])},v=[],b=n("a02a"),x={name:"ImTipMsg",inject:{parentVM:{default:""}},props:{data:Object},data:function(){return{prefix:"im-msg-tip"}},computed:{formatedTime:function(){return Object(b["l"])(this.data.createTime)}},methods:{onClick:function(e){var t=e.target;if("a"===t.tagName.toLowerCase()&&!t.classList.contains("is-disabled")){t.classList.add("is-disabled");var n=t.dataset.action;"leavemsg"===n&&this.parentVM&&this.parentVM.addMsg(this.parentVM.joinData)}}}},_=x,w=(n("92e5"),Object(f["a"])(_,h,v,!1,null,null,null)),j=w.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{class:e.prefix},[e.submited?n("div",[e._v("留言提交成功，感谢您的参与！")]):n("div",{class:e.prefix+"_box"},[n("header",{class:e.prefix+"_header"},[e._v("当前没有客服在线，请留言")]),n("el-form",{ref:"Form",class:e.prefix+"_form",attrs:{"label-width":"6em",size:"mini",model:e.form,rules:e.rules}},[e.config.lvmname?n("el-form-item",{attrs:{label:"您的姓名"}},[n("el-input",{attrs:{maxlength:"30"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),e.config.lvmphone?n("el-form-item",{attrs:{label:"您的电话",prop:"mobile"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1):e._e(),e.config.lvmemail?n("el-form-item",{attrs:{label:"您的邮箱",prop:"email"}},[n("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1):e._e(),e.config.lvmaddress?n("el-form-item",{attrs:{label:"您的地址"}},[n("el-input",{attrs:{maxlength:"50"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1):e._e(),e.config.lvmqq?n("el-form-item",{attrs:{label:"您的QQ",prop:"qq"}},[n("el-input",{attrs:{maxlength:"12"},model:{value:e.form.qq,callback:function(t){e.$set(e.form,"qq",t)},expression:"form.qq"}})],1):e._e(),n("el-form-item",{attrs:{label:"留言内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"300"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),n("el-form-item",[n("div",{class:e.prefix+"_btnBox"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.loading?"提交中...":"提交"))])],1)])],1)],1)])},y=[],O=n("5530"),S=(n("00b4"),n("3ca3"),n("ddb0"),n("4328")),C=n.n(S),T={name:"ImLeaveMessage",props:{data:Object},data:function(){return{prefix:"im-msg-leave-message",form:{},rules:{mobile:{trigger:"blur",validator:function(e,t,n){!t||b["a"].pattern.test(t)?n():n(new Error(b["a"].message))}},email:{trigger:"blur",type:"email",message:"邮箱格式不正确"},qq:{trigger:"blur",type:"number",validator:function(e,t,n){!t||/^\d{5,12}$/.test(t)?n():n(new Error("QQ格式不正确"))}},content:{trigger:"blur",required:!0,validator:function(e,t,n){t&&t.trim()?n():n(new Error("请输入留言内容"))}}},loading:!1,submited:!1}},computed:{config:function(){return this.data.inviteData}},methods:{onSubmit:function(){var e=this;this.$refs.Form.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return a=e.data,t.prev=2,t.next=5,Promise.all([e.$http.post("/leavemsg/",Object(O["a"])(Object(O["a"])({},e.form),{},{orgi:a.orgi,userid:a.userid})),e.$http.post("/message/saveMessage",C.a.stringify({content:e.form.content,customerId:a.userid,entId:a.orgi}),{baseURL:Object(l["d"])(!0)})]);case 5:e.submited=!0,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}}},M=T,I=(n("3687"),Object(f["a"])(M,k,y,!1,null,null,null)),$=I.exports,E={name:"ImMsgList",inject:{inClient:{default:!1}},props:{imUser:{type:Object,default:function(){return{}}},hasMore:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},onSend:Function,onLoadmore:Function},data:function(){return{loading:!1,prefix:"im-msg-list"}},computed:{imgUrls:function(){var e=Object(l["f"])(this.inClient);return e.endsWith("/")&&(e=e.slice(0,-1)),this.data.filter((function(e){return e.messageType===u["j"].IMAGE})).map((function(t){return t.messageId?"".concat(e,"/file/image/").concat(t.messageId):t.content}))},reducedData:function(){return Object(u["o"])(this.data)}},watch:{data:{immediate:!0,handler:"onDataChange"}},methods:{getMsgView:function(e){var t="client",n=this.imUser.source===t,a=["system","allot","ainew"].indexOf(e.cmdType)>-1||"system"===e.source;if(a)return{is:j,data:e};if("leavemsg"===e.cmdType)return{is:$,data:e};var r=n?e.source===t:e.source!==t;return{is:g,data:e,isSelf:r,imgUrls:this.imgUrls,onSend:this.onSend}},toBottom:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))},loadmore:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.onLoadmore||e.loading){t.next=15;break}return e.loading=!0,e.preventScroll=!0,n=e.data[0]||{},a=n.messageId,t.prev=4,t.next=7,e.onLoadmore(a);case 7:r=t.sent,r.length||(e.preventScroll=!1),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),e.preventScroll=!1;case 14:e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})))()},onDataChange:function(){this.preventScroll?this.preventScroll=!1:this.toBottom()}}},U=E,q=(n("a70f"),Object(f["a"])(U,a,r,!1,null,null,null));t["a"]=q.exports},"2cc5":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ui-modal",e._g(e._b({},"ui-modal",e.modalProps,!1),e.$listeners),[n("com-message-list",{attrs:{hasMore:e.hasMore,data:e.data,imUser:e.imUser,onLoadmore:e.getData}})],1)},r=[],i=n("2909"),s=n("1da1"),o=(n("96cf"),n("0eec")),c={props:["row","imUser"],components:{ComMessageList:o["a"]},data:function(){return{data:[],hasMore:!0,total:0}},computed:{modalProps:function(){return{drawer:!0,hideOK:!0,cancelText:"关闭",title:"聊天记录 (共".concat(this.total,"条)")}}},mounted:function(){this.getData(),this.getCount(this.row.agentserviceid)},methods:{getData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$imHttp("/chatMessage/moremsgForAgentServiceid",{params:{size:30,orgi:t.imUser.orgi,agentserviceid:t.row.agentserviceid,messageId:e}});case 2:r=n.sent,s=r.data,(a=t.data).unshift.apply(a,Object(i["a"])(s)),t.hasMore=s.length>0;case 6:case"end":return n.stop()}}),n)})))()},getCount:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$imHttp("/chatMessage/msgTotal",{params:{agentserviceid:e,orgi:t.imUser.orgi}});case 2:a=n.sent,r=a.data,t.total=r;case 5:case"end":return n.stop()}}),n)})))()}}},l=c,u=(n("5c67"),n("2877")),m=Object(u["a"])(l,a,r,!1,null,"6776a4cc",null);t["default"]=m.exports},3687:function(e,t,n){"use strict";n("b6f6")},"498a":function(e,t,n){"use strict";var a=n("23e7"),r=n("58a8").trim,i=n("c8d2");a({target:"String",proto:!0,forced:i("trim")},{trim:function(){return r(this)}})},"5c67":function(e,t,n){"use strict";n("09fc")},"88cf":function(e,t,n){},"92e5":function(e,t,n){"use strict";n("e13a")},a70f:function(e,t,n){"use strict";n("0016")},b6f6:function(e,t,n){},c8d2:function(e,t,n){var a=n("5e77").PROPER,r=n("d039"),i=n("5899"),s="​᠎";e.exports=function(e){return r((function(){return!!i[e]()||s[e]()!==s||a&&i[e].name!==e}))}},e13a:function(e,t,n){},fc45:function(e,t,n){"use strict";n("88cf")}}]);