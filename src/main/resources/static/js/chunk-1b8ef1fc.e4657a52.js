(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b8ef1fc"],{"001e":function(e,t,n){"use strict";n("beaa")},"09ba":function(e,t,n){"use strict";n("c578")},"927c":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"Form",attrs:{"label-position":"top",model:e.form}},e._l(e.fieldList,(function(t){return n("el-form-item",{key:t.fieldUid,attrs:{label:t.fieldTitle,prop:t.fieldUid,rules:e.createRules(t)}},[+t.fieldType===e.T.INPUT?n("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.TEXTAREA?n("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入内容"},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.SELECT?n("el-select",{attrs:{clearable:!+t.isNecessary},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(e){return n("el-option",{key:e.optionsUid,attrs:{value:e.optionsUid,label:e.optionsName}})})),1):+t.fieldType===e.T.CASCADER?n("el-cascader",{attrs:{clearable:!+t.isNecessary,options:e.dataMap["tree_"+t.fieldUid],props:{value:"optionsUid",label:"optionsName"}},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.RADIO?n("el-radio-group",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(t){return n("el-radio",{key:t.optionsUid,attrs:{label:t.optionsUid}},[e._v(e._s(t.optionsName))])})),1):+t.fieldType===e.T.CHECKBOX?n("el-checkbox-group",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(t){return n("el-checkbox",{key:t.optionsUid,attrs:{label:t.optionsUid}},[e._v(e._s(t.optionsName))])})),1):+t.fieldType===e.T.DATE?n("el-date-picker",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.UPLOAD?n("com-upload",{attrs:{action:e.uploadAction,jsonParam:t.fieldInfo},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):e._e()],1)})),1)},i=[],a=n("ade3"),o=n("5530"),c=n("1da1"),s=(n("96cf"),n("4de4"),n("d3b7"),n("159b"),n("7db0"),n("d81d"),n("a02a")),u=n("e6f4"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:e.accept},on:{change:e.onChange}}),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.onSelect}},[e._v("选择文件")]),n("p",{staticClass:"tip"},[e._v("* 文件大小不能超过"+e._s(+e.options.limit)+"M")]),e.file?n("div",{staticClass:"file-wrap"},[e.isImg()?n("img",{attrs:{src:e.blobUrl}}):e.isVideo()?n("video",{attrs:{src:e.blobUrl,controls:""}}):n("p",{staticClass:"filename"},[e._v(e._s(e.file.name))])]):e._e()],1)},l=[],f=(n("caad"),n("2532"),n("ac1f"),n("1276"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("2ca0"),{props:{value:{},jsonParam:{},action:Function},data:function(){return{file:null,blobUrl:null,model:this.value}},computed:{options:function(){try{return JSON.parse(this.jsonParam)||{}}catch(e){return{}}},accept:function(){var e,t=this.options.accept||[],n=(e={},Object(a["a"])(e,u["c"].IMAGE,"image/*"),Object(a["a"])(e,u["c"].VIDEO,"video/*"),e);return t.includes(u["c"].ALL)?"":t.map((function(e){return n[e]}))+""}},watch:{value:function(e){this.model=e},model:function(e){this.$emit("input",e)}},methods:{onSelect:function(){this.action?this.$refs.File.click():Object(s["C"])("预览模式不允许上传")},onChange:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,i,a,o,c,u,d,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.target,i=r.files[0],r.value="",!i){n.next=21;break}if(a=i.type.split("/")[0],o=+t.options.limit,c=1024*o*1024,!(i.size>c)){n.next=9;break}return n.abrupt("return",Object(s["C"])("文件大小不能超过".concat(o,"M")));case 9:if(u=t.accept,!u){n.next=13;break}if(!(u.indexOf(a)<0)){n.next=13;break}return n.abrupt("return",Object(s["C"])("该文件类型不支持"));case 13:return t.file=i,t.blobUrl=window.URL.createObjectURL(i),setTimeout((function(){window.URL.revokeObjectURL(t.blobUrl)}),500),n.next=18,t.action(i);case 18:d=n.sent,l=d.data,t.model={fileType:a,name:l.fileUrl};case 21:case"end":return n.stop()}}),n)})))()},isImg:function(){return this.file.type.startsWith("image/")},isVideo:function(){return this.file.type.startsWith("video/")}}}),p=f,m=(n("09ba"),n("2877")),b=Object(m["a"])(p,d,l,!1,null,"e29f960c",null),v=b.exports,h={components:{ComUpload:v},props:["action","optionsAction","uploadAction"],data:function(){return{T:u["b"],fieldList:[],form:{},dataMap:{}}},mounted:function(){this.getData()},methods:{getData:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.action();case 2:n=t.sent.filter((function(e){return+e.fieldStatus})),n.forEach(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var r,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Object(u["i"])(n.fieldType)){t.next=6;break}return Object(u["j"])(n)&&(e.form=Object(o["a"])(Object(o["a"])({},e.form),{},Object(a["a"])({},n.fieldUid,[]))),t.next=4,e.optionsAction(n.fieldUid);case 4:r=t.sent,+n.fieldType===u["b"].CASCADER?(c="tree_".concat(n.fieldUid),e.dataMap=Object(o["a"])(Object(o["a"])({},e.dataMap),{},(i={},Object(a["a"])(i,n.fieldUid,r),Object(a["a"])(i,c,Object(s["F"])(r,{key:"optionsUid"})),i))):e.dataMap=Object(o["a"])(Object(o["a"])({},e.dataMap),{},Object(a["a"])({},n.fieldUid,r));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.fieldList=n;case 5:case"end":return t.stop()}}),t)})))()},getForm:function(){var e=this,t={},n=this.dataMap,r=function(r){var i=e.form[r],a=n[r],c=e.fieldList.find((function(e){return e.fieldUid===r}))||{};c={title:c.fieldTitle,type:c.fieldType};var s=function(e){return(a.find((function(t){return t.optionsUid===e}))||{}).optionsName};a?Array.isArray(i)?t[r]={field:c,id:i,name:i.map(s)}:t[r]={field:c,id:i,name:s(i)}:+c.type===u["b"].UPLOAD?t[r]=Object(o["a"])({field:c},i):t[r]={field:c,name:i}};for(var i in this.form)r(i);return t},validate:function(){return this.$refs.Form.validate()},createRules:function(e){return+e.isNecessary?{required:!0,message:"该字段不能为空",trigger:Object(u["k"])(e.fieldType)?null:"blur"}:null}}},O=h,U=Object(m["a"])(O,r,i,!1,null,null,null);t["a"]=U.exports},beaa:function(e,t,n){},c578:function(e,t,n){},d2c0:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-form"},[n("div",{staticClass:"title"},[e._v("您好，请填写如下表单")]),n("com-custom-form",{ref:"Form",attrs:{action:e.getFieldList,optionsAction:e.getOptionList,uploadAction:e.upload}}),n("div",{staticClass:"btns"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion"},on:{click:e.submit}},[e._v("提 交")])],1)],1)},i=[],a=n("1da1"),o=(n("e9c4"),n("96cf"),n("4328")),c=n("60e2"),s=n("927c"),u=n("bd90"),d={components:{ComCustomForm:s["a"]},data:function(){return{fieldList:[]}},computed:{templateUid:function(){return this.$route.params.id},uuid:function(){return this.$route.query.uuid}},methods:{getFieldList:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["b"])("/media/field/get",{params:{templateUid:e.templateUid},baseURL:Object(c["d"])(!0)});case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t)})))()},getOptionList:function(e){return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["b"])("/media/field/getOptionList",{params:{fieldUid:e},baseURL:Object(c["d"])(!0)});case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t)})))()},upload:function(e){var t=new FormData;return t.append("file",e),t.append("infoUuid",this.uuid),t.append("templateId",this.templateUid),u["b"].post("/file/handle/fileByForm",t,{baseURL:Object(c["d"])(!0)})},submit:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$refs.Form,t.next=3,n.validate();case 3:return r=e.$loading(),i=n.getForm(),a={fileType:"form",infoUuid:e.uuid,form:JSON.stringify(i)},t.prev=6,t.next=9,u["b"].post("/file/handle/templateCommit",Object(o["stringify"])(a),{baseURL:Object(c["d"])(!0)});case 9:e.$router.push("/success"),t.next=14;break;case 12:t.prev=12,t.t0=t["catch"](6);case 14:r.close();case 15:case"end":return t.stop()}}),t,null,[[6,12]])})))()}}},l=d,f=(n("001e"),n("2877")),p=Object(f["a"])(l,r,i,!1,null,null,null);t["default"]=p.exports},e6f4:function(e,t,n){"use strict";n.d(t,"m",(function(){return c})),n.d(t,"g",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"l",(function(){return b})),n.d(t,"i",(function(){return v})),n.d(t,"j",(function(){return h})),n.d(t,"k",(function(){return O})),n.d(t,"a",(function(){return U}));var r=n("5530"),i=n("ade3"),a=n("1da1"),o=(n("e9c4"),n("caad"),n("2532"),n("fb6a"),n("96cf"),n("fa65")),c="media-link",s=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,Object(o["e"])("/file/handle/getChatRecord",{params:{callId:t}});case 3:e.t0=e.sent.data,e.next=7;break;case 6:e.t0=[];case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["e"])("/media/field/get?templateUid=".concat(t));case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(e){return"https://miniprogram.sindvision.com/web/#/?".concat(btoa(JSON.stringify(e)))},l={INPUT:1,TEXTAREA:2,SELECT:3,CASCADER:4,RADIO:5,CHECKBOX:6,DATE:7,UPLOAD:8},f=function(e){var t;return t={},Object(i["a"])(t,e.INPUT,"输入框"),Object(i["a"])(t,e.TEXTAREA,"多行输入框"),Object(i["a"])(t,e.SELECT,"下拉框"),Object(i["a"])(t,e.CASCADER,"级联下拉框"),Object(i["a"])(t,e.RADIO,"单选框"),Object(i["a"])(t,e.CHECKBOX,"复选框"),Object(i["a"])(t,e.DATE,"日期"),Object(i["a"])(t,e.UPLOAD,"文件上传"),t}(l),p={ALL:1,IMAGE:2,VIDEO:3},m=function(e){var t;return t={},Object(i["a"])(t,e.ALL,"所有"),Object(i["a"])(t,e.IMAGE,"图片"),Object(i["a"])(t,e.VIDEO,"视频"),t}(p),b=function(e){try{return JSON.parse(e)||{}}catch(t){return{}}},v=function(e){var t=l;return[t.SELECT,t.CASCADER,t.RADIO,t.CHECKBOX].includes(+e)},h=function(e){var t=l;return+e.fieldType===t.CHECKBOX},O=function(e){var t=l;return v(e)||[t.DATE].includes(+e)},U=function(e){var t=e||{},n=t.callId;return n?Object(r["a"])(Object(r["a"])({},e),{},{callId:(n+"").slice(0,9)}):e}},fa65:function(e,t,n){"use strict";n.d(t,"e",(function(){return m})),n.d(t,"a",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return O}));n("d3b7"),n("b0c0");var r=n("4328"),i=n.n(r),a=n("bc3a"),o=n.n(a),c=n("5c96"),s=n("e5ac"),u=n("a02a"),d=n("60e2"),l=function(e){var t=e.statusCode,n=e.message,r=e.data,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&c["Message"].error(n||"发生未知异常");var a=new Error(n);return a.data=r,a.statusCode=t,Promise.reject(a)},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d["a"],n=o.a.create();return n.defaults.baseURL=t,n.defaults.withCredentials=!0,e&&(n.defaults.transformRequest=[function(e){return i.a.stringify(e)}]),n.interceptors.request.use((function(e){var t=sessionStorage.getItem("token");return t&&!1!==e.isAuth&&(e.headers.Authorization=t),e})),n.interceptors.response.use((function(e){var t=e.data;return t instanceof Blob&&(t.name=Object(u["n"])(e.headers["content-disposition"])),"number"===typeof t.code?t.code?l({message:t.msg,data:t,statusCode:e.status}):t:!1!==t.ok?(Object(s["b"])(e.config.url)&&sessionStorage.setItem("token",e.headers.authorization||e.headers.Authorization),t):l({message:t.info,data:t,statusCode:e.status},"-20"!==t.code)}),(function(e){var t=e.response,n=t||{},r=n.data,i=n.status,a=t?r.info||e.message:"请求失败，请稍候重试";return 401===i?(sessionStorage.removeItem("token"),window.opener?window.close():(u["t"].close(),s["a"].dispatch("GO_LOGIN")),l({message:a,data:r,statusCode:i},!1)):l({message:a,data:r,statusCode:i})})),n},p=f(!0,d["b"]),m=f(),b=f(!0),v=function(){return b.post.apply(b,arguments)},h=f(!1,d["b"]),O=function(){return p.post.apply(p,arguments)}}}]);