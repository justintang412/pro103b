(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2255d0bb"],{"2f23":function(e,t,n){"use strict";n("b53e")},"498a":function(e,t,n){"use strict";var a=n("23e7"),r=n("58a8").trim,i=n("c8d2");a({target:"String",proto:!0,forced:i("trim")},{trim:function(){return r(this)}})},"4fbf":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"container"},[n("el-alert",{attrs:{type:"warning",closable:!1,title:"企业可根据业务结构，创建多个业务单元，为每个业务单元制定独立的客服方案"}}),n("div",{staticClass:"actionbar"},[n("b",{staticClass:"title"},[e._v(" 业务单元 "),n("el-popover",{attrs:{trigger:"hover",placement:"bottom-start"}},[n("i",{staticClass:"el-icon-question icon-help",attrs:{slot:"reference"},slot:"reference"}),n("div",{staticClass:"business-unit-tips"},[e._v(" *通常“业务单元”对应企业的一款独立“产品”或“业务”,企业可根据自身需要灵活配置"),n("br"),e._v(" *添加业务单元并完成设置后，客服工作台“客户资料”栏将显示咨询总结模块，客服可对每次会话进行咨询总结"),n("br"),e._v(" *总结的数据在“统计-在线客服-会话记录”中查询和导出 ")])])],1)]),n("div",{staticClass:"edit-container"},[n("aside",{directives:[{name:"loading",rawName:"v-loading",value:e.templateLoading,expression:"templateLoading"}],staticClass:"aside"},[n("main",{staticClass:"aside-main"},[n("el-scrollbar",{staticClass:"ui-scrollbar"},[n("ul",{staticClass:"aside-main-list"},e._l(e.templates,(function(t){return n("li",{key:t.id,class:{active:e.currentTemplate&&t.id===e.currentTemplate.id},attrs:{title:t.name},on:{click:function(n){return e.onTemplateClick(t)}}},[e._v(e._s(t.name))])})),0)])],1),n("footer",{staticClass:"aside-footer"},[n("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.onAddTemplate}},[e._v("添加业务单元")]),n("p",{staticStyle:{flex:"1"}}),n("el-button",{attrs:{type:"text",disabled:e.disableMoveUp},on:{click:e.onMoveUpTemplate}},[e._v("上移")]),n("el-button",{attrs:{type:"text",disabled:e.disableMoveDown},on:{click:e.onMoveDownTemplate}},[e._v("下移")])],1)]),n("main",{staticClass:"main"},[e.currentTemplate?[n("header",{staticClass:"main-header"},[n("p",{staticClass:"main-header-title",attrs:{title:e.form.name}},[e._v(e._s(e.form.name))]),n("el-link",{staticClass:"main-header-delete",attrs:{underline:!1,icon:"el-icon-delete"},on:{click:e.onDelTemplate}},[e._v("删除业务单元")])],1),n("el-form",{ref:"Form",attrs:{"label-width":"8em",model:e.form,rules:e.rules}},[n("el-form-item",{attrs:{label:"业务单元ID"}},[n("span",[e._v(e._s(e.currentTemplate.id))])]),n("ui-text-field",{attrs:{label:"业务单元名称",prop:"name",maxlength:"30"},on:{blur:function(t){return e.onUpdateTemplate("name")}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),n("el-form-item",{attrs:{label:"业务单元状态"}},[n("el-radio-group",{on:{change:function(t){return e.onUpdateTemplate("status")}},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[n("el-radio",{attrs:{label:1}},[e._v("开启")]),n("el-radio",{attrs:{label:0}},[e._v("关闭")])],1)],1),n("el-form-item",[n("span",{attrs:{slot:"label"},slot:"label"},[e._v(" 业务类型 "),n("el-popover",{attrs:{slot:"label",trigger:"hover",placement:"bottom-start"},slot:"label"},[n("i",{staticClass:"el-icon-question icon-help",attrs:{slot:"reference"},slot:"reference"}),n("div",{staticStyle:{"line-height":"1.8","font-size":"12px"}},[e._v(" *通常“业务类型”对应客户咨询内容的分类，企业可根据自身需要灵活配置"),n("br"),e._v(" *企业可以为每个业务单元设置想用的会话问题类型"),n("br"),e._v(" *更改此处的业务类型设置不影响已标记到会话或工单的业务类型 ")])])],1),n("el-tree",{attrs:{data:e.businessTypes,"default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{staticClass:"custom-node"},[n("span",{staticClass:"custom-node-label"},[e._v(e._s(a.label))]),n("span",{staticClass:"custom-node-actions"},[-1!==r.id?n("i",{staticClass:"el-icon-edit",on:{click:function(t){return e.onEditBusinessType(r)}}}):e._e(),r.level<4?n("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.onAddBusinessType(r)}}}):e._e(),-1!==r.id?n("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.onDelBusinessType(a,r)}}}):e._e()])])}}],null,!1,2418709991)})],1),n("ui-text-field",{attrs:{label:"备注引导文案",type:"textarea"},on:{blur:function(t){return e.onUpdateTemplate("content")}},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),n("el-form-item",{attrs:{label:"自定义字段"}},[n("p",{staticClass:"tip"},[e._v("可最多添加2个业务相关字段")]),n("ui-table-view",{staticStyle:{"line-height":"initial"},attrs:{hidePager:"",columns:e.columns,data:e.form.serviceFieldList}}),e.form.serviceFieldList&&e.form.serviceFieldList.length<2?n("el-button",{attrs:{type:"text",icon:"el-icon-circle-plus"},on:{click:function(t){return e.onEditField()}}},[e._v("添加新字段")]):e._e()],1)],1)]:n("div",{staticClass:"main-placeholder"},[e._v("请添加业务单元")])],2)])],1)},r=[],i=n("5530"),s=n("1da1"),c=(n("96cf"),n("e9c4"),n("4e82"),n("d81d"),n("b0c0"),n("a434"),n("498a"),n("d3b7"),n("3ca3"),n("ddb0"),n("c740"),n("a02a")),l=function(e){return JSON.parse(JSON.stringify(e))},o={data:function(){return{form:{},loading:!1,businessTypes:[],currentTemplate:null,templateLoading:!1,templates:[],rules:{name:Object(c["y"])("业务单元名称不能为空")},columns:[{label:"字段标题",prop:"name"},{label:"字段类型",render:function(e){return e("span","单行文本")}},{label:"是否必填",render:function(e,t){var n=t.row;return e("span",n.flag?"是":"否")}},{label:"操作",width:80,fixed:"right",render:this.$hBtns([{props:{icon:"el-icon-edit"},action:this.onEditField},{props:{icon:"el-icon-delete"},action:this.onDelField}])}]}},computed:{disableMoveUp:function(){return!this.currentTemplate||this.templates.indexOf(this.currentTemplate)<1},disableMoveDown:function(){return!this.currentTemplate||this.templates.indexOf(this.currentTemplate)===this.templates.length-1}},watch:{currentTemplate:function(e){this.form=e?l(e.data):{},e&&this.getBusinessTypes()}},mounted:function(){var e=this;this.getTemplates(),Object(c["g"])(this,(function(){e.getTemplates(),e.currentTemplate=null}))},methods:{getTemplates:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/serviceTemplate/listByPage");case 2:n=t.sent,a=n.data,a.sort((function(e,t){var n=e.position,a=t.position;return n>a?1:n<a?-1:0})),e.templates=a.map((function(e){return{id:e.id,name:e.name,data:e}})),e.currentTemplate=e.templates[0];case 7:case"end":return t.stop()}}),t)})))()},onAddTemplate:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n="新业务单元",a=e.templates.length,r=a?e.templates[a-1].data.position+1:1,s={name:n,position:r,status:1},e.templateLoading=!0,t.prev=5,t.next=8,e.$http.post("/serviceTemplate/save",s);case 8:c=t.sent.data,l={id:c,name:n,data:Object(i["a"])(Object(i["a"])({},s),{},{id:c,serviceFieldList:[]})},e.templates.push(l),e.currentTemplate=l,e.$nextTick((function(){var t=e.$el.querySelector(".el-scrollbar__wrap");t.scrollTop=t.scrollHeight})),t.next=17;break;case 15:t.prev=15,t.t0=t["catch"](5);case 17:e.templateLoading=!1;case 18:case"end":return t.stop()}}),t,null,[[5,15]])})))()},onDelTemplate:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm("确认删除？","删除");case 2:return t.next=4,e.$http.post("/serviceTemplate/remove/".concat(e.currentTemplate.id));case 4:e.templates.splice(e.templates.indexOf(e.currentTemplate),1),e.currentTemplate=e.templates[0];case 6:case"end":return t.stop()}}),t)})))()},updateTemplate:function(e){return this.$http.post("/serviceTemplate/update",e)},onUpdateTemplate:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=function(e){return(t.currentTemplate.data[e]||"").trim()===(t.form[e]||"").trim()},!(["name","content"].indexOf(e)>-1&&("name"===e&&!t.form.name.trim()||a(e)))){n.next=3;break}return n.abrupt("return");case 3:return t.loading=!0,n.prev=4,n.next=7,t.updateTemplate(t.form);case 7:t.currentTemplate.name=t.form.name,t.currentTemplate.data=l(t.form),n.next=13;break;case 11:n.prev=11,n.t0=n["catch"](4);case 13:t.loading=!1;case 14:case"end":return n.stop()}}),n,null,[[4,11]])})))()},onMoveUpTemplate:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.templates.indexOf(e.currentTemplate),a=n-1,r=e.templates[a],s=e.form.position,c=r.data.position,e.templateLoading=!0,t.prev=6,t.next=9,Promise.all([e.updateTemplate(Object(i["a"])(Object(i["a"])({},e.form),{},{position:c})),e.updateTemplate(Object(i["a"])(Object(i["a"])({},r.data),{},{position:s}))]);case 9:e.$set(e.form,"position",c),e.$set(r.data,"position",s),e.currentTemplate.data=l(e.form),e.templates.splice(a,2,e.currentTemplate,r),e.$nextTick((function(){var e=document.querySelector(".aside-main-list li.active");e.scrollIntoViewIfNeeded()})),t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](6);case 18:e.templateLoading=!1;case 19:case"end":return t.stop()}}),t,null,[[6,16]])})))()},onMoveDownTemplate:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.templates.indexOf(e.currentTemplate),a=n+1,r=e.templates[a],s=e.form.position,c=r.data.position,e.templateLoading=!0,t.prev=6,t.next=9,Promise.all([e.updateTemplate(Object(i["a"])(Object(i["a"])({},e.form),{},{position:c})),e.updateTemplate(Object(i["a"])(Object(i["a"])({},r.data),{},{position:s}))]);case 9:e.$set(e.form,"position",c),e.$set(r.data,"position",s),e.currentTemplate.data=l(e.form),e.templates.splice(n,2,r,e.currentTemplate),e.$nextTick((function(){var e=document.querySelector(".aside-main-list li.active");e.scrollIntoViewIfNeeded()})),t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](6);case 18:e.templateLoading=!1;case 19:case"end":return t.stop()}}),t,null,[[6,16]])})))()},onTemplateClick:function(e){this.currentTemplate=e},onEditField:function(e){var t=this;this.$openModal((function(){return n.e("chunk-2d0b1a16").then(n.bind(null,"2156"))}),{row:e,serviceId:this.currentTemplate.id},{success:function(e,n,a){var r=a.data,s=t.form.serviceFieldList;if(e){var c=s.findIndex((function(e){return e.id===n.id}));s.splice(c,1,n)}else s.push(Object(i["a"])(Object(i["a"])({},n),{},{id:r}));t.currentTemplate.data=l(t.form)}})},onDelField:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$confirm("删除该字段后，已填写该字段信息的会话导出后将不显示该字段","删除");case 2:return n.next=4,t.$http.post("/serviceFeild/remove/".concat(e.id));case 4:a=t.form.serviceFieldList.findIndex((function(t){return t.id===e.id})),t.form.serviceFieldList.splice(a,1),t.currentTemplate.data=l(t.form);case 7:case"end":return n.stop()}}),n)})))()},getBusinessTypes:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={label:"全部类别",level:0,id:-1},e.businessTypes=[n],t.next=4,e.$http("/serviceType/listByPage",{params:{templateId:e.currentTemplate.id}});case 4:a=t.sent,r=a.data,e.businessTypes=[Object(i["a"])(Object(i["a"])({},n),{},{children:Object(c["F"])(r.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{label:e.name})})))})];case 7:case"end":return t.stop()}}),t)})))()},onEditBusinessType:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$prompt("问题类型","编辑",{inputValue:e.label,inputPlaceholder:"请输入问题类型",inputValidator:function(e){var t=(e||"").trim();return t?!(t.length>20)||"分类名称不能超过20个字符":"请输入分类名称"}});case 2:a=n.sent,r=a.value,s=r.trim(),t.$http.post("/serviceType/update",Object(i["a"])(Object(i["a"])({},e),{},{name:s})).then((function(){t.$set(e,"label",s)}));case 6:case"end":return n.stop()}}),n)})))()},onAddBusinessType:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,r,s,c,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$prompt("问题类型","新增",{inputPlaceholder:"请输入问题类型",inputValidator:function(e){var t=(e||"").trim();return t?!(t.length>20)||"分类名称不能超过20个字符":"请输入分类名称"}});case 2:return a=n.sent,r=a.value,s=r.trim(),c={name:s,label:s,level:e.level?e.level+1:1,parentId:e.id,templateId:t.currentTemplate.id},n.next=8,t.$http.post("/serviceType/save",c);case 8:l=n.sent.data,c=Object(i["a"])(Object(i["a"])({},c),{},{id:l}),e.children?e.children.push(c):t.$set(e,"children",[c]);case 11:case"end":return n.stop()}}),n)})))()},onDelBusinessType:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.$confirm("确认删除","删除");case 2:return a.next=4,n.$http.post("/serviceType/remove/".concat(t.id));case 4:r=e.parent,i=r.data.children||r.data,s=i.findIndex((function(e){return e.id===t.id})),i.splice(s,1);case 8:case"end":return a.stop()}}),a)})))()}}},u=o,p=(n("2f23"),n("2877")),m=Object(p["a"])(u,a,r,!1,null,"26898c8d",null);t["default"]=m.exports},b53e:function(e,t,n){},c740:function(e,t,n){"use strict";var a=n("23e7"),r=n("b727").findIndex,i=n("44d2"),s="findIndex",c=!0;s in[]&&Array(1)[s]((function(){c=!1})),a({target:"Array",proto:!0,forced:c},{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),i(s)},c8d2:function(e,t,n){var a=n("5e77").PROPER,r=n("d039"),i=n("5899"),s="​᠎";e.exports=function(e){return r((function(){return!!i[e]()||s[e]()!==s||a&&i[e].name!==e}))}}}]);