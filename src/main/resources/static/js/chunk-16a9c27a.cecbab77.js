(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16a9c27a"],{"001e":function(e,t,n){"use strict";n("beaa")},"09ba":function(e,t,n){"use strict";n("c578")},beaa:function(e,t,n){},c578:function(e,t,n){},d2c0:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-form"},[n("div",{staticClass:"title"},[e._v("您好，请填写如下表单")]),n("com-custom-form",{ref:"Form",attrs:{action:e.getFieldList,optionsAction:e.getOptionList,uploadAction:e.upload}}),n("div",{staticClass:"btns"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion"},on:{click:e.submit}},[e._v("提 交")])],1)],1)},r=[],a=n("1da1"),o=(n("e9c4"),n("96cf"),n("4328")),s=n("60e2"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"Form",attrs:{"label-position":"top",model:e.form}},e._l(e.fieldList,(function(t){return n("el-form-item",{key:t.fieldUid,attrs:{label:t.fieldTitle,prop:t.fieldUid,rules:e.createRules(t)}},[+t.fieldType===e.T.INPUT?n("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.TEXTAREA?n("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入内容"},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.SELECT?n("el-select",{attrs:{clearable:!+t.isNecessary},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(e){return n("el-option",{key:e.optionsUid,attrs:{value:e.optionsUid,label:e.optionsName}})})),1):+t.fieldType===e.T.CASCADER?n("el-cascader",{attrs:{clearable:!+t.isNecessary,options:e.dataMap["tree_"+t.fieldUid],props:{value:"optionsUid",label:"optionsName"}},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.RADIO?n("el-radio-group",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(t){return n("el-radio",{key:t.optionsUid,attrs:{label:t.optionsUid}},[e._v(e._s(t.optionsName))])})),1):+t.fieldType===e.T.CHECKBOX?n("el-checkbox-group",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}},e._l(e.dataMap[t.fieldUid],(function(t){return n("el-checkbox",{key:t.optionsUid,attrs:{label:t.optionsUid}},[e._v(e._s(t.optionsName))])})),1):+t.fieldType===e.T.DATE?n("el-date-picker",{model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):+t.fieldType===e.T.UPLOAD?n("com-upload",{attrs:{action:e.uploadAction,jsonParam:t.fieldInfo},model:{value:e.form[t.fieldUid],callback:function(n){e.$set(e.form,t.fieldUid,n)},expression:"form[_.fieldUid]"}}):e._e()],1)})),1)},u=[],l=n("ade3"),d=n("5530"),f=(n("4de4"),n("d3b7"),n("159b"),n("7db0"),n("d81d"),n("a02a")),p=n("e6f4"),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:e.accept},on:{change:e.onChange}}),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.onSelect}},[e._v("选择文件")]),n("p",{staticClass:"tip"},[e._v("* 文件大小不能超过"+e._s(+e.options.limit)+"M")]),e.file?n("div",{staticClass:"file-wrap"},[e.isImg()?n("img",{attrs:{src:e.blobUrl}}):e.isVideo()?n("video",{attrs:{src:e.blobUrl,controls:""}}):n("p",{staticClass:"filename"},[e._v(e._s(e.file.name))])]):e._e()],1)},b=[],v=(n("caad"),n("2532"),n("ac1f"),n("1276"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("2ca0"),{props:{value:{},jsonParam:{},action:Function},data:function(){return{file:null,blobUrl:null,model:this.value}},computed:{options:function(){try{return JSON.parse(this.jsonParam)||{}}catch(e){return{}}},accept:function(){var e,t=this.options.accept||[],n=(e={},Object(l["a"])(e,p["b"].IMAGE,"image/*"),Object(l["a"])(e,p["b"].VIDEO,"video/*"),e);return t.includes(p["b"].ALL)?"":t.map((function(e){return n[e]}))+""}},watch:{value:function(e){this.model=e},model:function(e){this.$emit("input",e)}},methods:{onSelect:function(){this.action?this.$refs.File.click():Object(f["x"])("预览模式不允许上传")},onChange:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,r,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.target,r=i.files[0],i.value="",!r){n.next=21;break}if(a=r.type.split("/")[0],o=+t.options.limit,s=1024*o*1024,!(r.size>s)){n.next=9;break}return n.abrupt("return",Object(f["x"])("文件大小不能超过".concat(o,"M")));case 9:if(c=t.accept,!c){n.next=13;break}if(!(c.indexOf(a)<0)){n.next=13;break}return n.abrupt("return",Object(f["x"])("该文件类型不支持"));case 13:return t.file=r,t.blobUrl=window.URL.createObjectURL(r),setTimeout((function(){window.URL.revokeObjectURL(t.blobUrl)}),500),n.next=18,t.action(r);case 18:u=n.sent,l=u.data,t.model={fileType:a,name:l.fileUrl};case 21:case"end":return n.stop()}}),n)})))()},isImg:function(){return this.file.type.startsWith("image/")},isVideo:function(){return this.file.type.startsWith("video/")}}}),O=v,U=(n("09ba"),n("2877")),h=Object(U["a"])(O,m,b,!1,null,"e29f960c",null),g=h.exports,j={components:{ComUpload:g},props:["action","optionsAction","uploadAction"],data:function(){return{T:p["a"],fieldList:[],form:{},dataMap:{}}},mounted:function(){this.getData()},methods:{getData:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.action();case 2:n=t.sent.filter((function(e){return+e.fieldStatus})),n.forEach(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var i,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Object(p["d"])(n.fieldType)){t.next=6;break}return Object(p["e"])(n)&&(e.form=Object(d["a"])(Object(d["a"])({},e.form),{},Object(l["a"])({},n.fieldUid,[]))),t.next=4,e.optionsAction(n.fieldUid);case 4:i=t.sent,+n.fieldType===p["a"].CASCADER?(a="tree_".concat(n.fieldUid),e.dataMap=Object(d["a"])(Object(d["a"])({},e.dataMap),{},(r={},Object(l["a"])(r,n.fieldUid,i),Object(l["a"])(r,a,Object(f["y"])(i,{key:"optionsUid"})),r))):e.dataMap=Object(d["a"])(Object(d["a"])({},e.dataMap),{},Object(l["a"])({},n.fieldUid,i));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.fieldList=n;case 5:case"end":return t.stop()}}),t)})))()},getForm:function(){var e=this,t={},n=this.dataMap,i=function(i){var r=e.form[i],a=n[i],o=e.fieldList.find((function(e){return e.fieldUid===i}))||{};o={title:o.fieldTitle,type:o.fieldType};var s=function(e){return(a.find((function(t){return t.optionsUid===e}))||{}).optionsName};a?Array.isArray(r)?t[i]={field:o,id:r,name:r.map(s)}:t[i]={field:o,id:r,name:s(r)}:+o.type===p["a"].UPLOAD?t[i]=Object(d["a"])({field:o},r):t[i]={field:o,name:r}};for(var r in this.form)i(r);return t},validate:function(){return this.$refs.Form.validate()},createRules:function(e){return+e.isNecessary?{required:!0,message:"该字段不能为空",trigger:Object(p["f"])(e.fieldType)?null:"blur"}:null}}},y=j,A=Object(U["a"])(y,c,u,!1,null,null,null),C=A.exports,T=n("bd90"),w={components:{ComCustomForm:C},data:function(){return{fieldList:[]}},computed:{templateUid:function(){return this.$route.params.id},uuid:function(){return this.$route.query.uuid}},methods:{getFieldList:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(T["b"])("/media/field/get",{params:{templateUid:e.templateUid},baseURL:Object(s["d"])(!0)});case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t)})))()},getOptionList:function(e){return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(T["b"])("/media/field/getOptionList",{params:{fieldUid:e},baseURL:Object(s["d"])(!0)});case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t)})))()},upload:function(e){var t=new FormData;return t.append("file",e),t.append("infoUuid",this.uuid),t.append("templateId",this.templateUid),T["b"].post("/file/handle/fileByForm",t,{baseURL:Object(s["d"])(!0)})},submit:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,i,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$refs.Form,t.next=3,n.validate();case 3:return i=e.$loading(),r=n.getForm(),a={fileType:"form",infoUuid:e.uuid,form:JSON.stringify(r)},t.prev=6,t.next=9,T["b"].post("/file/handle/templateCommit",Object(o["stringify"])(a),{baseURL:Object(s["d"])(!0)});case 9:e.$router.push("/success"),t.next=14;break;case 12:t.prev=12,t.t0=t["catch"](6);case 14:i.close();case 15:case"end":return t.stop()}}),t,null,[[6,12]])})))()}}},k=w,E=(n("001e"),Object(U["a"])(k,i,r,!1,null,null,null));t["default"]=E.exports},e6f4:function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return l}));n("5530");var i=n("ade3"),r=(n("1da1"),n("e9c4"),n("caad"),n("2532"),n("fb6a"),n("96cf"),n("fa65"),"media-link"),a=function(e){return"https://miniprogram.sindvision.com/web/#/?".concat(btoa(JSON.stringify(e)))},o={INPUT:1,TEXTAREA:2,SELECT:3,CASCADER:4,RADIO:5,CHECKBOX:6,DATE:7,UPLOAD:8},s=(function(e){var t;t={},Object(i["a"])(t,e.INPUT,"输入框"),Object(i["a"])(t,e.TEXTAREA,"多行输入框"),Object(i["a"])(t,e.SELECT,"下拉框"),Object(i["a"])(t,e.CASCADER,"级联下拉框"),Object(i["a"])(t,e.RADIO,"单选框"),Object(i["a"])(t,e.CHECKBOX,"复选框"),Object(i["a"])(t,e.DATE,"日期"),Object(i["a"])(t,e.UPLOAD,"文件上传")}(o),{ALL:1,IMAGE:2,VIDEO:3}),c=(function(e){var t;t={},Object(i["a"])(t,e.ALL,"所有"),Object(i["a"])(t,e.IMAGE,"图片"),Object(i["a"])(t,e.VIDEO,"视频")}(s),function(e){var t=o;return[t.SELECT,t.CASCADER,t.RADIO,t.CHECKBOX].includes(+e)}),u=function(e){var t=o;return+e.fieldType===t.CHECKBOX},l=function(e){var t=o;return c(e)||[t.DATE].includes(+e)}},fa65:function(e,t,n){"use strict";n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return v})),n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return U}));n("d3b7"),n("b0c0");var i=n("4328"),r=n.n(i),a=n("bc3a"),o=n.n(a),s=n("5c96"),c=n("e5ac"),u=n("a02a"),l=n("60e2"),d=function(e){var t=e.statusCode,n=e.message,i=e.data,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r&&s["Message"].error(n||"发生未知异常");var a=new Error(n);return a.data=i,a.statusCode=t,Promise.reject(a)},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l["a"],n=o.a.create();return n.defaults.baseURL=t,n.defaults.withCredentials=!0,e&&(n.defaults.transformRequest=[function(e){return r.a.stringify(e)}]),n.interceptors.request.use((function(e){var t=sessionStorage.getItem("token");return t&&!1!==e.isAuth&&(e.headers.Authorization=t),e})),n.interceptors.response.use((function(e){var t=e.data;return t instanceof Blob&&(t.name=Object(u["l"])(e.headers["content-disposition"])),"number"===typeof t.code?t.code?d({message:t.msg,data:t,statusCode:e.status}):t:!1!==t.ok?(Object(c["b"])(e.config.url)&&sessionStorage.setItem("token",e.headers.authorization||e.headers.Authorization),t):d({message:t.info,data:t,statusCode:e.status},"-20"!==t.code)}),(function(e){var t=e.response,n=t||{},i=n.data,r=n.status,a=t?i.info||e.message:"请求失败，请稍候重试";return 401===r?(sessionStorage.removeItem("token"),window.opener?window.close():(u["q"].close(),c["a"].dispatch("GO_LOGIN")),d({message:a,data:i,statusCode:r},!1)):d({message:a,data:i,statusCode:r})})),n},p=f(!0,l["b"]),m=f(),b=f(!0),v=function(){return b.post.apply(b,arguments)},O=f(!1,l["b"]),U=function(){return p.post.apply(p,arguments)}}}]);