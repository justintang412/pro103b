(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d50f7ad2"],{"2b2f":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ui-table-view",t._g(t._b({scopedSlots:t._u([{key:"search",fn:function(){return[t.isSuper?a("el-form-item",{attrs:{label:"所属企业"}},[a("ui-ent-select",{on:{change:t.onSearch},model:{value:t.searchForm.entId,callback:function(e){t.$set(t.searchForm,"entId",e)},expression:"searchForm.entId"}})],1):t._e(),a("el-form-item",{attrs:{label:"流程执行时间"}},[a("el-date-picker",{staticStyle:{width:"240px"},attrs:{type:"daterange","value-format":"yyyy-MM-dd"},on:{change:t.onDateChange},model:{value:t.flowDate,callback:function(e){t.flowDate=e},expression:"flowDate"}})],1),a("ui-text-field",{attrs:{placeholder:"请输入流程名称/热线号查询"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.searchForm.keywords,callback:function(e){t.$set(t.searchForm,"keywords",e)},expression:"searchForm.keywords"}})]},proxy:!0},{key:"other",fn:function(){return[a("Modal",{attrs:{fullscreen:"",closable:!1,"footer-hide":""},model:{value:t.modalIvrFlow,callback:function(e){t.modalIvrFlow=e},expression:"modalIvrFlow"}},[t.modalIvrFlow?a("ivr-modal",{attrs:{row:t.ivrParams},on:{"close-ivr":function(e){t.modalIvrFlow=!1}}}):t._e()],1),a("input",{directives:[{name:"show",rawName:"v-show",value:0,expression:"0"}],ref:"File",attrs:{type:"file",accept:"application/json"},on:{change:t.onFileChange}})]},proxy:!0}])},"ui-table-view",Object.assign({},t.viewProps,{columns:t.columns}),!1),t.viewListeners),[a("el-button",{attrs:{slot:"actions",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.onEdit()}},slot:"actions"},[t._v("新增")])],1)},i=[],r=a("1da1"),s=a("3835"),n=a("5530"),l=(a("96cf"),a("fb6a"),a("d3b7"),a("3ca3"),a("ddb0"),a("8a79"),a("b0c0"),a("a02a")),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"IVRModal",staticStyle:{height:"100%"}},[a("div",{staticStyle:{"margin-bottom":"37px"},attrs:{id:"demo"}}),a("div",{staticClass:"ivrfoot",staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{margin:"0 100px"},attrs:{type:"warning"},on:{click:function(e){return t.beforeClose()}}},[t._v("关闭IVR流程")]),a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.onClearIVR()}}},[t._v("清空编辑器")])],1),a("Modal",{attrs:{draggable:"",scrollable:"",title:t.fromTitle,width:420},on:{"on-cancel":t.restFormdata},model:{value:t.formModal,callback:function(e){t.formModal=e},expression:"formModal"}},[a("el-link",{staticStyle:{"font-size":"20px"},attrs:{slot:"close",icon:"el-icon-close",underline:!1},slot:"close"}),a("el-form",{attrs:{model:t.formData,"label-width":"9em"},nativeOn:{submit:function(t){t.preventDefault()}}},[t.hasProp("actcellid")?a("ui-text-field",{attrs:{label:"序号",readonly:""},model:{value:t.formData.actcellid,callback:function(e){t.$set(t.formData,"actcellid",e)},expression:"formData.actcellid"}}):t._e(),t.hasProp("conditions")?a("ui-text-field",{attrs:{label:"流程节点ID",readonly:""},model:{value:t.formData.linekey,callback:function(e){t.$set(t.formData,"linekey",e)},expression:"formData.linekey"}}):a("ui-text-field",{attrs:{label:"流程节点ID",readonly:""},model:{value:t.formData.nodekey,callback:function(e){t.$set(t.formData,"nodekey",e)},expression:"formData.nodekey"}}),t.hasProp("actname")?a("ui-text-field",{attrs:{label:"节点名称"},model:{value:t.formData.actname,callback:function(e){t.$set(t.formData,"actname",e)},expression:"formData.actname"}}):t._e(),t.hasProp("conditions")?a("ui-text-field",{attrs:{label:"条件"},model:{value:t.formData.conditions,callback:function(e){t.$set(t.formData,"conditions",e)},expression:"formData.conditions"}}):t._e(),t.hasProp("state")?a("ui-select",{attrs:{label:"状态"},model:{value:t.formData.state,callback:function(e){t.$set(t.formData,"state",e)},expression:"formData.state"}},[a("el-option",{attrs:{value:1,label:"禁用"}}),a("el-option",{attrs:{value:0,label:"启用"}})],1):t._e(),t.hasProp("voicetype")&&"nav"==t.showModal?a("ui-select",{attrs:{label:"流程类型"},on:{change:function(e){t.formData.saveparam=2==t.formData.voicetype?"01":""}},model:{value:t.formData.voicetype,callback:function(e){t.$set(t.formData,"voicetype",e)},expression:"formData.voicetype"}},[a("el-option",{attrs:{value:2,label:"三方CRS"}}),a("el-option",{attrs:{value:12,label:"科大aiobs"}})],1):t._e(),t.hasProp("voicetype")&&"nav"!=t.showModal?a("ui-select",{attrs:{label:"播报内容类型"},model:{value:t.formData.voicetype,callback:function(e){t.$set(t.formData,"voicetype",e)},expression:"formData.voicetype"}},[a("el-option",{attrs:{value:0,label:"文本"}}),a("el-option",{attrs:{value:1,label:"文件"}}),a("el-option",{attrs:{value:2,label:"xml表述"}})],1):t._e(),1===t.formData.voicetype||3===t.formData.voicetype?a("ui-select",{attrs:{label:"nav"===t.showModal?"模板ID":"语音文件ID",options:t.voiceList,props:{value:"id",label:"textfile"}},model:{value:t.formData.voiceid,callback:function(e){t.$set(t.formData,"voiceid",e)},expression:"formData.voiceid"}}):t._e(),!t.hasProp("ttstext")||0!==t.formData.voicetype&&2!==t.formData.voicetype?t._e():a("ui-text-field",{attrs:{label:"语音文本内容"},model:{value:t.formData.ttstext,callback:function(e){t.$set(t.formData,"ttstext",e)},expression:"formData.ttstext"}}),t.hasProp("ttstext")&&"contain"==t.showModal?a("el-form-item",{attrs:{label:"子串内容"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{placeholder:"请输入子串内容"},model:{value:t.formData.ttstext,callback:function(e){t.$set(t.formData,"ttstext",e)},expression:"formData.ttstext"}}),a("el-tooltip",{attrs:{content:"子串内容，支持多个子串，中间用“|”分割，查找到其中一个字串即为1，都不包含为0",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),!t.hasProp("parametertype")||"menuplay"!=t.showModal&&"voiceplay"!=t.showModal?t._e():a("ui-select",{attrs:{label:"是否启用表达式"},model:{value:t.formData.parametertype,callback:function(e){t.$set(t.formData,"parametertype",e)},expression:"formData.parametertype"}},[a("el-option",{attrs:{value:0,label:"停用"}}),a("el-option",{attrs:{value:1,label:"启用"}})],1),!t.hasProp("parameter")||1!=t.formData.parametertype||"menuplay"!=t.showModal&&"voiceplay"!=t.showModal?t._e():a("el-form-item",{attrs:{label:"表达式"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"注意:表达式内的用户变量必须在参数表里面有定义"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"动作执行前进行变量赋值操,取值空或者多个变量,比如:$carid=$goto1,$pwd=$goto2",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]),t.hasProp("parametertype")&&"contain"==t.showModal?a("ui-select",{attrs:{label:"是否启用附加词"},model:{value:t.formData.parametertype,callback:function(e){t.$set(t.formData,"parametertype",e)},expression:"formData.parametertype"}},[a("el-option",{attrs:{value:0,label:"停用"}}),a("el-option",{attrs:{value:1,label:"启用"}})],1):t._e(),t.hasProp("parameter")&&1==t.formData.parametertype&&"contain"==t.showModal?a("el-form-item",{attrs:{label:"被查字符串变量"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入被查被查字符串变量"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"被查询的字符串变量，如果有多个变量,只会在第一个变量里面查询,具体参见IVR流程编辑文档",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"httpdata"==t.showModal?a("el-form-item",{attrs:{label:"http请求url"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入http请求url"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"http请求的url,支持变量",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"call"==t.showModal?a("el-form-item",{attrs:{label:"呼叫号码"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入列表值"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"呼叫号码。$outcaller=xx,$outcalled=xx,$outcallop=xx(xx支持变量)",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"sendDTMF"==t.showModal?a("el-form-item",{attrs:{label:"Dtmf值"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入列表值"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"可以是常量也可以是变量,非0~9,*,#字符将去除",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"listvalue"==t.showModal?a("el-form-item",{attrs:{label:"列表值"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入列表值"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"具体说明参见IVR流程编辑说明文档",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),"return"==t.showModal?a("ui-select",{attrs:{label:"跳转流程",options:t.ivrList,props:{value:"id",label:"flowname"},filterable:""},on:{change:t.changeIVR},model:{value:t.formData.ivrId,callback:function(e){t.$set(t.formData,"ivrId",e)},expression:"formData.ivrId"}}):t._e(),"return"==t.showModal?a("el-form-item",{attrs:{label:"跳转节点"}},[a("div",{staticClass:"flexbox"},[a("el-select",{attrs:{filterable:"",placeholder:"注意:不能跳转到自身"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}},t._l(t.parameterList,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}})})),1),a("el-tooltip",{attrs:{content:"cti_action表的id:只支持常量,不支持变量",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parametertype")&&"extension"==t.showModal?a("ui-select",{attrs:{label:"分机类型"},model:{value:t.formData.parametertype,callback:function(e){t.$set(t.formData,"parametertype",e)},expression:"formData.parametertype"}},[a("el-option",{attrs:{value:0,label:"普通转坐席工号"}}),a("el-option",{attrs:{value:1,label:"鉴权流程转指定分机号"}}),a("el-option",{attrs:{value:3,label:"转分机号"}})],1):t._e(),t.hasProp("parameter")&&"agent"==t.showModal?a("el-form-item",{attrs:{label:"坐席组 "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"常量比如1，变量比如$qid,只能支持1个座席组"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"座席组(Cti_queue表的id字段);流程根ID；流程id:常量比如1，变量比如$qid,只能支持1个座席组。",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"extension"==t.showModal?a("el-form-item",{attrs:{label:"分机值 "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"注意:要做校验如果没传入流程id根id和流程id,可能会造成程序瘫痪"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"座席工号或分机号(cti_work表的extentionno);流程根ID;流程id",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),!t.hasProp("parametertype")||"think"!=t.showModal&&"boole"!=t.showModal?t._e():a("el-form-item",{attrs:{label:"比较方式 "}},[a("div",{staticClass:"flexbox"},[a("el-select",{model:{value:t.formData.parametertype,callback:function(e){t.$set(t.formData,"parametertype",e)},expression:"formData.parametertype"}},[a("el-option",{attrs:{value:10,label:"字符串比较"}}),a("el-option",{attrs:{value:11,label:"整数比较"}}),a("el-option",{attrs:{value:12,label:"浮点比较"}})],1),a("el-tooltip",{attrs:{content:"如果整数和浮点数转换发现非法值,那么就无效,系统默认修改为字符串比较",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]),!t.hasProp("parameter")||"think"!=t.showModal&&"boole"!=t.showModal?t._e():a("el-form-item",{attrs:{label:"判断表达式 "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入判断表达式"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"以~为判断符,比如$a~123或者$a~$b,只支持1个表达式",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]),t.hasProp("parameter")&&"variable"==t.showModal?a("el-form-item",{attrs:{label:"运算表达式 "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入运算表达式"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"变量运算赋值表达式，支持多个表达式赋值运算，中间用逗号分割",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parametertype")&&"sqldata"==t.showModal?a("el-form-item",{attrs:{label:"执行方式"}},[a("div",{staticClass:"flexbox"},[a("el-select",{model:{value:t.formData.parametertype,callback:function(e){t.$set(t.formData,"parametertype",e)},expression:"formData.parametertype"}},[a("el-option",{attrs:{value:0,label:"返回记录集"}}),a("el-option",{attrs:{value:1,label:"返回执行结果"}})],1),a("el-tooltip",{attrs:{content:"返回记录集:如select语句,返回执行结果:如insert、update语句",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("parameter")&&"sqldata"==t.showModal?a("el-form-item",{attrs:{label:"sql "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入sql"},model:{value:t.formData.parameter,callback:function(e){t.$set(t.formData,"parameter",e)},expression:"formData.parameter"}}),a("el-tooltip",{attrs:{content:"只支持select * from tab where col1=$a的格式支持update和insert等操作语句,操作型sql执行结果放在db1中,1为成功",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("saveflag")&&"voiceplay"==t.showModal?a("ui-select",{attrs:{label:"执行结果保存"},model:{value:t.formData.saveflag,callback:function(e){t.$set(t.formData,"saveflag",e)},expression:"formData.saveflag"}},[a("el-option",{attrs:{value:0,label:"停用"}}),a("el-option",{attrs:{value:1,label:"启用"}})],1):t._e(),t.hasProp("saveparam")&&"sqldata"==t.showModal?a("el-form-item",{attrs:{label:"执行结果赋值"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入sql参数"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"取值:空或者指定变量串。系统会把sql返回值保持在$db1~9中,如果本参数有设定变量,则还会赋值一遍,多变量逗号分隔",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("saveparam")&&"httpdata"==t.showModal?a("el-form-item",{attrs:{label:"指定变量串"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入指定变量串"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"系统会把http返回值保持在$http1~9中,如果本参数有设定变量,则还会赋值一遍,多变量逗号分隔",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("saveparam")&&1===t.formData.saveflag&&"voiceplay"==t.showModal?a("el-form-item",{attrs:{label:"保存参数变量 "}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"注意:用户变量必须在参数表里面有定义"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"保存按键输入结果到用户参数中,变量名、参数名只支持流程变量,不支持系统变量,如:$aaa",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),!t.hasProp("saveflag")||"agent"!=t.showModal&&"extension"!=t.showModal&&"contain"!=t.showModal&&"queue"!=t.showModal?t._e():a("ui-select",{attrs:{label:"是否携带业务"},model:{value:t.formData.saveflag,callback:function(e){t.$set(t.formData,"saveflag",e)},expression:"formData.saveflag"}},[a("el-option",{attrs:{value:0,label:"否"}}),a("el-option",{attrs:{value:1,label:"是"}})],1),!t.hasProp("saveparam")||1!==t.formData.saveflag||"agent"!=t.showModal&&"extension"!=t.showModal&&"contain"!=t.showModal&&"queue"!=t.showModal?t._e():a("el-form-item",{attrs:{label:"业务携带信息"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入业务携带信息"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"跳转的业务携带信息;比如:$dtmf1,$dtmf2",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]),t.hasProp("saveparam")&&"nav"==t.showModal?a("el-form-item",{attrs:{label:"导航入口"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"text"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"对呼入导航机器人有效，对外呼机器人无效",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("saveflag")&&"receive"==t.showModal?a("ui-select",{attrs:{label:"是否变量名输出"},model:{value:t.formData.saveflag,callback:function(e){t.$set(t.formData,"saveflag",e)},expression:"formData.saveflag"}},[a("el-option",{attrs:{value:0,label:"否"}}),a("el-option",{attrs:{value:1,label:"是"}})],1):t._e(),t.hasProp("saveparam")&&1===t.formData.saveflag&&"receive"===t.showModal?a("el-form-item",{attrs:{label:"输出变量名"}},[a("div",{staticClass:"flexbox"},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入输出变量名"},model:{value:t.formData.saveparam,callback:function(e){t.$set(t.formData,"saveparam",e)},expression:"formData.saveparam"}}),a("el-tooltip",{attrs:{content:"取值:空或者变量名。输出变量名(只能一个变量)",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),"voiceplay"===t.showModal?a("ui-select",{attrs:{label:"放音方式"},on:{change:t.changePlayType},model:{value:t.formData.playType,callback:function(e){t.$set(t.formData,"playType",e)},expression:"formData.playType"}},[a("el-option",{attrs:{value:1,label:"绝对放音"}}),a("el-option",{attrs:{value:2,label:"放音收键"}})],1):t._e(),"voiceplay"!=t.showModal||1!==t.formData.playType&&0!==t.formData.maxdtmf?a("div",[t.hasProp("maxdtmf")&&"nav"!=t.showModal?a("el-form-item",{attrs:{label:"最大按键数量"}},[a("el-input-number",{attrs:{"controls-position":"right",min:"menuplay"===t.showModal?1:0},on:{change:function(e){t.formData.playType=0===t.formData.maxdtmf?1:2}},model:{value:t.formData.maxdtmf,callback:function(e){t.$set(t.formData,"maxdtmf",e)},expression:"formData.maxdtmf"}})],1):t._e(),t.hasProp("enddtmf")?a("el-form-item",{attrs:{label:"结束按键名称"}},[a("div",{staticClass:"flexbox"},[a("el-input",{model:{value:t.formData.enddtmf,callback:function(e){t.$set(t.formData,"enddtmf",e)},expression:"formData.enddtmf"}}),a("el-tooltip",{attrs:{content:"取到按键截掉结束按键.取值:1-9,*,0,#,y  y为放背景音",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("alldtmftimer")?a("el-form-item",{attrs:{label:"按键超时时间"}},[a("div",{staticClass:"flexbox"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.formData.alldtmftimer,callback:function(e){t.$set(t.formData,"alldtmftimer",e)},expression:"formData.alldtmftimer"}}),a("el-tooltip",{attrs:{content:"按键超时时间,单位秒,0表示没有限制,需要收到满足条件按键才结束播音",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("twodtmftimer")?a("el-form-item",{attrs:{label:"按键间隔超时时间"}},[a("div",{staticClass:"flexbox"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.formData.twodtmftimer,callback:function(e){t.$set(t.formData,"twodtmftimer",e)},expression:"formData.twodtmftimer"}}),a("el-tooltip",{attrs:{content:"接收超时时间(单位秒)",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e()],1):t._e(),t.hasProp("maxtimer")&&"sendDTMF"==t.showModal?a("el-form-item",{attrs:{label:"发送时间"}},[a("div",{staticClass:"flexbox"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.formData.maxtimer,callback:function(e){t.$set(t.formData,"maxtimer",e)},expression:"formData.maxtimer"}}),a("el-tooltip",{attrs:{content:"发送时间(单位秒)",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("maxtimer")&&"receive"==t.showModal?a("el-form-item",{attrs:{label:"接收超时时间"}},[a("div",{staticClass:"flexbox"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.formData.maxtimer,callback:function(e){t.$set(t.formData,"maxtimer",e)},expression:"formData.maxtimer"}}),a("el-tooltip",{attrs:{content:"接收超时时间(单位秒)",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),t.hasProp("maxtimer")&&"record"==t.showModal?a("el-form-item",{attrs:{label:"录音超时时长"}},[a("div",{staticClass:"flexbox"},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.formData.maxtimer,callback:function(e){t.$set(t.formData,"maxtimer",e)},expression:"formData.maxtimer"}}),a("el-tooltip",{attrs:{content:"录音超时时长,单位秒",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)]):t._e(),!t.hasProp("menuselect")||"menuplay"!=t.showModal&&"nav"!=t.showModal?t._e():a("el-form-item",{attrs:{label:"菜单允许选择"}},[a("div",{staticClass:"flexbox"},[a("el-input",{model:{value:t.formData.menuselect,callback:function(e){t.$set(t.formData,"menuselect",e)},expression:"formData.menuselect"}}),a("el-tooltip",{attrs:{content:"menuplay"==t.showModal?"菜单允许选择 1-9,*,0,# 允许多个,用逗号分隔":"http开头则为CRS地址url地址，如果不是则以配置文件intellpath为准",placement:"top"}},[a("i",{staticClass:"el-icon-info"})])],1)])],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:t.saveAble},on:{click:t.saveForm}},[t._v("保存")]),a("el-button",{on:{click:t.restFormdata}},[t._v("取消")])],1)],1)],1)},c=[],h=(a("b64b"),a("159b"),a("e9c4"),a("ac1f"),a("1276"),a("a630"),a("6062"),a("99af"),a("fcda"),a("7db0"),a("a434"),a("fa65"));function p(t){var e=t.offsetTop,a=t.offsetLeft;t=t.offsetParent;while(t)e+=t.offsetTop,a+=t.offsetLeft,t=t.offsetParent;return{top:e,left:a}}function m(t){return t||(t=window.event),t.pageX||t.pageY?{x:t.pageX,y:t.pageY}:{x:t.clientX+document.documentElement.scrollLeft-document.body.clientLeft,y:t.clientY+document.documentElement.scrollTop-document.body.clientTop}}var u={cursor:1,direct:1};function f(t,e,a,o,i,r){this.$id=t.attr("id"),this.$bgDiv=t,this.$bgDiv.addClass("GooFlow"),f.prototype.color.font&&this.$bgDiv.css("color",f.prototype.color.font);var s=(e.width||800)-2,l=(e.height||500)-2;this.$bgDiv.css({width:s+"px",height:l+"px"}),this.$tool=null,this.$head=null,this.$tabs=null,this.$title="newFlow_1",this.$nodeRemark={},this.$nowType="cursor",this.$lineData={},this.$lineCount=0,this.$nodeData={},this.$nodeCount=0,this.$areaData={},this.$areaCount=0,this.$lineDom={},this.$nodeDom={},this.$areaDom={},this.$max=e.initNum||1,this.$focus="",this.$cursor="default",this.$editable=!1,this.$deletedItem={};var d=0,c="",u=["重新加载"];if(e.haveTabs&&(y="<div class='line_title'>",this.$tabs=$(y),this.$bgDiv.append(this.$tabs)),e.haveHead){c="<div class='GooFlow_head' "+(f.prototype.color.main?"style='border-bottom-color:"+f.prototype.color.main+"'":"")+">",c+="<a href='javascript:void(0)' class='GooFlow_head_title'><h3>IVR流程编辑</h3></a>",e.headLabel&&(c+="<label title='"+(e.initLabelText||"newFlow_1")+"' "+(f.prototype.color.main?"style='background:"+f.prototype.color.main+"'":"")+">"+(e.initLabelText||"newFlow_1")+"</label>");for(var v=0;v<e.headBtns.length;++v)c+="<a class='GooFlow_head_btn top_btn' title='"+u[v]+"'><i class='ico_"+e.headBtns[v]+"'></i></a>";c+="</div>",this.$head=$(c),this.$bgDiv.append(this.$head),d=24,this.onFreshClick=function(){console.log(i),confirm("确定加载文件吗？加载文件前确保已编辑的流程是否需要保存")&&r.onReload()},e.headBtns&&this.$head.on("click",{inthis:this},(function(t){var e=t.target;if("DIV"!=e.tagName&&"SPAN"!=e.tagName){"a"==e.tagName&&(e=e.childNode[0]);var a=t.data.inthis;switch($(e).attr("class")){case"ico_reload":a.onFreshClick&&a.onFreshClick();break}}}))}var D=0;if(e.haveTool){if(this.$bgDiv.append("<div class='GooFlow_tool'"+(e.haveHead?"":" style='margin-top:3px'")+"><div style='height:"+(l-d-(e.haveHead?7:10))+"px' class='GooFlow_tool_div'></div></div>"),this.$tool=this.$bgDiv.find(".GooFlow_tool .GooFlow_tool_div"),this.$tool.append("<div class='GooFlow_ellipsis'>………</div>"),e.toolBtns&&e.toolBtns.length>0){c="<span/>";for(var b=0;b<e.toolBtns.length;++b){var w=e.toolBtns[b];c+="<a href='javascript:void(0)' type='"+e.toolBtns[b]+"' id='"+this.$id+"_btn_"+e.toolBtns[b].split(" ")[0]+"' class='GooFlow_tool_btn'><i class='ico_"+e.toolBtns[b]+"'/><i class='fun_"+e.toolBtns[b]+"'>"+a[w]+"</i></a>"}this.$tool.append(c)}e.haveGroup&&(D=31),this.$nowType="cursor",this.$tool.on("click",{inthis:this},(function(t){var e;switch(t||(t=window.event),t.target.tagName){case"SPAN":return!1;case"DIV":return!1;case"I":e=t.target.parentNode;break;case"A":e=t.target}var a=$(e).attr("type");return t.data.inthis.switchToolBtn(a),!1})),this.$editable=!0}if(s=s-D-9,l=l-d-(e.haveHead?5:8),this.$bgDiv.append("<div class='GooFlow_work' style='width:"+s+"px;height:"+l+"px;"+(e.haveHead?"":"margin-top:3px")+"'></div>"),this.$workArea=$("<div class='GooFlow_work_inner' style='width:"+3*s+"px;height:"+3*l+"px'></div>").attr({unselectable:"on",onselectstart:"return false",onselect:"document.selection.empty()"}),this.$bgDiv.children(".GooFlow_work").append(this.$workArea),this.$draw=null,this.initDraw("draw_"+this.$id,s,l),this.$group=null,e.haveTabs){var y="";y+="<ul id ='tabs' class='tabsUl'>",y+="<li class='current tab_btn_down' id='1'>",y+="<a href='#'' class='remove'></a>",y+="<a href='#'' class='tab' id='mainwork'>主流程</a>",y+="</li></ul>",$(".line_title").append(y)}e.haveGroup&&this.initGroup(s,l),this.$editable&&(this.$workArea.on("click",{inthis:this},(function(t){t||(t=window.event);var e=t.data.inthis;if(e.$editable){var r=e.$nowType;if("cursor"!=r){if("direct"!=r&&"group"!=r){var s,l,d=m(t);f=p(this);s=d.x-f.left+$(".IVRModal").parent().scrollLeft()-1,l=d.y-f.top+$(".IVRModal").parent().scrollTop()-1;var c=a[e.$nowType],u=Object(n["a"])({nodekey:e.$id+"_node_"+e.$max,left:s,top:l,type:e.$nowType},o[e.$nowType]);h["a"].post("/pm/cti/action/save",{data:JSON.stringify(u),rootactid:i.rootactid,entid:i.entid}).then((function(t){u.name=c+" "+t.data,u.id=t.data})).finally((function(){e.addNode(e.$id+"_node_"+e.$max,u),e.switchToolBtn("cursor"),e.$max++}))}}else{var f=$(t.target),v=f.prop("tagName");("svg"==v||"DIV"==v&&f.prop("class").indexOf("GooFlow_work")>-1||"LABEL"==v)&&(e.$lineOper.data("tid")?e.focusItem(e.$lineOper.data("tid"),!1):e.blurItem())}}})),this.$workArea.mousemove({inthis:this},(function(t){if("direct"==t.data.inthis.$nowType||t.data.inthis.$mpTo.data("p")){var e=$(this).data("lineStart"),a=$(this).data("lineEnd");if(e||a){var o,i,r=m(t),s=p(this);o=r.x-s.left+$(".IVRModal").parent().scrollLeft(),i=r.y-s.top+$(".IVRModal").parent().scrollTop();var n=document.getElementById("GooFlow_tmp_line");e?(n.childNodes[0].setAttribute("d","M "+e.x+" "+e.y+" L "+o+" "+i),n.childNodes[1].setAttribute("d","M "+e.x+" "+e.y+" L "+o+" "+i),'url("#arrow2")'==n.childNodes[1].getAttribute("marker-end")?n.childNodes[1].setAttribute("marker-end","url(#arrow3)"):n.childNodes[1].setAttribute("marker-end","url(#arrow2)")):a&&(n.childNodes[0].setAttribute("d","M "+o+" "+i+" L "+a.x+" "+a.y),n.childNodes[1].setAttribute("d","M "+o+" "+i+" L "+a.x+" "+a.y),'url("#arrow2")'==n.childNodes[1].getAttribute("marker-end")?n.childNodes[1].setAttribute("marker-end","url(#arrow3)"):n.childNodes[1].setAttribute("marker-end","url(#arrow2)"))}}})),this.$workArea.mouseup({inthis:this},(function(t){var e=t.data.inthis;if("direct"==e.$nowType||e.$mpTo.data("p")){var a=document.getElementById("GooFlow_tmp_line");a?($(this).css("cursor","auto").removeData("lineStart").removeData("lineEnd"),e.$mpTo.hide().removeData("p"),e.$mpFrom.hide().removeData("p"),e.$draw.removeChild(a),e.focusItem(e.$focus,!1)):e.$lineOper.removeData("tid")}})),this.initWorkForNode(),this.$ghost=$("<div class='rs_ghost'></div>").attr({unselectable:"on",onselectstart:"return false",onselect:"document.selection.empty()"}),this.$bgDiv.append(this.$ghost),this.$textArea=$("<textarea></textarea>"),this.$bgDiv.append(this.$textArea),this.$lineMove=$("<div class='GooFlow_line_move' style='display:none'></div>"),this.$workArea.append(this.$lineMove),this.$lineMove.on("mousedown",{inthis:this},(function(t){if(2==t.button)return!1;var e=$(this);e.css({"background-color":f.prototype.color.font||"#333"});var a,o,i=t.data.inthis,r=m(t),s=p(i.$workArea[0]);a=r.x-s.left+$(".IVRModal").parent().scrollLeft(),o=r.y-s.top+$(".IVRModal").parent().scrollTop();var n=i.$lineMove.position(),l=a-n.left,d=o-n.top,c=!1;document.onmousemove=function(t){t||(t=window.event);var e=m(t);a=e.x-s.left+$(".IVRModal").parent().scrollLeft(),o=e.y-s.top+$(".IVRModal").parent().scrollTop(),"lr"==i.$lineMove.data("type")?(a-=l,a<0?a=0:a>i.$workArea.width()&&(a=i.$workArea.width()),i.$lineMove.css({left:a+"px"})):"tb"==i.$lineMove.data("type")&&(o-=d,o<0?o=0:o>i.$workArea.height()&&(o=i.$workArea.height()),i.$lineMove.css({top:o+"px"})),c=!0},document.onmouseup=function(t){if(c){var e=i.$lineMove.position();"lr"==i.$lineMove.data("type")?i.setLineM(i.$lineMove.data("tid"),e.left+3):"tb"==i.$lineMove.data("type")&&i.setLineM(i.$lineMove.data("tid"),e.top+3)}i.$lineMove.css({"background-color":"transparent"}),document.onmousemove=null,document.onmouseup=null}})),this.$lineOper=$("<div class='GooFlow_line_oper' style='display:none'><i class='b_l1'></i><i class='b_l2'></i><i class='b_l3'></i><i class='b_x'></i></div>"),this.$workArea.parent().append(this.$lineOper),this.$lineOper.on("click",{inthis:this},(function(t){if(t||(t=window.event),"I"==t.target.tagName){var e=t.data.inthis,a=$(this).data("tid");switch($(t.target).attr("class")){case"b_x":e.delLine(a),this.style.display="none";break;case"b_l1":e.setLineType(a,"lr");break;case"b_l2":e.setLineType(a,"tb");break;case"b_l3":e.setLineType(a,"sl");break}}})),this.$mpFrom=$("<div class='GooFlow_line_mp' style='display:none'></div>"),this.$mpTo=$("<div class='GooFlow_line_mp' style='display:none'></div>"),this.$workArea.append(this.$mpFrom).append(this.$mpTo),this.initLinePointsChg(),this.onItemAdd=null,this.onItemDel=null,this.onItemMove=null,this.onItemRename=null,this.onItemFocus=null,this.onItemBlur=null,this.onItemResize=null,this.onLineMove=null,this.onLineSetType=null,this.onLinePointMove=null,this.onItemMark=null,e.useOperStack&&this.$editable&&(this.$undoStack=[],this.$redoStack=[],this.$isUndo=0,this.pushOper=function(t,e){this.$undoStack.length;1==this.$isUndo?(this.$redoStack.push([t,e]),this.$isUndo=!1,this.$redoStack.length>40&&this.$redoStack.shift()):(this.$undoStack.push([t,e]),this.$undoStack.length>40&&this.$undoStack.shift(),0==this.$isUndo&&this.$redoStack.splice(0,this.$redoStack.length),this.$isUndo=0)},this.pushExternalOper=function(t,e){this.pushOper("externalFunc",[t,e])}),$(document).keydown({inthis:this},(function(t){var e=t.data.inthis;if(""!=e.$focus)switch(t.keyCode){case 46:e.delNode(e.$focus,!0),e.delLine(e.$focus);break}})));var x=this;$(".GooFlow_work_inner").on("mousedown",(function(t){if("cursor"==x.$nowType){var e,a,o,i,r,s,n,l,d=$(".GooFlow_work_inner");d.css({cursor:"grab"}),a=parseInt(d.css("top")),e=parseInt(d.css("left")),r=$(window).width(),s=$(window).height(),o=t.clientX-e,i=t.clientY-a,n=parseInt(d.css("height")),l=parseInt(d.css("width")),$(document).on("mousemove",(function(t){return e=t.clientX-o,a=t.clientY-i,a=a<=s-n-85?s-n-85:a>s-n-85&&a<=0?t.clientY-i:0,e=e<=r-l-57?r-l-57:e>r-l-57&&e<=0?t.clientX-o:0,d.css({left:e,top:a}),!1})),$(document).on("mouseup",(function(){d.css({cursor:"default"}),$(this).off("mousemove"),$(this).off("mousemup")}))}}))}f.prototype={getSvgMarker:function(t,e){var a=document.createElementNS("http://www.w3.org/2000/svg","marker");a.setAttribute("id",t),a.setAttribute("viewBox","0 0 6 6"),a.setAttribute("refX",5),a.setAttribute("refY",3),a.setAttribute("markerUnits","strokeWidth"),a.setAttribute("markerWidth",6),a.setAttribute("markerHeight",6),a.setAttribute("orient","auto");var o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d","M 0 0 L 6 3 L 0 6 z"),o.setAttribute("fill",e),o.setAttribute("stroke-width",0),a.appendChild(o),a},initDraw:function(t,e,a){this.$draw=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.$workArea.prepend(this.$draw);var o=document.createElementNS("http://www.w3.org/2000/svg","defs");this.$draw.appendChild(o),o.appendChild(f.prototype.getSvgMarker("arrow1",f.prototype.color.line||"#3892D3")),o.appendChild(f.prototype.getSvgMarker("arrow2",f.prototype.color.mark||"#ff3300")),o.appendChild(f.prototype.getSvgMarker("arrow3",f.prototype.color.mark||"#ff3300")),this.$draw.id=t,this.$draw.style.width=3*e+"px",this.$draw.style.height=3*+a+"px";var i="g";this.$editable&&($(this.$draw).delegate(i,"click",{inthis:this},(function(t){t.data.inthis.focusItem(this.id,!0)})),$(this.$draw).delegate(i,"dblclick",{inthis:this},(function(t){var e,a,o,i,r,s=t.data.inthis;e=this.childNodes[2].textContent,i=this.getAttribute("from").split(","),r=this.getAttribute("to").split(","),"lr"==s.$lineData[this.id].type?(i[0]=s.$lineData[this.id].M,r[0]=i[0]):"tb"==s.$lineData[this.id].type&&(i[1]=s.$lineData[this.id].M,r[1]=i[1]),a=(parseInt(i[0],10)+parseInt(r[0],10))/2-60,o=(parseInt(i[1],10)+parseInt(r[1],10))/2-12;var n=p(s.$workArea[0]);s.$textArea.val(e).css({display:"block",width:120,height:14,left:n.left+a-$(".IVRModal").parent().scrollLeft(),top:n.top+o-$(".IVRModal").parent().scrollTop()}).data("id",s.$focus).focus(),s.$workArea.parent().one("mousedown",(function(t){if(2==t.button)return!1;s.setName(s.$textArea.data("id"),s.$textArea.val(),"line"),s.$textArea.val("").removeData("id").hide()}))})))},initGroup:function(t,e){this.$group=$("<div class='GooFlow_work_group' style='width:"+3*t+"px;height:"+3*e+"px'></div>"),this.$workArea.prepend(this.$group),this.$editable&&(this.$group.on("mousedown",{inthis:this},(function(t){if(2==t.button)return!1;var e=t.data.inthis;if("group"==e.$nowType){if("block"==e.$textArea.css("display"))return e.setName(e.$textArea.data("id"),e.$textArea.val(),"area"),e.$textArea.val("").removeData("id").hide(),!1;t||(t=window.event);var a=$(t.target).css("cursor"),o=t.target.parentNode;switch(a){case"nw-resize":o=o.parentNode;break;case"w-resize":o=o.parentNode;break;case"n-resize":o=o.parentNode;break;case"move":break;default:return}o=o.id;var i,r,s=1,n=m(t),l=p(e.$workArea[0]);if(i=n.x-l.left+$(".IVRModal").parent().scrollLeft(),r=n.y-l.top+$(".IVRModal").parent().scrollTop(),"move"!=a){e.$ghost.css({display:"block",width:e.$areaData[o].width-2+"px",height:e.$areaData[o].height-2+"px",top:e.$areaData[o].top+l.top-$(".IVRModal").parent().scrollTop()+s+"px",left:e.$areaData[o].left+l.left-$(".IVRModal").parent().scrollLeft()+s+"px",cursor:a});var d=e.$areaData[o].left+e.$areaData[o].width-i,c=e.$areaData[o].top+e.$areaData[o].height-r}else d=i-e.$areaData[o].left,c=r-e.$areaData[o].top;var h=!1;e.$ghost.css("cursor",a),document.onmousemove=function(t){t||(t=window.event);var n=m(t);if("move"!=a)switch(i=n.x-l.left+$(".IVRModal").parent().scrollLeft()-e.$areaData[o].left+d,r=n.y-l.top+$(".IVRModal").parent().scrollTop()-e.$areaData[o].top+c,i<200&&(i=200),r<100&&(r=100),a){case"nw-resize":e.$ghost.css({width:i-2+"px",height:r-2+"px"});break;case"w-resize":e.$ghost.css({width:i-2+"px"});break;case"n-resize":e.$ghost.css({height:r-2+"px"});break}else"none"==e.$ghost.css("display")&&e.$ghost.css({display:"block",width:e.$areaData[o].width-2+"px",height:e.$areaData[o].height-2+"px",top:e.$areaData[o].top+l.top-$(".IVRModal").parent().scrollTop()+s+"px",left:e.$areaData[o].left+l.left-$(".IVRModal").parent().scrollLeft()+s+"px",cursor:a}),i=n.x-d,r=n.y-c,i<l.left-$(".IVRModal").parent().scrollLeft()?i=l.left-$(".IVRModal").parent().scrollLeft():i+$(".IVRModal").parent().scrollLeft()+e.$areaData[o].width>l.left+e.$workArea.width()&&(i=l.left+e.$workArea.width()-$(".IVRModal").parent().scrollLeft()-e.$areaData[o].width),r<l.top-$(".IVRModal").parent().scrollTop()?r=l.top-$(".IVRModal").parent().scrollTop():r+$(".IVRModal").parent().scrollTop()+e.$areaData[o].height>l.top+e.$workArea.height()&&(r=l.top+e.$workArea.height()-$(".IVRModal").parent().scrollTop()-e.$areaData[o].height),e.$ghost.css({left:i+s+"px",top:r+s+"px"});h=!0},document.onmouseup=function(t){if(e.$ghost.empty().hide(),document.onmousemove=null,document.onmouseup=null,h)return"move"!=a?e.resizeArea(o,e.$ghost.outerWidth(),e.$ghost.outerHeight()):e.moveArea(o,i+$(".IVRModal").parent().scrollLeft()-l.left,r+$(".IVRModal").parent().scrollTop()-l.top),!1}}})),this.$group.on("dblclick",{inthis:this},(function(t){var e=t.data.inthis;if("group"==e.$nowType){if(t||(t=window.event),"LABEL"!=t.target.tagName)return!1;var a=t.target.innerHTML,o=t.target.parentNode,i=parseInt(o.style.left,10)+18,r=parseInt(o.style.top,10)+1,s=p(e.$workArea[0]);return e.$textArea.val(a).css({display:"block",width:100,height:14,left:s.left+i-$(".IVRModal").parent().scrollLeft(),top:s.top+r-$(".IVRModal").parent().scrollTop()}).data("id",o.id).focus(),e.$workArea.parent().one("mousedown",(function(t){if(2==t.button)return!1;"block"==e.$textArea.css("display")&&(e.setName(e.$textArea.data("id"),e.$textArea.val(),"area"),e.$textArea.val("").removeData("id").hide())})),!1}})),this.$group.mouseup({inthis:this},(function(t){var e=t.data.inthis;if("group"==e.$nowType){switch(t||(t=window.event),$(t.target).attr("class")){case"rs_close":return e.delArea(t.target.parentNode.parentNode.id),!1;case"bg":return}switch(t.target.tagName){case"LABEL":return!1;case"I":var a=t.target.parentNode.id;switch(e.$areaData[a].color){case"red":e.setAreaColor(a,"yellow");break;case"yellow":e.setAreaColor(a,"blue");break;case"blue":e.setAreaColor(a,"green");break;case"green":e.setAreaColor(a,"red");break}return!1}if("none"==t.data.inthis.$ghost.css("display")){var o,i,r=m(t),s=p(this);o=r.x-s.left+$(".IVRModal").parent().scrollLeft()-1,i=r.y-s.top+$(".IVRModal").parent().scrollTop()-1;var n=["red","yellow","blue","green"];return t.data.inthis.addArea(t.data.inthis.$id+"_area_"+t.data.inthis.$max,{name:"area_"+t.data.inthis.$max,left:o,top:i,color:n[t.data.inthis.$max%4],width:200,height:100}),t.data.inthis.$max++,!1}}})))},initLinePointsChg:function(){this.$mpFrom.on("mousedown",{inthis:this},(function(t){var e=t.data.inthis;e.switchToolBtn("cursor");var a=e.$mpFrom.data("p").split(","),o=e.$mpTo.data("p").split(",");$(this).hide(),e.$workArea.data("lineEnd",{x:o[0],y:o[1],id:e.$lineData[e.$lineOper.data("tid")].to}).css("cursor","crosshair");var i=f.prototype.drawLine("GooFlow_tmp_line",[a[0],a[1]],[o[0],o[1]],!0,!0);return e.$draw.appendChild(i),!1})),this.$mpTo.on("mousedown",{inthis:this},(function(t){var e=t.data.inthis;e.switchToolBtn("cursor");var a=e.$mpFrom.data("p").split(","),o=e.$mpTo.data("p").split(",");$(this).hide(),e.$workArea.data("lineStart",{x:a[0],y:a[1],id:e.$lineData[e.$lineOper.data("tid")].from}).css("cursor","crosshair");var i=f.prototype.drawLine("GooFlow_tmp_line",[a[0],a[1]],[o[0],o[1]],!0,!0);return e.$draw.appendChild(i),!1}))},switchToolBtn:function(t){if(this.$tool.children("#"+this.$id+"_btn_"+this.$nowType.split(" ")[0]).attr("class","GooFlow_tool_btn"),this.$tool.children("#"+this.$id+"_btn_"+this.$nowType.split(" ")[0]).children("i").css("background-position","-42px 0px"),"group"==this.$nowType)for(var e in this.$workArea.prepend(this.$group),this.$areaDom)this.$areaDom[e].addClass("lock").children("div:eq(1)").css("display","none");if(this.$nowType=t,this.$tool.children("#"+this.$id+"_btn_"+t.split(" ")[0]).attr("class","GooFlow_tool_btndown"),this.$tool.children("#"+this.$id+"_btn_"+this.$nowType.split(" ")[0]).children("i").css("background-position","11px 0px"),"group"==this.$nowType)for(var e in this.blurItem(),this.$workArea.append(this.$group),this.$areaDom)this.$areaDom[e].removeClass("lock").children("div:eq(1)").css("display","");else"direct"==this.$nowType&&this.blurItem();if("none"==this.$textArea.css("display")&&this.$textArea.removeData("id").val("").hide(),$(".GooFlow_work svg").css("cursor",u[t]?"default":"pointer"),"mutiselect"==t){var a="",o="";o="";o+="<li class='current' id='"+tabId+"'>",o+="<a href='#'' class='remove'>X</a>",o+="<a href='#'' class='tab' id='mainwork'>子流程</a></li>",$("#tabs li").attr("class","current"),$("#tabs #"+tabId).attr("class","tab_btn_down"),$(".GooFlow_work").hide(),a+="<div class='GooFlow_work' id='GooFlow_work"+tabId+"' style='width:"+width+"px;height:"+height+"px;'><p>"+tabId+"GooFlow_work</p></div>",$(".tabsUl").append(o),$("#demo").append(a),tabId++}},addNode:function(t,e){if(null==this.onItemAdd||this.onItemAdd(t,"node",e)){this.$undoStack&&this.$editable&&this.pushOper("delNode",[t]);var a=e.marked?" item_mark":"";e.type.indexOf(" round")<0?((!e.width||e.width<100)&&(e.width=100),(!e.height||e.height<24)&&(e.height=24),(!e.top||e.top<0)&&(e.top=0),(!e.left||e.left<0)&&(e.left=0),this.$nodeDom[t]=$("<div class='GooFlow_item"+a+"' id='"+t+"' style='top:"+e.top+"px;left:"+e.left+"px'><table cellspacing='1' style='width:"+(e.width-2)+"px;height:"+(e.height-2)+"px;'><tr><td class='ico'><i class='ico_"+e.type+"'></i></td><td>"+e.name+"</td></tr></table><div style='display:none'><div class='rs_bottom'></div><div class='rs_right'></div><div class='rs_rb'></div><div class='rs_close'></div></div></div>")):(e.width=24,e.height=24,this.$nodeDom[t]=$("<div class='GooFlow_item item_round"+a+"' id='"+t+"' style='top:"+e.top+"px;left:"+e.left+"px'><table cellspacing='0'><tr><td class='ico'><i class='ico_"+e.type+"'></i></td></tr></table><div  style='display:none'><div class='rs_close'></div></div><div class='span'>"+e.name+"</div></div>")),f.prototype.color.node&&(e.type.indexOf(" mix")>-1?this.$nodeDom[t].css({"background-color":f.prototype.color.mix,"border-color":f.prototype.color.mix}):this.$nodeDom[t].css({"background-color":f.prototype.color.node,"border-color":f.prototype.color.node}),a&&f.prototype.color.mark&&this.$nodeDom[t].css({"border-color":f.prototype.color.mark})),e.type.indexOf(" mix")>-1&&this.$nodeDom[t].addClass("item_mix"),this.$workArea.append(this.$nodeDom[t]),this.$nodeData[t]=e,++this.$nodeCount,this.$editable&&(this.$nodeData[t].alt=!0,this.$deletedItem[t]&&delete this.$deletedItem[t])}},initWorkForNode:function(){this.$workArea.delegate(".GooFlow_item","click",{inthis:this},(function(t){t.data.inthis.focusItem(this.id,!0),$(this).removeClass("item_mark")})),this.$workArea.delegate(".ico","mousedown",{inthis:this},(function(t){if(t||(t=window.event),2==t.button)return!1;var e=t.data.inthis;if("direct"!=e.$nowType){t.stopPropagation();var a=$(this).parents(".GooFlow_item"),o=a.attr("id");e.focusItem(o,!1);var i,r,s=1,n=m(t),l=p(e.$workArea[0]);a.children("table").clone().prependTo(e.$ghost),i=n.x-l.left+$(".IVRModal").parent().scrollLeft(),r=n.y-l.top+$(".IVRModal").parent().scrollTop();var d=i-e.$nodeData[o].left,c=r-e.$nodeData[o].top,h=!1;document.onmousemove=function(t){t||(t=window.event);var a=m(t);if(i==a.x-d&&r==a.y-c)return!1;i=a.x-d,r=a.y-c,h&&"none"==e.$ghost.css("display")&&e.$ghost.css({display:"block",width:e.$nodeData[o].width-2+"px",height:e.$nodeData[o].height-2+"px",top:e.$nodeData[o].top+l.top-$(".IVRModal").parent().scrollTop()+s+"px",left:e.$nodeData[o].left+l.left-$(".IVRModal").parent().scrollLeft()+s+"px",cursor:"move"}),i<l.left-$(".IVRModal").parent().scrollLeft()?i=l.left-$(".IVRModal").parent().scrollLeft():i+$(".IVRModal").parent().scrollLeft()+e.$nodeData[o].width>l.left+e.$workArea.width()&&(i=l.left+e.$workArea.width()-$(".IVRModal").parent().scrollLeft()-e.$nodeData[o].width),r<l.top-$(".IVRModal").parent().scrollTop()?r=l.top-$(".IVRModal").parent().scrollTop():r+$(".IVRModal").parent().scrollTop()+e.$nodeData[o].height>l.top+e.$workArea.height()&&(r=l.top+e.$workArea.height()-$(".IVRModal").parent().scrollTop()-e.$nodeData[o].height),e.$ghost.css({left:i+s+"px",top:r+s+"px"}),h=!0},document.onmouseup=function(t){h&&e.moveNode(o,i+$(".IVRModal").parent().scrollLeft()-l.left,r+$(".IVRModal").parent().scrollTop()-l.top),e.$ghost.empty().hide(),document.onmousemove=null,document.onmouseup=null}}})),this.$editable&&(this.$workArea.delegate(".GooFlow_item","mouseenter",{inthis:this},(function(t){("direct"==t.data.inthis.$nowType||document.getElementById("GooFlow_tmp_line"))&&$(this).addClass("item_mark").addClass("crosshair").css("border-color",f.prototype.color.mark||"#ff3300")})),this.$workArea.delegate(".GooFlow_item","mouseleave",{inthis:this},(function(t){("direct"==t.data.inthis.$nowType||document.getElementById("GooFlow_tmp_line"))&&($(this).removeClass("item_mark").removeClass("crosshair"),this.id==t.data.inthis.$focus?$(this).css("border-color",f.prototype.color.line||"#3892D3"):$(this).css("border-color",f.prototype.color.node||"#A1DCEB"))})),this.$workArea.delegate(".GooFlow_item","mousedown",{inthis:this},(function(t){if(2==t.button)return!1;var e=t.data.inthis;if("direct"==e.$nowType){var a,o,i=m(t),r=p(e.$workArea[0]);a=i.x-r.left+$(".IVRModal").parent().scrollLeft(),o=i.y-r.top+$(".IVRModal").parent().scrollTop(),e.$workArea.data("lineStart",{x:a,y:o,id:this.id}).css("cursor","crosshair");var s=f.prototype.drawLine("GooFlow_tmp_line",[a,o],[a,o],!0,!0);e.$draw.appendChild(s)}})),this.$workArea.delegate(".GooFlow_item","mouseup",{inthis:this},(function(t){var e=t.data.inthis;if("direct"==e.$nowType||e.$mpTo.data("p")){var a=e.$workArea.data("lineStart"),o=e.$workArea.data("lineEnd");a&&!e.$mpTo.data("p")?(e.addLine(e.$id+"_line_"+e.$max,{from:a.id,to:this.id,name:""}),e.$max++):(a?e.moveLinePoints(e.$focus,a.id,this.id):o&&e.moveLinePoints(e.$focus,this.id,o.id),e.$nodeData[this.id].marked||($(this).removeClass("item_mark"),this.id!=e.$focus?$(this).css("border-color",f.prototype.color.node):$(this).css("border-color",f.prototype.color.line)))}})),this.$workArea.delegate(".GooFlow_item > .span","dblclick",{inthis:this},(function(t){var e=this.innerHTML,a=t.data.inthis,o=this.parentNode.id,i=p(a.$workArea[0]);a.$textArea.val(e).css({display:"block",height:$(this).height(),width:100,left:i.left+a.$nodeData[o].left-$(".IVRModal").parent().scrollLeft()-24,top:i.top+a.$nodeData[o].top-$(".IVRModal").parent().scrollTop()+26}).data("id",a.$focus).focus(),a.$workArea.parent().one("mousedown",(function(t){if(2==t.button)return!1;a.setName(a.$textArea.data("id"),a.$textArea.val(),"node"),a.$textArea.val("").removeData("id").hide()}))})),this.$workArea.delegate(".ico + td","dblclick",{inthis:this},(function(t){var e=this.innerHTML,a=t.data.inthis,o=$(this).parents(".GooFlow_item").attr("id"),i=p(a.$workArea[0]);a.$textArea.val(e).css({display:"block",width:$(this).width()+24,height:$(this).height(),left:i.left+24+a.$nodeData[o].left-$(".IVRModal").parent().scrollLeft(),top:i.top+2+a.$nodeData[o].top-$(".IVRModal").parent().scrollTop()}).data("id",a.$focus).focus(),a.$workArea.parent().one("mousedown",(function(t){if(2==t.button)return!1;a.setName(a.$textArea.data("id"),a.$textArea.val(),"node"),a.$textArea.val("").removeData("id").hide()}))})),this.$workArea.delegate(".rs_close","click",{inthis:this},(function(t){return t||(t=window.event),t.data.inthis.delNode(t.data.inthis.$focus),!1})),this.$workArea.delegate(".GooFlow_item > div > div[class!=rs_close]","mousedown",{inthis:this},(function(t){if(t||(t=window.event),2==t.button)return!1;var e=$(this).css("cursor");if("pointer"!=e){var a=t.data.inthis,o=a.$focus;a.switchToolBtn("cursor"),t.cancelBubble=!0,t.stopPropagation();var i,r,s=1,n=m(t),l=p(a.$workArea[0]);a.$ghost.css({display:"block",width:a.$nodeData[o].width-2+"px",height:a.$nodeData[o].height-2+"px",top:a.$nodeData[o].top+l.top-$(".IVRModal").parent().scrollTop()+s+"px",left:a.$nodeData[o].left+l.left-$(".IVRModal").parent().scrollLeft()+s+"px",cursor:e}),i=n.x-l.left+$(".IVRModal").parent().scrollLeft(),r=n.y-l.top+$(".IVRModal").parent().scrollTop();var d=a.$nodeData[o].left+a.$nodeData[o].width-i,c=a.$nodeData[o].top+a.$nodeData[o].height-r,h=!1;a.$ghost.css("cursor",e),document.onmousemove=function(t){t||(t=window.event);var s=m(t);switch(i=s.x-l.left+$(".IVRModal").parent().scrollLeft()-a.$nodeData[o].left+d,r=s.y-l.top+$(".IVRModal").parent().scrollTop()-a.$nodeData[o].top+c,i<100&&(i=100),r<24&&(r=24),h=!0,e){case"nw-resize":a.$ghost.css({width:i-2+"px",height:r-2+"px"});break;case"w-resize":a.$ghost.css({width:i-2+"px"});break;case"n-resize":a.$ghost.css({height:r-2+"px"});break}},document.onmouseup=function(t){a.$ghost.hide(),h&&(t||(t=window.event),a.resizeNode(o,a.$ghost.outerWidth(),a.$ghost.outerHeight()),document.onmousemove=null,document.onmouseup=null)}}})))},blurItem:function(){if(""!=this.$focus){var t=$("#"+this.$focus);if("DIV"==t.prop("tagName")){if(null!=this.onItemBlur&&!this.onItemBlur(this.$focus,"node"))return!1;t.removeClass("item_focus").children("div:eq(0)").css("display","none"),f.prototype.color.line&&(this.$nodeData[this.$focus].marked?t.css("border-color",f.prototype.color.mark||"#ff3300"):t.css("border-color",f.prototype.color.node||"#A1DCEB"))}else{if(null!=this.onItemBlur&&!this.onItemBlur(this.$focus,"line"))return!1;this.$lineData[this.$focus].marked||(t[0].childNodes[1].setAttribute("stroke",f.prototype.color.line||"#3892D3"),t[0].childNodes[1].setAttribute("marker-end","url(#arrow1)")),this.$lineMove.hide().removeData("type").removeData("tid"),this.$editable&&(this.$lineOper.hide().removeData("tid"),this.$mpFrom.hide().removeData("p"),this.$mpTo.hide().removeData("p"))}}return this.$focus="",!0},focusItem:function(t,e){var a=$("#"+t);if(0!=a.length&&this.blurItem()){if("DIV"==a.prop("tagName")){if(e&&null!=this.onItemFocus&&!this.onItemFocus(t,"node"))return;a.addClass("item_focus"),f.prototype.color.line&&a.css("border-color",f.prototype.color.line),this.$editable&&a.children("div:eq(0)").css("display","block"),this.$workArea.append(a)}else{if(null!=this.onItemFocus&&!this.onItemFocus(t,"line"))return;if(a[0].childNodes[1].setAttribute("stroke",f.prototype.color.mark||"#ff3300"),a[0].childNodes[1].setAttribute("marker-end","url(#arrow2)"),!this.$editable)return;var o,i,r,s,n;r=a.attr("from").split(","),s=a.attr("to").split(","),n=[r[0],r[1],s[0],s[1]],r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10),s[0]=parseInt(s[0],10),s[1]=parseInt(s[1],10),"lr"==this.$lineData[t].type?(r[0]=this.$lineData[t].M,s[0]=r[0],this.$lineMove.css({width:"5px",height:(s[1]-r[1])*(s[1]>r[1]?1:-1)+"px",left:r[0]-3+"px",top:(s[1]>r[1]?r[1]:s[1])+1+"px",cursor:"e-resize",display:"block"}).data({type:"lr",tid:t})):"tb"==this.$lineData[t].type&&(r[1]=this.$lineData[t].M,s[1]=r[1],this.$lineMove.css({width:(s[0]-r[0])*(s[0]>r[0]?1:-1)+"px",height:"5px",left:(s[0]>r[0]?r[0]:s[0])+1+"px",top:r[1]-3+"px",cursor:"s-resize",display:"block"}).data({type:"tb",tid:t})),o=(r[0]+s[0])/2-35,i=(r[1]+s[1])/2+6,this.$lineOper.css({display:"block",left:o+"px",top:i+"px"}).data("tid",t),this.$editable&&(this.$mpFrom.css({display:"block",left:n[0]-4+"px",top:n[1]-4+"px"}).data("p",n[0]+","+n[1]),this.$mpTo.css({display:"block",left:n[2]-4+"px",top:n[3]-4+"px"}).data("p",n[2]+","+n[3])),this.$draw.appendChild(a[0])}this.$focus=t,this.switchToolBtn("cursor"),$(".GooFlow_item").removeClass("crosshair").css("border-color","transparent")}},moveNode:function(t,e,a){if(this.$nodeData[t]&&(null==this.onItemMove||this.onItemMove(t,"node",e,a))){if(this.$undoStack){var o=[t,this.$nodeData[t].left,this.$nodeData[t].top];this.pushOper("moveNode",o)}e<0&&(e=0),a<0&&(a=0),$("#"+t).css({left:e+"px",top:a+"px"}),this.$nodeData[t].left=e,this.$nodeData[t].top=a,this.resetLines(t,this.$nodeData[t]),this.$editable&&(this.$nodeData[t].alt=!0)}},setName:function(t,e,a){var o;if("node"==a){if(!this.$nodeData[t])return;if(this.$nodeData[t].name==e)return;if(null!=this.onItemRename&&!this.onItemRename(t,e,"node"))return;if(o=this.$nodeData[t].name,this.$nodeData[t].name=e,this.$nodeData[t].type.indexOf("round")>1)this.$nodeDom[t].children(".span").text(e);else{this.$nodeDom[t].find("td:eq(1)").text(e);var i=this.$nodeDom[t].outerWidth(),r=this.$nodeDom[t].outerHeight();this.$nodeDom[t].children("table").css({width:i-2+"px",height:r-2+"px"}),this.$nodeData[t].width=i,this.$nodeData[t].height=r}this.$editable&&(this.$nodeData[t].alt=!0),this.resetLines(t,this.$nodeData[t])}else if("line"==a){if(!this.$lineData[t])return;if(this.$lineData[t].name==e)return;if(null!=this.onItemRename&&!this.onItemRename(t,e,"line"))return;o=this.$lineData[t].name,this.$lineData[t].name=e,this.$lineDom[t].childNodes[2].textContent=e,this.$editable&&(this.$lineData[t].alt=!0)}else if("area"==a){if(!this.$areaData[t])return;if(this.$areaData[t].name==e)return;if(null!=this.onItemRename&&!this.onItemRename(t,e,"area"))return;o=this.$areaData[t].name,this.$areaData[t].name=e,this.$areaDom[t].children("label").text(e),this.$editable&&(this.$areaData[t].alt=!0)}if(this.$undoStack){var s=[t,o,a];this.pushOper("setName",s)}},resizeNode:function(t,e,a){if(this.$nodeData[t]&&(null==this.onItemResize||this.onItemResize(t,"node",e,a))&&"start"!=this.$nodeData[t].type&&"end"!=this.$nodeData[t].type){if(this.$undoStack){var o=[t,this.$nodeData[t].width,this.$nodeData[t].height];this.pushOper("resizeNode",o)}var i=0;this.$nodeDom[t].children("table").css({width:e-2+"px",height:a-2+"px"}),e=this.$nodeDom[t].outerWidth()-i,a=this.$nodeDom[t].outerHeight()-i,this.$nodeDom[t].children("table").css({width:e-2+"px",height:a-2+"px"}),this.$nodeData[t].width=e,this.$nodeData[t].height=a,this.$editable&&(this.$nodeData[t].alt=!0),this.resetLines(t,this.$nodeData[t])}},delNode:function(t){if(this.$nodeData[t]&&(null==this.onItemDel||this.onItemDel(t,"node"))){for(var e in console.log(t),this.$lineData)this.$lineData[e].from!=t&&this.$lineData[e].to!=t||this.delLine(e);if(this.$undoStack){var a=[t,this.$nodeData[t]];this.pushOper("addNode",a)}delete this.$nodeData[t],this.$nodeDom[t].remove(),delete this.$nodeDom[t],--this.$nodeCount,this.$focus==t&&(this.$focus=""),this.$editable&&t.indexOf(this.$id+"_node_")<0&&(this.$deletedItem[t]="node")}},setTitle:function(t){this.$title=t,this.$head&&this.$head.children("label").attr("title",t).text(t)},loadData:function(t,e){var a=this.$editable;for(var o in this.$editable=!1,t.title&&this.setTitle(t.title),t.initNum&&(this.$max=t.initNum),t.nodes)"start"===t.nodes[o].type?t.nodes[o].name=t.nodes[o].name+" "+e:t.nodes[o].name=t.nodes[o].name+" "+t.nodes[o].id,this.addNode(o,t.nodes[o]);for(var i in t.lines)this.addLine(i,t.lines[i]);for(var r in t.areas)this.addArea(r,t.areas[r]);this.$editable=a,this.$deletedItem={}},clearData:function(){for(var t in this.$nodeData)this.delNode(t);for(var t in this.$lineData)this.delLine(t);for(var t in this.$areaData)this.delArea(t);this.$deletedItem={}},destrory:function(){this.$bgDiv.empty(),this.$lineData=null,this.$nodeData=null,this.$lineDom=null,this.$nodeDom=null,this.$areaDom=null,this.$areaData=null,this.$nodeCount=0,this.$areaCount=0,this.$areaCount=0,this.$deletedItem={}},drawLine:function(t,e,a,o,i,r){var s=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","path"),l=document.createElementNS("http://www.w3.org/2000/svg","path");if(""!=t&&s.setAttribute("id",t),s.setAttribute("from",e[0]+","+e[1]),s.setAttribute("to",a[0]+","+a[1]),n.setAttribute("visibility","hidden"),n.setAttribute("stroke-width",9),n.setAttribute("fill","none"),n.setAttribute("stroke","white"),n.setAttribute("d","M "+e[0]+" "+e[1]+" L "+a[0]+" "+a[1]),n.setAttribute("pointer-events","stroke"),l.setAttribute("d","M "+e[0]+" "+e[1]+" L "+a[0]+" "+a[1]),l.setAttribute("stroke-width",1.4),l.setAttribute("stroke-linecap","round"),l.setAttribute("fill","none"),i&&l.setAttribute("style","stroke-dasharray:6,5"),o?(l.setAttribute("stroke",f.prototype.color.mark||"#ff3300"),l.setAttribute("marker-end","url(#arrow2)")):(l.setAttribute("stroke",f.prototype.color.line||"#3892D3"),l.setAttribute("marker-end","url(#arrow1)")),s.appendChild(n),s.appendChild(l),s.style.cursor="crosshair",""!=t&&"GooFlow_tmp_line"!=t){var d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("fill",f.prototype.color.font||"#333"),s.appendChild(d);var c=(a[0]+e[0])/2,h=(a[1]+e[1])/2;d.setAttribute("text-anchor","middle"),d.setAttribute("x",c),d.setAttribute("y",h),s.style.cursor="pointer",d.style.cursor="text",setTimeout((function(){return d.textContent=r}),0)}return s},drawPoly:function(t,e,a,o,i,r){var s,n;s=document.createElementNS("http://www.w3.org/2000/svg","g");var l=document.createElementNS("http://www.w3.org/2000/svg","path"),d=document.createElementNS("http://www.w3.org/2000/svg","path");""!=t&&s.setAttribute("id",t),s.setAttribute("from",e[0]+","+e[1]),s.setAttribute("to",i[0]+","+i[1]),l.setAttribute("visibility","hidden"),l.setAttribute("stroke-width",9),l.setAttribute("fill","none"),l.setAttribute("stroke","white"),n="M "+e[0]+" "+e[1],a[0]==e[0]&&a[1]==e[1]||(n+=" L "+a[0]+" "+a[1]),o[0]==i[0]&&o[1]==i[1]||(n+=" L "+o[0]+" "+o[1]),n+=" L "+i[0]+" "+i[1],l.setAttribute("d",n),l.setAttribute("pointer-events","stroke"),d.setAttribute("d",n),d.setAttribute("stroke-width",1.4),d.setAttribute("stroke-linecap","round"),d.setAttribute("fill","none"),r?(d.setAttribute("stroke",f.prototype.color.mark||"#ff3300"),d.setAttribute("marker-end","url(#arrow2)")):(d.setAttribute("stroke",f.prototype.color.line||"#3892D3"),d.setAttribute("marker-end","url(#arrow1)")),s.appendChild(l),s.appendChild(d);var c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("fill",f.prototype.color.font||"#333"),s.appendChild(c);var h=(o[0]+a[0])/2,p=(o[1]+a[1])/2;return c.setAttribute("text-anchor","middle"),c.setAttribute("x",h),c.setAttribute("y",p),c.style.cursor="text",s.style.cursor="pointer",s},calcStartEnd:function(t,e){var a,o,i,r,s=t.left,n=t.left+t.width,l=e.left,d=e.left+e.width;s>=d?(a=s,i=d):n<=l?(a=n,i=l):s<=l&&n>=l&&n<=d?(a=(n+l)/2,i=a):s>=l&&n<=d?(a=(s+n)/2,i=a):l>=s&&d<=n?(a=(l+d)/2,i=a):s<=d&&n>=d&&(a=(s+d)/2,i=a);var c=t.top,h=t.top+t.height,p=e.top,m=e.top+e.height;return c>=m?(o=c,r=m):h<=p?(o=h,r=p):c<=p&&h>=p&&h<=m?(o=(h+p)/2,r=o):c>=p&&h<=m?(o=(c+h)/2,r=o):p>=c&&m<=h?(o=(p+m)/2,r=o):c<=m&&h>=m&&(o=(c+m)/2,r=o),{start:[a,o],end:[i,r]}},calcPolyPoints:function(t,e,a,o){var i={x:t.left+t.width/2,y:t.top+t.height/2},r={x:e.left+e.width/2,y:e.top+e.height/2},s=[],n=[],l=[],d=[];return s=[i.x,i.y],d=[r.x,r.y],"lr"==a?(n=[o,i.y],l=[o,r.y],n[0]>t.left&&n[0]<t.left+t.width?(n[1]=i.y>r.y?t.top:t.top+t.height,s[0]=n[0],s[1]=n[1]):s[0]=n[0]<t.left?t.left:t.left+t.width,l[0]>e.left&&l[0]<e.left+e.width?(l[1]=i.y>r.y?e.top+e.height:e.top,d[0]=l[0],d[1]=l[1]):d[0]=l[0]<e.left?e.left:e.left+e.width):"tb"==a&&(n=[i.x,o],l=[r.x,o],n[1]>t.top&&n[1]<t.top+t.height?(n[0]=i.x>r.x?t.left:t.left+t.width,s[0]=n[0],s[1]=n[1]):s[1]=n[1]<t.top?t.top:t.top+t.height,l[1]>e.top&&l[1]<e.top+e.height?(l[0]=i.x>r.x?e.left+e.width:e.left,d[0]=l[0],d[1]=l[1]):d[1]=l[1]<e.top?e.top:e.top+e.height),{start:s,m1:n,m2:l,end:d}},getMValue:function(t,e,a){return"lr"==a?(t.left+t.width/2+e.left+e.width/2)/2:"tb"==a?(t.top+t.height/2+e.top+e.height/2)/2:void 0},addLineDom:function(t,e,a){var o,i=this.$nodeData[e.from],r=this.$nodeData[e.to];if(i&&r&&(o=e.type&&"sl"!=e.type?f.prototype.calcPolyPoints(i,r,e.type,e.M):f.prototype.calcStartEnd(i,r),o))if("sl"==e.type?this.$lineDom[t]=f.prototype.drawLine(t,o.start,o.end,e.marked,null,a):this.$lineDom[t]=f.prototype.drawPoly(t,o.start,o.m1,o.m2,o.end,e.marked),this.$draw.appendChild(this.$lineDom[t]),this.$lineDom[t].childNodes[1].innerHTML=e.name,"sl"!=e.type){var s=o.start[0]>o.end[0]?o.end[0]:o.start[0];s>o.m2[0]&&(s=o.m2[0]),s>o.m1[0]&&(s=o.m1[0]),this.$lineDom[t].childNodes[1].style.left=(o.m2[0]+o.m1[0])/2-s-this.$lineDom[t].childNodes[1].offsetWidth/2+4,s=o.start[1]>o.end[1]?o.end[1]:o.start[1],s>o.m2[1]&&(s=o.m2[1]),s>o.m1[1]&&(s=o.m1[1]),this.$lineDom[t].childNodes[1].style.top=(o.m2[1]+o.m1[1])/2-s-this.$lineDom[t].childNodes[1].offsetHeight/2}else this.$lineDom[t].childNodes[1].style.left=((o.end[0]-o.start[0])*(o.end[0]>o.start[0]?1:-1)-this.$lineDom[t].childNodes[1].offsetWidth)/2+4},addLine:function(t,e){if((null==this.onItemAdd||this.onItemAdd(t,"line",e))&&(this.$undoStack&&this.$editable&&this.pushOper("delLine",[t]),e.from!=e.to)){var a=this.$nodeData[e.from],o=this.$nodeData[e.to];if(a&&o){for(var i in this.$lineData)if(e.from==this.$lineData[i].from&&e.to==this.$lineData[i].to)return;this.$lineData[t]={},e.type?(this.$lineData[t].type=e.type,this.$lineData[t].M=e.M):this.$lineData[t].type="sl",this.$lineData[t].from=e.from,this.$lineData[t].to=e.to,this.$lineData[t].name=e.name,this.$lineData[t].conditions=e.conditions,e.marked?this.$lineData[t].marked=e.marked:this.$lineData[t].marked=!1,this.addLineDom(t,this.$lineData[t],e.conditions),++this.$lineCount,this.$editable&&(this.$lineData[t].alt=!0,this.$deletedItem[t]&&delete this.$deletedItem[t])}}},resetLines:function(t,e){for(var a in this.$lineData){var o,i=null;if(this.$lineData[a].from==t){if(i=this.$nodeData[this.$lineData[a].to]||null,null==i)continue;if(o="sl"==this.$lineData[a].type?f.prototype.calcStartEnd(e,i):f.prototype.calcPolyPoints(e,i,this.$lineData[a].type,this.$lineData[a].M),!o)break}else if(this.$lineData[a].to==t){if(i=this.$nodeData[this.$lineData[a].from]||null,null==i)continue;if(o="sl"==this.$lineData[a].type?f.prototype.calcStartEnd(i,e):f.prototype.calcPolyPoints(i,e,this.$lineData[a].type,this.$lineData[a].M),!o)break}if(null!=i)if(this.$draw.removeChild(this.$lineDom[a]),"sl"==this.$lineData[a].type?this.$lineDom[a]=f.prototype.drawLine(a,o.start,o.end,this.$lineData[a].marked,null,this.$lineData[a].conditions):this.$lineDom[a]=f.prototype.drawPoly(a,o.start,o.m1,o.m2,o.end,this.$lineData[a].marked),this.$draw.appendChild(this.$lineDom[a]),this.$lineDom[a].childNodes[1].innerHTML=this.$lineData[a].name,"sl"!=this.$lineData[a].type){var r=o.start[0]>o.end[0]?o.end[0]:o.start[0];r>o.m2[0]&&(r=o.m2[0]),r>o.m1[0]&&(r=o.m1[0]),this.$lineDom[a].childNodes[1].style.left=(o.m2[0]+o.m1[0])/2-r-this.$lineDom[a].childNodes[1].offsetWidth/2+4,r=o.start[1]>o.end[1]?o.end[1]:o.start[1],r>o.m2[1]&&(r=o.m2[1]),r>o.m1[1]&&(r=o.m1[1]),this.$lineDom[a].childNodes[1].style.top=(o.m2[1]+o.m1[1])/2-r-this.$lineDom[a].childNodes[1].offsetHeight/2-4}else this.$lineDom[a].childNodes[1].style.left=((o.end[0]-o.start[0])*(o.end[0]>o.start[0]?1:-1)-this.$lineDom[a].childNodes[1].offsetWidth)/2+4}},setLineType:function(t,e,a){if(!e||null==e||""==e||e==this.$lineData[t].type)return!1;if(null==this.onLineSetType||this.onLineSetType(t,e)){if(this.$undoStack){var o=[t,this.$lineData[t].type,this.$lineData[t].M];this.pushOper("setLineType",o)}var i=this.$lineData[t].from,r=this.$lineData[t].to;if(this.$lineData[t].type=e,"sl"!=e){var s=f.prototype.calcPolyPoints(this.$nodeData[i],this.$nodeData[r],this.$lineData[t].type,this.$lineData[t].M);a?this.setLineM(t,a,!0):this.setLineM(t,this.getMValue(this.$nodeData[i],this.$nodeData[r],e),!0)}else{if(delete this.$lineData[t].M,this.$lineMove.hide().removeData("type").removeData("tid"),s=f.prototype.calcStartEnd(this.$nodeData[i],this.$nodeData[r]),!s)return;this.$draw.removeChild(this.$lineDom[t]),this.$lineDom[t]=f.prototype.drawLine(t,s.start,s.end,this.$lineData[t].marked||this.$focus==t),this.$draw.appendChild(this.$lineDom[t]),this.$lineDom[t].childNodes[1].innerHTML=this.$lineData[t].name,this.$lineDom[t].childNodes[1].style.left=((s.end[0]-s.start[0])*(s.end[0]>s.start[0]?1:-1)-this.$lineDom[t].childNodes[1].offsetWidth)/2+4}this.$focus==t&&this.focusItem(t),this.$editable&&(this.$lineData[t].alt=!0)}},setLineM:function(t,e,a){if(!this.$lineData[t]||e<0||!this.$lineData[t].type||"sl"==this.$lineData[t].type)return!1;if(null!=this.onLineMove&&!this.onLineMove(t,e))return!1;if(this.$undoStack&&!a){var o=[t,this.$lineData[t].M];this.pushOper("setLineM",o)}var i=this.$lineData[t].from,r=this.$lineData[t].to;this.$lineData[t].M=e;var s=f.prototype.calcPolyPoints(this.$nodeData[i],this.$nodeData[r],this.$lineData[t].type,this.$lineData[t].M);this.$draw.removeChild(this.$lineDom[t]),this.$lineDom[t]=f.prototype.drawPoly(t,s.start,s.m1,s.m2,s.end,this.$lineData[t].marked||this.$focus==t),this.$draw.appendChild(this.$lineDom[t]),this.$lineDom[t].childNodes[1].innerHTML=this.$lineData[t].name;var n=s.start[0]>s.end[0]?s.end[0]:s.start[0];n>s.m2[0]&&(n=s.m2[0]),n>s.m1[0]&&(n=s.m1[0]),this.$lineDom[t].childNodes[1].style.left=(s.m2[0]+s.m1[0])/2-n-this.$lineDom[t].childNodes[1].offsetWidth/2+4,n=s.start[1]>s.end[1]?s.end[1]:s.start[1],n>s.m2[1]&&(n=s.m2[1]),n>s.m1[1]&&(n=s.m1[1]),this.$lineDom[t].childNodes[1].style.top=(s.m2[1]+s.m1[1])/2-n-this.$lineDom[t].childNodes[1].offsetHeight/2-4,this.$editable&&(this.$lineData[t].alt=!0)},delLine:function(t){if(this.$lineData[t]&&(null==this.onItemDel||this.onItemDel(t,"node"))){if(this.$undoStack){var e=[t,this.$lineData[t]];this.pushOper("addLine",e)}this.$draw.removeChild(this.$lineDom[t]),delete this.$lineData[t],delete this.$lineDom[t],console.log(this.$lineData),this.$focus==t&&(this.$focus=""),--this.$lineCount,this.$editable&&(t.indexOf(this.$id+"_line_")<0&&(this.$deletedItem[t]="line"),this.$mpFrom.hide().removeData("p"),this.$mpTo.hide().removeData("p")),this.$lineOper.hide().removeData("tid")}},moveLinePoints:function(t,e,a,o){if(e!=a&&t&&this.$lineData[t]){for(var i in null!=e&&""!=e||(e=this.$lineData[t].from),null!=a&&""!=a||(a=this.$lineData[t].to),this.$lineData)if(e==this.$lineData[i].from&&a==this.$lineData[i].to)return;if(null==this.onLinePointMove||this.onLinePointMove(id,e,a)){if(this.$undoStack&&!o){var r=[t,this.$lineData[t].from,this.$lineData[t].to];this.pushOper("moveLinePoints",r)}null!=e&&""!=e&&(this.$lineData[t].from=e),null!=a&&""!=a&&(this.$lineData[t].to=a),this.$draw.removeChild(this.$lineDom[t]),this.addLineDom(t,this.$lineData[t]),this.$editable&&(this.$lineData[t].alt=!0)}}},markItem:function(t,e,a){if("node"==e){if(!this.$nodeData[t])return;if(null!=this.onItemMark&&!this.onItemMark(t,"node",a))return;this.$nodeData[t].marked=a||!1,a?(this.$nodeDom[t].addClass("item_mark"),jq.css("border-color",f.prototype.color.mark)):(this.$nodeDom[t].removeClass("item_mark"),t!=this.$focus&&jq.css("border-color","transparent"))}else if("line"==e){if(!this.$lineData[t])return;if(null!=this.onItemMark&&!this.onItemMark(t,"line",a))return;this.$lineData[t].marked=a||!1,a?(this.$nodeDom[t].childNodes[1].setAttribute("stroke",f.prototype.color.mark||"#ff3300"),this.$nodeDom[t].childNodes[1].setAttribute("marker-end","url(#arrow2)")):(this.$nodeDom[t].childNodes[1].setAttribute("stroke",f.prototype.color.line||"#3892D3"),this.$nodeDom[t].childNodes[1].setAttribute("marker-end","url(#arrow1)"))}if(this.$undoStatck){var o=[t,e,!a];this.pushOper("markItem",o)}},moveArea:function(t,e,a){if(this.$areaData[t]&&(null==this.onItemMove||this.onItemMove(t,"area",e,a))){if(this.$undoStack){var o=[t,this.$areaData[t].left,this.$areaData[t].top];this.pushOper("moveNode",o)}e<0&&(e=0),a<0&&(a=0),$("#"+t).css({left:e+"px",top:a+"px"}),this.$areaData[t].left=e,this.$areaData[t].top=a,this.$editable&&(this.$areaData[t].alt=!0)}},delArea:function(t){if(this.$areaData[t]){if(this.$undoStack){var e=[t,this.$areaData[t]];this.pushOper("addArea",e)}(null==this.onItemDel||this.onItemDel(t,"node"))&&(delete this.$areaData[t],this.$areaDom[t].remove(),delete this.$areaDom[t],--this.$areaCount,this.$editable&&t.indexOf(this.$id+"_area_")<0&&(this.$deletedItem[t]="area"))}},setAreaColor:function(t,e){if(this.$areaData[t]){if(this.$undoStack){var a=[t,this.$areaData[t].color];this.pushOper("setAreaColor",a)}"red"!=e&&"yellow"!=e&&"blue"!=e&&"green"!=e||(this.$areaDom[t].removeClass("area_"+this.$areaData[t].color).addClass("area_"+e),this.$areaData[t].color=e),this.$editable&&(this.$areaData[t].alt=!0)}},resizeArea:function(t,e,a){if(this.$areaData[t]&&(null==this.onItemResize||this.onItemResize(t,"area",e,a))){if(this.$undoStack){var o=[t,this.$areaData[t].width,this.$areaData[t].height];this.pushOper("resizeArea",o)}this.$areaDom[t].children(".bg").css({width:e-2+"px",height:a-2+"px"}),e=this.$areaDom[t].outerWidth(),a=this.$areaDom[t].outerHeight(),this.$areaDom[t].children("bg").css({width:e-2+"px",height:a-2+"px"}),this.$areaData[t].width=e,this.$areaData[t].height=a,this.$editable&&(this.$areaData[t].alt=!0)}},addArea:function(t,e){(null==this.onItemAdd||this.onItemAdd(t,"area",e))&&(this.$undoStack&&this.$editable&&this.pushOper("delArea",[t]),this.$areaDom[t]=$("<div id='"+t+"' class='GooFlow_area area_"+e.color+"' style='top:"+e.top+"px;left:"+e.left+"px'><div class='bg' style='width:"+(e.width-2)+"px;height:"+(e.height-2)+"px'></div><label>"+e.name+"</label><i></i><div><div class='rs_bottom'></div><div class='rs_right'></div><div class='rs_rb'></div><div class='rs_close'></div></div></div>"),this.$areaData[t]=e,this.$group.append(this.$areaDom[t]),"group"!=this.$nowType&&this.$areaDom[t].children("div:eq(1)").css("display","none"),++this.$areaCount,this.$editable&&(this.$areaData[t].alt=!0,this.$deletedItem[t]&&delete this.$deletedItem[t]))}},f.prototype.color={};var v=f,D={props:["row"],data:function(){return{ivrParams:this.row,ivrList:[],leftWith:0,demo:null,voiceList:[],saveAble:!1,isTag:!1,parameterList:[],JsonFromData:{title:"newFlow_1",nodes:{demo_node_2:{name:"开始",type:"start",width:100,height:24,left:449,top:85,childnum:1,noDel:!0}},lines:{},areas:{},initNum:3},formData:{},fromTitle:"",formModal:!1,showModal:"",rMap:{start:{name:"开始",type:"start",width:100,height:30,left:449,top:85,childnum:1,noDel:!0},direct:{name:"",conditions:"",state:0},voiceplay:{name:"播报语音",parentNum:1,childnum:10,actcellid:11,actname:"",voicetype:0,voiceid:"",ttstext:"",parametertype:1,parameter:"",saveflag:1,playType:2,maxdtmf:3,enddtmf:"#",alldtmftimer:30,twodtmftimer:10,saveparam:""},menuplay:{name:"播报菜单",parentNum:1,childnum:10,actcellid:12,actname:"",voicetype:0,voiceid:"",ttstext:"",parametertype:1,parameter:"",maxdtmf:1,alldtmftimer:30,menuselect:"1,2"},agent:{name:"转坐席组",parentNum:1,childnum:0,actcellid:3,actname:"",parametertype:0,parameter:"",saveflag:1,saveparam:""},extension:{name:"转分机",parentNum:1,childnum:10,actcellid:7,actname:"",parametertype:0,parameter:"",saveflag:1,saveparam:""},return:{name:"跳转",parentNum:1,childnum:10,actcellid:4,actname:"",parametertype:0,parameter:"",ivrId:""},holdon:{name:"挂机",parentNum:1,childnum:0,actcellid:5,actname:""},stopPlay:{name:"停止放音",parentNum:1,childnum:10,actcellid:29,actname:""},think:{name:"大小判断",parentNum:1,childnum:10,actcellid:13,actname:"",parametertype:10,parameter:"",menuselect:"123"},variable:{name:"变量运算",parentNum:1,childnum:10,actcellid:14,actname:"",parameter:""},httpdata:{name:"http访问",parentNum:1,childnum:10,actcellid:15,actname:"",parametertype:0,parameter:"",saveparam:""},sendDTMF:{name:"发送dtmf",parentNum:1,childnum:10,actcellid:16,actname:"",parametertype:0,parameter:"",maxtimer:null},record:{name:"录音",parentNum:1,childnum:10,actcellid:17,actname:"",saveflag:1,maxdtmf:null,enddtmf:"#",maxtimer:null,saveparam:""},sqldata:{name:"数据库访问",parentNum:1,childnum:10,actcellid:20,actname:"",parametertype:0,parameter:"",saveflag:1,saveparam:""},call:{name:"发起呼叫",parentNum:1,childnum:10,actcellid:21,actname:"",parameter:""},boole:{name:"布尔判断",parentNum:1,childnum:10,actcellid:22,actname:"",parametertype:10,parameter:"",menuselect:"01"},receive:{name:"接收dtmf",parentNum:1,childnum:10,actcellid:23,actname:"",saveflag:1,maxdtmf:null,enddtmf:"#",twodtmftimer:10,maxtimer:null,saveparam:""},listvalue:{name:"取db或http数据",parentNum:1,childnum:10,actcellid:24,actname:"",parameter:""},nav:{name:"智能导航",parentNum:1,childnum:10,actcellid:25,actname:"",voicetype:"",parametertype:2,saveflag:1,maxdtmf:2,menuselect:"",saveparam:""},contain:{name:"子串判断",parentNum:1,childnum:10,actcellid:26,actname:"",ttstext:"",parametertype:1,parameter:"",saveflag:1,saveparam:""},queue:{name:"预排队",parentNum:1,childnum:10,actcellid:27,actname:"",ttstext:"",parametertype:1,parameter:"",saveflag:1,saveparam:"",menuselect:0}}}},mounted:function(){this.getIvrVoice(),this.ivrinnit()},methods:{hasProp:function(t){return this.formData.hasOwnProperty(t)},changePlayType:function(t){this.formData.maxdtmf=1===t?0:3,this.formData.alldtmftimer=30,this.formData.twodtmftimer=10,this.formData.enddtmf="#"},onClearIVR:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$confirm("你确认要清除IVR流程么？","温馨提醒");case 2:t.demo.clearData(),t.JsonFromData={title:"newFlow_1",nodes:{demo_node_2:{name:"开始",type:"start",width:100,height:24,left:449,top:85,childnum:1,noDel:!0}},lines:{},areas:{},initNum:3};case 4:case"end":return e.stop()}}),e)})))()},onClose:function(){var t=this,e=Object.keys(this.JsonFromData.nodes).length,a=Object.keys(this.JsonFromData.lines).length;Object.keys(this.JsonFromData.nodes).forEach((function(e){t.JsonFromData.nodes[e].name=t.rMap[t.JsonFromData.nodes[e].type].name})),this.JsonFromData.initNum=e+a+2,this.$post("/pm/cti/rootflow/actionsave",{id:this.ivrParams.id,rootactid:this.ivrParams.rootactid,data:JSON.stringify(this.JsonFromData)}).finally((function(){t.$emit("close-ivr")}))},beforeClose:function(){var t=this,e=this.demo.$focus;if(e&&"node"===e.split("_")[1]){this.JsonFromData.nodes[e]=Object(n["a"])(Object(n["a"])(Object(n["a"])({},this.JsonFromData.nodes[e]),this.demo.$nodeData[e]),{},{name:this.rMap[this.JsonFromData.nodes[e].type].name});var a={data:JSON.stringify(this.JsonFromData.nodes[e]),rootactid:this.ivrParams.rootactid};this.$post("/pm/cti/action/update",a).finally((function(){t.onClose()}))}else this.onClose()},getIvrVoice:function(){var t=this;this.$post("/pm/cti/voice/search",{entId:this.ivrParams.entid}).then((function(e){var a=e.data;t.voiceList=a}))},onReload:function(){var t=this;this.$openModal((function(){return a.e("chunk-2d0b1fca").then(a.bind(null,"21d9"))}),{entId:this.ivrParams.entid},{success:function(){t.demo.destrory(),t.ivrinnit()}})},restFormdata:function(){this.formModal=!1},saveForm:function(){var t=this,e=this.formData.nodekey||this.formData.linekey,a=e.split("_")[1],o={data:JSON.stringify(Object(n["a"])(Object(n["a"])({},this.formData),{},{name:"line"===a?"连接指针":this.formData.name.split(" ")[0]})),rootactid:this.ivrParams.rootactid};this.saveAble=!0,"node"===a?this.$post("/pm/cti/action/update",o).then((function(){var a=Object(n["a"])({},t.demo.$nodeData[e]);t.demo.$nodeData[e]=Object(n["a"])(Object(n["a"])({},a),t.formData),t.JsonFromData.nodes[e]=Object(n["a"])(Object(n["a"])(Object(n["a"])({},t.JsonFromData.nodes[e]),a),t.formData),t.formModal=!1})).finally((function(){t.saveAble=!1})):this.$post("/pm/cti/flow/update",o).then((function(){t.demo.setName(e,t.formData.conditions,a);var o=Object(n["a"])({},t.demo.$lineData[e]);t.demo.$lineData[e]=Object(n["a"])(Object(n["a"])({},o),t.formData),t.JsonFromData.lines[e]=Object(n["a"])(Object(n["a"])(Object(n["a"])({},t.JsonFromData.lines[e]),o),t.formData),t.formModal=!1})).finally((function(){t.saveAble=!1}))},ivrinnit:function(){var t=this,e={width:1e3,height:600,toolBtns:["cursor","direct","voiceplay","menuplay","agent","extension","sqldata","httpdata","listvalue","return","think","variable","boole","call","holdon","stopPlay","sendDTMF","receive","record","nav","contain","queue"],haveHead:!0,headBtns:["reload"],haveTool:!0,haveGroup:!0,useOperStack:!0},a={cursor:"移动指针",direct:"连线指针",voiceplay:"播报语音",menuplay:"播报菜单",agent:"转坐席组",extension:"转分机",sqldata:"数据库访问",httpdata:"http访问",listvalue:"取db或http数据",return:"跳转",think:"大小判断",variable:"变量运算",boole:"布尔判断",call:"发起呼叫",holdon:"挂机",stopPlay:"停止放音",sendDTMF:"发送dtmf",receive:"接收dtmf",record:"录音",nav:"智能导航",contain:"子串判断",queue:"预排队"};e.width=window.$(".IVRModal").width()+15,e.height=window.$(".IVRModal").height()-52,this.leftWith=e.width;var o=null,i=this;o=new v(window.$("#demo"),e,a,this.rMap,this.ivrParams,this),this.demo=o,this.$post("/pm/cti/rootflow/ivrsearch",{id:this.ivrParams.id}).then((function(e){var a=e.data;t.JsonFromData=JSON.parse(a.ivrjson),o.loadData(t.JsonFromData,t.ivrParams.rootactid),o.onItemAdd=function(t,e,a){if("line"===e){var r=o.$nodeData[a.from],s=i.rMap[r.type].childnum;if(0===s||!i.valiNodeFTNum(a.from,s,"from"))return i.$message.warning({content:"【"+r.name+"】类型结点只允许存在"+s+"个子结点！",duration:3}),!1;var l=o.$nodeData[a.to],d=i.rMap[l.type].parentNum;if(0===d||!i.valiNodeFTNum(a.to,d,"to"))return i.$message.warning({content:"【"+l.name+"】类型结点只允许存在"+d+"个父结点！",duration:3}),!1;if("start"===l.type)return i.$message.warning({content:"开始结点不允许存在父结点！",duration:3}),!1;if(a.from===a.to)return!1;a.linekey=t,a.fromid=r.id?r.id:i.ivrParams.rootactid,a.toid=l.id,a.state=0,a.conditions="",a.name="",i.$post("/pm/cti/flow/linesave",{data:JSON.stringify(a),rootactid:i.ivrParams.rootactid}).finally((function(){i.JsonFromData.lines[t]=Object(n["a"])(Object(n["a"])({},a),i.rMap.direct)}))}else{var c=Object(n["a"])(Object(n["a"])({},a),i.rMap[a.type]);i.JsonFromData.nodes[t]=c}return!0},window.$("#demo").click((function(t){"TD"!==t.target.tagName&&"path"!==t.target.tagName||i.isTag?i.isTag=!1:i.$message.warning({content:"切换选择节点，请先保存或者关闭当前弹框信息",duration:3})})),o.onItemFocus=function(t,e){if(i.isTag=!0,"start"!==i.getObj(t,e).type){if("node"===e){console.log("返回节点信息",i.JsonFromData.nodes[t]);var a=i.rMap[i.JsonFromData.nodes[t].type],o=i.JsonFromData.nodes[t];"return"===i.JsonFromData.nodes[t].type&&i.getIVR(i),i.formData=Object(n["a"])(Object(n["a"])(Object(n["a"])({},a),o),{},{name:a.name+" "+o.id}),"voiceplay"===i.JsonFromData.nodes[t].type&&(i.formData.playType=0===i.formData.maxdtmf?1:2)}else i.formData=Object(n["a"])({},i.JsonFromData.lines[t]);return i.fromTitle="node"===e?i.formData.name:"连接指针",i.showModal=i.formData.type,i.formModal=!0,i.$nextTick((function(){var t=window.$(".ivu-modal-content-drag")[0],e=window.innerWidth||document.body.clientWidth,a=t.style.top?40:40-t.getBoundingClientRect().top,o=t.style.left?e-450:t.getBoundingClientRect().left-30;t.style.left&&(t.parentNode.style.width="auto",t.parentNode.style.top="0px"),t.style.top=a+"px",t.style.left=o+"px"})),!0}},o.onItemBlur=function(t,e){if(!i.formModal){if("node"===e){i.JsonFromData.nodes[t]=Object(n["a"])(Object(n["a"])(Object(n["a"])({},i.JsonFromData.nodes[t]),i.demo.$nodeData[t]),{},{name:i.rMap[i.JsonFromData.nodes[t].type].name});var a={data:JSON.stringify(i.JsonFromData.nodes[t]),rootactid:i.ivrParams.rootactid};i.$post("/pm/cti/action/update",a)}return!0}},o.onItemDel=function(t,e){var a=t.split("_")[1];return"node"===a&&i.getObj(t,e)&&"start"===i.getObj(t,e).type?(i.$message.warning("开始节点不能删除"),!1):("node"===a?(i.$post("/pm/cti/action/del",{actId:i.JsonFromData.nodes[t].id,rootactid:i.ivrParams.rootactid}).finally((function(){})),delete i.JsonFromData.nodes[t]):(i.$post("/pm/cti/flow/del",{data:JSON.stringify(i.JsonFromData.lines[t]),rootactid:i.ivrParams.rootactid}).finally((function(){})),delete i.JsonFromData.lines[t]),i.formModal=!1,!0)}}))},getObj:function(t,e){return"node"===e?this.demo.$nodeData[t]:this.demo.$lineData[t]},onVerify:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,o,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=Object.keys(t.JsonFromData.nodes).length,o=Object.keys(t.JsonFromData.lines).length,i=[],1!==a||0===o){e.next=7;break}return e.next=6,t.$confirm("只有一个流程节点时,连线的条数为0，你还要保存IVR流程么？","IVR流程异常提示");case 6:return e.abrupt("return",t.saveIVRForm(a,o));case 7:if(!(a>1&&0===o)){e.next=11;break}return e.next=10,t.$confirm("连线异常,请添加连线的条数，你还要保存IVR流程么？","IVR流程异常提示");case 10:return e.abrupt("return",t.saveIVRForm(a,o));case 11:if(!(a>1&&o>0)){e.next=18;break}if(r=t.JsonFromData.lines,Object.keys(t.JsonFromData.lines).forEach((function(t){i.push(r[t].to)})),1+Array.from(new Set(i)).length===a){e.next=18;break}return e.next=17,t.$confirm("IVR流程设置不合理，你还要保存IVR流程么？","IVR流程异常提示");case 17:return e.abrupt("return",t.saveIVRForm(a,o));case 18:t.saveIVRForm(a,o);case 19:case"end":return e.stop()}}),e)})))()},saveIVRForm:function(t,e){var a=this;Object.keys(this.JsonFromData.nodes).forEach((function(t){a.JsonFromData.nodes[t].name=a.rMap[a.JsonFromData.nodes[t].type].name})),this.JsonFromData.initNum=t+e+2,this.$post("/pm/cti/rootflow/actionsave",{id:this.ivrParams.id,rootactid:this.ivrParams.rootactid,data:JSON.stringify(this.JsonFromData)}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.$confirm("IVR流程保存成功，你要关闭IVR流程么？","温馨提示提示");case 2:a.$emit("close-ivr");case 3:case"end":return t.stop()}}),t)}))))},valiNodeFTNum:function(t,e,a){var o=0;return window.$.each(this.demo.$lineData,(function(e,i){t===i[a]&&++o})),o<e},getIVR:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var o,i,r,s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.ivrList=[],a.next=3,t.$post("/pm/cti/rootflow/searchNoPage");case 3:if(o=a.sent,i=o.data,t.ivrList=i,r=t.formData.parameter,!r){a.next=15;break}return a.next=10,t.$http("/pm/cti/rootflow/nodeProcess?parameter=".concat(r,"&rootactid=").concat(t.ivrParams.rootactid));case 10:s=a.sent,n=s.data,n.length?t.formData.ivrId=n[0].id:(t.formData.ivrId=t.ivrParams.id,t.$set(e.formData,"parameter","")),a.next=16;break;case 15:t.formData.ivrId=t.ivrParams.id;case 16:t.getIVRNodes(t.formData.ivrId,t);case 17:case"end":return a.stop()}}),a)})))()},changeIVR:function(t){this.$set(this.formData,"parameter",""),this.getIVRNodes(t,this)},getIVRNodes:function(t,e){return Object(r["a"])(regeneratorRuntime.mark((function a(){var o,i,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$post("/pm/cti/rootflow/ivrsearch",{id:t});case 2:o=a.sent,i=o.data,r=JSON.parse(i.ivrjson).nodes,s=[],Object.keys(r).forEach((function(t){var a=r[t].type;"return"!==a&&"start"!==a&&s.push({label:e.rMap[a].name+" "+r[t].id,value:r[t].id+""})})),e.parameterList=s;case 8:case"end":return a.stop()}}),a)})))()}}},b=D,w=(a("9d14"),a("7f57"),a("2877")),y=Object(w["a"])(b,d,c,!1,null,"70376626",null),x=y.exports,g={name:"IVRManagement",mixins:[window.mixTableView],components:{ivrModal:x},data:function(){return{ivrParams:{},modalIvrFlow:!1,flowDate:"",columns:[{title:"编号",minWidth:80,key:"id"},{title:"流程名称",key:"flowname"},{title:"中继字冠",minWidth:80,key:"trunkno"},{title:"流程引导码",key:"hotlineno"},{title:"优先级",minWidth:80,key:"priority"},{title:"每周执行时段",minWidth:105,render:function(t,e){var a=e.row;return t("div",a.weekstart+"~"+a.weekend)}},{title:"每天执行时段",minWidth:125,render:function(t,e){var a=e.row;return t("div",a.weekstarttime+"~"+a.weekendtime)}},{title:"流程执行时限",minWidth:155,render:function(t,e){var a=e.row;return t("div",a.startdate.slice(0,10)+"~"+a.enddate.slice(0,10))}},{title:"操作",width:225,fixed:"right",render:this.$hBtns([{label:"重载",action:this.onReload},{label:"编辑",action:this.onEdit},{label:"导出",action:this.onExport},{label:"上传",action:this.onUpload},{label:"流程",action:this.onFlow},{label:"删除",action:this.onDelete}])}]}},computed:{isSuper:function(){return this.$store.getters.isAdmin}},mounted:function(){this.setInitForm(),this.getData(),Object(l["g"])(this,this.getData)},methods:{setInitForm:function(){this.tableForm={entId:this.$store.state.userData.entid},this.searchForm=Object(n["a"])({},this.tableForm)},fetchMethod:function(t){return this.$post("/pm/cti/rootflow/search",t).then((function(t){var e=t.data;return e}))},onDelete:function(t){var e=this;this.delData({action:function(){return e.$post("/pm/cti/rootflow/del",{ids:t.id})}})},onDateChange:function(t){var e=t||[],a=Object(s["a"])(e,2),o=a[0],i=a[1];this.searchForm=Object(n["a"])(Object(n["a"])({},this.searchForm),{},{beginDate:o,endDate:i}),this.onSearch()},onReload:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http("/pm/cti/rootflow/notice");case 2:t.$message.success("重载成功");case 3:case"end":return e.stop()}}),e)})))()},onEdit:function(t){var e=this.searchForm.entId;this.$openModal((function(){return a.e("chunk-1ebd262e").then(a.bind(null,"224f"))}),{row:t,entId:e},{success:this.onEditSuccess})},onExport:function(t){var e=this;Object(l["i"])({fileName:"ivr流程数据导出.json",action:function(){return e.$http("/pm/cti/rootflow/download",{params:{id:t.id,entId:t.entid},responseType:"blob"})}})},onFlow:function(t){this.ivrParams=t,this.modalIvrFlow=!0},onFileChange:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var o,i,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=t.target,i=o.files[0],!i.name.endsWith(".json")){a.next=13;break}return r=o.row,s=new FormData,s.append("file",i),s.append("entid",r.entid),s.append("rootactid",r.rootactid),a.next=10,e.$http.post("/pm/cti/rootflow/upload",s);case 10:e.$message.success("流程上传成功"),a.next=14;break;case 13:e.$message.error("请选择.json的文件");case 14:case"end":return a.stop()}}),a)})))()},onUpload:function(t){var e=this.$refs.File;e.row=t,e.click()}}},k=g,I=Object(w["a"])(k,o,i,!1,null,null,null);e["default"]=I.exports},"4fad":function(t,e,a){var o=a("d039"),i=a("861d"),r=a("c6b6"),s=a("d86b"),n=Object.isExtensible,l=o((function(){n(1)}));t.exports=l||s?function(t){return!!i(t)&&((!s||"ArrayBuffer"!=r(t))&&(!n||n(t)))}:n},"50a5":function(t,e,a){},6062:function(t,e,a){"use strict";var o=a("6d61"),i=a("6566");o("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),i)},6566:function(t,e,a){"use strict";var o=a("9bf2").f,i=a("7c73"),r=a("e2cc"),s=a("0366"),n=a("19aa"),l=a("2266"),d=a("7dd0"),c=a("2626"),h=a("83ab"),p=a("f183").fastKey,m=a("69f3"),u=m.set,f=m.getterFor;t.exports={getConstructor:function(t,e,a,d){var c=t((function(t,o){n(t,m),u(t,{type:e,index:i(null),first:void 0,last:void 0,size:0}),h||(t.size=0),void 0!=o&&l(o,t[d],{that:t,AS_ENTRIES:a})})),m=c.prototype,$=f(e),v=function(t,e,a){var o,i,r=$(t),s=D(t,e);return s?s.value=a:(r.last=s={index:i=p(e,!0),key:e,value:a,previous:o=r.last,next:void 0,removed:!1},r.first||(r.first=s),o&&(o.next=s),h?r.size++:t.size++,"F"!==i&&(r.index[i]=s)),t},D=function(t,e){var a,o=$(t),i=p(e);if("F"!==i)return o.index[i];for(a=o.first;a;a=a.next)if(a.key==e)return a};return r(m,{clear:function(){var t=this,e=$(t),a=e.index,o=e.first;while(o)o.removed=!0,o.previous&&(o.previous=o.previous.next=void 0),delete a[o.index],o=o.next;e.first=e.last=void 0,h?e.size=0:t.size=0},delete:function(t){var e=this,a=$(e),o=D(e,t);if(o){var i=o.next,r=o.previous;delete a.index[o.index],o.removed=!0,r&&(r.next=i),i&&(i.previous=r),a.first==o&&(a.first=i),a.last==o&&(a.last=r),h?a.size--:e.size--}return!!o},forEach:function(t){var e,a=$(this),o=s(t,arguments.length>1?arguments[1]:void 0);while(e=e?e.next:a.first){o(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!D(this,t)}}),r(m,a?{get:function(t){var e=D(this,t);return e&&e.value},set:function(t,e){return v(this,0===t?0:t,e)}}:{add:function(t){return v(this,t=0===t?0:t,t)}}),h&&o(m,"size",{get:function(){return $(this).size}}),c},setStrong:function(t,e,a){var o=e+" Iterator",i=f(e),r=f(o);d(t,e,(function(t,e){u(this,{type:o,target:t,state:i(t),kind:e,last:void 0})}),(function(){var t=r(this),e=t.kind,a=t.last;while(a&&a.removed)a=a.previous;return t.target&&(t.last=a=a?a.next:t.state.first)?"keys"==e?{value:a.key,done:!1}:"values"==e?{value:a.value,done:!1}:{value:[a.key,a.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),a?"entries":"values",!a,!0),c(e)}}},"6d61":function(t,e,a){"use strict";var o=a("23e7"),i=a("da84"),r=a("e330"),s=a("94ca"),n=a("6eeb"),l=a("f183"),d=a("2266"),c=a("19aa"),h=a("1626"),p=a("861d"),m=a("d039"),u=a("1c7e"),f=a("d44e"),$=a("7156");t.exports=function(t,e,a){var v=-1!==t.indexOf("Map"),D=-1!==t.indexOf("Weak"),b=v?"set":"add",w=i[t],y=w&&w.prototype,x=w,g={},k=function(t){var e=r(y[t]);n(y,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(D&&!p(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return D&&!p(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(D&&!p(t))&&e(this,0===t?0:t)}:function(t,a){return e(this,0===t?0:t,a),this})},I=s(t,!h(w)||!(D||y.forEach&&!m((function(){(new w).entries().next()}))));if(I)x=a.getConstructor(e,t,v,b),l.enable();else if(s(t,!0)){var M=new x,_=M[b](D?{}:-0,1)!=M,A=m((function(){M.has(1)})),F=u((function(t){new w(t)})),N=!D&&m((function(){var t=new w,e=5;while(e--)t[b](e,e);return!t.has(-0)}));F||(x=e((function(t,e){c(t,y);var a=$(new w,t,x);return void 0!=e&&d(e,a[b],{that:a,AS_ENTRIES:v}),a})),x.prototype=y,y.constructor=x),(A||N)&&(k("delete"),k("has"),v&&k("get")),(N||_)&&k(b),D&&y.clear&&delete y.clear}return g[t]=x,o({global:!0,forced:x!=w},g),f(x,t),D||a.setStrong(x,t,v),x}},7156:function(t,e,a){var o=a("1626"),i=a("861d"),r=a("d2bb");t.exports=function(t,e,a){var s,n;return r&&o(s=e.constructor)&&s!==a&&i(n=s.prototype)&&n!==a.prototype&&r(t,n),t}},"7f57":function(t,e,a){"use strict";a("f875")},"9d14":function(t,e,a){"use strict";a("50a5")},bb2f:function(t,e,a){var o=a("d039");t.exports=!o((function(){return Object.isExtensible(Object.preventExtensions({}))}))},d86b:function(t,e,a){var o=a("d039");t.exports=o((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}}))},f183:function(t,e,a){var o=a("23e7"),i=a("e330"),r=a("d012"),s=a("861d"),n=a("1a2d"),l=a("9bf2").f,d=a("241c"),c=a("057f"),h=a("4fad"),p=a("90e3"),m=a("bb2f"),u=!1,f=p("meta"),$=0,v=function(t){l(t,f,{value:{objectID:"O"+$++,weakData:{}}})},D=function(t,e){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!n(t,f)){if(!h(t))return"F";if(!e)return"E";v(t)}return t[f].objectID},b=function(t,e){if(!n(t,f)){if(!h(t))return!0;if(!e)return!1;v(t)}return t[f].weakData},w=function(t){return m&&u&&h(t)&&!n(t,f)&&v(t),t},y=function(){x.enable=function(){},u=!0;var t=d.f,e=i([].splice),a={};a[f]=1,t(a).length&&(d.f=function(a){for(var o=t(a),i=0,r=o.length;i<r;i++)if(o[i]===f){e(o,i,1);break}return o},o({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:c.f}))},x=t.exports={enable:y,fastKey:D,getWeakData:b,onFreeze:w};r[f]=!0},f875:function(t,e,a){},fa65:function(t,e,a){"use strict";a.d(e,"e",(function(){return u})),a.d(e,"a",(function(){return f})),a.d(e,"d",(function(){return $})),a.d(e,"c",(function(){return v})),a.d(e,"b",(function(){return D}));a("d3b7"),a("b0c0");var o=a("4328"),i=a.n(o),r=a("bc3a"),s=a.n(r),n=a("5c96"),l=a("e5ac"),d=a("a02a"),c=a("60e2"),h=function(t){var e=t.statusCode,a=t.message,o=t.data,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&n["Message"].error(a||"发生未知异常");var r=new Error(a);return r.data=o,r.statusCode=e,Promise.reject(r)},p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c["a"],a=s.a.create();return a.defaults.baseURL=e,a.defaults.withCredentials=!0,t&&(a.defaults.transformRequest=[function(t){return i.a.stringify(t)}]),a.interceptors.request.use((function(t){var e=sessionStorage.getItem("token");return e&&!1!==t.isAuth&&(t.headers.Authorization=e),t})),a.interceptors.response.use((function(t){var e=t.data;return e instanceof Blob&&(e.name=Object(d["n"])(t.headers["content-disposition"])),"number"===typeof e.code?e.code?h({message:e.msg,data:e,statusCode:t.status}):e:!1!==e.ok?(Object(l["b"])(t.config.url)&&sessionStorage.setItem("token",t.headers.authorization||t.headers.Authorization),e):h({message:e.info,data:e,statusCode:t.status},"-20"!==e.code)}),(function(t){var e=t.response,a=e||{},o=a.data,i=a.status,r=e?o.info||t.message:"请求失败，请稍候重试";return 401===i?(sessionStorage.removeItem("token"),window.opener?window.close():(d["t"].close(),l["a"].dispatch("GO_LOGIN")),h({message:r,data:o,statusCode:i},!1)):h({message:r,data:o,statusCode:i})})),a},m=p(!0,c["b"]),u=p(),f=p(!0),$=function(){return f.post.apply(f,arguments)},v=p(!1,c["b"]),D=function(){return m.post.apply(m,arguments)}},fcda:function(t,e,a){}}]);