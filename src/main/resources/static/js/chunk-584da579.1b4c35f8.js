(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-584da579"],{"1ac4":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SckmMainLayout",{staticClass:"page-sckm-manage"},[a("SckmStructure",{attrs:{slot:"left",disabled:t.userType>2,data:t.treeData},slot:"left",model:{value:t.selectedNodeData,callback:function(e){t.selectedNodeData=e},expression:"selectedNodeData"}}),a("div",{staticClass:"tabs-wrap"},[a("el-tabs",{on:{"tab-click":function(e){return t.getData()}},model:{value:t.itemType,callback:function(e){t.itemType=e},expression:"itemType"}},[a("el-tab-pane",{attrs:{label:"卷",name:"0"}},[a("ComManage",t._b({ref:"Manage",attrs:{title:t.title,loading:t.loading},on:{"on-edit":t.handleEdit,"on-import":t.handleImport,"on-exportall":t.handleExportAll,"on-change":t.getData}},"ComManage",t.tableData[0],!1))],1),a("el-tab-pane",{attrs:{label:"电子档案",name:"1"}},[a("ComDraftbox",t._b({ref:"Draftbox",attrs:{title:t.title,loading:t.loading},on:{"on-edit":t.handleEdit,"on-change":t.getData}},"ComDraftbox",t.tableData[1],!1))],1)],1)],1)],1)},i=[],o=a("5530"),l=(a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("99af"),a("a02a")),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SckmDataTable",t._b({on:{"on-change":t.handleChange,"on-selection-change":t.handleSelectionChange}},"SckmDataTable",t.bindProps,!1),[a("el-button-group",{attrs:{slot:"actions"},slot:"actions"},[a("el-button",{attrs:{icon:"el-icon-plus"},on:{click:t.handleAdd}},[t._v("立卷")]),t.userType<3?a("el-button",{attrs:{icon:"el-icon-upload2"},on:{click:t.handleImport}},[t._v("取消立卷")]):t._e()],1),a("template",{slot:"toolbar"},[a("SckmTextButton",{attrs:{noBorder:""},on:{click:t.handleExport}},[t._v("导出")]),a("SckmTextButton",{on:{click:t.handleToDraft}},[t._v("转草稿")]),a("span",{class:t.cls.tableHeadPicker},[a("SckmTextButton",[t._v("有效期修改")]),a("el-date-picker",{class:t.cls.tableHeadDatePicker,attrs:{"picker-options":{disabledDate:function(t){return t<new Date}},type:"datetime"},on:{change:t.handleDateChange},model:{value:t.datePickerValue,callback:function(e){t.datePickerValue=e},expression:"datePickerValue"}})],1),t.canTop?a("SckmTextButton",{on:{click:t.handleSetTop}},[t._v(t._s(t.selectedData[0].isTop?"取消置顶":"置顶"))]):t._e(),t.userType<3?a("SckmTextButton",{attrs:{disabled:!t.canEdit},on:{click:t.handleRemind}},[t._v("提醒更新")]):t._e(),a("SckmTextButton",{attrs:{disabled:!t.canEdit},on:{click:t.handleEdit}},[t._v("编辑")]),a("SckmTextButton",{attrs:{type:"danger"},on:{click:t.handleDelete}},[t._v("删除")])],1)],2)},s=[],r=(a("a15b"),a("d81d"),a("5012")),d=a.n(r),u={mixins:[window.sckm.manageTabMixin],data:function(){return{cls:d.a,datePickerValue:"",columns:[{title:"室编档号",key:"eItemNo"},{title:"全文名称",key:"itemFullName",minWidth:170},{title:"页数",key:"pages"},{title:"密级",key:"securityClassification"}]}},methods:{handleAdd:function(){this.$emit("on-edit")},handleImport:function(){this.$emit("on-import")},handleExport:function(){var t=this;Object(l["i"])({fileName:"知识库数据导出.xls",action:function(){return t.$http("/sckm/item/export?itemIds=".concat(t.selectedData.map((function(t){return t.itemId})).join(",")),{responseType:"blob"})}})},handleExportAll:function(){this.$emit("on-exportall")},handleToDraft:function(){this.toDraftOrPublish({title:"转至草稿",content:"确定要将所选的".concat(this.selectedData.length,"条知识转到草稿吗？"),isDraft:0})},handleDateChange:function(t){var e=this;t&&this.$post("/sckm/item/update/invalid",{invalidTime:+t,userType:this.userType,itemIds:this.selectedData.map((function(t){return t.itemId})).join(",")}).then((function(t){var a=t.data;e.$message(a),e.$emit("on-change")}))},handleSetTop:function(){var t=this,e=this.selectedData[0],a=e.itemId,n=e.categoryId,i=e.isTop;this.$post("/sckm/item/isTop",{isTop:+!i,itemId:a,categoryId:n}).then((function(){return t.$emit("on-change")}))},handleRemind:function(){var t=this;this.$post("/sckm/item/message/remind",{itemId:this.selectedData[0].itemId}).then((function(){return t.$message("已提醒更新")}))}}},h=u,m=a("2877"),p=Object(m["a"])(h,c,s,!1,null,null,null),f=p.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SckmDataTable",t._b({on:{"on-change":t.handleChange,"on-selection-change":t.handleSelectionChange}},"SckmDataTable",t.bindProps,!1),[a("template",{slot:"toolbar"},[a("SckmTextButton",{attrs:{noBorder:""},on:{click:t.handlePublish}},[t._v("发布")]),a("SckmTextButton",{attrs:{disabled:!t.canEdit},on:{click:t.handleEdit}},[t._v("编辑")]),a("SckmTextButton",{attrs:{type:"danger"},on:{click:t.handleDelete}},[t._v("删除")])],1)],2)},D=[],g={mixins:[window.sckm.manageTabMixin],data:function(){return{columns:[{title:"室编档号",key:"fileNo"},{title:"题名",key:"fileTitle",minWidth:170},{title:"保存期限",key:"validYears"},{title:"页数",key:"pages"},{title:"密级",key:"securityClassification"}]}},methods:{handlePublish:function(){this.toDraftOrPublish({title:"发布知识",content:"确定要发布所选的".concat(this.selectedData.length,"条知识吗？"),isDraft:1})}}},k=g,T=Object(m["a"])(k,b,D,!1,null,null,null),y=T.exports,v={components:{ComManage:f,ComDraftbox:y},data:function(){return{itemType:"0",selectedNodeData:null,tableData:{0:this.getInitData(),1:this.getInitData(),2:this.getInitData()},loading:!1,treeData:[]}},computed:{title:function(){return this.selectedNodeData?this.selectedNodeData.name:"知识库"},currentData:function(){return this.tableData[this.itemType]},userType:function(){return this.$store.getters.isAdmin?"1":this.$store.state.permissions.indexOf("kbm")>-1?"2":"3"}},watch:{selectedNodeData:function(){this.getData({pageNum:1})}},activated:function(){this.getData({pageNum:1})},mounted:function(){this.getTreeData()},methods:{getTreeData:function(){var t=this;return this.$http("/collect/tree/list").then((function(t){var e=t.data;return[{title:"全宗",name:"全宗",expand:!0,id:"-1",children:Object(l["y"])(e,{parentId:"pId"})}]})).then((function(e){t.treeData=e,t.selectedNodeData=e[0]}))},getInitData:function(){return{data:[],total:0,params:{pageNum:1,pageSize:10}}},handleEdit:function(t){var e=this,n={row:t?{itemId:t}:null,category:this.selectedNodeData||{}};this.$openModal((function(){return a.e("chunk-5d15c5c4").then(a.bind(null,"c29c"))}),n,{success:function(){return e.getData()}})},handleImport:function(){var t=this,e={category:this.selectedNodeData||{}};this.$openModal((function(){return a.e("chunk-3b197492").then(a.bind(null,"8d62"))}),e,{success:function(){return t.getData({pageNum:1})}})},handleExportAll:function(){var t=this;Object(l["i"])({fileName:"知识库全部数据导出.xls",action:function(){return t.$http("/sckm/item/batchExport?categoryId=".concat(t.selectedNodeData.id,"&userType=").concat(t.userType),{responseType:"blob"})}})},clearSelectedData:function(){var t=this.$refs,e=t.Manage,a=t.Draftbox,n=t.Recycle;({0:e,1:a,2:n})[this.itemType].clearSelectedData()},getData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0,this.clearSelectedData(),this.currentData.params=Object(o["a"])(Object(o["a"])({},this.currentData.params),e),this.$http("/sys/file/list",{params:Object(o["a"])(Object(o["a"])({},this.currentData.params),{},{itemType:this.itemType,userType:this.userType,categoryId:this.selectedNodeData&&this.selectedNodeData.id})}).then((function(e){var a=e.data;t.$set(t.currentData,"data",a.list),t.$set(t.currentData,"total",a.total)})).finally((function(){t.loading=!1}))}}},x=v,_=(a("aa36"),Object(m["a"])(x,n,i,!1,null,null,null));e["default"]=_.exports},"8af1":function(t,e,a){},aa36:function(t,e,a){"use strict";a("8af1")}}]);