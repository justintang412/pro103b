(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c153ac08"],{"4bd2":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ui-modal",e._g(e._b({ref:"Modal",scopedSlots:e._u([{key:"footer",fn:function(){return[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")]),r("el-button",{on:{click:e.onCancel}},[e._v("取消")]),r("el-button",{on:{click:function(t){return e.onReset()}}},[e._v("清空")])]},proxy:!0}])},"ui-modal",e.modalProps,!1),e.$listeners),[r("el-form",{ref:"Form",attrs:{"label-width":"7em",model:e.form,rules:e.rules}},[r("h4",{staticClass:"form-header"},[e._v("工单内容")]),r("el-form-item",{attrs:{label:"工单分类",prop:"typeId"}},[r("el-cascader",{attrs:{options:e.types,filterable:""},on:{change:function(t){return e.getTemplates(e.form.typeId?e.form.typeId[e.form.typeId.length-1]:"")}},model:{value:e.form.typeId,callback:function(t){e.$set(e.form,"typeId",t)},expression:"form.typeId"}})],1),r("ui-text-field",{attrs:{label:"工单标题",prop:"name",placeholder:"最多输入100个字符"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),r("el-form-item",{attrs:{label:"问题描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:"10"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}}),r("com-upload",{attrs:{fileList:e.form.orderFiles}})],1),r("h4",{staticClass:"form-header"},[e._v("工单描述")]),r("el-form-item",{attrs:{label:"相关客户",prop:"customerId"}},[e.isDisable?r("span",[e._v(e._s(e.getCustomerName(e.form.customerId)))]):r("div",[r("el-select",{attrs:{filterable:""},model:{value:e.form.customerId,callback:function(t){e.$set(e.form,"customerId",t)},expression:"form.customerId"}},e._l(e.customerList,(function(e){return r("el-option",{key:e.customerId,attrs:{value:e.customerId,label:e.customerNickname}})})),1),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(t){return e.onAddCustomer()}}},[e._v("新建客户")]),r("el-button",{attrs:{type:"text"},on:{click:e.onPreciseSearch}},[e._v("精准查找")])],1)]),r("ui-select",{attrs:{label:"优先级",options:e.priorities},model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}}),r("ui-select",{attrs:{label:"工单状态",options:e.WO_STATES},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}}),r("ui-select",{attrs:{label:"受理客服组",options:e.skillGroups,props:{value:"id",label:"name"},clearable:""},on:{change:e.changeSgroup},model:{value:e.form.sgroupId,callback:function(t){e.$set(e.form,"sgroupId",t)},expression:"form.sgroupId"}}),r("ui-select",{attrs:{label:"受理客服",options:e.agents,props:{value:"userId",label:"name"},clearable:""},model:{value:e.form.acceptorId,callback:function(t){e.$set(e.form,"acceptorId",t)},expression:"form.acceptorId"}}),e._l(e.form.templates,(function(t,o){return r("el-form-item",{key:t.id,attrs:{label:t.name,prop:"templates."+o+".orderFieldValue",rules:{required:t.flag,message:t.name+"不能为空",trigger:t.type>1?null:"blur"}}},[0==t.type?r("el-input",{attrs:{placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}}):e._e(),1==t.type?r("el-input",{attrs:{type:"textarea",rows:"10",placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}}):e._e(),2==t.type?r("el-radio-group",{model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(e){return r("el-radio",{key:e.id,attrs:{label:e.content}})})),1):e._e(),3==t.type?r("el-checkbox-group",{model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.content}},[e._v(e._s(t.content))])})),1):e._e(),4==t.type?r("el-select",{attrs:{clearable:"",placeholder:t.description},model:{value:t.orderFieldValue,callback:function(r){e.$set(t,"orderFieldValue",r)},expression:"item.orderFieldValue"}},e._l(t.orderFieldDataLists,(function(e){return r("el-option",{key:e.id,attrs:{label:e.content,value:e.content}})})),1):e._e()],1)}))],2)],1)},i=[],n=r("5530"),s=r("1da1"),a=(r("96cf"),r("d81d"),r("b0c0"),r("a15b"),r("7db0"),r("d3b7"),r("a4d3"),r("e01a"),r("ac1f"),r("1276"),r("fb6a"),r("e9c4"),r("3ca3"),r("ddb0"),r("159b"),r("a02a")),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-upload",{attrs:{action:"",multiple:"",limit:10,"file-list":e.fileList,"on-remove":e.onFileRemove,"on-error":e.onFileError,"on-exceed":e.onFileExceed,"http-request":e.onFileUpload}},[r("el-link",{attrs:{type:"primary",icon:"el-icon-paperclip",underline:!1}},[e._v("上传附件")]),r("span",{staticClass:"el-upload__tip",staticStyle:{"margin-left":"5px"},attrs:{slot:"tip"},slot:"tip"},[e._v("(最多上传10个附件，单个文件最大20M)")])],1)},c=[],u=(r("c740"),r("a434"),r("99af"),{props:{fileList:{type:Array,default:function(){return[]}}},methods:{onFileRemove:function(e){var t=this.fileList;this.$post("/workOrder/remove",{fileName:e.fileName}).then((function(r){r.data;var o=t.findIndex((function(t){return t.fileName===e.response}));t.splice(o,1)}))},onFileExceed:function(e,t){this.$message.warning("当前限制选择 10个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},onFileUpload:function(e){var t=this,r=e.file,o=new FormData;return o.append("file",r),this.$http.post("/workOrder/upload",o).then((function(e){var r=e.data;return t.fileList.push({name:r.split("_").slice(1).join("_"),fileName:r}),r}))},onFileError:function(e){this.$message.error(e.message)},getFileName:function(e){return e.split("_").slice(1).join("_")}}}),d=u,p=r("2877"),m=Object(p["a"])(d,l,c,!1,null,null,null),f=m.exports,h=r("fffc"),b={components:{ComUpload:f},props:["row","customerInfo"],data:function(){var e=this;return{priorities:h["o"],WO_STATES:h["e"],types:[],rules:{typeId:Object(a["z"])("请选择工单分类"),name:Object(a["y"])("请输入工单标题"),description:Object(a["y"])("请输入问题描述"),customerId:Object(a["z"])("请选择关联客户")},skillGroups:[],agents:[],classificationData:[],customerList:[],customizeFields:[],isDisable:!1,form:{templates:[]},modalProps:{drawer:!0,width:"600px",isEdit:!!this.row,onSubmit:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.Form.validate();case 2:return r=e.form,o=r.templates.map((function(e){return{orderFieldId:e.id,orderFieldName:e.name,orderFieldValue:3===e.type?e.orderFieldValue.join(","):e.orderFieldValue}})),t.next=6,e.$http.post("/workOrder/saveOrUpdate",Object(n["a"])(Object(n["a"])({},r),{},{fieldValues:o,channelId:r.channelId||1,typeId:r.typeId[r.typeId.length-1]}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));function r(){return t.apply(this,arguments)}return r}()}}},mounted:function(){var e=this.row,t=this.customerInfo;this.onReset(e),this.getTypes(e),this.onCustomerList(),this.form=Object(n["a"])(Object(n["a"])({},this.form),{},{templates:[]}),this.getSkillGroups(),e&&e.sgroupId&&this.getAgents(e.sgroupId),t&&t.customerId?(this.isDisable=!0,this.$set(this.form,"customerId",t.customerId),this.$set(this.form,"channelId",t.channelId),2===t.channelId&&this.$set(this.form,"agentServiceId",t.agentserviceid)):this.isDisable=!1},methods:{onSubmit:function(){this.$refs.Modal.submit()},onCancel:function(){this.$refs.Modal.show(!1)},getTemplates:function(e,t){var r=this;if(e){var o=this.classificationData.find((function(t){return t.id===e}));e=o&&o.templateId}e&&(this.form.templateId=e,this.$http("/orderTemplate/listByPage?id=".concat(e)).then((function(e){var o=e.data;o.length?(r.$set(r.form,"description",o[0].description),o=o[0].filedList,r.form.templates=o.map((function(e,r){return e.orderFieldValue=t&&t.length&&t[r].orderFieldValue||"",t&&t.length&&t[r].orderFieldValue?e.orderFieldValue=3===+e.type?t[r].orderFieldValue.split(","):t[r].orderFieldValue:e.orderFieldValue=3===+e.type?[]:"",e}))):r.form.templates=[]})))},getCustomerName:function(e){var t=this.customerList.find((function(t){return t.customerId===e}));return t?t.customerNickname:""},getSkillGroups:function(){var e=this;this.$http("/orderGroup/listGroup").then((function(t){var r=t.data;e.skillGroups=r}))},getTypes:function(e){var t=this;this.$http("/orderType/listByPage").then((function(r){var o=r.data;t.classificationData=o,t.types=Object(a["F"])(o.map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{value:e.id,label:e.name})}))),e&&t.getTemplates(e.typeId,e.fieldValues)}))},changeSgroup:function(e){this.$set(this.form,"acceptorId",void 0),this.getAgents(e)},getAgents:function(e){var t=this;this.agents=[],this.$post("/orderGroup/listByGroup",{groupId:e}).then((function(e){var r=e.data;t.agents=r}))},getFileName:function(e){return e.split("_").slice(1).join("_")},onReset:function(e){var t=this;this.form=e?Object(n["a"])(Object(n["a"])({},JSON.parse(JSON.stringify(e))),{},{orderFiles:e.orderFiles?e.orderFiles.map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{name:t.getFileName(e.fileName)})})):[]}):{orderFiles:[],priority:h["o"][0].value,status:h["e"][0].value,channelId:1}},onAddCustomer:function(){var e=this;this.$openModal((function(){return Promise.all([r.e("chunk-4e8d5934"),r.e("chunk-1438376a")]).then(r.bind(null,"6d7f"))}),{},{success:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r,o){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.onCustomerList();case 2:e.$set(e.form,"customerId",o.customerId);case 3:case"end":return t.stop()}}),t)})));function r(e,r){return t.apply(this,arguments)}return r}()})},onCustomerList:function(){var e=this;return this.$http("/ccas/cc/customer/list",{params:{isBlackList:0}}).then((function(t){var r=t.data;e.customerList=r}))},onPreciseSearch:function(){var e=this;this.$openModal((function(){return r.e("chunk-2d2259e5").then(r.bind(null,"e4bb"))}),{customerList:this.customerList},{success:function(t,r){return e.$set(e.form,"customerId",r)}})},onKeyChange:function(){var e=this;this.options.forEach((function(t){e.$set(e.searchForm,t[0],void 0)}))}}},v=b,g=(r("6af4"),Object(p["a"])(v,o,i,!1,null,"6d48bf67",null));t["default"]=g.exports},"61d1":function(e,t,r){},"6af4":function(e,t,r){"use strict";r("61d1")}}]);