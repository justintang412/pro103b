(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b2bba242"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"15cb":function(e,t,r){},2959:function(e,t,r){"use strict";r("caa5")},"3ab9":function(e,t,r){},"60e6":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"statistical-information"},[r("el-form",{staticClass:"search-form",attrs:{inline:""}},[r("el-form-item",{attrs:{label:"创建时间"}},[r("ui-date-range-picker",{attrs:{clearable:!1},on:{change:e.onTimeChange},model:{value:e.timerange,callback:function(t){e.timerange=t},expression:"timerange"}})],1),r("el-form-item",{attrs:{label:"工单分类"}},[r("el-cascader",{attrs:{options:e.typeList,filterable:"",clearable:""},on:{change:e.onSearch},model:{value:e.sortTypes,callback:function(t){e.sortTypes=t},expression:"sortTypes"}})],1),r("ui-select",{attrs:{label:"创建渠道",multiple:"",clearable:""},on:{change:e.onSearch},model:{value:e.searchForm.channelIds,callback:function(t){e.$set(e.searchForm,"channelIds",t)},expression:"searchForm.channelIds"}},[r("el-option",{attrs:{label:"工单中心",value:"1"}}),r("el-option",{attrs:{label:"在线客服",value:"2"}})],1),r("ui-select",{attrs:{label:"受理客服组",options:e.orderGroups,props:{value:"id",label:"name"},multiple:"",filterable:"",clearable:"","collapse-tags":""},on:{change:e.changeSgroup},model:{value:e.searchForm.sGroupIds,callback:function(t){e.$set(e.searchForm,"sGroupIds",t)},expression:"searchForm.sGroupIds"}}),r("ui-select",{attrs:{label:"受理客服",options:e.csList,props:{value:"userId",label:"userName"},multiple:"",filterable:"",clearable:"","collapse-tags":""},on:{change:e.onSearch},model:{value:e.searchForm.acceptorIds,callback:function(t){e.$set(e.searchForm,"acceptorIds",t)},expression:"searchForm.acceptorIds"}}),r("ui-select",{attrs:{label:"创建客服组",options:e.orderGroups,props:{value:"id",label:"name"},multiple:"",filterable:"",clearable:"","collapse-tags":""},on:{change:e.onSearch},model:{value:e.searchForm.cGroupIds,callback:function(t){e.$set(e.searchForm,"cGroupIds",t)},expression:"searchForm.cGroupIds"}}),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search"},on:{click:e.onSearch}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.onReset}},[e._v("重置")])],1)],1),r("div",{staticClass:"statistics"},[r("h4",{staticClass:"sub-title"},[e._v("数据概览")]),r("com-overview",{attrs:{data:e.statistics}})],1),r("div",{staticClass:"work-list"},[r("h4",{staticClass:"sub-title"},[e._v("工单列表")]),r("com-work-list",{ref:"ComWorkList"})],1),r("div",{staticClass:"flex-box"},[r("div",{staticClass:"flex-left"},[r("h4",{staticClass:"sub-title"},[e._v("支持渠道")]),r("com-columnar",{ref:"ComColumnar",attrs:{"get-channel":e.getCreatedChannel}})],1),r("div",{staticClass:"flex-right"},[r("div",{staticClass:"flex-item"},[r("h4",{staticClass:"sub-title"},[e._v("工单首次响应时长（小时）")]),r("com-doughnut",{ref:"responseTime",attrs:{"get-doughnut":e.getResponseTime}})],1),r("div",{staticClass:"flex-item"},[r("h4",{staticClass:"sub-title"},[e._v("工单解决时长（小时）")]),r("com-doughnut",{ref:"resolveTime",attrs:{"get-doughnut":e.getResolveTime}})],1)])])],1)},a=[],s=r("3835"),i=r("1da1"),o=r("2909"),c=r("5530"),u=(r("96cf"),r("d81d"),r("b0c0"),r("ac1f"),r("841c"),r("b64b"),r("d3b7"),r("99af"),r("a02a")),l=r("4242"),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",{staticClass:"container"},e._l(e.items,(function(t){return r("li",{key:t.label,staticClass:"list"},[r("h4",[e._v(" "+e._s(t.label)+" "),r("el-tooltip",{attrs:{content:t.desc,placement:"top"}},[r("i",{staticClass:"el-icon-question"})])],1),r("div",{staticClass:"value"},[e._v(e._s(e.data[t.prop]||0))])])})),0)},d=[],h={props:["data"],data:function(){return{items:[{label:"工单创建数",prop:"countCreated",desc:"在当前筛选时间段内工单的创建数量"},{label:"客服已解决",prop:"countResolvedByAcceptor",desc:"工单状态由人工客服手动更改的数量"},{label:"客服已关闭",prop:"countClosedByAcceptor",desc:"工单状态由人工客服手动更改的数量"},{label:"尚未受理",prop:"countUnAccept",desc:"工单状态为尚未受理的数量"},{label:"受理中",prop:"countAccept",desc:"工单状态为受理中的数量"},{label:"等待回复",prop:"countForReply",desc:"工单状态为等待回复的数量"},{label:"未解决",prop:"countUnResolve",desc:"工单状态为尚未受理、受理中、等待回复的总和"},{label:"平均首次响应时长",prop:"averageFirstResponseTime",desc:"首次响应时长总和/首次响应工单数,首次响应工单数为经过处理的工单数量,首次响应工单数为经过处理的工单数量"},{label:"客服平均解决时长",prop:"averageResolveTime",desc:"客服手动选择已解决或已关闭的工单,解决时长总和/已解决的工单数,解决时长总和：（首次解决时间-创建时间）求和"}]}}},m=h,f=(r("b05b"),r("2877")),b=Object(f["a"])(m,p,d,!1,null,"7c6ca76a",null),v=b.exports,g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ui-table-view",e._g(e._b({scopedSlots:e._u([{key:"actions",fn:function(){return[r("el-select",{attrs:{clearable:""},on:{change:e.onSearch},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},e._l(e.states,(function(t){return r("el-option",e._b({key:t.value},"el-option",t,!1))})),1)]},proxy:!0}])},"ui-table-view",e.viewProps,!1),e.viewListeners))},C=[],T=r("fffc"),I={mixins:[window.mixTableView],data:function(){return{states:T["e"],columns:[{label:"工单编号",prop:"number",minWidth:140},{label:"工单标题",prop:"name",minWidth:100},{label:"创建渠道",minWidth:120,render:function(e,t){var r=t.row;return e("span",1===+r.channelId?"工单中心":"在线客服")}},{label:"工单状态",minWidth:80,render:function(e,t){var r=t.row;return e("span",Object(T["j"])(r.status))}},{label:"受理客服组",prop:"sGroupName",minWidth:120},{label:"受理客服",prop:"acceptor",minWidth:120},{label:"操作",width:100,fixed:"right",render:this.$hBtns({label:"详情",action:this.onDetail})}]}},methods:{fetchMethod:function(e){return this.$http("/orderStatistics/getWorkOrder",{params:e}).then((function(e){return e.data}))},search:function(e){this.searchForm=Object(c["a"])({},e),this.onSearch()},onDetail:function(e){this.$router.push({name:"workorder-detail",params:{id:e.id}})}}},O=I,w=Object(f["a"])(O,g,C,!1,null,null,null),y=w.exports,x=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-wrap"})},j=[],k=r("565a"),E={data:function(){return{chart:null}},props:{getDoughnut:{type:Function,required:!0}},mounted:function(){var e=this,t=k["a"].init(this.$el);this.chart=t;var r=function(){return t.resize()};window.addEventListener("resize",r),this.$once("hook:beforeDestroy",(function(){e.chart.dispose(),e.chart=null,window.removeEventListener("resize",r)}))},methods:{create:function(e){var t=this;this.getDoughnut(e).then((function(e){var r=e.map((function(e){return e.name})),n={tooltip:{trigger:"item",formatter:"{b}<br/> 数量：{c}<br/>百分比：{d}%"},legend:{data:r},series:[{type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold"}},labelLine:{show:!1},data:e}]};t.chart.setOption(n),t.chart.resize()}))}}},F=E,$=(r("99da"),Object(f["a"])(F,x,j,!1,null,"c4b24bb4",null)),_=$.exports,S=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chart-wrap"})},R=[],D={data:function(){return{chart:null}},props:{getChannel:{type:Function,required:!0}},mounted:function(){var e=k["a"].init(this.$el);this.chart=e;var t=function(){return e.resize()};window.addEventListener("resize",t),this.$once("hook:beforeDestroy",(function(){e.dispose(),e=null,window.removeEventListener("resize",t)}))},methods:{create:function(e){var t=this;this.getChannel(e).then((function(e){var r={color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},yAxis:[{type:"value"}],xAxis:[{type:"category",data:e.XValue}],series:[{name:"工单数量",type:"bar",barWidth:"20%",data:e.serieData}]};t.chart.setOption(r),t.chart.resize()}))}}},G=D,W=(r("2959"),Object(f["a"])(G,S,R,!1,null,"568c8a36",null)),L=W.exports,A={name:"StatisticsWorkorderOverview",components:{ComOverview:v,ComWorkList:y,ComDoughnut:_,ComColumnar:L},data:function(){return{types:[],orderGroups:[],searchForm:{},sortTypes:[],csList:[],statistics:[],timerange:[]}},computed:{typeList:function(){return Object(u["F"])(this.types.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{value:e.id,label:e.name})})))}},mounted:function(){var e=this;this.setInitForm();var t=function(){e.getTypes(),e.getOrderGroups(),e.getCsList(e.searchForm.sGroupIds),e.onSearch()};t(),Object(u["g"])(this,t)},methods:{setInitForm:function(){var e=this.$adminCore.formatDate(new Date,"yyyy-MM-dd");this.timerange=[e,e],this.sortTypes=[],this.searchForm={beginTime:e,endTime:e}},onSearch:function(){var e=Object(c["a"])(Object(c["a"])({},this.searchForm),{},{sortTypes:Object(o["a"])(this.sortTypes||[]).pop()||void 0,channelIds:Object(l["a"])(this.searchForm.channelIds),sGroupIds:Object(l["a"])(this.searchForm.sGroupIds),acceptorIds:Object(l["a"])(this.searchForm.acceptorIds),cGroupIds:Object(l["a"])(this.searchForm.cGroupIds)});this.getStatistics(e),this.onWorkSearch(e),this.$refs.responseTime.create(e),this.$refs.resolveTime.create(e),this.$refs.ComColumnar.create(e)},onReset:function(){this.setInitForm(),this.getCsList(),this.onSearch()},onWorkSearch:function(e){this.$refs.ComWorkList.search(e)},changeSgroup:function(e){this.$set(this.searchForm,"acceptorIds",[]),this.onSearch(),this.getCsList(e)},getOrderGroups:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderGroup/listGroup");case 2:e.orderGroups=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getTypes:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderType/listByPage");case 2:e.types=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getCsList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$post("/orderGroup/getUserIdByGroups",{groupIds:Object(l["a"])(e)});case 2:t.csList=r.sent.data;case 3:case"end":return r.stop()}}),r)})))()},onTimeChange:function(e){var t=e||[],r=Object(s["a"])(t,2),n=r[0],a=r[1];this.searchForm=Object(c["a"])(Object(c["a"])({},this.searchForm),{},{beginTime:n,endTime:a}),this.onSearch()},getStatistics:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http("/orderStatistics/getStatistics",{params:e});case 2:t.statistics=r.sent.data;case 3:case"end":return r.stop()}}),r)})))()},getResponseTime:function(e){return this.$http("/orderStatistics/countResponseTime",{params:e}).then((function(e){var t=e.data;return t.map((function(e){var t=Object.keys(e)[0];return{name:"".concat(t,"小时"),value:e[t]}}))}))},getResolveTime:function(e){return this.$http("/orderStatistics/countResolveTime",{params:e}).then((function(e){var t=e.data;return t.map((function(e){var t=Object.keys(e)[0];return{name:"".concat(t,"小时"),value:e[t]}}))}))},getCreatedChannel:function(e){return this.$http("/orderStatistics/countCreatedChannel",{params:e}).then((function(e){var t=e.data;return t.reduce((function(e,t){return Object(c["a"])(Object(c["a"])({},e),{},{serieData:[].concat(Object(o["a"])(e.serieData),[t.total]),XValue:[].concat(Object(o["a"])(e.XValue),[1===+t.channelId?"工单中心":"在线客服"])})}),{serieData:[],XValue:[],isCross:!0})}))}}},N=A,P=(r("615a"),Object(f["a"])(N,n,a,!1,null,"0cfd4716",null));t["default"]=P.exports},"615a":function(e,t,r){"use strict";r("3ab9")},"6e58":function(e,t,r){},"841c":function(e,t,r){"use strict";var n=r("c65b"),a=r("d784"),s=r("825a"),i=r("1d80"),o=r("129f"),c=r("577e"),u=r("dc4a"),l=r("14c3");a("search",(function(e,t,r){return[function(t){var r=i(this),a=void 0==t?void 0:u(t,e);return a?n(a,t,r):new RegExp(t)[e](c(r))},function(e){var n=s(this),a=c(e),i=r(t,n,a);if(i.done)return i.value;var u=n.lastIndex;o(u,0)||(n.lastIndex=0);var p=l(n,a);return o(n.lastIndex,u)||(n.lastIndex=u),null===p?-1:p.index}]}))},"99da":function(e,t,r){"use strict";r("15cb")},b05b:function(e,t,r){"use strict";r("6e58")},caa5:function(e,t,r){},fffc:function(e,t,r){"use strict";r.d(t,"n",(function(){return c})),r.d(t,"a",(function(){return m})),r.d(t,"f",(function(){return f})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"b",(function(){return g})),r.d(t,"j",(function(){return C})),r.d(t,"c",(function(){return T})),r.d(t,"o",(function(){return I})),r.d(t,"i",(function(){return O})),r.d(t,"h",(function(){return y})),r.d(t,"l",(function(){return x})),r.d(t,"k",(function(){return j})),r.d(t,"g",(function(){return k})),r.d(t,"m",(function(){return E}));var n=r("1da1"),a=r("2909"),s=r("5530"),i=r("ade3"),o=(r("96cf"),r("7db0"),r("d3b7"),r("b0c0"),r("a15b"),r("99af"),r("d81d"),r("4de4"),r("b64b"),r("caad"),r("2532"),r("3ca3"),r("ddb0"),r("159b"),r("a02a")),c="workorder",u={label:"尚未受理",value:0},l={label:"受理中",value:1},p={label:"等待回复",value:2},d={label:"已解决",value:3},h={label:"已关闭",value:4},m=[5,"已删除"],f=[u,l,p],b=[d,h],v=[u,l,p,d,h],g=[l,d,h],C=function(e){return(v.find((function(t){return t.value===e}))||{}).label},T=[[0,"我来受理工单","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很高兴为您服务！\n  我们已将您的请求生成工单 {TICKET_CODE} - {TICKET_TITLE}。该工单正在进行处理，一旦有任何更新我们会及时给您回复，请您耐心等待。"],[1,"尝试联系用户","您好，我是 {COMPANY_NAME} 的客服代表 {SERVICE_NICK} ，很抱歉在您百忙之中打扰您。\n  关于您的工单 {TICKET_CODE} - {TICKET_TITLE} ，我们希望确认您是否还存在其他疑问。鉴于还没有收到您的回复，我们会继续尝试联系您。如果您有任何进展或者其他疑问，可随时在系统中进行回复，感谢您的理解与支持。"],[2,"客服处理完毕，请用户确认","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 已完成处理，请在回复中进行确认。\n  希望我们的工作能使您满意，如您有任何建议或意见，欢迎回复告知我们，我们会努力改进。"],[3,"用户没有回复工单","您好，您的工单 {TICKET_CODE} - {TICKET_TITLE} 用户超时未回复，置为已解决。"]],I=[{label:"低",value:0},{label:"中",value:1},{label:"高",value:2},{label:"紧急",value:3}],O=function(e){return(I.find((function(t){return t.value===e}))||{}).label},w={INPUT:0,TEXTAREA:1,RADIO:2,CHECKBOX:3,SELECT:4},y=function(e){var t;return t={},Object(i["a"])(t,e.INPUT,"单行文本框"),Object(i["a"])(t,e.TEXTAREA,"多行文本框"),Object(i["a"])(t,e.RADIO,"单选框"),Object(i["a"])(t,e.CHECKBOX,"复选框"),Object(i["a"])(t,e.SELECT,"下拉框"),t}(w),x=function(e){return!Object(o["v"])(e)&&e>1},j=function(e,t){var r=[],n=e.find((function(e){return e.id===t}));while(n)r.unshift(n.name),n=e.find((function(e){return e.id===n.parentId}));return r.join(" / ")},k=function(){return{label:"工单标题",prop:"name",minWidth:120,render:function(e,t){var r=t.row;return 1===r.flag&&new Date-new Date(r.lastUrgeTime)<864e5?e("span",[e("span",{style:"color:#E59208;border:1px solid #E59208;padding:2px;margin-right:5px"},"催"),e("span",r.name)]):e("span",r.name)}}},E={data:function(){var e=this,t=["number","name","channelId","status","sgroupName","acceptor","typeId","createTime"];return{priorities:I,types:[],skillGroups:[],states:v,allColumns:{base:{title:"基础字段",data:[{label:"工单编号",prop:"number",minWidth:140},k(),{label:"创建渠道",prop:"channelId",minWidth:80,render:function(e,t){var r=t.row;return e("span",1===r.channelId?"工单中心":"在线客服")}},{label:"工单描述",prop:"description",minWidth:120},{label:"工单状态",prop:"status",minWidth:80,render:function(e,t){var r=t.row;return e("span",C(r.status)||"已删除")}},{label:"优先级",prop:"priority",minWidth:80,render:function(e,t){var r=t.row;return e("span",O(r.priority))}},{label:"创建人",prop:"cuserName"},{label:"创建客服组",prop:"cgroupName",minWidth:120},{label:"受理客服组",prop:"sgroupName",minWidth:120},{label:"受理客服",prop:"acceptor"},{label:"分类",prop:"typeId",minWidth:140,render:function(t,r){var n=r.row;return t("span",e.getTypeText(n.typeId))}},{label:"创建时间",prop:"createTime",minWidth:140},{label:"首次响应时间",prop:"firstUpdateTime",minWidth:140},{label:"首次受理时间",prop:"firstAcceptTime",minWidth:140},{label:"更新时间",prop:"modifyTime",minWidth:140},{label:"首次解决时间",prop:"firstSolveTime",minWidth:140},{label:"最后回复人",prop:"lastReplingPersonName"}]},customer:{title:"客户字段",data:[{label:"客户昵称",prop:"customerNickName"},{label:"客户姓名",prop:"customerName"}]}},defaultProps:t,selectedProps:[].concat(t)}},computed:{typeList:function(){return Object(o["F"])(this.types.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{value:e.id,label:e.name})})))},showedColumns:function(){var e=this;return[{type:"selection"}].concat(Object(a["a"])(Object.keys(this.allColumns).reduce((function(t,r){return[].concat(Object(a["a"])(t),Object(a["a"])(e.allColumns[r].data))}),[]).filter((function(t){return e.selectedProps.includes(t.prop)}))))},typeId:function(){var e=this.searchForm.typeId;return e&&e.length?e[e.length-1]:""}},mounted:function(){this.setInitForm&&this.setInitForm(),this.getInitData(),Object(o["g"])(this,this.getInitData)},methods:{getStateText:C,getInitData:function(){this.isActive?this.getData():(this.onReset(),this.isActive=!0),this.getTypes(),this.getSkillGroups()},onDelete:function(e){var t=this;this.delData({rows:e,action:function(e){return t.$post("/workOrder/delete",{orderId:e.map((function(e){return e.id}))+""})}})},getSkillGroups:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderGroup/listGroup");case 2:e.skillGroups=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getGroupText:function(e){return(this.skillGroups.find((function(t){return t.id===e}))||{}).name},onCreate:function(){this.$openModal((function(){return r.e("chunk-497ef431").then(r.bind(null,"4bd2"))}),{},{success:this.onEditSuccess})},onBatchImport:function(){this.$openModal((function(){return r.e("chunk-2d0da7ad").then(r.bind(null,"6c7a"))}),{typeList:this.typeList},{success:this.onEditSuccess})},onBatchExport:function(e,t){var r=this,n=t.typeId||[],a=n[n.length-1];a?Object(o["i"])({fileName:"工单批量导出数据.xls",action:function(){return r.$post(e,Object(s["a"])(Object(s["a"])({},t),{},{typeId:a}),{responseType:"blob"})}}):this.$message("请先选择分类再导出")},onDetail:function(e){this.$router.push({name:"".concat(c,"-detail"),params:{id:e.id}})},onAccept:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e instanceof Array?e.map((function(e){return e.id}))+"":e.id,r.next=3,t.$post("/workOrder/accept",{orderId:n});case 3:t.$message.success("接单成功"),t.getData();case 5:case"end":return r.stop()}}),r)})))()},getTypes:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http("/orderType/listByPage");case 2:e.types=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},getTypeText:function(e){return j(this.types,e)},onKeyChange:function(){var e=this;this.options.forEach((function(t){e.$set(e.searchForm,t[0],void 0)}))},onCustomField:function(){var e=this;this.$openModal("UiFieldCustom",{columns:this.allColumns,defaultProps:this.defaultProps,selectedProps:this.selectedProps},{success:function(t){e.selectedProps=t}})}}}}}]);